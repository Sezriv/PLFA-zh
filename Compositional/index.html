<!DOCTYPE html>
<html lang="en">
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../public/css/style.css">
  
  <title>编程语言基础：Agda 语言描述 – Compositional</title>
  
  
  
</head>

    <body>
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="../">编程语言基础：Agda 语言描述</a>
        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="../">主页</a>
                <a class="page-link" href="../Announcements/">公告</a>
                <a class="page-link" href="../GettingStarted/">使用说明</a>
                <a class="page-link" href="../Citing/">引用</a>
                <a class="page-link" href="https://plfa.github.io/">English</a>
            </div>
        </nav>
    </div>
</header>

        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                <article class="post">
    <nav class="pager">
    <ul class="pagination">
        
        <li><a class="pagelink" href="../Denotational/">上一章</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/part3/Compositional.lagda.md">源文件</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="../Soundness/">下一章</a></li>
        <li class="separator">&bullet;</li>
        
    </ul>
</nav>

    <header class="post-header">
        <h1 class="post-title" id="compositional">Compositional: The denotational semantics is compositional</h1>
    </header>
    <div class="post-content">
        <pre class="Agda"><a id="183" class="Keyword">module</a> <a id="190" href="../Compositional/" class="Module">plfa.part3.Compositional</a> <a id="215" class="Keyword">where</a>
</pre>
<h2 id="introduction">Introduction</h2>
<p>In this chapter we prove that the denotational semantics is compositional, which means we fill in the ellipses in the following equations.</p>
<pre><code>ℰ (` x) ≃ ...
ℰ (ƛ M) ≃ ... ℰ M ...
ℰ (M · N) ≃ ... ℰ M ... ℰ N ...</code></pre>
<p>Such equations would imply that the denotational semantics could be instead defined as a recursive function. Indeed, we end this chapter with such a definition and prove that it is equivalent to ℰ.</p>
<h2 id="imports">Imports</h2>
<pre class="Agda"><a id="680" class="Keyword">open</a> <a id="685" class="Keyword">import</a> <a id="692" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html" class="Module">Data.Product</a> <a id="705" class="Keyword">using</a> <a id="711" class="Symbol">(</a><a id="712" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">_×_</a><a id="715" class="Symbol">;</a> <a id="717" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#166" class="Record">Σ</a><a id="718" class="Symbol">;</a> <a id="720" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ-syntax</a><a id="728" class="Symbol">;</a> <a id="730" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1369" class="Function">∃</a><a id="731" class="Symbol">;</a> <a id="733" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1788" class="Function">∃-syntax</a><a id="741" class="Symbol">;</a> <a id="743" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a><a id="748" class="Symbol">;</a> <a id="750" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#264" class="Field">proj₂</a><a id="755" class="Symbol">)</a>
  <a id="759" class="Keyword">renaming</a> <a id="768" class="Symbol">(</a><a id="769" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="773" class="Symbol">to</a> <a id="_,_"></a><a id="776" href="../Compositional/#776" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="781" class="Symbol">)</a>
<a id="783" class="Keyword">open</a> <a id="788" class="Keyword">import</a> <a id="795" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.html" class="Module">Data.Sum</a> <a id="804" class="Keyword">using</a> <a id="810" class="Symbol">(</a><a id="811" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#728" class="Datatype Operator">_⊎_</a><a id="814" class="Symbol">;</a> <a id="816" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a><a id="820" class="Symbol">;</a> <a id="822" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a><a id="826" class="Symbol">)</a>
<a id="828" class="Keyword">open</a> <a id="833" class="Keyword">import</a> <a id="840" href="https://agda.github.io/agda-stdlib/v1.3/Data.Unit.html" class="Module">Data.Unit</a> <a id="850" class="Keyword">using</a> <a id="856" class="Symbol">(</a><a id="857" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Unit.html#164" class="Record">⊤</a><a id="858" class="Symbol">;</a> <a id="860" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a><a id="862" class="Symbol">)</a>
<a id="864" class="Keyword">open</a> <a id="869" class="Keyword">import</a> <a id="876" href="../Untyped/" class="Module">plfa.part2.Untyped</a>
  <a id="897" class="Keyword">using</a> <a id="903" class="Symbol">(</a><a id="904" href="../Untyped/#3135" class="Datatype">Context</a><a id="911" class="Symbol">;</a> <a id="913" href="../Untyped/#3173" class="InductiveConstructor Operator">_,_</a><a id="916" class="Symbol">;</a> <a id="918" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="919" class="Symbol">;</a> <a id="921" href="../Untyped/#3503" class="Datatype Operator">_∋_</a><a id="924" class="Symbol">;</a> <a id="926" href="../Untyped/#4276" class="Datatype Operator">_⊢_</a><a id="929" class="Symbol">;</a> <a id="931" href="../Untyped/#4312" class="InductiveConstructor Operator">`_</a><a id="933" class="Symbol">;</a> <a id="935" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ_</a><a id="937" class="Symbol">;</a> <a id="939" href="../Untyped/#4424" class="InductiveConstructor Operator">_·_</a><a id="942" class="Symbol">)</a>
<a id="944" class="Keyword">open</a> <a id="949" class="Keyword">import</a> <a id="956" href="../Denotational/" class="Module">plfa.part3.Denotational</a>
  <a id="982" class="Keyword">using</a> <a id="988" class="Symbol">(</a><a id="989" href="../Denotational/#4067" class="Datatype">Value</a><a id="994" class="Symbol">;</a> <a id="996" href="../Denotational/#4099" class="InductiveConstructor Operator">_↦_</a><a id="999" class="Symbol">;</a> <a id="1001" href="../Denotational/#7361" class="Function Operator">_`,_</a><a id="1005" class="Symbol">;</a> <a id="1007" href="../Denotational/#4129" class="InductiveConstructor Operator">_⊔_</a><a id="1010" class="Symbol">;</a> <a id="1012" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="1013" class="Symbol">;</a> <a id="1015" href="../Denotational/#4424" class="Datatype Operator">_⊑_</a><a id="1018" class="Symbol">;</a> <a id="1020" href="../Denotational/#9262" class="Datatype Operator">_⊢_↓_</a><a id="1025" class="Symbol">;</a>
         <a id="1036" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a><a id="1041" class="Symbol">;</a> <a id="1043" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a><a id="1048" class="Symbol">;</a> <a id="1050" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a><a id="1058" class="Symbol">;</a> <a id="1060" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a><a id="1069" class="Symbol">;</a> <a id="1071" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a><a id="1080" class="Symbol">;</a>
         <a id="1091" href="../Denotational/#4888" class="InductiveConstructor">⊑-dist</a><a id="1097" class="Symbol">;</a> <a id="1099" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="1105" class="Symbol">;</a> <a id="1107" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a><a id="1114" class="Symbol">;</a> <a id="1116" href="../Denotational/#6189" class="Function">⊔↦⊔-dist</a><a id="1124" class="Symbol">;</a>
         <a id="1135" href="../Denotational/#9316" class="InductiveConstructor">var</a><a id="1138" class="Symbol">;</a> <a id="1140" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a><a id="1147" class="Symbol">;</a> <a id="1149" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a><a id="1155" class="Symbol">;</a> <a id="1157" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a><a id="1164" class="Symbol">;</a> <a id="1166" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a><a id="1173" class="Symbol">;</a> <a id="1175" href="../Denotational/#9807" class="InductiveConstructor">sub</a><a id="1178" class="Symbol">;</a>
         <a id="1189" href="../Denotational/#26071" class="Function">up-env</a><a id="1195" class="Symbol">;</a> <a id="1197" href="../Denotational/#17402" class="Function">ℰ</a><a id="1198" class="Symbol">;</a> <a id="1200" href="../Denotational/#17584" class="Function Operator">_≃_</a><a id="1203" class="Symbol">;</a> <a id="1205" href="../Denotational/#17856" class="Function">≃-sym</a><a id="1210" class="Symbol">;</a> <a id="1212" href="../Denotational/#17189" class="Function">Denotation</a><a id="1222" class="Symbol">;</a> <a id="1224" href="../Denotational/#7204" class="Function">Env</a><a id="1227" class="Symbol">)</a>
<a id="1229" class="Keyword">open</a> <a id="1234" href="../Denotational/#18982" class="Module">plfa.part3.Denotational.≃-Reasoning</a>
</pre>
<h2 id="equation-for-lambda-abstraction">Equation for lambda abstraction</h2>
<p>Regarding the first equation</p>
<pre><code>ℰ (ƛ M) ≃ ... ℰ M ...</code></pre>
<p>we need to define a function that maps a <code>Denotation (Γ , ★)</code> to a <code>Denotation Γ</code>. This function, let us name it <code>ℱ</code>, should mimic the non-recursive part of the semantics when applied to a lambda term. In particular, we need to consider the rules <code>↦-intro</code>, <code>⊥-intro</code>, and <code>⊔-intro</code>. So <code>ℱ</code> has three parameters, the denotation <code>D</code> of the subterm <code>M</code>, an environment <code>γ</code>, and a value <code>v</code>. If we define <code>ℱ</code> by recursion on the value <code>v</code>, then it matches up nicely with the three rules <code>↦-intro</code>, <code>⊥-intro</code>, and <code>⊔-intro</code>.</p>
<pre class="Agda"><a id="ℱ"></a><a id="1896" href="../Compositional/#1896" class="Function">ℱ</a> <a id="1898" class="Symbol">:</a> <a id="1900" class="Symbol">∀{</a><a id="1902" href="../Compositional/#1902" class="Bound">Γ</a><a id="1903" class="Symbol">}</a> <a id="1905" class="Symbol">→</a> <a id="1907" href="../Denotational/#17189" class="Function">Denotation</a> <a id="1918" class="Symbol">(</a><a id="1919" href="../Compositional/#1902" class="Bound">Γ</a> <a id="1921" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="1923" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="1924" class="Symbol">)</a> <a id="1926" class="Symbol">→</a> <a id="1928" href="../Denotational/#17189" class="Function">Denotation</a> <a id="1939" href="../Compositional/#1902" class="Bound">Γ</a>
<a id="1941" href="../Compositional/#1896" class="Function">ℱ</a> <a id="1943" href="../Compositional/#1943" class="Bound">D</a> <a id="1945" href="../Compositional/#1945" class="Bound">γ</a> <a id="1947" class="Symbol">(</a><a id="1948" href="../Compositional/#1948" class="Bound">v</a> <a id="1950" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="1952" href="../Compositional/#1952" class="Bound">w</a><a id="1953" class="Symbol">)</a> <a id="1955" class="Symbol">=</a> <a id="1957" href="../Compositional/#1943" class="Bound">D</a> <a id="1959" class="Symbol">(</a><a id="1960" href="../Compositional/#1945" class="Bound">γ</a> <a id="1962" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="1965" href="../Compositional/#1948" class="Bound">v</a><a id="1966" class="Symbol">)</a> <a id="1968" href="../Compositional/#1952" class="Bound">w</a>
<a id="1970" href="../Compositional/#1896" class="Function">ℱ</a> <a id="1972" href="../Compositional/#1972" class="Bound">D</a> <a id="1974" href="../Compositional/#1974" class="Bound">γ</a> <a id="1976" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="1978" class="Symbol">=</a> <a id="1980" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Unit.html#164" class="Record">⊤</a>
<a id="1982" href="../Compositional/#1896" class="Function">ℱ</a> <a id="1984" href="../Compositional/#1984" class="Bound">D</a> <a id="1986" href="../Compositional/#1986" class="Bound">γ</a> <a id="1988" class="Symbol">(</a><a id="1989" href="../Compositional/#1989" class="Bound">u</a> <a id="1991" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="1993" href="../Compositional/#1993" class="Bound">v</a><a id="1994" class="Symbol">)</a> <a id="1996" class="Symbol">=</a> <a id="1998" class="Symbol">(</a><a id="1999" href="../Compositional/#1896" class="Function">ℱ</a> <a id="2001" href="../Compositional/#1984" class="Bound">D</a> <a id="2003" href="../Compositional/#1986" class="Bound">γ</a> <a id="2005" href="../Compositional/#1989" class="Bound">u</a><a id="2006" class="Symbol">)</a> <a id="2008" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="2010" class="Symbol">(</a><a id="2011" href="../Compositional/#1896" class="Function">ℱ</a> <a id="2013" href="../Compositional/#1984" class="Bound">D</a> <a id="2015" href="../Compositional/#1986" class="Bound">γ</a> <a id="2017" href="../Compositional/#1993" class="Bound">v</a><a id="2018" class="Symbol">)</a>
</pre>
<p>If one squints hard enough, the <code>ℱ</code> function starts to look like the <code>curry</code> operation familiar to functional programmers. It turns a function that expects a tuple of length <code>n + 1</code> (the environment <code>Γ , ★</code>) into a function that expects a tuple of length <code>n</code> and returns a function of one parameter.</p>
<p>Using this <code>ℱ</code>, we hope to prove that</p>
<pre><code>ℰ (ƛ N) ≃ ℱ (ℰ N)</code></pre>
<p>The function <code>ℱ</code> is preserved when going from a larger value <code>v</code> to a smaller value <code>u</code>. The proof is a straightforward induction on the derivation of <code>u ⊑ v</code>, using the <code>up-env</code> lemma in the case for the <code>⊑-fun</code> rule.</p>
<pre class="Agda"><a id="sub-ℱ"></a><a id="2612" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2618" class="Symbol">:</a> <a id="2620" class="Symbol">∀{</a><a id="2622" href="../Compositional/#2622" class="Bound">Γ</a><a id="2623" class="Symbol">}{</a><a id="2625" href="../Compositional/#2625" class="Bound">N</a> <a id="2627" class="Symbol">:</a> <a id="2629" href="../Compositional/#2622" class="Bound">Γ</a> <a id="2631" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="2633" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="2635" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="2637" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="2638" class="Symbol">}{</a><a id="2640" href="../Compositional/#2640" class="Bound">γ</a> <a id="2642" href="../Compositional/#2642" class="Bound">v</a> <a id="2644" href="../Compositional/#2644" class="Bound">u</a><a id="2645" class="Symbol">}</a>
  <a id="2649" class="Symbol">→</a> <a id="2651" href="../Compositional/#1896" class="Function">ℱ</a> <a id="2653" class="Symbol">(</a><a id="2654" href="../Denotational/#17402" class="Function">ℰ</a> <a id="2656" href="../Compositional/#2625" class="Bound">N</a><a id="2657" class="Symbol">)</a> <a id="2659" href="../Compositional/#2640" class="Bound">γ</a> <a id="2661" href="../Compositional/#2642" class="Bound">v</a>
  <a id="2665" class="Symbol">→</a> <a id="2667" href="../Compositional/#2644" class="Bound">u</a> <a id="2669" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="2671" href="../Compositional/#2642" class="Bound">v</a>
    <a id="2677" class="Comment">------------</a>
  <a id="2692" class="Symbol">→</a> <a id="2694" href="../Compositional/#1896" class="Function">ℱ</a> <a id="2696" class="Symbol">(</a><a id="2697" href="../Denotational/#17402" class="Function">ℰ</a> <a id="2699" href="../Compositional/#2625" class="Bound">N</a><a id="2700" class="Symbol">)</a> <a id="2702" href="../Compositional/#2640" class="Bound">γ</a> <a id="2704" href="../Compositional/#2644" class="Bound">u</a>
<a id="2706" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2712" href="../Compositional/#2712" class="Bound">d</a> <a id="2714" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a> <a id="2720" class="Symbol">=</a> <a id="2722" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
<a id="2725" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2731" href="../Compositional/#2731" class="Bound">d</a> <a id="2733" class="Symbol">(</a><a id="2734" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="2740" href="../Compositional/#2740" class="Bound">lt</a> <a id="2743" href="../Compositional/#2743" class="Bound">lt′</a><a id="2746" class="Symbol">)</a> <a id="2748" class="Symbol">=</a> <a id="2750" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="2754" class="Symbol">(</a><a id="2755" href="../Denotational/#26071" class="Function">up-env</a> <a id="2762" href="../Compositional/#2731" class="Bound">d</a> <a id="2764" href="../Compositional/#2740" class="Bound">lt</a><a id="2766" class="Symbol">)</a> <a id="2768" href="../Compositional/#2743" class="Bound">lt′</a>
<a id="2772" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2778" href="../Compositional/#2778" class="Bound">d</a> <a id="2780" class="Symbol">(</a><a id="2781" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="2790" href="../Compositional/#2790" class="Bound">lt</a> <a id="2793" href="../Compositional/#2793" class="Bound">lt₁</a><a id="2796" class="Symbol">)</a> <a id="2798" class="Symbol">=</a> <a id="2800" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="2802" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2808" href="../Compositional/#2778" class="Bound">d</a> <a id="2810" href="../Compositional/#2790" class="Bound">lt</a> <a id="2813" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="2815" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2821" href="../Compositional/#2778" class="Bound">d</a> <a id="2823" href="../Compositional/#2793" class="Bound">lt₁</a> <a id="2827" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
<a id="2829" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2835" href="../Compositional/#2835" class="Bound">d</a> <a id="2837" class="Symbol">(</a><a id="2838" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="2848" href="../Compositional/#2848" class="Bound">lt</a><a id="2850" class="Symbol">)</a> <a id="2852" class="Symbol">=</a> <a id="2854" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2860" class="Symbol">(</a><a id="2861" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="2867" href="../Compositional/#2835" class="Bound">d</a><a id="2868" class="Symbol">)</a> <a id="2870" href="../Compositional/#2848" class="Bound">lt</a>
<a id="2873" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2879" href="../Compositional/#2879" class="Bound">d</a> <a id="2881" class="Symbol">(</a><a id="2882" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="2892" href="../Compositional/#2892" class="Bound">lt</a><a id="2894" class="Symbol">)</a> <a id="2896" class="Symbol">=</a> <a id="2898" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2904" class="Symbol">(</a><a id="2905" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="2911" href="../Compositional/#2879" class="Bound">d</a><a id="2912" class="Symbol">)</a> <a id="2914" href="../Compositional/#2892" class="Bound">lt</a>
<a id="2917" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="2923" class="Symbol">{</a><a id="2924" class="Argument">v</a> <a id="2926" class="Symbol">=</a> <a id="2928" href="../Compositional/#2928" class="Bound">v₁</a> <a id="2931" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="2933" href="../Compositional/#2933" class="Bound">v₂</a> <a id="2936" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="2938" href="../Compositional/#2928" class="Bound">v₁</a> <a id="2941" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="2943" href="../Compositional/#2943" class="Bound">v₃</a><a id="2945" class="Symbol">}</a> <a id="2947" class="Symbol">{</a><a id="2948" href="../Compositional/#2928" class="Bound">v₁</a> <a id="2951" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="2953" class="Symbol">(</a><a id="2954" href="../Compositional/#2933" class="Bound">v₂</a> <a id="2957" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="2959" href="../Compositional/#2943" class="Bound">v₃</a><a id="2961" class="Symbol">)}</a> <a id="2964" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="2966" href="../Compositional/#2966" class="Bound">N2</a> <a id="2969" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="2971" href="../Compositional/#2971" class="Bound">N3</a> <a id="2974" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="2976" href="../Denotational/#4888" class="InductiveConstructor">⊑-dist</a> <a id="2983" class="Symbol">=</a>
   <a id="2988" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="2996" href="../Compositional/#2966" class="Bound">N2</a> <a id="2999" href="../Compositional/#2971" class="Bound">N3</a>
<a id="3002" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="3008" href="../Compositional/#3008" class="Bound">d</a> <a id="3010" class="Symbol">(</a><a id="3011" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="3019" href="../Compositional/#3019" class="Bound">x₁</a> <a id="3022" href="../Compositional/#3022" class="Bound">x₂</a><a id="3024" class="Symbol">)</a> <a id="3026" class="Symbol">=</a> <a id="3028" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="3034" class="Symbol">(</a><a id="3035" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="3041" href="../Compositional/#3008" class="Bound">d</a> <a id="3043" href="../Compositional/#3022" class="Bound">x₂</a><a id="3045" class="Symbol">)</a> <a id="3047" href="../Compositional/#3019" class="Bound">x₁</a>
</pre>
<!--
[PLW:
  If denotations were strengthened to be downward closed,
  we could rewrite the signature replacing (ℰ N) by d : Denotation (Γ , ★)]
[JGS: I'll look into this.]
-->
<p>With this subsumption property in hand, we can prove the forward direction of the semantic equation for lambda. The proof is by induction on the semantics, using <code>sub-ℱ</code> in the case for the <code>sub</code> rule.</p>
<pre class="Agda"><a id="ℰƛ→ℱℰ"></a><a id="3441" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a> <a id="3447" class="Symbol">:</a> <a id="3449" class="Symbol">∀{</a><a id="3451" href="../Compositional/#3451" class="Bound">Γ</a><a id="3452" class="Symbol">}{</a><a id="3454" href="../Compositional/#3454" class="Bound">γ</a> <a id="3456" class="Symbol">:</a> <a id="3458" href="../Denotational/#7204" class="Function">Env</a> <a id="3462" href="../Compositional/#3451" class="Bound">Γ</a><a id="3463" class="Symbol">}{</a><a id="3465" href="../Compositional/#3465" class="Bound">N</a> <a id="3467" class="Symbol">:</a> <a id="3469" href="../Compositional/#3451" class="Bound">Γ</a> <a id="3471" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="3473" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="3475" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="3477" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="3478" class="Symbol">}{</a><a id="3480" href="../Compositional/#3480" class="Bound">v</a> <a id="3482" class="Symbol">:</a> <a id="3484" href="../Denotational/#4067" class="Datatype">Value</a><a id="3489" class="Symbol">}</a>
  <a id="3493" class="Symbol">→</a> <a id="3495" href="../Denotational/#17402" class="Function">ℰ</a> <a id="3497" class="Symbol">(</a><a id="3498" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="3500" href="../Compositional/#3465" class="Bound">N</a><a id="3501" class="Symbol">)</a> <a id="3503" href="../Compositional/#3454" class="Bound">γ</a> <a id="3505" href="../Compositional/#3480" class="Bound">v</a>
    <a id="3511" class="Comment">------------</a>
  <a id="3526" class="Symbol">→</a> <a id="3528" href="../Compositional/#1896" class="Function">ℱ</a> <a id="3530" class="Symbol">(</a><a id="3531" href="../Denotational/#17402" class="Function">ℰ</a> <a id="3533" href="../Compositional/#3465" class="Bound">N</a><a id="3534" class="Symbol">)</a> <a id="3536" href="../Compositional/#3454" class="Bound">γ</a> <a id="3538" href="../Compositional/#3480" class="Bound">v</a>
<a id="3540" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a> <a id="3546" class="Symbol">(</a><a id="3547" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="3555" href="../Compositional/#3555" class="Bound">d</a><a id="3556" class="Symbol">)</a> <a id="3558" class="Symbol">=</a> <a id="3560" href="../Compositional/#3555" class="Bound">d</a>
<a id="3562" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a> <a id="3568" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a> <a id="3576" class="Symbol">=</a> <a id="3578" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
<a id="3581" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a> <a id="3587" class="Symbol">(</a><a id="3588" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="3596" href="../Compositional/#3596" class="Bound">d₁</a> <a id="3599" href="../Compositional/#3599" class="Bound">d₂</a><a id="3601" class="Symbol">)</a> <a id="3603" class="Symbol">=</a> <a id="3605" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="3607" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a> <a id="3613" href="../Compositional/#3596" class="Bound">d₁</a> <a id="3616" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="3618" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a> <a id="3624" href="../Compositional/#3599" class="Bound">d₂</a> <a id="3627" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
<a id="3629" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a> <a id="3635" class="Symbol">(</a><a id="3636" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="3640" href="../Compositional/#3640" class="Bound">d</a> <a id="3642" href="../Compositional/#3642" class="Bound">lt</a><a id="3644" class="Symbol">)</a> <a id="3646" class="Symbol">=</a> <a id="3648" href="../Compositional/#2612" class="Function">sub-ℱ</a> <a id="3654" class="Symbol">(</a><a id="3655" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a> <a id="3661" href="../Compositional/#3640" class="Bound">d</a><a id="3662" class="Symbol">)</a> <a id="3664" href="../Compositional/#3642" class="Bound">lt</a>
</pre>
<p>The “inversion lemma” for lambda abstraction is a special case of the above. The inversion lemma is useful in proving that denotations are preserved by reduction.</p>
<pre class="Agda"><a id="lambda-inversion"></a><a id="3840" href="../Compositional/#3840" class="Function">lambda-inversion</a> <a id="3857" class="Symbol">:</a> <a id="3859" class="Symbol">∀{</a><a id="3861" href="../Compositional/#3861" class="Bound">Γ</a><a id="3862" class="Symbol">}{</a><a id="3864" href="../Compositional/#3864" class="Bound">γ</a> <a id="3866" class="Symbol">:</a> <a id="3868" href="../Denotational/#7204" class="Function">Env</a> <a id="3872" href="../Compositional/#3861" class="Bound">Γ</a><a id="3873" class="Symbol">}{</a><a id="3875" href="../Compositional/#3875" class="Bound">N</a> <a id="3877" class="Symbol">:</a> <a id="3879" href="../Compositional/#3861" class="Bound">Γ</a> <a id="3881" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="3883" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="3885" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="3887" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="3888" class="Symbol">}{</a><a id="3890" href="../Compositional/#3890" class="Bound">v₁</a> <a id="3893" href="../Compositional/#3893" class="Bound">v₂</a> <a id="3896" class="Symbol">:</a> <a id="3898" href="../Denotational/#4067" class="Datatype">Value</a><a id="3903" class="Symbol">}</a>
  <a id="3907" class="Symbol">→</a> <a id="3909" href="../Compositional/#3864" class="Bound">γ</a> <a id="3911" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="3913" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="3915" href="../Compositional/#3875" class="Bound">N</a> <a id="3917" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="3919" href="../Compositional/#3890" class="Bound">v₁</a> <a id="3922" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="3924" href="../Compositional/#3893" class="Bound">v₂</a>
    <a id="3931" class="Comment">-----------------</a>
  <a id="3951" class="Symbol">→</a> <a id="3953" class="Symbol">(</a><a id="3954" href="../Compositional/#3864" class="Bound">γ</a> <a id="3956" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="3959" href="../Compositional/#3890" class="Bound">v₁</a><a id="3961" class="Symbol">)</a> <a id="3963" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="3965" href="../Compositional/#3875" class="Bound">N</a> <a id="3967" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="3969" href="../Compositional/#3893" class="Bound">v₂</a>
<a id="3972" href="../Compositional/#3840" class="Function">lambda-inversion</a><a id="3988" class="Symbol">{</a><a id="3989" class="Argument">v₁</a> <a id="3992" class="Symbol">=</a> <a id="3994" href="../Compositional/#3994" class="Bound">v₁</a><a id="3996" class="Symbol">}{</a><a id="3998" class="Argument">v₂</a> <a id="4001" class="Symbol">=</a> <a id="4003" href="../Compositional/#4003" class="Bound">v₂</a><a id="4005" class="Symbol">}</a> <a id="4007" href="../Compositional/#4007" class="Bound">d</a> <a id="4009" class="Symbol">=</a> <a id="4011" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a><a id="4016" class="Symbol">{</a><a id="4017" class="Argument">v</a> <a id="4019" class="Symbol">=</a> <a id="4021" href="../Compositional/#3994" class="Bound">v₁</a> <a id="4024" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="4026" href="../Compositional/#4003" class="Bound">v₂</a><a id="4028" class="Symbol">}</a> <a id="4030" href="../Compositional/#4007" class="Bound">d</a>
</pre>
<p>The backward direction of the semantic equation for lambda is even easier to prove than the forward direction. We proceed by induction on the value v.</p>
<pre class="Agda"><a id="ℱℰ→ℰƛ"></a><a id="4193" href="../Compositional/#4193" class="Function">ℱℰ→ℰƛ</a> <a id="4199" class="Symbol">:</a> <a id="4201" class="Symbol">∀{</a><a id="4203" href="../Compositional/#4203" class="Bound">Γ</a><a id="4204" class="Symbol">}{</a><a id="4206" href="../Compositional/#4206" class="Bound">γ</a> <a id="4208" class="Symbol">:</a> <a id="4210" href="../Denotational/#7204" class="Function">Env</a> <a id="4214" href="../Compositional/#4203" class="Bound">Γ</a><a id="4215" class="Symbol">}{</a><a id="4217" href="../Compositional/#4217" class="Bound">N</a> <a id="4219" class="Symbol">:</a> <a id="4221" href="../Compositional/#4203" class="Bound">Γ</a> <a id="4223" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="4225" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="4227" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="4229" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="4230" class="Symbol">}{</a><a id="4232" href="../Compositional/#4232" class="Bound">v</a> <a id="4234" class="Symbol">:</a> <a id="4236" href="../Denotational/#4067" class="Datatype">Value</a><a id="4241" class="Symbol">}</a>
  <a id="4245" class="Symbol">→</a> <a id="4247" href="../Compositional/#1896" class="Function">ℱ</a> <a id="4249" class="Symbol">(</a><a id="4250" href="../Denotational/#17402" class="Function">ℰ</a> <a id="4252" href="../Compositional/#4217" class="Bound">N</a><a id="4253" class="Symbol">)</a> <a id="4255" href="../Compositional/#4206" class="Bound">γ</a> <a id="4257" href="../Compositional/#4232" class="Bound">v</a>
    <a id="4263" class="Comment">------------</a>
  <a id="4278" class="Symbol">→</a> <a id="4280" href="../Denotational/#17402" class="Function">ℰ</a> <a id="4282" class="Symbol">(</a><a id="4283" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="4285" href="../Compositional/#4217" class="Bound">N</a><a id="4286" class="Symbol">)</a> <a id="4288" href="../Compositional/#4206" class="Bound">γ</a> <a id="4290" href="../Compositional/#4232" class="Bound">v</a>
<a id="4292" href="../Compositional/#4193" class="Function">ℱℰ→ℰƛ</a> <a id="4298" class="Symbol">{</a><a id="4299" class="Argument">v</a> <a id="4301" class="Symbol">=</a> <a id="4303" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="4304" class="Symbol">}</a> <a id="4306" href="../Compositional/#4306" class="Bound">d</a> <a id="4308" class="Symbol">=</a> <a id="4310" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a>
<a id="4318" href="../Compositional/#4193" class="Function">ℱℰ→ℰƛ</a> <a id="4324" class="Symbol">{</a><a id="4325" class="Argument">v</a> <a id="4327" class="Symbol">=</a> <a id="4329" href="../Compositional/#4329" class="Bound">v₁</a> <a id="4332" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="4334" href="../Compositional/#4334" class="Bound">v₂</a><a id="4336" class="Symbol">}</a> <a id="4338" href="../Compositional/#4338" class="Bound">d</a> <a id="4340" class="Symbol">=</a> <a id="4342" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="4350" href="../Compositional/#4338" class="Bound">d</a>
<a id="4352" href="../Compositional/#4193" class="Function">ℱℰ→ℰƛ</a> <a id="4358" class="Symbol">{</a><a id="4359" class="Argument">v</a> <a id="4361" class="Symbol">=</a> <a id="4363" href="../Compositional/#4363" class="Bound">v₁</a> <a id="4366" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="4368" href="../Compositional/#4368" class="Bound">v₂</a><a id="4370" class="Symbol">}</a> <a id="4372" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="4374" href="../Compositional/#4374" class="Bound">d1</a> <a id="4377" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="4379" href="../Compositional/#4379" class="Bound">d2</a> <a id="4382" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="4384" class="Symbol">=</a> <a id="4386" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="4394" class="Symbol">(</a><a id="4395" href="../Compositional/#4193" class="Function">ℱℰ→ℰƛ</a> <a id="4401" href="../Compositional/#4374" class="Bound">d1</a><a id="4403" class="Symbol">)</a> <a id="4405" class="Symbol">(</a><a id="4406" href="../Compositional/#4193" class="Function">ℱℰ→ℰƛ</a> <a id="4412" href="../Compositional/#4379" class="Bound">d2</a><a id="4414" class="Symbol">)</a>
</pre>
<p>So indeed, the denotational semantics is compositional with respect to lambda abstraction, as witnessed by the function <code>ℱ</code>.</p>
<pre class="Agda"><a id="lam-equiv"></a><a id="4551" href="../Compositional/#4551" class="Function">lam-equiv</a> <a id="4561" class="Symbol">:</a> <a id="4563" class="Symbol">∀{</a><a id="4565" href="../Compositional/#4565" class="Bound">Γ</a><a id="4566" class="Symbol">}{</a><a id="4568" href="../Compositional/#4568" class="Bound">N</a> <a id="4570" class="Symbol">:</a> <a id="4572" href="../Compositional/#4565" class="Bound">Γ</a> <a id="4574" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="4576" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="4578" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="4580" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="4581" class="Symbol">}</a>
  <a id="4585" class="Symbol">→</a> <a id="4587" href="../Denotational/#17402" class="Function">ℰ</a> <a id="4589" class="Symbol">(</a><a id="4590" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="4592" href="../Compositional/#4568" class="Bound">N</a><a id="4593" class="Symbol">)</a> <a id="4595" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="4597" href="../Compositional/#1896" class="Function">ℱ</a> <a id="4599" class="Symbol">(</a><a id="4600" href="../Denotational/#17402" class="Function">ℰ</a> <a id="4602" href="../Compositional/#4568" class="Bound">N</a><a id="4603" class="Symbol">)</a>
<a id="4605" href="../Compositional/#4551" class="Function">lam-equiv</a> <a id="4615" href="../Compositional/#4615" class="Bound">γ</a> <a id="4617" href="../Compositional/#4617" class="Bound">v</a> <a id="4619" class="Symbol">=</a> <a id="4621" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="4623" href="../Compositional/#3441" class="Function">ℰƛ→ℱℰ</a> <a id="4629" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="4631" href="../Compositional/#4193" class="Function">ℱℰ→ℰƛ</a> <a id="4637" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
</pre>
<h2 id="equation-for-function-application">Equation for function application</h2>
<p>Next we fill in the ellipses for the equation concerning function application.</p>
<pre><code>ℰ (M · N) ≃ ... ℰ M ... ℰ N ...</code></pre>
<p>For this we need to define a function that takes two denotations, both in context <code>Γ</code>, and produces another one in context <code>Γ</code>. This function, let us name it <code>●</code>, needs to mimic the non-recursive aspects of the semantics of an application <code>L · M</code>. We cannot proceed as easily as for <code>ℱ</code> and define the function by recursion on value <code>v</code> because, for example, the rule <code>↦-elim</code> applies to any value. Instead we shall define <code>●</code> in a way that directly deals with the <code>↦-elim</code> and <code>⊥-intro</code> rules but ignores <code>⊔-intro</code>. This makes the forward direction of the proof more difficult, and the case for <code>⊔-intro</code> demonstrates why the <code>⊑-dist</code> rule is important.</p>
<p>So we define the application of <code>D₁</code> to <code>D₂</code>, written <code>D₁ ● D₂</code>, to include any value <code>w</code> equivalent to <code>⊥</code>, for the <code>⊥-intro</code> rule, and to include any value <code>w</code> that is the output of an entry <code>v ↦ w</code> in <code>D₁</code>, provided the input <code>v</code> is in <code>D₂</code>, for the <code>↦-elim</code> rule.</p>
<pre class="Agda"><a id="5730" class="Keyword">infixl</a> <a id="5737" class="Number">7</a> <a id="5739" href="../Compositional/#5744" class="Function Operator">_●_</a>

<a id="_●_"></a><a id="5744" href="../Compositional/#5744" class="Function Operator">_●_</a> <a id="5748" class="Symbol">:</a> <a id="5750" class="Symbol">∀{</a><a id="5752" href="../Compositional/#5752" class="Bound">Γ</a><a id="5753" class="Symbol">}</a> <a id="5755" class="Symbol">→</a> <a id="5757" href="../Denotational/#17189" class="Function">Denotation</a> <a id="5768" href="../Compositional/#5752" class="Bound">Γ</a> <a id="5770" class="Symbol">→</a> <a id="5772" href="../Denotational/#17189" class="Function">Denotation</a> <a id="5783" href="../Compositional/#5752" class="Bound">Γ</a> <a id="5785" class="Symbol">→</a> <a id="5787" href="../Denotational/#17189" class="Function">Denotation</a> <a id="5798" href="../Compositional/#5752" class="Bound">Γ</a>
<a id="5800" class="Symbol">(</a><a id="5801" href="../Compositional/#5801" class="Bound">D₁</a> <a id="5804" href="../Compositional/#5744" class="Function Operator">●</a> <a id="5806" href="../Compositional/#5806" class="Bound">D₂</a><a id="5808" class="Symbol">)</a> <a id="5810" href="../Compositional/#5810" class="Bound">γ</a> <a id="5812" href="../Compositional/#5812" class="Bound">w</a> <a id="5814" class="Symbol">=</a> <a id="5816" href="../Compositional/#5812" class="Bound">w</a> <a id="5818" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="5820" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="5822" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#728" class="Datatype Operator">⊎</a> <a id="5824" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="5827" href="../Compositional/#5827" class="Bound">v</a> <a id="5829" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="5831" href="../Denotational/#4067" class="Datatype">Value</a> <a id="5837" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a><a id="5838" class="Symbol">(</a> <a id="5840" href="../Compositional/#5801" class="Bound">D₁</a> <a id="5843" href="../Compositional/#5810" class="Bound">γ</a> <a id="5845" class="Symbol">(</a><a id="5846" href="../Compositional/#5827" class="Bound">v</a> <a id="5848" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="5850" href="../Compositional/#5812" class="Bound">w</a><a id="5851" class="Symbol">)</a> <a id="5853" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="5855" href="../Compositional/#5806" class="Bound">D₂</a> <a id="5858" href="../Compositional/#5810" class="Bound">γ</a> <a id="5860" href="../Compositional/#5827" class="Bound">v</a> <a id="5862" class="Symbol">)</a>
</pre>
<p>If one squints hard enough, the <code>_●_</code> operator starts to look like the <code>apply</code> operation familiar to functional programmers. It takes two parameters and applies the first to the second.</p>
<p>Next we consider the inversion lemma for application, which is also the forward direction of the semantic equation for application. We describe the proof below.</p>
<pre class="Agda"><a id="ℰ·→●ℰ"></a><a id="6223" href="../Compositional/#6223" class="Function">ℰ·→●ℰ</a> <a id="6229" class="Symbol">:</a> <a id="6231" class="Symbol">∀{</a><a id="6233" href="../Compositional/#6233" class="Bound">Γ</a><a id="6234" class="Symbol">}{</a><a id="6236" href="../Compositional/#6236" class="Bound">γ</a> <a id="6238" class="Symbol">:</a> <a id="6240" href="../Denotational/#7204" class="Function">Env</a> <a id="6244" href="../Compositional/#6233" class="Bound">Γ</a><a id="6245" class="Symbol">}{</a><a id="6247" href="../Compositional/#6247" class="Bound">L</a> <a id="6249" href="../Compositional/#6249" class="Bound">M</a> <a id="6251" class="Symbol">:</a> <a id="6253" href="../Compositional/#6233" class="Bound">Γ</a> <a id="6255" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="6257" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="6258" class="Symbol">}{</a><a id="6260" href="../Compositional/#6260" class="Bound">v</a> <a id="6262" class="Symbol">:</a> <a id="6264" href="../Denotational/#4067" class="Datatype">Value</a><a id="6269" class="Symbol">}</a>
  <a id="6273" class="Symbol">→</a> <a id="6275" href="../Denotational/#17402" class="Function">ℰ</a> <a id="6277" class="Symbol">(</a><a id="6278" href="../Compositional/#6247" class="Bound">L</a> <a id="6280" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="6282" href="../Compositional/#6249" class="Bound">M</a><a id="6283" class="Symbol">)</a> <a id="6285" href="../Compositional/#6236" class="Bound">γ</a> <a id="6287" href="../Compositional/#6260" class="Bound">v</a>
    <a id="6293" class="Comment">----------------</a>
  <a id="6312" class="Symbol">→</a> <a id="6314" class="Symbol">(</a><a id="6315" href="../Denotational/#17402" class="Function">ℰ</a> <a id="6317" href="../Compositional/#6247" class="Bound">L</a> <a id="6319" href="../Compositional/#5744" class="Function Operator">●</a> <a id="6321" href="../Denotational/#17402" class="Function">ℰ</a> <a id="6323" href="../Compositional/#6249" class="Bound">M</a><a id="6324" class="Symbol">)</a> <a id="6326" href="../Compositional/#6236" class="Bound">γ</a> <a id="6328" href="../Compositional/#6260" class="Bound">v</a>
<a id="6330" href="../Compositional/#6223" class="Function">ℰ·→●ℰ</a> <a id="6336" class="Symbol">(</a><a id="6337" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a><a id="6343" class="Symbol">{</a><a id="6344" class="Argument">v</a> <a id="6346" class="Symbol">=</a> <a id="6348" href="../Compositional/#6348" class="Bound">v′</a><a id="6350" class="Symbol">}</a> <a id="6352" href="../Compositional/#6352" class="Bound">d₁</a> <a id="6355" href="../Compositional/#6355" class="Bound">d₂</a><a id="6357" class="Symbol">)</a> <a id="6359" class="Symbol">=</a> <a id="6361" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="6366" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6368" href="../Compositional/#6348" class="Bound">v′</a> <a id="6371" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6373" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6375" href="../Compositional/#6352" class="Bound">d₁</a> <a id="6378" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6380" href="../Compositional/#6355" class="Bound">d₂</a> <a id="6383" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="6385" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
<a id="6387" href="../Compositional/#6223" class="Function">ℰ·→●ℰ</a> <a id="6393" class="Symbol">{</a><a id="6394" class="Argument">v</a> <a id="6396" class="Symbol">=</a> <a id="6398" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="6399" class="Symbol">}</a> <a id="6401" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a> <a id="6409" class="Symbol">=</a> <a id="6411" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="6416" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a>
<a id="6422" href="../Compositional/#6223" class="Function">ℰ·→●ℰ</a> <a id="6428" class="Symbol">{</a><a id="6429" href="../Compositional/#6429" class="Bound">Γ</a><a id="6430" class="Symbol">}{</a><a id="6432" href="../Compositional/#6432" class="Bound">γ</a><a id="6433" class="Symbol">}{</a><a id="6435" href="../Compositional/#6435" class="Bound">L</a><a id="6436" class="Symbol">}{</a><a id="6438" href="../Compositional/#6438" class="Bound">M</a><a id="6439" class="Symbol">}{</a><a id="6441" href="../Compositional/#6441" class="Bound">v</a><a id="6442" class="Symbol">}</a> <a id="6444" class="Symbol">(</a><a id="6445" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a><a id="6452" class="Symbol">{</a><a id="6453" class="Argument">v</a> <a id="6455" class="Symbol">=</a> <a id="6457" href="../Compositional/#6457" class="Bound">v₁</a><a id="6459" class="Symbol">}{</a><a id="6461" class="Argument">w</a> <a id="6463" class="Symbol">=</a> <a id="6465" href="../Compositional/#6465" class="Bound">v₂</a><a id="6467" class="Symbol">}</a> <a id="6469" href="../Compositional/#6469" class="Bound">d₁</a> <a id="6472" href="../Compositional/#6472" class="Bound">d₂</a><a id="6474" class="Symbol">)</a>
    <a id="6480" class="Keyword">with</a> <a id="6485" href="../Compositional/#6223" class="Function">ℰ·→●ℰ</a> <a id="6491" href="../Compositional/#6469" class="Bound">d₁</a> <a id="6494" class="Symbol">|</a> <a id="6496" href="../Compositional/#6223" class="Function">ℰ·→●ℰ</a> <a id="6502" href="../Compositional/#6472" class="Bound">d₂</a>
<a id="6505" class="Symbol">...</a> <a id="6509" class="Symbol">|</a> <a id="6511" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="6516" href="../Compositional/#6516" class="Bound">lt1</a> <a id="6520" class="Symbol">|</a> <a id="6522" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="6527" href="../Compositional/#6527" class="Bound">lt2</a> <a id="6531" class="Symbol">=</a> <a id="6533" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="6538" class="Symbol">(</a><a id="6539" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="6548" href="../Compositional/#6516" class="Bound">lt1</a> <a id="6552" href="../Compositional/#6527" class="Bound">lt2</a><a id="6555" class="Symbol">)</a>
<a id="6557" class="Symbol">...</a> <a id="6561" class="Symbol">|</a> <a id="6563" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="6568" href="../Compositional/#6568" class="Bound">lt1</a> <a id="6572" class="Symbol">|</a> <a id="6574" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="6579" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6581" href="../Compositional/#6581" class="Bound">v₁′</a> <a id="6585" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6587" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6589" href="../Compositional/#6589" class="Bound">L↓v12</a> <a id="6595" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6597" href="../Compositional/#6597" class="Bound">M↓v3</a> <a id="6602" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="6604" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="6606" class="Symbol">=</a>
      <a id="6614" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="6619" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6621" href="../Compositional/#6581" class="Bound">v₁′</a> <a id="6625" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6627" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6629" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="6633" href="../Compositional/#6589" class="Bound">L↓v12</a> <a id="6639" href="../Compositional/#6665" class="Function">lt</a> <a id="6642" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6644" href="../Compositional/#6597" class="Bound">M↓v3</a> <a id="6649" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="6651" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
      <a id="6659" class="Keyword">where</a> <a id="6665" href="../Compositional/#6665" class="Function">lt</a> <a id="6668" class="Symbol">:</a> <a id="6670" href="../Compositional/#6581" class="Bound">v₁′</a> <a id="6674" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="6676" class="Symbol">(</a><a id="6677" class="Bound">v₁</a> <a id="6680" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="6682" class="Bound">v₂</a><a id="6684" class="Symbol">)</a> <a id="6686" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="6688" href="../Compositional/#6581" class="Bound">v₁′</a> <a id="6692" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="6694" class="Bound">v₂</a>
            <a id="6709" href="../Compositional/#6665" class="Function">lt</a> <a id="6712" class="Symbol">=</a> <a id="6714" class="Symbol">(</a><a id="6715" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="6721" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="6728" class="Symbol">(</a><a id="6729" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="6738" class="Symbol">(</a><a id="6739" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="6747" href="../Compositional/#6568" class="Bound">lt1</a> <a id="6751" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a><a id="6756" class="Symbol">)</a> <a id="6758" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="6764" class="Symbol">))</a>
<a id="6767" class="Symbol">...</a> <a id="6771" class="Symbol">|</a> <a id="6773" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="6778" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6780" href="../Compositional/#6780" class="Bound">v₁′</a> <a id="6784" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6786" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6788" href="../Compositional/#6788" class="Bound">L↓v12</a> <a id="6794" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6796" href="../Compositional/#6796" class="Bound">M↓v3</a> <a id="6801" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="6803" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="6805" class="Symbol">|</a> <a id="6807" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="6812" href="../Compositional/#6812" class="Bound">lt2</a> <a id="6816" class="Symbol">=</a>
      <a id="6824" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="6829" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6831" href="../Compositional/#6780" class="Bound">v₁′</a> <a id="6835" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6837" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6839" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="6843" href="../Compositional/#6788" class="Bound">L↓v12</a> <a id="6849" href="../Compositional/#6875" class="Function">lt</a> <a id="6852" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6854" href="../Compositional/#6796" class="Bound">M↓v3</a> <a id="6859" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="6861" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
      <a id="6869" class="Keyword">where</a> <a id="6875" href="../Compositional/#6875" class="Function">lt</a> <a id="6878" class="Symbol">:</a> <a id="6880" href="../Compositional/#6780" class="Bound">v₁′</a> <a id="6884" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="6886" class="Symbol">(</a><a id="6887" class="Bound">v₁</a> <a id="6890" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="6892" class="Bound">v₂</a><a id="6894" class="Symbol">)</a> <a id="6896" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="6898" href="../Compositional/#6780" class="Bound">v₁′</a> <a id="6902" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="6904" class="Bound">v₁</a>
            <a id="6919" href="../Compositional/#6875" class="Function">lt</a> <a id="6922" class="Symbol">=</a> <a id="6924" class="Symbol">(</a><a id="6925" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="6931" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="6938" class="Symbol">(</a><a id="6939" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="6948" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="6955" class="Symbol">(</a><a id="6956" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="6964" href="../Compositional/#6812" class="Bound">lt2</a> <a id="6968" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a><a id="6973" class="Symbol">)))</a>
<a id="6977" class="Symbol">...</a> <a id="6981" class="Symbol">|</a> <a id="6983" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="6988" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6990" href="../Compositional/#6990" class="Bound">v₁′</a> <a id="6994" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="6996" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="6998" href="../Compositional/#6998" class="Bound">L↓v12</a> <a id="7004" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="7006" href="../Compositional/#7006" class="Bound">M↓v3</a> <a id="7011" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="7013" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="7015" class="Symbol">|</a> <a id="7017" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="7022" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="7024" href="../Compositional/#7024" class="Bound">v₁′′</a> <a id="7029" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="7031" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="7033" href="../Compositional/#7033" class="Bound">L↓v12′</a> <a id="7040" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="7042" href="../Compositional/#7042" class="Bound">M↓v3′</a> <a id="7048" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="7050" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="7052" class="Symbol">=</a>
      <a id="7060" class="Keyword">let</a> <a id="7064" href="../Compositional/#7064" class="Bound">L↓⊔</a> <a id="7068" class="Symbol">=</a> <a id="7070" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="7078" href="../Compositional/#6998" class="Bound">L↓v12</a> <a id="7084" href="../Compositional/#7033" class="Bound">L↓v12′</a> <a id="7091" class="Keyword">in</a>
      <a id="7100" class="Keyword">let</a> <a id="7104" href="../Compositional/#7104" class="Bound">M↓⊔</a> <a id="7108" class="Symbol">=</a> <a id="7110" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="7118" href="../Compositional/#7006" class="Bound">M↓v3</a> <a id="7123" href="../Compositional/#7042" class="Bound">M↓v3′</a> <a id="7129" class="Keyword">in</a>
      <a id="7138" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="7143" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="7145" href="../Compositional/#6990" class="Bound">v₁′</a> <a id="7149" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="7151" href="../Compositional/#7024" class="Bound">v₁′′</a> <a id="7156" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="7158" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="7160" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="7164" href="../Compositional/#7064" class="Bound">L↓⊔</a> <a id="7168" href="../Denotational/#6189" class="Function">⊔↦⊔-dist</a> <a id="7177" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="7179" href="../Compositional/#7104" class="Bound">M↓⊔</a> <a id="7183" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="7185" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
<a id="7187" href="../Compositional/#6223" class="Function">ℰ·→●ℰ</a> <a id="7193" class="Symbol">{</a><a id="7194" href="../Compositional/#7194" class="Bound">Γ</a><a id="7195" class="Symbol">}{</a><a id="7197" href="../Compositional/#7197" class="Bound">γ</a><a id="7198" class="Symbol">}{</a><a id="7200" href="../Compositional/#7200" class="Bound">L</a><a id="7201" class="Symbol">}{</a><a id="7203" href="../Compositional/#7203" class="Bound">M</a><a id="7204" class="Symbol">}{</a><a id="7206" href="../Compositional/#7206" class="Bound">v</a><a id="7207" class="Symbol">}</a> <a id="7209" class="Symbol">(</a><a id="7210" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="7214" href="../Compositional/#7214" class="Bound">d</a> <a id="7216" href="../Compositional/#7216" class="Bound">lt</a><a id="7218" class="Symbol">)</a>
    <a id="7224" class="Keyword">with</a> <a id="7229" href="../Compositional/#6223" class="Function">ℰ·→●ℰ</a> <a id="7235" href="../Compositional/#7214" class="Bound">d</a>
<a id="7237" class="Symbol">...</a> <a id="7241" class="Symbol">|</a> <a id="7243" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="7248" href="../Compositional/#7248" class="Bound">lt2</a> <a id="7252" class="Symbol">=</a> <a id="7254" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="7259" class="Symbol">(</a><a id="7260" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="7268" class="Bound">lt</a> <a id="7271" href="../Compositional/#7248" class="Bound">lt2</a><a id="7274" class="Symbol">)</a>
<a id="7276" class="Symbol">...</a> <a id="7280" class="Symbol">|</a> <a id="7282" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="7287" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="7289" href="../Compositional/#7289" class="Bound">v₁</a> <a id="7292" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="7294" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="7296" href="../Compositional/#7296" class="Bound">L↓v12</a> <a id="7302" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="7304" href="../Compositional/#7304" class="Bound">M↓v3</a> <a id="7309" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="7311" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="7313" class="Symbol">=</a>
      <a id="7321" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="7326" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="7328" href="../Compositional/#7289" class="Bound">v₁</a> <a id="7331" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="7333" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="7335" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="7339" href="../Compositional/#7296" class="Bound">L↓v12</a> <a id="7345" class="Symbol">(</a><a id="7346" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="7352" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="7359" class="Bound">lt</a><a id="7361" class="Symbol">)</a> <a id="7363" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="7365" href="../Compositional/#7304" class="Bound">M↓v3</a> <a id="7370" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="7372" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We proceed by induction on the semantics.</p>
<ul>
<li><p>In case <code>↦-elim</code> we have <code>γ ⊢ L ↓ (v′ ↦ v)</code> and <code>γ ⊢ M ↓ v′</code>, which is all we need to show <code>(ℰ L ● ℰ M) γ v</code>.</p></li>
<li><p>In case <code>⊥-intro</code> we have <code>v = ⊥</code>. We conclude that <code>v ⊑ ⊥</code>.</p></li>
<li><p>In case <code>⊔-intro</code> we have <code>ℰ (L · M) γ v₁</code> and <code>ℰ (L · M) γ v₂</code> and need to show <code>(ℰ L ● ℰ M) γ (v₁ ⊔ v₂)</code>. By the induction hypothesis, we have <code>(ℰ L ● ℰ M) γ v₁</code> and <code>(ℰ L ● ℰ M) γ v₂</code>. We have four subcases to consider.</p>
<ul>
<li><p>Suppose <code>v₁ ⊑ ⊥</code> and <code>v₂ ⊑ ⊥</code>. Then <code>v₁ ⊔ v₂ ⊑ ⊥</code>.</p></li>
<li><p>Suppose <code>v₁ ⊑ ⊥</code>, <code>γ ⊢ L ↓ v₁′ ↦ v₂</code>, and <code>γ ⊢ M ↓ v₁′</code>. We have <code>γ ⊢ L ↓ v₁′ ↦ (v₁ ⊔ v₂)</code> by rule <code>sub</code> because <code>v₁′ ↦ (v₁ ⊔ v₂) ⊑ v₁′ ↦ v₂</code>.</p></li>
<li><p>Suppose <code>γ ⊢ L ↓ v₁′ ↦ v₁</code>, <code>γ ⊢ M ↓ v₁′</code>, and <code>v₂ ⊑ ⊥</code>. We have <code>γ ⊢ L ↓ v₁′ ↦ (v₁ ⊔ v₂)</code> by rule <code>sub</code> because <code>v₁′ ↦ (v₁ ⊔ v₂) ⊑ v₁′ ↦ v₁</code>.</p></li>
<li><p>Suppose <code>γ ⊢ L ↓ v₁′′ ↦ v₁, γ ⊢ M ↓ v₁′′</code>, <code>γ ⊢ L ↓ v₁′ ↦ v₂</code>, and <code>γ ⊢ M ↓ v₁′</code>. This case is the most interesting. By two uses of the rule <code>⊔-intro</code> we have <code>γ ⊢ L ↓ (v₁′ ↦ v₂) ⊔ (v₁′′ ↦ v₁)</code> and <code>γ ⊢ M ↓ (v₁′ ⊔ v₁′′)</code>. But this does not yet match what we need for <code>ℰ L ● ℰ M</code> because the result of <code>L</code> must be an <code>↦</code> whose input entry is <code>v₁′ ⊔ v₁′′</code>. So we use the <code>sub</code> rule to obtain <code>γ ⊢ L ↓ (v₁′ ⊔ v₁′′) ↦ (v₁ ⊔ v₂)</code>, using the <code>⊔↦⊔-dist</code> lemma (thanks to the <code>⊑-dist</code> rule) to show that</p>
<pre><code>  (v₁′ ⊔ v₁′′) ↦ (v₁ ⊔ v₂) ⊑ (v₁′ ↦ v₂) ⊔ (v₁′′ ↦ v₁)</code></pre>
<p>So we have proved what is needed for this case.</p></li>
</ul></li>
<li><p>In case <code>sub</code> we have <code>Γ ⊢ L · M ↓ v₁</code> and <code>v ⊑ v₁</code>. By the induction hypothesis, we have <code>(ℰ L ● ℰ M) γ v₁</code>. We have two subcases to consider.</p>
<ul>
<li>Suppose <code>v₁ ⊑ ⊥</code>. We conclude that <code>v ⊑ ⊥</code>.</li>
<li>Suppose <code>Γ ⊢ L ↓ v′ → v₁</code> and <code>Γ ⊢ M ↓ v′</code>. We conclude with <code>Γ ⊢ L ↓ v′ → v</code> by rule <code>sub</code>, because <code>v′ → v ⊑ v′ → v₁</code>.</li>
</ul></li>
</ul>
<p>The forward direction is proved by cases on the premise <code>(ℰ L ● ℰ M) γ v</code>. In case <code>v ⊑ ⊥</code>, we obtain <code>Γ ⊢ L · M ↓ ⊥</code> by rule <code>⊥-intro</code>. Otherwise, we conclude immediately by rule <code>↦-elim</code>.</p>
<pre class="Agda"><a id="●ℰ→ℰ·"></a><a id="9438" href="../Compositional/#9438" class="Function">●ℰ→ℰ·</a> <a id="9444" class="Symbol">:</a> <a id="9446" class="Symbol">∀{</a><a id="9448" href="../Compositional/#9448" class="Bound">Γ</a><a id="9449" class="Symbol">}{</a><a id="9451" href="../Compositional/#9451" class="Bound">γ</a> <a id="9453" class="Symbol">:</a> <a id="9455" href="../Denotational/#7204" class="Function">Env</a> <a id="9459" href="../Compositional/#9448" class="Bound">Γ</a><a id="9460" class="Symbol">}{</a><a id="9462" href="../Compositional/#9462" class="Bound">L</a> <a id="9464" href="../Compositional/#9464" class="Bound">M</a> <a id="9466" class="Symbol">:</a> <a id="9468" href="../Compositional/#9448" class="Bound">Γ</a> <a id="9470" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="9472" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="9473" class="Symbol">}{</a><a id="9475" href="../Compositional/#9475" class="Bound">v</a><a id="9476" class="Symbol">}</a>
  <a id="9480" class="Symbol">→</a> <a id="9482" class="Symbol">(</a><a id="9483" href="../Denotational/#17402" class="Function">ℰ</a> <a id="9485" href="../Compositional/#9462" class="Bound">L</a> <a id="9487" href="../Compositional/#5744" class="Function Operator">●</a> <a id="9489" href="../Denotational/#17402" class="Function">ℰ</a> <a id="9491" href="../Compositional/#9464" class="Bound">M</a><a id="9492" class="Symbol">)</a> <a id="9494" href="../Compositional/#9451" class="Bound">γ</a> <a id="9496" href="../Compositional/#9475" class="Bound">v</a>
    <a id="9502" class="Comment">----------------</a>
  <a id="9521" class="Symbol">→</a> <a id="9523" href="../Denotational/#17402" class="Function">ℰ</a> <a id="9525" class="Symbol">(</a><a id="9526" href="../Compositional/#9462" class="Bound">L</a> <a id="9528" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="9530" href="../Compositional/#9464" class="Bound">M</a><a id="9531" class="Symbol">)</a> <a id="9533" href="../Compositional/#9451" class="Bound">γ</a> <a id="9535" href="../Compositional/#9475" class="Bound">v</a>
<a id="9537" href="../Compositional/#9438" class="Function">●ℰ→ℰ·</a> <a id="9543" class="Symbol">{</a><a id="9544" href="../Compositional/#9544" class="Bound">γ</a><a id="9545" class="Symbol">}{</a><a id="9547" href="../Compositional/#9547" class="Bound">v</a><a id="9548" class="Symbol">}</a> <a id="9550" class="Symbol">(</a><a id="9551" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="9556" href="../Compositional/#9556" class="Bound">lt</a><a id="9558" class="Symbol">)</a> <a id="9560" class="Symbol">=</a> <a id="9562" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="9566" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a> <a id="9574" href="../Compositional/#9556" class="Bound">lt</a>
<a id="9577" href="../Compositional/#9438" class="Function">●ℰ→ℰ·</a> <a id="9583" class="Symbol">{</a><a id="9584" href="../Compositional/#9584" class="Bound">γ</a><a id="9585" class="Symbol">}{</a><a id="9587" href="../Compositional/#9587" class="Bound">v</a><a id="9588" class="Symbol">}</a> <a id="9590" class="Symbol">(</a><a id="9591" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="9596" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="9598" href="../Compositional/#9598" class="Bound">v₁</a> <a id="9601" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="9603" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="9605" href="../Compositional/#9605" class="Bound">d1</a> <a id="9608" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="9610" href="../Compositional/#9610" class="Bound">d2</a> <a id="9613" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="9615" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a><a id="9616" class="Symbol">)</a> <a id="9618" class="Symbol">=</a> <a id="9620" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="9627" href="../Compositional/#9605" class="Bound">d1</a> <a id="9630" href="../Compositional/#9610" class="Bound">d2</a>
</pre>
<p>So we have proved that the semantics is compositional with respect to function application, as witnessed by the <code>●</code> function.</p>
<pre class="Agda"><a id="app-equiv"></a><a id="9769" href="../Compositional/#9769" class="Function">app-equiv</a> <a id="9779" class="Symbol">:</a> <a id="9781" class="Symbol">∀{</a><a id="9783" href="../Compositional/#9783" class="Bound">Γ</a><a id="9784" class="Symbol">}{</a><a id="9786" href="../Compositional/#9786" class="Bound">L</a> <a id="9788" href="../Compositional/#9788" class="Bound">M</a> <a id="9790" class="Symbol">:</a> <a id="9792" href="../Compositional/#9783" class="Bound">Γ</a> <a id="9794" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="9796" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="9797" class="Symbol">}</a>
  <a id="9801" class="Symbol">→</a> <a id="9803" href="../Denotational/#17402" class="Function">ℰ</a> <a id="9805" class="Symbol">(</a><a id="9806" href="../Compositional/#9786" class="Bound">L</a> <a id="9808" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="9810" href="../Compositional/#9788" class="Bound">M</a><a id="9811" class="Symbol">)</a> <a id="9813" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="9815" class="Symbol">(</a><a id="9816" href="../Denotational/#17402" class="Function">ℰ</a> <a id="9818" href="../Compositional/#9786" class="Bound">L</a><a id="9819" class="Symbol">)</a> <a id="9821" href="../Compositional/#5744" class="Function Operator">●</a> <a id="9823" class="Symbol">(</a><a id="9824" href="../Denotational/#17402" class="Function">ℰ</a> <a id="9826" href="../Compositional/#9788" class="Bound">M</a><a id="9827" class="Symbol">)</a>
<a id="9829" href="../Compositional/#9769" class="Function">app-equiv</a> <a id="9839" href="../Compositional/#9839" class="Bound">γ</a> <a id="9841" href="../Compositional/#9841" class="Bound">v</a> <a id="9843" class="Symbol">=</a> <a id="9845" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="9847" href="../Compositional/#6223" class="Function">ℰ·→●ℰ</a> <a id="9853" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="9855" href="../Compositional/#9438" class="Function">●ℰ→ℰ·</a> <a id="9861" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We also need an inversion lemma for variables. If <code>Γ ⊢ x ↓ v</code>, then <code>v ⊑ γ x</code>. The proof is a straightforward induction on the semantics.</p>
<pre class="Agda"><a id="var-inv"></a><a id="10011" href="../Compositional/#10011" class="Function">var-inv</a> <a id="10019" class="Symbol">:</a> <a id="10021" class="Symbol">∀</a> <a id="10023" class="Symbol">{</a><a id="10024" href="../Compositional/#10024" class="Bound">Γ</a> <a id="10026" href="../Compositional/#10026" class="Bound">v</a> <a id="10028" href="../Compositional/#10028" class="Bound">x</a><a id="10029" class="Symbol">}</a> <a id="10031" class="Symbol">{</a><a id="10032" href="../Compositional/#10032" class="Bound">γ</a> <a id="10034" class="Symbol">:</a> <a id="10036" href="../Denotational/#7204" class="Function">Env</a> <a id="10040" href="../Compositional/#10024" class="Bound">Γ</a><a id="10041" class="Symbol">}</a>
  <a id="10045" class="Symbol">→</a> <a id="10047" href="../Denotational/#17402" class="Function">ℰ</a> <a id="10049" class="Symbol">(</a><a id="10050" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="10052" href="../Compositional/#10028" class="Bound">x</a><a id="10053" class="Symbol">)</a> <a id="10055" href="../Compositional/#10032" class="Bound">γ</a> <a id="10057" href="../Compositional/#10026" class="Bound">v</a>
    <a id="10063" class="Comment">-------------------</a>
  <a id="10085" class="Symbol">→</a> <a id="10087" href="../Compositional/#10026" class="Bound">v</a> <a id="10089" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="10091" href="../Compositional/#10032" class="Bound">γ</a> <a id="10093" href="../Compositional/#10028" class="Bound">x</a>
<a id="10095" href="../Compositional/#10011" class="Function">var-inv</a> <a id="10103" class="Symbol">(</a><a id="10104" href="../Denotational/#9316" class="InductiveConstructor">var</a><a id="10107" class="Symbol">)</a> <a id="10109" class="Symbol">=</a> <a id="10111" href="../Denotational/#5554" class="Function">⊑-refl</a>
<a id="10118" href="../Compositional/#10011" class="Function">var-inv</a> <a id="10126" class="Symbol">(</a><a id="10127" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="10135" href="../Compositional/#10135" class="Bound">d₁</a> <a id="10138" href="../Compositional/#10138" class="Bound">d₂</a><a id="10140" class="Symbol">)</a> <a id="10142" class="Symbol">=</a> <a id="10144" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="10153" class="Symbol">(</a><a id="10154" href="../Compositional/#10011" class="Function">var-inv</a> <a id="10162" href="../Compositional/#10135" class="Bound">d₁</a><a id="10164" class="Symbol">)</a> <a id="10166" class="Symbol">(</a><a id="10167" href="../Compositional/#10011" class="Function">var-inv</a> <a id="10175" href="../Compositional/#10138" class="Bound">d₂</a><a id="10177" class="Symbol">)</a>
<a id="10179" href="../Compositional/#10011" class="Function">var-inv</a> <a id="10187" class="Symbol">(</a><a id="10188" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="10192" href="../Compositional/#10192" class="Bound">d</a> <a id="10194" href="../Compositional/#10194" class="Bound">lt</a><a id="10196" class="Symbol">)</a> <a id="10198" class="Symbol">=</a> <a id="10200" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="10208" href="../Compositional/#10194" class="Bound">lt</a> <a id="10211" class="Symbol">(</a><a id="10212" href="../Compositional/#10011" class="Function">var-inv</a> <a id="10220" href="../Compositional/#10192" class="Bound">d</a><a id="10221" class="Symbol">)</a>
<a id="10223" href="../Compositional/#10011" class="Function">var-inv</a> <a id="10231" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a> <a id="10239" class="Symbol">=</a> <a id="10241" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a>
</pre>
<p>To round-out the semantic equations, we establish the following one for variables.</p>
<pre class="Agda"><a id="var-equiv"></a><a id="10340" href="../Compositional/#10340" class="Function">var-equiv</a> <a id="10350" class="Symbol">:</a> <a id="10352" class="Symbol">∀{</a><a id="10354" href="../Compositional/#10354" class="Bound">Γ</a><a id="10355" class="Symbol">}{</a><a id="10357" href="../Compositional/#10357" class="Bound">x</a> <a id="10359" class="Symbol">:</a> <a id="10361" href="../Compositional/#10354" class="Bound">Γ</a> <a id="10363" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="10365" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="10366" class="Symbol">}</a> <a id="10368" class="Symbol">→</a> <a id="10370" href="../Denotational/#17402" class="Function">ℰ</a> <a id="10372" class="Symbol">(</a><a id="10373" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="10375" href="../Compositional/#10357" class="Bound">x</a><a id="10376" class="Symbol">)</a> <a id="10378" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="10380" class="Symbol">(λ</a> <a id="10383" href="../Compositional/#10383" class="Bound">γ</a> <a id="10385" href="../Compositional/#10385" class="Bound">v</a> <a id="10387" class="Symbol">→</a> <a id="10389" href="../Compositional/#10385" class="Bound">v</a> <a id="10391" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="10393" href="../Compositional/#10383" class="Bound">γ</a> <a id="10395" href="../Compositional/#10357" class="Bound">x</a><a id="10396" class="Symbol">)</a>
<a id="10398" href="../Compositional/#10340" class="Function">var-equiv</a> <a id="10408" href="../Compositional/#10408" class="Bound">γ</a> <a id="10410" href="../Compositional/#10410" class="Bound">v</a> <a id="10412" class="Symbol">=</a> <a id="10414" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="10416" href="../Compositional/#10011" class="Function">var-inv</a> <a id="10424" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="10426" class="Symbol">(λ</a> <a id="10429" href="../Compositional/#10429" class="Bound">lt</a> <a id="10432" class="Symbol">→</a> <a id="10434" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="10438" href="../Denotational/#9316" class="InductiveConstructor">var</a> <a id="10442" href="../Compositional/#10429" class="Bound">lt</a><a id="10444" class="Symbol">)</a> <a id="10446" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
</pre>
<h2 id="congruence">Congruence</h2>
<p>The main work of this chapter is complete: we have established semantic equations that show how the denotational semantics is compositional. In this section and the next we make use of these equations to prove some corollaries: that denotational equality is a <em>congruence</em> and to prove the <em>compositionality property</em>, which states that surrounding two denotationally-equal terms in the same context produces two programs that are denotationally equal.</p>
<p>We begin by showing that denotational equality is a congruence with respect to lambda abstraction: that <code>ℰ N ≃ ℰ N′</code> implies <code>ℰ (ƛ N) ≃ ℰ (ƛ N′)</code>. We shall use the <code>lam-equiv</code> equation to reduce this question to whether <code>ℱ</code> is a congruence.</p>
<pre class="Agda"><a id="ℱ-cong"></a><a id="11170" href="../Compositional/#11170" class="Function">ℱ-cong</a> <a id="11177" class="Symbol">:</a> <a id="11179" class="Symbol">∀{</a><a id="11181" href="../Compositional/#11181" class="Bound">Γ</a><a id="11182" class="Symbol">}{</a><a id="11184" href="../Compositional/#11184" class="Bound">D</a> <a id="11186" href="../Compositional/#11186" class="Bound">D′</a> <a id="11189" class="Symbol">:</a> <a id="11191" href="../Denotational/#17189" class="Function">Denotation</a> <a id="11202" class="Symbol">(</a><a id="11203" href="../Compositional/#11181" class="Bound">Γ</a> <a id="11205" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="11207" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="11208" class="Symbol">)}</a>
  <a id="11213" class="Symbol">→</a> <a id="11215" href="../Compositional/#11184" class="Bound">D</a> <a id="11217" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="11219" href="../Compositional/#11186" class="Bound">D′</a>
    <a id="11226" class="Comment">-----------</a>
  <a id="11240" class="Symbol">→</a> <a id="11242" href="../Compositional/#1896" class="Function">ℱ</a> <a id="11244" href="../Compositional/#11184" class="Bound">D</a> <a id="11246" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="11248" href="../Compositional/#1896" class="Function">ℱ</a> <a id="11250" href="../Compositional/#11186" class="Bound">D′</a>
<a id="11253" href="../Compositional/#11170" class="Function">ℱ-cong</a><a id="11259" class="Symbol">{</a><a id="11260" href="../Compositional/#11260" class="Bound">Γ</a><a id="11261" class="Symbol">}</a> <a id="11263" href="../Compositional/#11263" class="Bound">D≃D′</a> <a id="11268" href="../Compositional/#11268" class="Bound">γ</a> <a id="11270" href="../Compositional/#11270" class="Bound">v</a> <a id="11272" class="Symbol">=</a>
  <a id="11276" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="11278" class="Symbol">(λ</a> <a id="11281" href="../Compositional/#11281" class="Bound">x</a> <a id="11283" class="Symbol">→</a> <a id="11285" href="../Compositional/#11348" class="Function">ℱ≃</a><a id="11287" class="Symbol">{</a><a id="11288" href="../Compositional/#11268" class="Bound">γ</a><a id="11289" class="Symbol">}{</a><a id="11291" href="../Compositional/#11270" class="Bound">v</a><a id="11292" class="Symbol">}</a> <a id="11294" href="../Compositional/#11281" class="Bound">x</a> <a id="11296" href="../Compositional/#11263" class="Bound">D≃D′</a><a id="11300" class="Symbol">)</a> <a id="11302" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="11304" class="Symbol">(λ</a> <a id="11307" href="../Compositional/#11307" class="Bound">x</a> <a id="11309" class="Symbol">→</a> <a id="11311" href="../Compositional/#11348" class="Function">ℱ≃</a><a id="11313" class="Symbol">{</a><a id="11314" href="../Compositional/#11268" class="Bound">γ</a><a id="11315" class="Symbol">}{</a><a id="11317" href="../Compositional/#11270" class="Bound">v</a><a id="11318" class="Symbol">}</a> <a id="11320" href="../Compositional/#11307" class="Bound">x</a> <a id="11322" class="Symbol">(</a><a id="11323" href="../Denotational/#17856" class="Function">≃-sym</a> <a id="11329" href="../Compositional/#11263" class="Bound">D≃D′</a><a id="11333" class="Symbol">))</a> <a id="11336" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
  <a id="11340" class="Keyword">where</a>
  <a id="11348" href="../Compositional/#11348" class="Function">ℱ≃</a> <a id="11351" class="Symbol">:</a> <a id="11353" class="Symbol">∀{</a><a id="11355" href="../Compositional/#11355" class="Bound">γ</a> <a id="11357" class="Symbol">:</a> <a id="11359" href="../Denotational/#7204" class="Function">Env</a> <a id="11363" href="../Compositional/#11260" class="Bound">Γ</a><a id="11364" class="Symbol">}{</a><a id="11366" href="../Compositional/#11366" class="Bound">v</a><a id="11367" class="Symbol">}{</a><a id="11369" href="../Compositional/#11369" class="Bound">D</a> <a id="11371" href="../Compositional/#11371" class="Bound">D′</a> <a id="11374" class="Symbol">:</a> <a id="11376" href="../Denotational/#17189" class="Function">Denotation</a> <a id="11387" class="Symbol">(</a><a id="11388" href="../Compositional/#11260" class="Bound">Γ</a> <a id="11390" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="11392" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="11393" class="Symbol">)}</a>
    <a id="11400" class="Symbol">→</a> <a id="11402" href="../Compositional/#1896" class="Function">ℱ</a> <a id="11404" href="../Compositional/#11369" class="Bound">D</a> <a id="11406" href="../Compositional/#11355" class="Bound">γ</a> <a id="11408" href="../Compositional/#11366" class="Bound">v</a>  <a id="11411" class="Symbol">→</a>  <a id="11414" href="../Compositional/#11369" class="Bound">D</a> <a id="11416" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="11418" href="../Compositional/#11371" class="Bound">D′</a> <a id="11421" class="Symbol">→</a> <a id="11423" href="../Compositional/#1896" class="Function">ℱ</a> <a id="11425" href="../Compositional/#11371" class="Bound">D′</a> <a id="11428" href="../Compositional/#11355" class="Bound">γ</a> <a id="11430" href="../Compositional/#11366" class="Bound">v</a>
  <a id="11434" href="../Compositional/#11348" class="Function">ℱ≃</a> <a id="11437" class="Symbol">{</a><a id="11438" class="Argument">v</a> <a id="11440" class="Symbol">=</a> <a id="11442" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="11443" class="Symbol">}</a> <a id="11445" href="../Compositional/#11445" class="Bound">fd</a> <a id="11448" href="../Compositional/#11448" class="Bound">dd′</a> <a id="11452" class="Symbol">=</a> <a id="11454" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
  <a id="11459" href="../Compositional/#11348" class="Function">ℱ≃</a> <a id="11462" class="Symbol">{</a><a id="11463" href="../Compositional/#11463" class="Bound">γ</a><a id="11464" class="Symbol">}{</a><a id="11466" href="../Compositional/#11466" class="Bound">v</a> <a id="11468" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="11470" href="../Compositional/#11470" class="Bound">w</a><a id="11471" class="Symbol">}</a> <a id="11473" href="../Compositional/#11473" class="Bound">fd</a> <a id="11476" href="../Compositional/#11476" class="Bound">dd′</a> <a id="11480" class="Symbol">=</a> <a id="11482" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="11488" class="Symbol">(</a><a id="11489" href="../Compositional/#11476" class="Bound">dd′</a> <a id="11493" class="Symbol">(</a><a id="11494" href="../Compositional/#11463" class="Bound">γ</a> <a id="11496" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="11499" href="../Compositional/#11466" class="Bound">v</a><a id="11500" class="Symbol">)</a> <a id="11502" href="../Compositional/#11470" class="Bound">w</a><a id="11503" class="Symbol">)</a> <a id="11505" href="../Compositional/#11473" class="Bound">fd</a>
  <a id="11510" href="../Compositional/#11348" class="Function">ℱ≃</a> <a id="11513" class="Symbol">{</a><a id="11514" href="../Compositional/#11514" class="Bound">γ</a><a id="11515" class="Symbol">}{</a><a id="11517" href="../Compositional/#11517" class="Bound">u</a> <a id="11519" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="11521" href="../Compositional/#11521" class="Bound">w</a><a id="11522" class="Symbol">}</a> <a id="11524" href="../Compositional/#11524" class="Bound">fd</a> <a id="11527" href="../Compositional/#11527" class="Bound">dd′</a> <a id="11531" class="Symbol">=</a> <a id="11533" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="11535" href="../Compositional/#11348" class="Function">ℱ≃</a><a id="11537" class="Symbol">{</a><a id="11538" href="../Compositional/#11514" class="Bound">γ</a><a id="11539" class="Symbol">}{</a><a id="11541" href="../Compositional/#11517" class="Bound">u</a><a id="11542" class="Symbol">}</a> <a id="11544" class="Symbol">(</a><a id="11545" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="11551" href="../Compositional/#11524" class="Bound">fd</a><a id="11553" class="Symbol">)</a> <a id="11555" href="../Compositional/#11527" class="Bound">dd′</a> <a id="11559" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="11561" href="../Compositional/#11348" class="Function">ℱ≃</a><a id="11563" class="Symbol">{</a><a id="11564" href="../Compositional/#11514" class="Bound">γ</a><a id="11565" class="Symbol">}{</a><a id="11567" href="../Compositional/#11521" class="Bound">w</a><a id="11568" class="Symbol">}</a> <a id="11570" class="Symbol">(</a><a id="11571" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="11577" href="../Compositional/#11524" class="Bound">fd</a><a id="11579" class="Symbol">)</a> <a id="11581" href="../Compositional/#11527" class="Bound">dd′</a> <a id="11585" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>The proof of <code>ℱ-cong</code> uses the lemma <code>ℱ≃</code> to handle both directions of the if-and-only-if. That lemma is proved by a straightforward induction on the value <code>v</code>.</p>
<p>We now prove that lambda abstraction is a congruence by direct equational reasoning.</p>
<pre class="Agda"><a id="lam-cong"></a><a id="11844" href="../Compositional/#11844" class="Function">lam-cong</a> <a id="11853" class="Symbol">:</a> <a id="11855" class="Symbol">∀{</a><a id="11857" href="../Compositional/#11857" class="Bound">Γ</a><a id="11858" class="Symbol">}{</a><a id="11860" href="../Compositional/#11860" class="Bound">N</a> <a id="11862" href="../Compositional/#11862" class="Bound">N′</a> <a id="11865" class="Symbol">:</a> <a id="11867" href="../Compositional/#11857" class="Bound">Γ</a> <a id="11869" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="11871" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="11873" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="11875" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="11876" class="Symbol">}</a>
  <a id="11880" class="Symbol">→</a> <a id="11882" href="../Denotational/#17402" class="Function">ℰ</a> <a id="11884" href="../Compositional/#11860" class="Bound">N</a> <a id="11886" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="11888" href="../Denotational/#17402" class="Function">ℰ</a> <a id="11890" href="../Compositional/#11862" class="Bound">N′</a>
    <a id="11897" class="Comment">-----------------</a>
  <a id="11917" class="Symbol">→</a> <a id="11919" href="../Denotational/#17402" class="Function">ℰ</a> <a id="11921" class="Symbol">(</a><a id="11922" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="11924" href="../Compositional/#11860" class="Bound">N</a><a id="11925" class="Symbol">)</a> <a id="11927" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="11929" href="../Denotational/#17402" class="Function">ℰ</a> <a id="11931" class="Symbol">(</a><a id="11932" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="11934" href="../Compositional/#11862" class="Bound">N′</a><a id="11936" class="Symbol">)</a>
<a id="11938" href="../Compositional/#11844" class="Function">lam-cong</a> <a id="11947" class="Symbol">{</a><a id="11948" href="../Compositional/#11948" class="Bound">Γ</a><a id="11949" class="Symbol">}{</a><a id="11951" href="../Compositional/#11951" class="Bound">N</a><a id="11952" class="Symbol">}{</a><a id="11954" href="../Compositional/#11954" class="Bound">N′</a><a id="11956" class="Symbol">}</a> <a id="11958" href="../Compositional/#11958" class="Bound">N≃N′</a> <a id="11963" class="Symbol">=</a>
  <a id="11967" href="../Denotational/#19074" class="Function Operator">start</a>
    <a id="11977" href="../Denotational/#17402" class="Function">ℰ</a> <a id="11979" class="Symbol">(</a><a id="11980" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="11982" href="../Compositional/#11951" class="Bound">N</a><a id="11983" class="Symbol">)</a>
  <a id="11987" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="11990" href="../Compositional/#4551" class="Function">lam-equiv</a> <a id="12000" href="../Denotational/#19165" class="Function Operator">⟩</a>
    <a id="12006" href="../Compositional/#1896" class="Function">ℱ</a> <a id="12008" class="Symbol">(</a><a id="12009" href="../Denotational/#17402" class="Function">ℰ</a> <a id="12011" href="../Compositional/#11951" class="Bound">N</a><a id="12012" class="Symbol">)</a>
  <a id="12016" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="12019" href="../Compositional/#11170" class="Function">ℱ-cong</a> <a id="12026" href="../Compositional/#11958" class="Bound">N≃N′</a> <a id="12031" href="../Denotational/#19165" class="Function Operator">⟩</a>
    <a id="12037" href="../Compositional/#1896" class="Function">ℱ</a> <a id="12039" class="Symbol">(</a><a id="12040" href="../Denotational/#17402" class="Function">ℰ</a> <a id="12042" href="../Compositional/#11954" class="Bound">N′</a><a id="12044" class="Symbol">)</a>
  <a id="12048" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="12051" href="../Denotational/#17856" class="Function">≃-sym</a> <a id="12057" href="../Compositional/#4551" class="Function">lam-equiv</a> <a id="12067" href="../Denotational/#19165" class="Function Operator">⟩</a>
    <a id="12073" href="../Denotational/#17402" class="Function">ℰ</a> <a id="12075" class="Symbol">(</a><a id="12076" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="12078" href="../Compositional/#11954" class="Bound">N′</a><a id="12080" class="Symbol">)</a>
  <a id="12084" href="../Denotational/#19412" class="Function Operator">☐</a>
</pre>
<p>Next we prove that denotational equality is a congruence for application: that <code>ℰ L ≃ ℰ L′</code> and <code>ℰ M ≃ ℰ M′</code> imply <code>ℰ (L · M) ≃ ℰ (L′ · M′)</code>. The <code>app-equiv</code> equation reduces this to the question of whether the <code>●</code> operator is a congruence.</p>
<pre class="Agda"><a id="●-cong"></a><a id="12337" href="../Compositional/#12337" class="Function">●-cong</a> <a id="12344" class="Symbol">:</a> <a id="12346" class="Symbol">∀{</a><a id="12348" href="../Compositional/#12348" class="Bound">Γ</a><a id="12349" class="Symbol">}{</a><a id="12351" href="../Compositional/#12351" class="Bound">D₁</a> <a id="12354" href="../Compositional/#12354" class="Bound">D₁′</a> <a id="12358" href="../Compositional/#12358" class="Bound">D₂</a> <a id="12361" href="../Compositional/#12361" class="Bound">D₂′</a> <a id="12365" class="Symbol">:</a> <a id="12367" href="../Denotational/#17189" class="Function">Denotation</a> <a id="12378" href="../Compositional/#12348" class="Bound">Γ</a><a id="12379" class="Symbol">}</a>
  <a id="12383" class="Symbol">→</a> <a id="12385" href="../Compositional/#12351" class="Bound">D₁</a> <a id="12388" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="12390" href="../Compositional/#12354" class="Bound">D₁′</a> <a id="12394" class="Symbol">→</a> <a id="12396" href="../Compositional/#12358" class="Bound">D₂</a> <a id="12399" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="12401" href="../Compositional/#12361" class="Bound">D₂′</a>
  <a id="12407" class="Symbol">→</a> <a id="12409" class="Symbol">(</a><a id="12410" href="../Compositional/#12351" class="Bound">D₁</a> <a id="12413" href="../Compositional/#5744" class="Function Operator">●</a> <a id="12415" href="../Compositional/#12358" class="Bound">D₂</a><a id="12417" class="Symbol">)</a> <a id="12419" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="12421" class="Symbol">(</a><a id="12422" href="../Compositional/#12354" class="Bound">D₁′</a> <a id="12426" href="../Compositional/#5744" class="Function Operator">●</a> <a id="12428" href="../Compositional/#12361" class="Bound">D₂′</a><a id="12431" class="Symbol">)</a>
<a id="12433" href="../Compositional/#12337" class="Function">●-cong</a> <a id="12440" class="Symbol">{</a><a id="12441" href="../Compositional/#12441" class="Bound">Γ</a><a id="12442" class="Symbol">}</a> <a id="12444" href="../Compositional/#12444" class="Bound">d1</a> <a id="12447" href="../Compositional/#12447" class="Bound">d2</a> <a id="12450" href="../Compositional/#12450" class="Bound">γ</a> <a id="12452" href="../Compositional/#12452" class="Bound">v</a> <a id="12454" class="Symbol">=</a> <a id="12456" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="12458" class="Symbol">(λ</a> <a id="12461" href="../Compositional/#12461" class="Bound">x</a> <a id="12463" class="Symbol">→</a> <a id="12465" href="../Compositional/#12551" class="Function">●≃</a> <a id="12468" href="../Compositional/#12461" class="Bound">x</a> <a id="12470" href="../Compositional/#12444" class="Bound">d1</a> <a id="12473" href="../Compositional/#12447" class="Bound">d2</a><a id="12475" class="Symbol">)</a> <a id="12477" href="../Compositional/#776" class="InductiveConstructor Operator">,</a>
                         <a id="12504" class="Symbol">(λ</a> <a id="12507" href="../Compositional/#12507" class="Bound">x</a> <a id="12509" class="Symbol">→</a> <a id="12511" href="../Compositional/#12551" class="Function">●≃</a> <a id="12514" href="../Compositional/#12507" class="Bound">x</a> <a id="12516" class="Symbol">(</a><a id="12517" href="../Denotational/#17856" class="Function">≃-sym</a> <a id="12523" href="../Compositional/#12444" class="Bound">d1</a><a id="12525" class="Symbol">)</a> <a id="12527" class="Symbol">(</a><a id="12528" href="../Denotational/#17856" class="Function">≃-sym</a> <a id="12534" href="../Compositional/#12447" class="Bound">d2</a><a id="12536" class="Symbol">))</a> <a id="12539" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
  <a id="12543" class="Keyword">where</a>
  <a id="12551" href="../Compositional/#12551" class="Function">●≃</a> <a id="12554" class="Symbol">:</a> <a id="12556" class="Symbol">∀{</a><a id="12558" href="../Compositional/#12558" class="Bound">γ</a> <a id="12560" class="Symbol">:</a> <a id="12562" href="../Denotational/#7204" class="Function">Env</a> <a id="12566" href="../Compositional/#12441" class="Bound">Γ</a><a id="12567" class="Symbol">}{</a><a id="12569" href="../Compositional/#12569" class="Bound">v</a><a id="12570" class="Symbol">}{</a><a id="12572" href="../Compositional/#12572" class="Bound">D₁</a> <a id="12575" href="../Compositional/#12575" class="Bound">D₁′</a> <a id="12579" href="../Compositional/#12579" class="Bound">D₂</a> <a id="12582" href="../Compositional/#12582" class="Bound">D₂′</a> <a id="12586" class="Symbol">:</a> <a id="12588" href="../Denotational/#17189" class="Function">Denotation</a> <a id="12599" href="../Compositional/#12441" class="Bound">Γ</a><a id="12600" class="Symbol">}</a>
    <a id="12606" class="Symbol">→</a> <a id="12608" class="Symbol">(</a><a id="12609" href="../Compositional/#12572" class="Bound">D₁</a> <a id="12612" href="../Compositional/#5744" class="Function Operator">●</a> <a id="12614" href="../Compositional/#12579" class="Bound">D₂</a><a id="12616" class="Symbol">)</a> <a id="12618" href="../Compositional/#12558" class="Bound">γ</a> <a id="12620" href="../Compositional/#12569" class="Bound">v</a>  <a id="12623" class="Symbol">→</a>  <a id="12626" href="../Compositional/#12572" class="Bound">D₁</a> <a id="12629" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="12631" href="../Compositional/#12575" class="Bound">D₁′</a>  <a id="12636" class="Symbol">→</a>  <a id="12639" href="../Compositional/#12579" class="Bound">D₂</a> <a id="12642" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="12644" href="../Compositional/#12582" class="Bound">D₂′</a>
    <a id="12652" class="Symbol">→</a> <a id="12654" class="Symbol">(</a><a id="12655" href="../Compositional/#12575" class="Bound">D₁′</a> <a id="12659" href="../Compositional/#5744" class="Function Operator">●</a> <a id="12661" href="../Compositional/#12582" class="Bound">D₂′</a><a id="12664" class="Symbol">)</a> <a id="12666" href="../Compositional/#12558" class="Bound">γ</a> <a id="12668" href="../Compositional/#12569" class="Bound">v</a>
  <a id="12672" href="../Compositional/#12551" class="Function">●≃</a> <a id="12675" class="Symbol">(</a><a id="12676" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="12681" href="../Compositional/#12681" class="Bound">v⊑⊥</a><a id="12684" class="Symbol">)</a> <a id="12686" href="../Compositional/#12686" class="Bound">eq₁</a> <a id="12690" href="../Compositional/#12690" class="Bound">eq₂</a> <a id="12694" class="Symbol">=</a> <a id="12696" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="12701" href="../Compositional/#12681" class="Bound">v⊑⊥</a>
  <a id="12707" href="../Compositional/#12551" class="Function">●≃</a> <a id="12710" class="Symbol">{</a><a id="12711" href="../Compositional/#12711" class="Bound">γ</a><a id="12712" class="Symbol">}</a> <a id="12714" class="Symbol">{</a><a id="12715" href="../Compositional/#12715" class="Bound">w</a><a id="12716" class="Symbol">}</a> <a id="12718" class="Symbol">(</a><a id="12719" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="12724" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="12726" href="../Compositional/#12726" class="Bound">v</a> <a id="12728" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="12730" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="12732" href="../Compositional/#12732" class="Bound">Dv↦w</a> <a id="12737" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="12739" href="../Compositional/#12739" class="Bound">Dv</a> <a id="12742" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="12744" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a><a id="12745" class="Symbol">)</a> <a id="12747" href="../Compositional/#12747" class="Bound">eq₁</a> <a id="12751" href="../Compositional/#12751" class="Bound">eq₂</a> <a id="12755" class="Symbol">=</a>
    <a id="12761" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="12766" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="12768" href="../Compositional/#12726" class="Bound">v</a> <a id="12770" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="12772" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="12774" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="12780" class="Symbol">(</a><a id="12781" href="../Compositional/#12747" class="Bound">eq₁</a> <a id="12785" href="../Compositional/#12711" class="Bound">γ</a> <a id="12787" class="Symbol">(</a><a id="12788" href="../Compositional/#12726" class="Bound">v</a> <a id="12790" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="12792" href="../Compositional/#12715" class="Bound">w</a><a id="12793" class="Symbol">))</a> <a id="12796" href="../Compositional/#12732" class="Bound">Dv↦w</a> <a id="12801" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="12803" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="12809" class="Symbol">(</a><a id="12810" href="../Compositional/#12751" class="Bound">eq₂</a> <a id="12814" href="../Compositional/#12711" class="Bound">γ</a> <a id="12816" href="../Compositional/#12726" class="Bound">v</a><a id="12817" class="Symbol">)</a> <a id="12819" href="../Compositional/#12739" class="Bound">Dv</a> <a id="12822" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a> <a id="12824" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>Again, both directions of the if-and-only-if are proved via a lemma. This time the lemma is proved by cases on <code>(D₁ ● D₂) γ v</code>.</p>
<p>With the congruence of <code>●</code>, we can prove that application is a congruence by direct equational reasoning.</p>
<pre class="Agda"><a id="app-cong"></a><a id="13071" href="../Compositional/#13071" class="Function">app-cong</a> <a id="13080" class="Symbol">:</a> <a id="13082" class="Symbol">∀{</a><a id="13084" href="../Compositional/#13084" class="Bound">Γ</a><a id="13085" class="Symbol">}{</a><a id="13087" href="../Compositional/#13087" class="Bound">L</a> <a id="13089" href="../Compositional/#13089" class="Bound">L′</a> <a id="13092" href="../Compositional/#13092" class="Bound">M</a> <a id="13094" href="../Compositional/#13094" class="Bound">M′</a> <a id="13097" class="Symbol">:</a> <a id="13099" href="../Compositional/#13084" class="Bound">Γ</a> <a id="13101" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="13103" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="13104" class="Symbol">}</a>
  <a id="13108" class="Symbol">→</a> <a id="13110" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13112" href="../Compositional/#13087" class="Bound">L</a> <a id="13114" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="13116" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13118" href="../Compositional/#13089" class="Bound">L′</a>
  <a id="13123" class="Symbol">→</a> <a id="13125" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13127" href="../Compositional/#13092" class="Bound">M</a> <a id="13129" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="13131" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13133" href="../Compositional/#13094" class="Bound">M′</a>
    <a id="13140" class="Comment">-------------------------</a>
  <a id="13168" class="Symbol">→</a> <a id="13170" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13172" class="Symbol">(</a><a id="13173" href="../Compositional/#13087" class="Bound">L</a> <a id="13175" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="13177" href="../Compositional/#13092" class="Bound">M</a><a id="13178" class="Symbol">)</a> <a id="13180" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="13182" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13184" class="Symbol">(</a><a id="13185" href="../Compositional/#13089" class="Bound">L′</a> <a id="13188" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="13190" href="../Compositional/#13094" class="Bound">M′</a><a id="13192" class="Symbol">)</a>
<a id="13194" href="../Compositional/#13071" class="Function">app-cong</a> <a id="13203" class="Symbol">{</a><a id="13204" href="../Compositional/#13204" class="Bound">Γ</a><a id="13205" class="Symbol">}{</a><a id="13207" href="../Compositional/#13207" class="Bound">L</a><a id="13208" class="Symbol">}{</a><a id="13210" href="../Compositional/#13210" class="Bound">L′</a><a id="13212" class="Symbol">}{</a><a id="13214" href="../Compositional/#13214" class="Bound">M</a><a id="13215" class="Symbol">}{</a><a id="13217" href="../Compositional/#13217" class="Bound">M′</a><a id="13219" class="Symbol">}</a> <a id="13221" href="../Compositional/#13221" class="Bound">L≅L′</a> <a id="13226" href="../Compositional/#13226" class="Bound">M≅M′</a> <a id="13231" class="Symbol">=</a>
  <a id="13235" href="../Denotational/#19074" class="Function Operator">start</a>
    <a id="13245" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13247" class="Symbol">(</a><a id="13248" href="../Compositional/#13207" class="Bound">L</a> <a id="13250" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="13252" href="../Compositional/#13214" class="Bound">M</a><a id="13253" class="Symbol">)</a>
  <a id="13257" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="13260" href="../Compositional/#9769" class="Function">app-equiv</a> <a id="13270" href="../Denotational/#19165" class="Function Operator">⟩</a>
    <a id="13276" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13278" href="../Compositional/#13207" class="Bound">L</a> <a id="13280" href="../Compositional/#5744" class="Function Operator">●</a> <a id="13282" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13284" href="../Compositional/#13214" class="Bound">M</a>
  <a id="13288" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="13291" href="../Compositional/#12337" class="Function">●-cong</a> <a id="13298" href="../Compositional/#13221" class="Bound">L≅L′</a> <a id="13303" href="../Compositional/#13226" class="Bound">M≅M′</a> <a id="13308" href="../Denotational/#19165" class="Function Operator">⟩</a>
    <a id="13314" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13316" href="../Compositional/#13210" class="Bound">L′</a> <a id="13319" href="../Compositional/#5744" class="Function Operator">●</a> <a id="13321" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13323" href="../Compositional/#13217" class="Bound">M′</a>
  <a id="13328" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="13331" href="../Denotational/#17856" class="Function">≃-sym</a> <a id="13337" href="../Compositional/#9769" class="Function">app-equiv</a> <a id="13347" href="../Denotational/#19165" class="Function Operator">⟩</a>
    <a id="13353" href="../Denotational/#17402" class="Function">ℰ</a> <a id="13355" class="Symbol">(</a><a id="13356" href="../Compositional/#13210" class="Bound">L′</a> <a id="13359" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="13361" href="../Compositional/#13217" class="Bound">M′</a><a id="13363" class="Symbol">)</a>
  <a id="13367" href="../Denotational/#19412" class="Function Operator">☐</a>
</pre>
<h2 id="compositionality">Compositionality</h2>
<p>The <em>compositionality property</em> states that surrounding two terms that are denotationally equal in the same context produces two programs that are denotationally equal. To make this precise, we define what we mean by “context” and “surround”.</p>
<p>A <em>context</em> is a program with one hole in it. The following data definition <code>Ctx</code> makes this idea explicit. We index the <code>Ctx</code> data type with two contexts for variables: one for the hole and one for terms that result from filling the hole.</p>
<pre class="Agda"><a id="13885" class="Keyword">data</a> <a id="Ctx"></a><a id="13890" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="13894" class="Symbol">:</a> <a id="13896" href="../Untyped/#3135" class="Datatype">Context</a> <a id="13904" class="Symbol">→</a> <a id="13906" href="../Untyped/#3135" class="Datatype">Context</a> <a id="13914" class="Symbol">→</a> <a id="13916" class="PrimitiveType">Set</a> <a id="13920" class="Keyword">where</a>
  <a id="Ctx.ctx-hole"></a><a id="13928" href="../Compositional/#13928" class="InductiveConstructor">ctx-hole</a> <a id="13937" class="Symbol">:</a> <a id="13939" class="Symbol">∀{</a><a id="13941" href="../Compositional/#13941" class="Bound">Γ</a><a id="13942" class="Symbol">}</a> <a id="13944" class="Symbol">→</a> <a id="13946" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="13950" href="../Compositional/#13941" class="Bound">Γ</a> <a id="13952" href="../Compositional/#13941" class="Bound">Γ</a>
  <a id="Ctx.ctx-lam"></a><a id="13956" href="../Compositional/#13956" class="InductiveConstructor">ctx-lam</a> <a id="13964" class="Symbol">:</a>  <a id="13967" class="Symbol">∀{</a><a id="13969" href="../Compositional/#13969" class="Bound">Γ</a> <a id="13971" href="../Compositional/#13971" class="Bound">Δ</a><a id="13972" class="Symbol">}</a> <a id="13974" class="Symbol">→</a> <a id="13976" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="13980" class="Symbol">(</a><a id="13981" href="../Compositional/#13969" class="Bound">Γ</a> <a id="13983" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="13985" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="13986" class="Symbol">)</a> <a id="13988" class="Symbol">(</a><a id="13989" href="../Compositional/#13971" class="Bound">Δ</a> <a id="13991" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="13993" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="13994" class="Symbol">)</a> <a id="13996" class="Symbol">→</a> <a id="13998" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="14002" class="Symbol">(</a><a id="14003" href="../Compositional/#13969" class="Bound">Γ</a> <a id="14005" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="14007" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="14008" class="Symbol">)</a> <a id="14010" href="../Compositional/#13971" class="Bound">Δ</a>
  <a id="Ctx.ctx-app-L"></a><a id="14014" href="../Compositional/#14014" class="InductiveConstructor">ctx-app-L</a> <a id="14024" class="Symbol">:</a> <a id="14026" class="Symbol">∀{</a><a id="14028" href="../Compositional/#14028" class="Bound">Γ</a> <a id="14030" href="../Compositional/#14030" class="Bound">Δ</a><a id="14031" class="Symbol">}</a> <a id="14033" class="Symbol">→</a> <a id="14035" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="14039" href="../Compositional/#14028" class="Bound">Γ</a> <a id="14041" href="../Compositional/#14030" class="Bound">Δ</a> <a id="14043" class="Symbol">→</a> <a id="14045" href="../Compositional/#14030" class="Bound">Δ</a> <a id="14047" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="14049" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="14051" class="Symbol">→</a> <a id="14053" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="14057" href="../Compositional/#14028" class="Bound">Γ</a> <a id="14059" href="../Compositional/#14030" class="Bound">Δ</a>
  <a id="Ctx.ctx-app-R"></a><a id="14063" href="../Compositional/#14063" class="InductiveConstructor">ctx-app-R</a> <a id="14073" class="Symbol">:</a> <a id="14075" class="Symbol">∀{</a><a id="14077" href="../Compositional/#14077" class="Bound">Γ</a> <a id="14079" href="../Compositional/#14079" class="Bound">Δ</a><a id="14080" class="Symbol">}</a> <a id="14082" class="Symbol">→</a> <a id="14084" href="../Compositional/#14079" class="Bound">Δ</a> <a id="14086" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="14088" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="14090" class="Symbol">→</a> <a id="14092" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="14096" href="../Compositional/#14077" class="Bound">Γ</a> <a id="14098" href="../Compositional/#14079" class="Bound">Δ</a> <a id="14100" class="Symbol">→</a> <a id="14102" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="14106" href="../Compositional/#14077" class="Bound">Γ</a> <a id="14108" href="../Compositional/#14079" class="Bound">Δ</a>
</pre>
<ul>
<li><p>The constructor <code>ctx-hole</code> represents the hole, and in this case the variable context for the hole is the same as the variable context for the term that results from filling the hole.</p></li>
<li><p>The constructor <code>ctx-lam</code> takes a <code>Ctx</code> and produces a larger one that adds a lambda abstraction at the top. The variable context of the hole stays the same, whereas we remove one variable from the context of the resulting term because it is bound by this lambda abstraction.</p></li>
<li><p>There are two constructions for application, <code>ctx-app-L</code> and <code>ctx-app-R</code>. The <code>ctx-app-L</code> is for when the hole is inside the left-hand term (the operator) and the later is when the hole is inside the right-hand term (the operand).</p></li>
</ul>
<p>The action of surrounding a term with a context is defined by the following <code>plug</code> function. It is defined by recursion on the context.</p>
<pre class="Agda"><a id="plug"></a><a id="14974" href="../Compositional/#14974" class="Function">plug</a> <a id="14979" class="Symbol">:</a> <a id="14981" class="Symbol">∀{</a><a id="14983" href="../Compositional/#14983" class="Bound">Γ</a><a id="14984" class="Symbol">}{</a><a id="14986" href="../Compositional/#14986" class="Bound">Δ</a><a id="14987" class="Symbol">}</a> <a id="14989" class="Symbol">→</a> <a id="14991" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="14995" href="../Compositional/#14983" class="Bound">Γ</a> <a id="14997" href="../Compositional/#14986" class="Bound">Δ</a> <a id="14999" class="Symbol">→</a> <a id="15001" href="../Compositional/#14983" class="Bound">Γ</a> <a id="15003" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="15005" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="15007" class="Symbol">→</a> <a id="15009" href="../Compositional/#14986" class="Bound">Δ</a> <a id="15011" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="15013" href="../Untyped/#2870" class="InductiveConstructor">★</a>
<a id="15015" href="../Compositional/#14974" class="Function">plug</a> <a id="15020" href="../Compositional/#13928" class="InductiveConstructor">ctx-hole</a> <a id="15029" href="../Compositional/#15029" class="Bound">M</a> <a id="15031" class="Symbol">=</a> <a id="15033" href="../Compositional/#15029" class="Bound">M</a>
<a id="15035" href="../Compositional/#14974" class="Function">plug</a> <a id="15040" class="Symbol">(</a><a id="15041" href="../Compositional/#13956" class="InductiveConstructor">ctx-lam</a> <a id="15049" href="../Compositional/#15049" class="Bound">C</a><a id="15050" class="Symbol">)</a> <a id="15052" href="../Compositional/#15052" class="Bound">N</a> <a id="15054" class="Symbol">=</a> <a id="15056" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="15058" href="../Compositional/#14974" class="Function">plug</a> <a id="15063" href="../Compositional/#15049" class="Bound">C</a> <a id="15065" href="../Compositional/#15052" class="Bound">N</a>
<a id="15067" href="../Compositional/#14974" class="Function">plug</a> <a id="15072" class="Symbol">(</a><a id="15073" href="../Compositional/#14014" class="InductiveConstructor">ctx-app-L</a> <a id="15083" href="../Compositional/#15083" class="Bound">C</a> <a id="15085" href="../Compositional/#15085" class="Bound">N</a><a id="15086" class="Symbol">)</a> <a id="15088" href="../Compositional/#15088" class="Bound">L</a> <a id="15090" class="Symbol">=</a> <a id="15092" class="Symbol">(</a><a id="15093" href="../Compositional/#14974" class="Function">plug</a> <a id="15098" href="../Compositional/#15083" class="Bound">C</a> <a id="15100" href="../Compositional/#15088" class="Bound">L</a><a id="15101" class="Symbol">)</a> <a id="15103" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="15105" href="../Compositional/#15085" class="Bound">N</a>
<a id="15107" href="../Compositional/#14974" class="Function">plug</a> <a id="15112" class="Symbol">(</a><a id="15113" href="../Compositional/#14063" class="InductiveConstructor">ctx-app-R</a> <a id="15123" href="../Compositional/#15123" class="Bound">L</a> <a id="15125" href="../Compositional/#15125" class="Bound">C</a><a id="15126" class="Symbol">)</a> <a id="15128" href="../Compositional/#15128" class="Bound">M</a> <a id="15130" class="Symbol">=</a> <a id="15132" href="../Compositional/#15123" class="Bound">L</a> <a id="15134" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="15136" class="Symbol">(</a><a id="15137" href="../Compositional/#14974" class="Function">plug</a> <a id="15142" href="../Compositional/#15125" class="Bound">C</a> <a id="15144" href="../Compositional/#15128" class="Bound">M</a><a id="15145" class="Symbol">)</a>
</pre>
<p>We are ready to state and prove the compositionality principle. Given two terms <code>M</code> and <code>N</code> that are denotationally equal, plugging them both into an arbitrary context <code>C</code> produces two programs that are denotationally equal.</p>
<pre class="Agda"><a id="compositionality"></a><a id="15383" href="../Compositional/#15383" class="Function">compositionality</a> <a id="15400" class="Symbol">:</a> <a id="15402" class="Symbol">∀{</a><a id="15404" href="../Compositional/#15404" class="Bound">Γ</a> <a id="15406" href="../Compositional/#15406" class="Bound">Δ</a><a id="15407" class="Symbol">}{</a><a id="15409" href="../Compositional/#15409" class="Bound">C</a> <a id="15411" class="Symbol">:</a> <a id="15413" href="../Compositional/#13890" class="Datatype">Ctx</a> <a id="15417" href="../Compositional/#15404" class="Bound">Γ</a> <a id="15419" href="../Compositional/#15406" class="Bound">Δ</a><a id="15420" class="Symbol">}</a> <a id="15422" class="Symbol">{</a><a id="15423" href="../Compositional/#15423" class="Bound">M</a> <a id="15425" href="../Compositional/#15425" class="Bound">N</a> <a id="15427" class="Symbol">:</a> <a id="15429" href="../Compositional/#15404" class="Bound">Γ</a> <a id="15431" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="15433" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="15434" class="Symbol">}</a>
  <a id="15438" class="Symbol">→</a> <a id="15440" href="../Denotational/#17402" class="Function">ℰ</a> <a id="15442" href="../Compositional/#15423" class="Bound">M</a> <a id="15444" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="15446" href="../Denotational/#17402" class="Function">ℰ</a> <a id="15448" href="../Compositional/#15425" class="Bound">N</a>
    <a id="15454" class="Comment">---------------------------</a>
  <a id="15484" class="Symbol">→</a> <a id="15486" href="../Denotational/#17402" class="Function">ℰ</a> <a id="15488" class="Symbol">(</a><a id="15489" href="../Compositional/#14974" class="Function">plug</a> <a id="15494" href="../Compositional/#15409" class="Bound">C</a> <a id="15496" href="../Compositional/#15423" class="Bound">M</a><a id="15497" class="Symbol">)</a> <a id="15499" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="15501" href="../Denotational/#17402" class="Function">ℰ</a> <a id="15503" class="Symbol">(</a><a id="15504" href="../Compositional/#14974" class="Function">plug</a> <a id="15509" href="../Compositional/#15409" class="Bound">C</a> <a id="15511" href="../Compositional/#15425" class="Bound">N</a><a id="15512" class="Symbol">)</a>
<a id="15514" href="../Compositional/#15383" class="Function">compositionality</a> <a id="15531" class="Symbol">{</a><a id="15532" class="Argument">C</a> <a id="15534" class="Symbol">=</a> <a id="15536" href="../Compositional/#13928" class="InductiveConstructor">ctx-hole</a><a id="15544" class="Symbol">}</a> <a id="15546" href="../Compositional/#15546" class="Bound">M≃N</a> <a id="15550" class="Symbol">=</a>
  <a id="15554" href="../Compositional/#15546" class="Bound">M≃N</a>
<a id="15558" href="../Compositional/#15383" class="Function">compositionality</a> <a id="15575" class="Symbol">{</a><a id="15576" class="Argument">C</a> <a id="15578" class="Symbol">=</a> <a id="15580" href="../Compositional/#13956" class="InductiveConstructor">ctx-lam</a> <a id="15588" href="../Compositional/#15588" class="Bound">C′</a><a id="15590" class="Symbol">}</a> <a id="15592" href="../Compositional/#15592" class="Bound">M≃N</a> <a id="15596" class="Symbol">=</a>
  <a id="15600" href="../Compositional/#11844" class="Function">lam-cong</a> <a id="15609" class="Symbol">(</a><a id="15610" href="../Compositional/#15383" class="Function">compositionality</a> <a id="15627" class="Symbol">{</a><a id="15628" class="Argument">C</a> <a id="15630" class="Symbol">=</a> <a id="15632" href="../Compositional/#15588" class="Bound">C′</a><a id="15634" class="Symbol">}</a> <a id="15636" href="../Compositional/#15592" class="Bound">M≃N</a><a id="15639" class="Symbol">)</a>
<a id="15641" href="../Compositional/#15383" class="Function">compositionality</a> <a id="15658" class="Symbol">{</a><a id="15659" class="Argument">C</a> <a id="15661" class="Symbol">=</a> <a id="15663" href="../Compositional/#14014" class="InductiveConstructor">ctx-app-L</a> <a id="15673" href="../Compositional/#15673" class="Bound">C′</a> <a id="15676" href="../Compositional/#15676" class="Bound">L</a><a id="15677" class="Symbol">}</a> <a id="15679" href="../Compositional/#15679" class="Bound">M≃N</a> <a id="15683" class="Symbol">=</a>
  <a id="15687" href="../Compositional/#13071" class="Function">app-cong</a> <a id="15696" class="Symbol">(</a><a id="15697" href="../Compositional/#15383" class="Function">compositionality</a> <a id="15714" class="Symbol">{</a><a id="15715" class="Argument">C</a> <a id="15717" class="Symbol">=</a> <a id="15719" href="../Compositional/#15673" class="Bound">C′</a><a id="15721" class="Symbol">}</a> <a id="15723" href="../Compositional/#15679" class="Bound">M≃N</a><a id="15726" class="Symbol">)</a> <a id="15728" class="Symbol">λ</a> <a id="15730" href="../Compositional/#15730" class="Bound">γ</a> <a id="15732" href="../Compositional/#15732" class="Bound">v</a> <a id="15734" class="Symbol">→</a> <a id="15736" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="15738" class="Symbol">(λ</a> <a id="15741" href="../Compositional/#15741" class="Bound">x</a> <a id="15743" class="Symbol">→</a> <a id="15745" href="../Compositional/#15741" class="Bound">x</a><a id="15746" class="Symbol">)</a> <a id="15748" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="15750" class="Symbol">(λ</a> <a id="15753" href="../Compositional/#15753" class="Bound">x</a> <a id="15755" class="Symbol">→</a> <a id="15757" href="../Compositional/#15753" class="Bound">x</a><a id="15758" class="Symbol">)</a> <a id="15760" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a>
<a id="15762" href="../Compositional/#15383" class="Function">compositionality</a> <a id="15779" class="Symbol">{</a><a id="15780" class="Argument">C</a> <a id="15782" class="Symbol">=</a> <a id="15784" href="../Compositional/#14063" class="InductiveConstructor">ctx-app-R</a> <a id="15794" href="../Compositional/#15794" class="Bound">L</a> <a id="15796" href="../Compositional/#15796" class="Bound">C′</a><a id="15798" class="Symbol">}</a> <a id="15800" href="../Compositional/#15800" class="Bound">M≃N</a> <a id="15804" class="Symbol">=</a>
  <a id="15808" href="../Compositional/#13071" class="Function">app-cong</a> <a id="15817" class="Symbol">(λ</a> <a id="15820" href="../Compositional/#15820" class="Bound">γ</a> <a id="15822" href="../Compositional/#15822" class="Bound">v</a> <a id="15824" class="Symbol">→</a> <a id="15826" href="../Compositional/#776" class="InductiveConstructor Operator">⟨</a> <a id="15828" class="Symbol">(λ</a> <a id="15831" href="../Compositional/#15831" class="Bound">x</a> <a id="15833" class="Symbol">→</a> <a id="15835" href="../Compositional/#15831" class="Bound">x</a><a id="15836" class="Symbol">)</a> <a id="15838" href="../Compositional/#776" class="InductiveConstructor Operator">,</a> <a id="15840" class="Symbol">(λ</a> <a id="15843" href="../Compositional/#15843" class="Bound">x</a> <a id="15845" class="Symbol">→</a> <a id="15847" href="../Compositional/#15843" class="Bound">x</a><a id="15848" class="Symbol">)</a> <a id="15850" href="../Compositional/#776" class="InductiveConstructor Operator">⟩</a><a id="15851" class="Symbol">)</a> <a id="15853" class="Symbol">(</a><a id="15854" href="../Compositional/#15383" class="Function">compositionality</a> <a id="15871" class="Symbol">{</a><a id="15872" class="Argument">C</a> <a id="15874" class="Symbol">=</a> <a id="15876" href="../Compositional/#15796" class="Bound">C′</a><a id="15878" class="Symbol">}</a> <a id="15880" href="../Compositional/#15800" class="Bound">M≃N</a><a id="15883" class="Symbol">)</a>
</pre>
<p>The proof is a straightforward induction on the context <code>C</code>, using the congruence properties <code>lam-cong</code> and <code>app-cong</code> that we established above.</p>
<h2 id="the-denotational-semantics-defined-as-a-function">The denotational semantics defined as a function</h2>
<p>Having established the three equations <code>var-equiv</code>, <code>lam-equiv</code>, and <code>app-equiv</code>, one should be able to define the denotational semantics as a recursive function over the input term <code>M</code>. Indeed, we define the following function <code>⟦ M ⟧</code> that maps terms to denotations, using the auxiliary curry <code>ℱ</code> and apply <code>●</code> functions in the cases for lambda and application, respectively.</p>
<pre class="Agda"><a id="⟦_⟧"></a><a id="16472" href="../Compositional/#16472" class="Function Operator">⟦_⟧</a> <a id="16476" class="Symbol">:</a> <a id="16478" class="Symbol">∀{</a><a id="16480" href="../Compositional/#16480" class="Bound">Γ</a><a id="16481" class="Symbol">}</a> <a id="16483" class="Symbol">→</a> <a id="16485" class="Symbol">(</a><a id="16486" href="../Compositional/#16486" class="Bound">M</a> <a id="16488" class="Symbol">:</a> <a id="16490" href="../Compositional/#16480" class="Bound">Γ</a> <a id="16492" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="16494" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="16495" class="Symbol">)</a> <a id="16497" class="Symbol">→</a> <a id="16499" href="../Denotational/#17189" class="Function">Denotation</a> <a id="16510" href="../Compositional/#16480" class="Bound">Γ</a>
<a id="16512" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="16514" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="16516" href="../Compositional/#16516" class="Bound">x</a> <a id="16518" href="../Compositional/#16472" class="Function Operator">⟧</a> <a id="16520" href="../Compositional/#16520" class="Bound">γ</a> <a id="16522" href="../Compositional/#16522" class="Bound">v</a> <a id="16524" class="Symbol">=</a> <a id="16526" href="../Compositional/#16522" class="Bound">v</a> <a id="16528" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="16530" href="../Compositional/#16520" class="Bound">γ</a> <a id="16532" href="../Compositional/#16516" class="Bound">x</a>
<a id="16534" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="16536" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="16538" href="../Compositional/#16538" class="Bound">N</a> <a id="16540" href="../Compositional/#16472" class="Function Operator">⟧</a> <a id="16542" class="Symbol">=</a> <a id="16544" href="../Compositional/#1896" class="Function">ℱ</a> <a id="16546" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="16548" href="../Compositional/#16538" class="Bound">N</a> <a id="16550" href="../Compositional/#16472" class="Function Operator">⟧</a>
<a id="16552" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="16554" href="../Compositional/#16554" class="Bound">L</a> <a id="16556" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="16558" href="../Compositional/#16558" class="Bound">M</a> <a id="16560" href="../Compositional/#16472" class="Function Operator">⟧</a> <a id="16562" class="Symbol">=</a> <a id="16564" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="16566" href="../Compositional/#16554" class="Bound">L</a> <a id="16568" href="../Compositional/#16472" class="Function Operator">⟧</a> <a id="16570" href="../Compositional/#5744" class="Function Operator">●</a> <a id="16572" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="16574" href="../Compositional/#16558" class="Bound">M</a> <a id="16576" href="../Compositional/#16472" class="Function Operator">⟧</a>
</pre>
<p>The proof that <code>ℰ M</code> is denotationally equal to <code>⟦ M ⟧</code> is a straightforward induction, using the three equations <code>var-equiv</code>, <code>lam-equiv</code>, and <code>app-equiv</code> together with the congruence lemmas for <code>ℱ</code> and <code>●</code>.</p>
<pre class="Agda"><a id="ℰ≃⟦⟧"></a><a id="16797" href="../Compositional/#16797" class="Function">ℰ≃⟦⟧</a> <a id="16802" class="Symbol">:</a> <a id="16804" class="Symbol">∀</a> <a id="16806" class="Symbol">{</a><a id="16807" href="../Compositional/#16807" class="Bound">Γ</a><a id="16808" class="Symbol">}</a> <a id="16810" class="Symbol">{</a><a id="16811" href="../Compositional/#16811" class="Bound">M</a> <a id="16813" class="Symbol">:</a> <a id="16815" href="../Compositional/#16807" class="Bound">Γ</a> <a id="16817" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="16819" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="16820" class="Symbol">}</a> <a id="16822" class="Symbol">→</a> <a id="16824" href="../Denotational/#17402" class="Function">ℰ</a> <a id="16826" href="../Compositional/#16811" class="Bound">M</a> <a id="16828" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="16830" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="16832" href="../Compositional/#16811" class="Bound">M</a> <a id="16834" href="../Compositional/#16472" class="Function Operator">⟧</a>
<a id="16836" href="../Compositional/#16797" class="Function">ℰ≃⟦⟧</a> <a id="16841" class="Symbol">{</a><a id="16842" href="../Compositional/#16842" class="Bound">Γ</a><a id="16843" class="Symbol">}</a> <a id="16845" class="Symbol">{</a><a id="16846" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="16848" href="../Compositional/#16848" class="Bound">x</a><a id="16849" class="Symbol">}</a> <a id="16851" class="Symbol">=</a> <a id="16853" href="../Compositional/#10340" class="Function">var-equiv</a>
<a id="16863" href="../Compositional/#16797" class="Function">ℰ≃⟦⟧</a> <a id="16868" class="Symbol">{</a><a id="16869" href="../Compositional/#16869" class="Bound">Γ</a><a id="16870" class="Symbol">}</a> <a id="16872" class="Symbol">{</a><a id="16873" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="16875" href="../Compositional/#16875" class="Bound">N</a><a id="16876" class="Symbol">}</a> <a id="16878" class="Symbol">=</a>
  <a id="16882" class="Keyword">let</a> <a id="16886" href="../Compositional/#16886" class="Bound">ih</a> <a id="16889" class="Symbol">=</a> <a id="16891" href="../Compositional/#16797" class="Function">ℰ≃⟦⟧</a> <a id="16896" class="Symbol">{</a><a id="16897" class="Argument">M</a> <a id="16899" class="Symbol">=</a> <a id="16901" href="../Compositional/#16875" class="Bound">N</a><a id="16902" class="Symbol">}</a> <a id="16904" class="Keyword">in</a>
    <a id="16911" href="../Denotational/#17402" class="Function">ℰ</a> <a id="16913" class="Symbol">(</a><a id="16914" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="16916" href="../Compositional/#16875" class="Bound">N</a><a id="16917" class="Symbol">)</a>
  <a id="16921" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="16924" href="../Compositional/#4551" class="Function">lam-equiv</a> <a id="16934" href="../Denotational/#19165" class="Function Operator">⟩</a>
    <a id="16940" href="../Compositional/#1896" class="Function">ℱ</a> <a id="16942" class="Symbol">(</a><a id="16943" href="../Denotational/#17402" class="Function">ℰ</a> <a id="16945" href="../Compositional/#16875" class="Bound">N</a><a id="16946" class="Symbol">)</a>
  <a id="16950" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="16953" href="../Compositional/#11170" class="Function">ℱ-cong</a> <a id="16960" class="Symbol">(</a><a id="16961" href="../Compositional/#16797" class="Function">ℰ≃⟦⟧</a> <a id="16966" class="Symbol">{</a><a id="16967" class="Argument">M</a> <a id="16969" class="Symbol">=</a> <a id="16971" href="../Compositional/#16875" class="Bound">N</a><a id="16972" class="Symbol">})</a> <a id="16975" href="../Denotational/#19165" class="Function Operator">⟩</a>
    <a id="16981" href="../Compositional/#1896" class="Function">ℱ</a> <a id="16983" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="16985" href="../Compositional/#16875" class="Bound">N</a> <a id="16987" href="../Compositional/#16472" class="Function Operator">⟧</a>
  <a id="16991" href="../Denotational/#19305" class="Function Operator">≃⟨⟩</a>
    <a id="16999" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="17001" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="17003" href="../Compositional/#16875" class="Bound">N</a> <a id="17005" href="../Compositional/#16472" class="Function Operator">⟧</a>
  <a id="17009" href="../Denotational/#19412" class="Function Operator">☐</a>
<a id="17011" href="../Compositional/#16797" class="Function">ℰ≃⟦⟧</a> <a id="17016" class="Symbol">{</a><a id="17017" href="../Compositional/#17017" class="Bound">Γ</a><a id="17018" class="Symbol">}</a> <a id="17020" class="Symbol">{</a><a id="17021" href="../Compositional/#17021" class="Bound">L</a> <a id="17023" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="17025" href="../Compositional/#17025" class="Bound">M</a><a id="17026" class="Symbol">}</a> <a id="17028" class="Symbol">=</a>
   <a id="17033" href="../Denotational/#17402" class="Function">ℰ</a> <a id="17035" class="Symbol">(</a><a id="17036" href="../Compositional/#17021" class="Bound">L</a> <a id="17038" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="17040" href="../Compositional/#17025" class="Bound">M</a><a id="17041" class="Symbol">)</a>
  <a id="17045" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="17048" href="../Compositional/#9769" class="Function">app-equiv</a> <a id="17058" href="../Denotational/#19165" class="Function Operator">⟩</a>
   <a id="17063" href="../Denotational/#17402" class="Function">ℰ</a> <a id="17065" href="../Compositional/#17021" class="Bound">L</a> <a id="17067" href="../Compositional/#5744" class="Function Operator">●</a> <a id="17069" href="../Denotational/#17402" class="Function">ℰ</a> <a id="17071" href="../Compositional/#17025" class="Bound">M</a>
  <a id="17075" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="17078" href="../Compositional/#12337" class="Function">●-cong</a> <a id="17085" class="Symbol">(</a><a id="17086" href="../Compositional/#16797" class="Function">ℰ≃⟦⟧</a> <a id="17091" class="Symbol">{</a><a id="17092" class="Argument">M</a> <a id="17094" class="Symbol">=</a> <a id="17096" href="../Compositional/#17021" class="Bound">L</a><a id="17097" class="Symbol">})</a> <a id="17100" class="Symbol">(</a><a id="17101" href="../Compositional/#16797" class="Function">ℰ≃⟦⟧</a> <a id="17106" class="Symbol">{</a><a id="17107" class="Argument">M</a> <a id="17109" class="Symbol">=</a> <a id="17111" href="../Compositional/#17025" class="Bound">M</a><a id="17112" class="Symbol">})</a> <a id="17115" href="../Denotational/#19165" class="Function Operator">⟩</a>
   <a id="17120" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="17122" href="../Compositional/#17021" class="Bound">L</a> <a id="17124" href="../Compositional/#16472" class="Function Operator">⟧</a> <a id="17126" href="../Compositional/#5744" class="Function Operator">●</a> <a id="17128" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="17130" href="../Compositional/#17025" class="Bound">M</a> <a id="17132" href="../Compositional/#16472" class="Function Operator">⟧</a>
  <a id="17136" href="../Denotational/#19305" class="Function Operator">≃⟨⟩</a>
    <a id="17144" href="../Compositional/#16472" class="Function Operator">⟦</a> <a id="17146" href="../Compositional/#17021" class="Bound">L</a> <a id="17148" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="17150" href="../Compositional/#17025" class="Bound">M</a> <a id="17152" href="../Compositional/#16472" class="Function Operator">⟧</a>
  <a id="17156" href="../Denotational/#19412" class="Function Operator">☐</a>
</pre>
<h2 id="unicode">Unicode</h2>
<p>This chapter uses the following unicode:</p>
<pre><code>ℱ  U+2131  SCRIPT CAPITAL F (\McF)
●  U+2131  BLACK CIRCLE (\cib)</code></pre>
    </div>
    <nav class="pager">
    <ul class="pagination">
        
        <li><a class="pagelink" href="../Denotational/">上一章</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/part3/Compositional.lagda.md">源文件</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="../Soundness/">下一章</a></li>
        <li class="separator">&bullet;</li>
        
    </ul>
</nav>

</article>

            </div>
        </main>
        <footer class="site-footer h-card">
    <data class="u-url" href="../"></data>
    <div class="wrapper">
        <h2 class="footer-heading">编程语言基础：Agda 语言描述</h2>
        
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Philip Wadler</li>
                    <li>
                        
                        <a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/wadler" title="wadler"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;wadler</a></li>
    
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Wen Kokke</li>
                    <li>
                        
                        <a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/wenkokke" title="wenkokke"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;wenkokke</a></li>
    
    
    <li><a rel="me" href="https://twitter.com/wenkokke" title="wenkokke"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#twitter"></use></svg>&nbsp;wenkokke</a></li>
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Jeremy G. Siek</li>
                    <li>
                        
                        <a class="u-email" href="mailto:jsiek@indiana.edu">jsiek@indiana.edu</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/jsiek" title="jsiek"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;jsiek</a></li>
    
    
    <li><a rel="me" href="https://twitter.com/jeremysiek" title="jeremysiek"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#twitter"></use></svg>&nbsp;jeremysiek</a></li>
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        
        This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
    </div>
</footer>

    </body>
</html>
