<!DOCTYPE html>
<html lang="en">
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../public/css/style.css">
  
  <title>编程语言基础：Agda 语言描述 – Confluence</title>
  
  
  
</head>

    <body>
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="../">编程语言基础：Agda 语言描述</a>
        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="../">主页</a>
                <a class="page-link" href="../Announcements/">公告</a>
                <a class="page-link" href="../GettingStarted/">使用说明</a>
                <a class="page-link" href="../Citing/">引用</a>
                <a class="page-link" href="https://plfa.github.io/">English</a>
            </div>
        </nav>
    </div>
</header>

        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                <article class="post">
    <nav class="pager">
    <ul class="pagination">
        
        <li><a class="pagelink" href="../Untyped/">上一章</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/part2/Confluence.lagda.md">源文件</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="../BigStep/">下一章</a></li>
        <li class="separator">&bullet;</li>
        
    </ul>
</nav>

    <header class="post-header">
        <h1 class="post-title" id="confluence">Confluence: Confluence of untyped lambda calculus</h1>
    </header>
    <div class="post-content">
        <pre class="Agda"><a id="164" class="Keyword">module</a> <a id="171" href="../Confluence/" class="Module">plfa.part2.Confluence</a> <a id="193" class="Keyword">where</a>
</pre>
<h2 id="introduction">Introduction</h2>
<p>In this chapter we prove that beta reduction is <em>confluent</em>, a property also known as <em>Church-Rosser</em>. That is, if there are reduction sequences from any term <code>L</code> to two different terms <code>M₁</code> and <code>M₂</code>, then there exist reduction sequences from those two terms to some common term <code>N</code>. In pictures:</p>
<pre><code>    L
   / \
  /   \
 /     \
M₁      M₂
 \     /
  \   /
   \ /
    N</code></pre>
<p>where downward lines are instances of <code>—↠</code>.</p>
<p>Confluence is studied in many other kinds of rewrite systems besides the lambda calculus, and it is well known how to prove confluence in rewrite systems that enjoy the <em>diamond property</em>, a single-step version of confluence. Let <code>⇛</code> be a relation. Then <code>⇛</code> has the diamond property if whenever <code>L ⇛ M₁</code> and <code>L ⇛ M₂</code>, then there exists an <code>N</code> such that <code>M₁ ⇛ N</code> and <code>M₂ ⇛ N</code>. This is just an instance of the same picture above, where downward lines are now instance of <code>⇛</code>. If we write <code>⇛*</code> for the reflexive and transitive closure of <code>⇛</code>, then confluence of <code>⇛*</code> follows immediately from the diamond property.</p>
<p>Unfortunately, reduction in the lambda calculus does not satisfy the diamond property. Here is a counter example.</p>
<pre><code>(λ x. x x)((λ x. x) a) —→ (λ x. x x) a
(λ x. x x)((λ x. x) a) —→ ((λ x. x) a) ((λ x. x) a)</code></pre>
<p>Both terms can reduce to <code>a a</code>, but the second term requires two steps to get there, not one.</p>
<p>To side-step this problem, we’ll define an auxiliary reduction relation, called <em>parallel reduction</em>, that can perform many reductions simultaneously and thereby satisfy the diamond property. Furthermore, we show that a parallel reduction sequence exists between any two terms if and only if a beta reduction sequence exists between them. Thus, we can reduce the proof of confluence for beta reduction to confluence for parallel reduction.</p>
<h2 id="imports">Imports</h2>
<pre class="Agda"><a id="2053" class="Keyword">open</a> <a id="2058" class="Keyword">import</a> <a id="2065" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="2103" class="Keyword">using</a> <a id="2109" class="Symbol">(</a><a id="2110" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="2113" class="Symbol">;</a> <a id="2115" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="2119" class="Symbol">)</a>
<a id="2121" class="Keyword">open</a> <a id="2126" class="Keyword">import</a> <a id="2133" href="https://agda.github.io/agda-stdlib/v1.3/Function.html" class="Module">Function</a> <a id="2142" class="Keyword">using</a> <a id="2148" class="Symbol">(</a><a id="2149" href="https://agda.github.io/agda-stdlib/v1.3/Function.Base.html#992" class="Function Operator">_∘_</a><a id="2152" class="Symbol">)</a>
<a id="2154" class="Keyword">open</a> <a id="2159" class="Keyword">import</a> <a id="2166" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html" class="Module">Data.Product</a> <a id="2179" class="Keyword">using</a> <a id="2185" class="Symbol">(</a><a id="2186" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">_×_</a><a id="2189" class="Symbol">;</a> <a id="2191" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#166" class="Record">Σ</a><a id="2192" class="Symbol">;</a> <a id="2194" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ-syntax</a><a id="2202" class="Symbol">;</a> <a id="2204" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1369" class="Function">∃</a><a id="2205" class="Symbol">;</a> <a id="2207" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1788" class="Function">∃-syntax</a><a id="2215" class="Symbol">;</a> <a id="2217" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a><a id="2222" class="Symbol">;</a> <a id="2224" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#264" class="Field">proj₂</a><a id="2229" class="Symbol">)</a>
  <a id="2233" class="Keyword">renaming</a> <a id="2242" class="Symbol">(</a><a id="2243" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="2247" class="Symbol">to</a> <a id="_,_"></a><a id="2250" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="2255" class="Symbol">)</a>
<a id="2257" class="Keyword">open</a> <a id="2262" class="Keyword">import</a> <a id="2269" href="../Substitution/" class="Module">plfa.part2.Substitution</a> <a id="2293" class="Keyword">using</a> <a id="2299" class="Symbol">(</a><a id="2300" href="../Substitution/#2192" class="Function">Rename</a><a id="2306" class="Symbol">;</a> <a id="2308" href="../Substitution/#2405" class="Function">Subst</a><a id="2313" class="Symbol">)</a>
<a id="2315" class="Keyword">open</a> <a id="2320" class="Keyword">import</a> <a id="2327" href="../Untyped/" class="Module">plfa.part2.Untyped</a>
  <a id="2348" class="Keyword">using</a> <a id="2354" class="Symbol">(</a><a id="2355" href="../Untyped/#9930" class="Datatype Operator">_—→_</a><a id="2359" class="Symbol">;</a> <a id="2361" href="../Untyped/#10160" class="InductiveConstructor">β</a><a id="2362" class="Symbol">;</a> <a id="2364" href="../Untyped/#9980" class="InductiveConstructor">ξ₁</a><a id="2366" class="Symbol">;</a> <a id="2368" href="../Untyped/#10070" class="InductiveConstructor">ξ₂</a><a id="2370" class="Symbol">;</a> <a id="2372" href="../Untyped/#10268" class="InductiveConstructor">ζ</a><a id="2373" class="Symbol">;</a> <a id="2375" href="../Untyped/#11050" class="Datatype Operator">_—↠_</a><a id="2379" class="Symbol">;</a> <a id="2381" href="../Untyped/#11256" class="Function Operator">begin_</a><a id="2387" class="Symbol">;</a> <a id="2389" href="../Untyped/#11156" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="2396" class="Symbol">;</a> <a id="2398" href="../Untyped/#21981" class="Function Operator">_—↠⟨_⟩_</a><a id="2405" class="Symbol">;</a> <a id="2407" href="../Untyped/#11100" class="InductiveConstructor Operator">_∎</a><a id="2409" class="Symbol">;</a>
  <a id="2413" href="../Untyped/#23874" class="Function">abs-cong</a><a id="2421" class="Symbol">;</a> <a id="2423" href="../Untyped/#22877" class="Function">appL-cong</a><a id="2432" class="Symbol">;</a> <a id="2434" href="../Untyped/#23646" class="Function">appR-cong</a><a id="2443" class="Symbol">;</a> <a id="2445" href="../Untyped/#21711" class="Function">—↠-trans</a><a id="2453" class="Symbol">;</a>
  <a id="2457" href="../Untyped/#4276" class="Datatype Operator">_⊢_</a><a id="2460" class="Symbol">;</a> <a id="2462" href="../Untyped/#3503" class="Datatype Operator">_∋_</a><a id="2465" class="Symbol">;</a> <a id="2467" href="../Untyped/#4312" class="InductiveConstructor Operator">`_</a><a id="2469" class="Symbol">;</a> <a id="2471" href="../Untyped/#5093" class="Function Operator">#_</a><a id="2473" class="Symbol">;</a> <a id="2475" href="../Untyped/#3173" class="InductiveConstructor Operator">_,_</a><a id="2478" class="Symbol">;</a> <a id="2480" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="2481" class="Symbol">;</a> <a id="2483" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ_</a><a id="2485" class="Symbol">;</a> <a id="2487" href="../Untyped/#4424" class="InductiveConstructor Operator">_·_</a><a id="2490" class="Symbol">;</a> <a id="2492" href="../Untyped/#7473" class="Function Operator">_[_]</a><a id="2496" class="Symbol">;</a>
  <a id="2500" href="../Untyped/#6217" class="Function">rename</a><a id="2506" class="Symbol">;</a> <a id="2508" href="../Untyped/#5907" class="Function">ext</a><a id="2511" class="Symbol">;</a> <a id="2513" href="../Untyped/#6653" class="Function">exts</a><a id="2517" class="Symbol">;</a> <a id="2519" href="../Untyped/#3539" class="InductiveConstructor">Z</a><a id="2520" class="Symbol">;</a> <a id="2522" href="../Untyped/#3584" class="InductiveConstructor Operator">S_</a><a id="2524" class="Symbol">;</a> <a id="2526" href="../Untyped/#6945" class="Function">subst</a><a id="2531" class="Symbol">;</a> <a id="2533" href="../Untyped/#7357" class="Function">subst-zero</a><a id="2543" class="Symbol">)</a>
</pre>
<h2 id="parallel-reduction">Parallel Reduction</h2>
<p>The parallel reduction relation is defined as follows.</p>
<pre class="Agda"><a id="2633" class="Keyword">infix</a> <a id="2639" class="Number">2</a> <a id="2641" href="../Confluence/#2651" class="Datatype Operator">_⇛_</a>

<a id="2646" class="Keyword">data</a> <a id="_⇛_"></a><a id="2651" href="../Confluence/#2651" class="Datatype Operator">_⇛_</a> <a id="2655" class="Symbol">:</a> <a id="2657" class="Symbol">∀</a> <a id="2659" class="Symbol">{</a><a id="2660" href="../Confluence/#2660" class="Bound">Γ</a> <a id="2662" href="../Confluence/#2662" class="Bound">A</a><a id="2663" class="Symbol">}</a> <a id="2665" class="Symbol">→</a> <a id="2667" class="Symbol">(</a><a id="2668" href="../Confluence/#2660" class="Bound">Γ</a> <a id="2670" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="2672" href="../Confluence/#2662" class="Bound">A</a><a id="2673" class="Symbol">)</a> <a id="2675" class="Symbol">→</a> <a id="2677" class="Symbol">(</a><a id="2678" href="../Confluence/#2660" class="Bound">Γ</a> <a id="2680" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="2682" href="../Confluence/#2662" class="Bound">A</a><a id="2683" class="Symbol">)</a> <a id="2685" class="Symbol">→</a> <a id="2687" class="PrimitiveType">Set</a> <a id="2691" class="Keyword">where</a>

  <a id="_⇛_.pvar"></a><a id="2700" href="../Confluence/#2700" class="InductiveConstructor">pvar</a> <a id="2705" class="Symbol">:</a> <a id="2707" class="Symbol">∀{</a><a id="2709" href="../Confluence/#2709" class="Bound">Γ</a> <a id="2711" href="../Confluence/#2711" class="Bound">A</a><a id="2712" class="Symbol">}{</a><a id="2714" href="../Confluence/#2714" class="Bound">x</a> <a id="2716" class="Symbol">:</a> <a id="2718" href="../Confluence/#2709" class="Bound">Γ</a> <a id="2720" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="2722" href="../Confluence/#2711" class="Bound">A</a><a id="2723" class="Symbol">}</a>
      <a id="2731" class="Comment">---------</a>
    <a id="2745" class="Symbol">→</a> <a id="2747" class="Symbol">(</a><a id="2748" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="2750" href="../Confluence/#2714" class="Bound">x</a><a id="2751" class="Symbol">)</a> <a id="2753" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="2755" class="Symbol">(</a><a id="2756" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="2758" href="../Confluence/#2714" class="Bound">x</a><a id="2759" class="Symbol">)</a>

  <a id="_⇛_.pabs"></a><a id="2764" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="2769" class="Symbol">:</a> <a id="2771" class="Symbol">∀{</a><a id="2773" href="../Confluence/#2773" class="Bound">Γ</a><a id="2774" class="Symbol">}{</a><a id="2776" href="../Confluence/#2776" class="Bound">N</a> <a id="2778" href="../Confluence/#2778" class="Bound">N′</a> <a id="2781" class="Symbol">:</a> <a id="2783" href="../Confluence/#2773" class="Bound">Γ</a> <a id="2785" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="2787" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="2789" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="2791" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="2792" class="Symbol">}</a>
    <a id="2798" class="Symbol">→</a> <a id="2800" href="../Confluence/#2776" class="Bound">N</a> <a id="2802" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="2804" href="../Confluence/#2778" class="Bound">N′</a>
      <a id="2813" class="Comment">----------</a>
    <a id="2828" class="Symbol">→</a> <a id="2830" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="2832" href="../Confluence/#2776" class="Bound">N</a> <a id="2834" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="2836" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="2838" href="../Confluence/#2778" class="Bound">N′</a>

  <a id="_⇛_.papp"></a><a id="2844" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="2849" class="Symbol">:</a> <a id="2851" class="Symbol">∀{</a><a id="2853" href="../Confluence/#2853" class="Bound">Γ</a><a id="2854" class="Symbol">}{</a><a id="2856" href="../Confluence/#2856" class="Bound">L</a> <a id="2858" href="../Confluence/#2858" class="Bound">L′</a> <a id="2861" href="../Confluence/#2861" class="Bound">M</a> <a id="2863" href="../Confluence/#2863" class="Bound">M′</a> <a id="2866" class="Symbol">:</a> <a id="2868" href="../Confluence/#2853" class="Bound">Γ</a> <a id="2870" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="2872" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="2873" class="Symbol">}</a>
    <a id="2879" class="Symbol">→</a> <a id="2881" href="../Confluence/#2856" class="Bound">L</a> <a id="2883" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="2885" href="../Confluence/#2858" class="Bound">L′</a>
    <a id="2892" class="Symbol">→</a> <a id="2894" href="../Confluence/#2861" class="Bound">M</a> <a id="2896" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="2898" href="../Confluence/#2863" class="Bound">M′</a>
      <a id="2907" class="Comment">-----------------</a>
    <a id="2929" class="Symbol">→</a> <a id="2931" href="../Confluence/#2856" class="Bound">L</a> <a id="2933" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="2935" href="../Confluence/#2861" class="Bound">M</a> <a id="2937" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="2939" href="../Confluence/#2858" class="Bound">L′</a> <a id="2942" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="2944" href="../Confluence/#2863" class="Bound">M′</a>

  <a id="_⇛_.pbeta"></a><a id="2950" href="../Confluence/#2950" class="InductiveConstructor">pbeta</a> <a id="2956" class="Symbol">:</a> <a id="2958" class="Symbol">∀{</a><a id="2960" href="../Confluence/#2960" class="Bound">Γ</a><a id="2961" class="Symbol">}{</a><a id="2963" href="../Confluence/#2963" class="Bound">N</a> <a id="2965" href="../Confluence/#2965" class="Bound">N′</a>  <a id="2969" class="Symbol">:</a> <a id="2971" href="../Confluence/#2960" class="Bound">Γ</a> <a id="2973" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="2975" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="2977" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="2979" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="2980" class="Symbol">}{</a><a id="2982" href="../Confluence/#2982" class="Bound">M</a> <a id="2984" href="../Confluence/#2984" class="Bound">M′</a> <a id="2987" class="Symbol">:</a> <a id="2989" href="../Confluence/#2960" class="Bound">Γ</a> <a id="2991" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="2993" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="2994" class="Symbol">}</a>
    <a id="3000" class="Symbol">→</a> <a id="3002" href="../Confluence/#2963" class="Bound">N</a> <a id="3004" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="3006" href="../Confluence/#2965" class="Bound">N′</a>
    <a id="3013" class="Symbol">→</a> <a id="3015" href="../Confluence/#2982" class="Bound">M</a> <a id="3017" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="3019" href="../Confluence/#2984" class="Bound">M′</a>
      <a id="3028" class="Comment">-----------------------</a>
    <a id="3056" class="Symbol">→</a> <a id="3058" class="Symbol">(</a><a id="3059" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="3061" href="../Confluence/#2963" class="Bound">N</a><a id="3062" class="Symbol">)</a> <a id="3064" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="3066" href="../Confluence/#2982" class="Bound">M</a>  <a id="3069" href="../Confluence/#2651" class="Datatype Operator">⇛</a>  <a id="3072" href="../Confluence/#2965" class="Bound">N′</a> <a id="3075" href="../Untyped/#7473" class="Function Operator">[</a> <a id="3077" href="../Confluence/#2984" class="Bound">M′</a> <a id="3080" href="../Untyped/#7473" class="Function Operator">]</a>
</pre>
<p>The first three rules are congruences that reduce each of their parts simultaneously. The last rule reduces a lambda term and term in parallel followed by a beta step.</p>
<p>We remark that the <code>pabs</code>, <code>papp</code>, and <code>pbeta</code> rules perform reduction on all their subexpressions simultaneously. Also, the <code>pabs</code> rule is akin to the <code>ζ</code> rule and <code>pbeta</code> is akin to <code>β</code>.</p>
<p>Parallel reduction is reflexive.</p>
<pre class="Agda"><a id="par-refl"></a><a id="3483" href="../Confluence/#3483" class="Function">par-refl</a> <a id="3492" class="Symbol">:</a> <a id="3494" class="Symbol">∀{</a><a id="3496" href="../Confluence/#3496" class="Bound">Γ</a> <a id="3498" href="../Confluence/#3498" class="Bound">A</a><a id="3499" class="Symbol">}{</a><a id="3501" href="../Confluence/#3501" class="Bound">M</a> <a id="3503" class="Symbol">:</a> <a id="3505" href="../Confluence/#3496" class="Bound">Γ</a> <a id="3507" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="3509" href="../Confluence/#3498" class="Bound">A</a><a id="3510" class="Symbol">}</a> <a id="3512" class="Symbol">→</a> <a id="3514" href="../Confluence/#3501" class="Bound">M</a> <a id="3516" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="3518" href="../Confluence/#3501" class="Bound">M</a>
<a id="3520" href="../Confluence/#3483" class="Function">par-refl</a> <a id="3529" class="Symbol">{</a><a id="3530" href="../Confluence/#3530" class="Bound">Γ</a><a id="3531" class="Symbol">}</a> <a id="3533" class="Symbol">{</a><a id="3534" href="../Confluence/#3534" class="Bound">A</a><a id="3535" class="Symbol">}</a> <a id="3537" class="Symbol">{</a><a id="3538" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="3540" href="../Confluence/#3540" class="Bound">x</a><a id="3541" class="Symbol">}</a> <a id="3543" class="Symbol">=</a> <a id="3545" href="../Confluence/#2700" class="InductiveConstructor">pvar</a>
<a id="3550" href="../Confluence/#3483" class="Function">par-refl</a> <a id="3559" class="Symbol">{</a><a id="3560" href="../Confluence/#3560" class="Bound">Γ</a><a id="3561" class="Symbol">}</a> <a id="3563" class="Symbol">{</a><a id="3564" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="3565" class="Symbol">}</a> <a id="3567" class="Symbol">{</a><a id="3568" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="3570" href="../Confluence/#3570" class="Bound">N</a><a id="3571" class="Symbol">}</a> <a id="3573" class="Symbol">=</a> <a id="3575" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="3580" href="../Confluence/#3483" class="Function">par-refl</a>
<a id="3589" href="../Confluence/#3483" class="Function">par-refl</a> <a id="3598" class="Symbol">{</a><a id="3599" href="../Confluence/#3599" class="Bound">Γ</a><a id="3600" class="Symbol">}</a> <a id="3602" class="Symbol">{</a><a id="3603" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="3604" class="Symbol">}</a> <a id="3606" class="Symbol">{</a><a id="3607" href="../Confluence/#3607" class="Bound">L</a> <a id="3609" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="3611" href="../Confluence/#3611" class="Bound">M</a><a id="3612" class="Symbol">}</a> <a id="3614" class="Symbol">=</a> <a id="3616" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="3621" href="../Confluence/#3483" class="Function">par-refl</a> <a id="3630" href="../Confluence/#3483" class="Function">par-refl</a>
</pre>
<p>We define the sequences of parallel reduction as follows.</p>
<pre class="Agda"><a id="3706" class="Keyword">infix</a>  <a id="3713" class="Number">2</a> <a id="3715" href="../Confluence/#3754" class="Datatype Operator">_⇛*_</a>
<a id="3720" class="Keyword">infixr</a> <a id="3727" class="Number">2</a> <a id="3729" href="../Confluence/#3860" class="InductiveConstructor Operator">_⇛⟨_⟩_</a>
<a id="3736" class="Keyword">infix</a>  <a id="3743" class="Number">3</a> <a id="3745" href="../Confluence/#3804" class="InductiveConstructor Operator">_∎</a>

<a id="3749" class="Keyword">data</a> <a id="_⇛*_"></a><a id="3754" href="../Confluence/#3754" class="Datatype Operator">_⇛*_</a> <a id="3759" class="Symbol">:</a> <a id="3761" class="Symbol">∀</a> <a id="3763" class="Symbol">{</a><a id="3764" href="../Confluence/#3764" class="Bound">Γ</a> <a id="3766" href="../Confluence/#3766" class="Bound">A</a><a id="3767" class="Symbol">}</a> <a id="3769" class="Symbol">→</a> <a id="3771" class="Symbol">(</a><a id="3772" href="../Confluence/#3764" class="Bound">Γ</a> <a id="3774" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="3776" href="../Confluence/#3766" class="Bound">A</a><a id="3777" class="Symbol">)</a> <a id="3779" class="Symbol">→</a> <a id="3781" class="Symbol">(</a><a id="3782" href="../Confluence/#3764" class="Bound">Γ</a> <a id="3784" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="3786" href="../Confluence/#3766" class="Bound">A</a><a id="3787" class="Symbol">)</a> <a id="3789" class="Symbol">→</a> <a id="3791" class="PrimitiveType">Set</a> <a id="3795" class="Keyword">where</a>

  <a id="_⇛*_._∎"></a><a id="3804" href="../Confluence/#3804" class="InductiveConstructor Operator">_∎</a> <a id="3807" class="Symbol">:</a> <a id="3809" class="Symbol">∀</a> <a id="3811" class="Symbol">{</a><a id="3812" href="../Confluence/#3812" class="Bound">Γ</a> <a id="3814" href="../Confluence/#3814" class="Bound">A</a><a id="3815" class="Symbol">}</a> <a id="3817" class="Symbol">(</a><a id="3818" href="../Confluence/#3818" class="Bound">M</a> <a id="3820" class="Symbol">:</a> <a id="3822" href="../Confluence/#3812" class="Bound">Γ</a> <a id="3824" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="3826" href="../Confluence/#3814" class="Bound">A</a><a id="3827" class="Symbol">)</a>
      <a id="3835" class="Comment">--------</a>
    <a id="3848" class="Symbol">→</a> <a id="3850" href="../Confluence/#3818" class="Bound">M</a> <a id="3852" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="3855" href="../Confluence/#3818" class="Bound">M</a>

  <a id="_⇛*_._⇛⟨_⟩_"></a><a id="3860" href="../Confluence/#3860" class="InductiveConstructor Operator">_⇛⟨_⟩_</a> <a id="3867" class="Symbol">:</a> <a id="3869" class="Symbol">∀</a> <a id="3871" class="Symbol">{</a><a id="3872" href="../Confluence/#3872" class="Bound">Γ</a> <a id="3874" href="../Confluence/#3874" class="Bound">A</a><a id="3875" class="Symbol">}</a> <a id="3877" class="Symbol">(</a><a id="3878" href="../Confluence/#3878" class="Bound">L</a> <a id="3880" class="Symbol">:</a> <a id="3882" href="../Confluence/#3872" class="Bound">Γ</a> <a id="3884" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="3886" href="../Confluence/#3874" class="Bound">A</a><a id="3887" class="Symbol">)</a> <a id="3889" class="Symbol">{</a><a id="3890" href="../Confluence/#3890" class="Bound">M</a> <a id="3892" href="../Confluence/#3892" class="Bound">N</a> <a id="3894" class="Symbol">:</a> <a id="3896" href="../Confluence/#3872" class="Bound">Γ</a> <a id="3898" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="3900" href="../Confluence/#3874" class="Bound">A</a><a id="3901" class="Symbol">}</a>
    <a id="3907" class="Symbol">→</a> <a id="3909" href="../Confluence/#3878" class="Bound">L</a> <a id="3911" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="3913" href="../Confluence/#3890" class="Bound">M</a>
    <a id="3919" class="Symbol">→</a> <a id="3921" href="../Confluence/#3890" class="Bound">M</a> <a id="3923" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="3926" href="../Confluence/#3892" class="Bound">N</a>
      <a id="3934" class="Comment">---------</a>
    <a id="3948" class="Symbol">→</a> <a id="3950" href="../Confluence/#3878" class="Bound">L</a> <a id="3952" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="3955" href="../Confluence/#3892" class="Bound">N</a>
</pre>
<h4 id="exercise-par-diamond-eg-practice">Exercise <code>par-diamond-eg</code> (practice)</h4>
<p>Revisit the counter example to the diamond property for reduction by showing that the diamond property holds for parallel reduction in that case.</p>
<pre class="Agda"><a id="4157" class="Comment">-- Your code goes here</a>
</pre>
<h2 id="equivalence-between-parallel-reduction-and-reduction">Equivalence between parallel reduction and reduction</h2>
<p>Here we prove that for any <code>M</code> and <code>N</code>, <code>M ⇛* N</code> if and only if <code>M —↠ N</code>. The only-if direction is particularly easy. We start by showing that if <code>M —→ N</code>, then <code>M ⇛ N</code>. The proof is by induction on the reduction <code>M —→ N</code>.</p>
<pre class="Agda"><a id="beta-par"></a><a id="4471" href="../Confluence/#4471" class="Function">beta-par</a> <a id="4480" class="Symbol">:</a> <a id="4482" class="Symbol">∀{</a><a id="4484" href="../Confluence/#4484" class="Bound">Γ</a> <a id="4486" href="../Confluence/#4486" class="Bound">A</a><a id="4487" class="Symbol">}{</a><a id="4489" href="../Confluence/#4489" class="Bound">M</a> <a id="4491" href="../Confluence/#4491" class="Bound">N</a> <a id="4493" class="Symbol">:</a> <a id="4495" href="../Confluence/#4484" class="Bound">Γ</a> <a id="4497" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="4499" href="../Confluence/#4486" class="Bound">A</a><a id="4500" class="Symbol">}</a>
  <a id="4504" class="Symbol">→</a> <a id="4506" href="../Confluence/#4489" class="Bound">M</a> <a id="4508" href="../Untyped/#9930" class="Datatype Operator">—→</a> <a id="4511" href="../Confluence/#4491" class="Bound">N</a>
    <a id="4517" class="Comment">------</a>
  <a id="4526" class="Symbol">→</a> <a id="4528" href="../Confluence/#4489" class="Bound">M</a> <a id="4530" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="4532" href="../Confluence/#4491" class="Bound">N</a>
<a id="4534" href="../Confluence/#4471" class="Function">beta-par</a> <a id="4543" class="Symbol">{</a><a id="4544" href="../Confluence/#4544" class="Bound">Γ</a><a id="4545" class="Symbol">}</a> <a id="4547" class="Symbol">{</a><a id="4548" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="4549" class="Symbol">}</a> <a id="4551" class="Symbol">{</a><a id="4552" href="../Confluence/#4552" class="Bound">L</a> <a id="4554" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="4556" href="../Confluence/#4556" class="Bound">M</a><a id="4557" class="Symbol">}</a> <a id="4559" class="Symbol">(</a><a id="4560" href="../Untyped/#9980" class="InductiveConstructor">ξ₁</a> <a id="4563" href="../Confluence/#4563" class="Bound">r</a><a id="4564" class="Symbol">)</a> <a id="4566" class="Symbol">=</a> <a id="4568" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="4573" class="Symbol">(</a><a id="4574" href="../Confluence/#4471" class="Function">beta-par</a> <a id="4583" class="Symbol">{</a><a id="4584" class="Argument">M</a> <a id="4586" class="Symbol">=</a> <a id="4588" href="../Confluence/#4552" class="Bound">L</a><a id="4589" class="Symbol">}</a> <a id="4591" href="../Confluence/#4563" class="Bound">r</a><a id="4592" class="Symbol">)</a> <a id="4594" href="../Confluence/#3483" class="Function">par-refl</a>
<a id="4603" href="../Confluence/#4471" class="Function">beta-par</a> <a id="4612" class="Symbol">{</a><a id="4613" href="../Confluence/#4613" class="Bound">Γ</a><a id="4614" class="Symbol">}</a> <a id="4616" class="Symbol">{</a><a id="4617" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="4618" class="Symbol">}</a> <a id="4620" class="Symbol">{</a><a id="4621" href="../Confluence/#4621" class="Bound">L</a> <a id="4623" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="4625" href="../Confluence/#4625" class="Bound">M</a><a id="4626" class="Symbol">}</a> <a id="4628" class="Symbol">(</a><a id="4629" href="../Untyped/#10070" class="InductiveConstructor">ξ₂</a> <a id="4632" href="../Confluence/#4632" class="Bound">r</a><a id="4633" class="Symbol">)</a> <a id="4635" class="Symbol">=</a> <a id="4637" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="4642" href="../Confluence/#3483" class="Function">par-refl</a> <a id="4651" class="Symbol">(</a><a id="4652" href="../Confluence/#4471" class="Function">beta-par</a> <a id="4661" class="Symbol">{</a><a id="4662" class="Argument">M</a> <a id="4664" class="Symbol">=</a> <a id="4666" href="../Confluence/#4625" class="Bound">M</a><a id="4667" class="Symbol">}</a> <a id="4669" href="../Confluence/#4632" class="Bound">r</a><a id="4670" class="Symbol">)</a>
<a id="4672" href="../Confluence/#4471" class="Function">beta-par</a> <a id="4681" class="Symbol">{</a><a id="4682" href="../Confluence/#4682" class="Bound">Γ</a><a id="4683" class="Symbol">}</a> <a id="4685" class="Symbol">{</a><a id="4686" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="4687" class="Symbol">}</a> <a id="4689" class="Symbol">{(</a><a id="4691" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="4693" href="../Confluence/#4693" class="Bound">N</a><a id="4694" class="Symbol">)</a> <a id="4696" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="4698" href="../Confluence/#4698" class="Bound">M</a><a id="4699" class="Symbol">}</a> <a id="4701" href="../Untyped/#10160" class="InductiveConstructor">β</a> <a id="4703" class="Symbol">=</a> <a id="4705" href="../Confluence/#2950" class="InductiveConstructor">pbeta</a> <a id="4711" href="../Confluence/#3483" class="Function">par-refl</a> <a id="4720" href="../Confluence/#3483" class="Function">par-refl</a>
<a id="4729" href="../Confluence/#4471" class="Function">beta-par</a> <a id="4738" class="Symbol">{</a><a id="4739" href="../Confluence/#4739" class="Bound">Γ</a><a id="4740" class="Symbol">}</a> <a id="4742" class="Symbol">{</a><a id="4743" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="4744" class="Symbol">}</a> <a id="4746" class="Symbol">{</a><a id="4747" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="4749" href="../Confluence/#4749" class="Bound">N</a><a id="4750" class="Symbol">}</a> <a id="4752" class="Symbol">(</a><a id="4753" href="../Untyped/#10268" class="InductiveConstructor">ζ</a> <a id="4755" href="../Confluence/#4755" class="Bound">r</a><a id="4756" class="Symbol">)</a> <a id="4758" class="Symbol">=</a> <a id="4760" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="4765" class="Symbol">(</a><a id="4766" href="../Confluence/#4471" class="Function">beta-par</a> <a id="4775" href="../Confluence/#4755" class="Bound">r</a><a id="4776" class="Symbol">)</a>
</pre>
<p>With this lemma in hand we complete the only-if direction, that <code>M —↠ N</code> implies <code>M ⇛* N</code>. The proof is a straightforward induction on the reduction sequence <code>M —↠ N</code>.</p>
<pre class="Agda"><a id="betas-pars"></a><a id="4956" href="../Confluence/#4956" class="Function">betas-pars</a> <a id="4967" class="Symbol">:</a> <a id="4969" class="Symbol">∀{</a><a id="4971" href="../Confluence/#4971" class="Bound">Γ</a> <a id="4973" href="../Confluence/#4973" class="Bound">A</a><a id="4974" class="Symbol">}</a> <a id="4976" class="Symbol">{</a><a id="4977" href="../Confluence/#4977" class="Bound">M</a> <a id="4979" href="../Confluence/#4979" class="Bound">N</a> <a id="4981" class="Symbol">:</a> <a id="4983" href="../Confluence/#4971" class="Bound">Γ</a> <a id="4985" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="4987" href="../Confluence/#4973" class="Bound">A</a><a id="4988" class="Symbol">}</a>
  <a id="4992" class="Symbol">→</a> <a id="4994" href="../Confluence/#4977" class="Bound">M</a> <a id="4996" href="../Untyped/#11050" class="Datatype Operator">—↠</a> <a id="4999" href="../Confluence/#4979" class="Bound">N</a>
    <a id="5005" class="Comment">------</a>
  <a id="5014" class="Symbol">→</a> <a id="5016" href="../Confluence/#4977" class="Bound">M</a> <a id="5018" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="5021" href="../Confluence/#4979" class="Bound">N</a>
<a id="5023" href="../Confluence/#4956" class="Function">betas-pars</a> <a id="5034" class="Symbol">{</a><a id="5035" href="../Confluence/#5035" class="Bound">Γ</a><a id="5036" class="Symbol">}</a> <a id="5038" class="Symbol">{</a><a id="5039" href="../Confluence/#5039" class="Bound">A</a><a id="5040" class="Symbol">}</a> <a id="5042" class="Symbol">{</a><a id="5043" href="../Confluence/#5043" class="Bound">M₁</a><a id="5045" class="Symbol">}</a> <a id="5047" class="Symbol">{</a><a id="5048" class="DottedPattern Symbol">.</a><a id="5049" href="../Confluence/#5043" class="DottedPattern Bound">M₁</a><a id="5051" class="Symbol">}</a> <a id="5053" class="Symbol">(</a><a id="5054" href="../Confluence/#5043" class="Bound">M₁</a> <a id="5057" href="../Untyped/#11100" class="InductiveConstructor Operator">∎</a><a id="5058" class="Symbol">)</a> <a id="5060" class="Symbol">=</a> <a id="5062" href="../Confluence/#5043" class="Bound">M₁</a> <a id="5065" href="../Confluence/#3804" class="InductiveConstructor Operator">∎</a>
<a id="5067" href="../Confluence/#4956" class="Function">betas-pars</a> <a id="5078" class="Symbol">{</a><a id="5079" href="../Confluence/#5079" class="Bound">Γ</a><a id="5080" class="Symbol">}</a> <a id="5082" class="Symbol">{</a><a id="5083" href="../Confluence/#5083" class="Bound">A</a><a id="5084" class="Symbol">}</a> <a id="5086" class="Symbol">{</a><a id="5087" class="DottedPattern Symbol">.</a><a id="5088" href="../Confluence/#5096" class="DottedPattern Bound">L</a><a id="5089" class="Symbol">}</a> <a id="5091" class="Symbol">{</a><a id="5092" href="../Confluence/#5092" class="Bound">N</a><a id="5093" class="Symbol">}</a> <a id="5095" class="Symbol">(</a><a id="5096" href="../Confluence/#5096" class="Bound">L</a> <a id="5098" href="../Untyped/#11156" class="InductiveConstructor Operator">—→⟨</a> <a id="5102" href="../Confluence/#5102" class="Bound">b</a> <a id="5104" href="../Untyped/#11156" class="InductiveConstructor Operator">⟩</a> <a id="5106" href="../Confluence/#5106" class="Bound">bs</a><a id="5108" class="Symbol">)</a> <a id="5110" class="Symbol">=</a>
   <a id="5115" href="../Confluence/#5096" class="Bound">L</a> <a id="5117" href="../Confluence/#3860" class="InductiveConstructor Operator">⇛⟨</a> <a id="5120" href="../Confluence/#4471" class="Function">beta-par</a> <a id="5129" href="../Confluence/#5102" class="Bound">b</a> <a id="5131" href="../Confluence/#3860" class="InductiveConstructor Operator">⟩</a> <a id="5133" href="../Confluence/#4956" class="Function">betas-pars</a> <a id="5144" href="../Confluence/#5106" class="Bound">bs</a>
</pre>
<p>Now for the other direction, that <code>M ⇛* N</code> implies <code>M —↠ N</code>. The proof of this direction is a bit different because it’s not the case that <code>M ⇛ N</code> implies <code>M —→ N</code>. After all, <code>M ⇛ N</code> performs many reductions. So instead we shall prove that <code>M ⇛ N</code> implies <code>M —↠ N</code>.</p>
<pre class="Agda"><a id="par-betas"></a><a id="5425" href="../Confluence/#5425" class="Function">par-betas</a> <a id="5435" class="Symbol">:</a> <a id="5437" class="Symbol">∀{</a><a id="5439" href="../Confluence/#5439" class="Bound">Γ</a> <a id="5441" href="../Confluence/#5441" class="Bound">A</a><a id="5442" class="Symbol">}{</a><a id="5444" href="../Confluence/#5444" class="Bound">M</a> <a id="5446" href="../Confluence/#5446" class="Bound">N</a> <a id="5448" class="Symbol">:</a> <a id="5450" href="../Confluence/#5439" class="Bound">Γ</a> <a id="5452" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="5454" href="../Confluence/#5441" class="Bound">A</a><a id="5455" class="Symbol">}</a>
  <a id="5459" class="Symbol">→</a> <a id="5461" href="../Confluence/#5444" class="Bound">M</a> <a id="5463" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="5465" href="../Confluence/#5446" class="Bound">N</a>
    <a id="5471" class="Comment">------</a>
  <a id="5480" class="Symbol">→</a> <a id="5482" href="../Confluence/#5444" class="Bound">M</a> <a id="5484" href="../Untyped/#11050" class="Datatype Operator">—↠</a> <a id="5487" href="../Confluence/#5446" class="Bound">N</a>
<a id="5489" href="../Confluence/#5425" class="Function">par-betas</a> <a id="5499" class="Symbol">{</a><a id="5500" href="../Confluence/#5500" class="Bound">Γ</a><a id="5501" class="Symbol">}</a> <a id="5503" class="Symbol">{</a><a id="5504" href="../Confluence/#5504" class="Bound">A</a><a id="5505" class="Symbol">}</a> <a id="5507" class="Symbol">{</a><a id="5508" class="DottedPattern Symbol">.(</a><a id="5510" href="../Untyped/#4312" class="DottedPattern InductiveConstructor Operator">`</a> <a id="5512" class="DottedPattern Symbol">_)</a><a id="5514" class="Symbol">}</a> <a id="5516" class="Symbol">(</a><a id="5517" href="../Confluence/#2700" class="InductiveConstructor">pvar</a><a id="5521" class="Symbol">{</a><a id="5522" class="Argument">x</a> <a id="5524" class="Symbol">=</a> <a id="5526" href="../Confluence/#5526" class="Bound">x</a><a id="5527" class="Symbol">})</a> <a id="5530" class="Symbol">=</a> <a id="5532" class="Symbol">(</a><a id="5533" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="5535" href="../Confluence/#5526" class="Bound">x</a><a id="5536" class="Symbol">)</a> <a id="5538" href="../Untyped/#11100" class="InductiveConstructor Operator">∎</a>
<a id="5540" href="../Confluence/#5425" class="Function">par-betas</a> <a id="5550" class="Symbol">{</a><a id="5551" href="../Confluence/#5551" class="Bound">Γ</a><a id="5552" class="Symbol">}</a> <a id="5554" class="Symbol">{</a><a id="5555" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="5556" class="Symbol">}</a> <a id="5558" class="Symbol">{</a><a id="5559" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="5561" href="../Confluence/#5561" class="Bound">N</a><a id="5562" class="Symbol">}</a> <a id="5564" class="Symbol">(</a><a id="5565" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="5570" href="../Confluence/#5570" class="Bound">p</a><a id="5571" class="Symbol">)</a> <a id="5573" class="Symbol">=</a> <a id="5575" href="../Untyped/#23874" class="Function">abs-cong</a> <a id="5584" class="Symbol">(</a><a id="5585" href="../Confluence/#5425" class="Function">par-betas</a> <a id="5595" href="../Confluence/#5570" class="Bound">p</a><a id="5596" class="Symbol">)</a>
<a id="5598" href="../Confluence/#5425" class="Function">par-betas</a> <a id="5608" class="Symbol">{</a><a id="5609" href="../Confluence/#5609" class="Bound">Γ</a><a id="5610" class="Symbol">}</a> <a id="5612" class="Symbol">{</a><a id="5613" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="5614" class="Symbol">}</a> <a id="5616" class="Symbol">{</a><a id="5617" href="../Confluence/#5617" class="Bound">L</a> <a id="5619" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="5621" href="../Confluence/#5621" class="Bound">M</a><a id="5622" class="Symbol">}</a> <a id="5624" class="Symbol">(</a><a id="5625" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="5630" class="Symbol">{</a><a id="5631" class="Argument">L</a> <a id="5633" class="Symbol">=</a> <a id="5635" href="../Confluence/#5617" class="Bound">L</a><a id="5636" class="Symbol">}{</a><a id="5638" href="../Confluence/#5638" class="Bound">L′</a><a id="5640" class="Symbol">}{</a><a id="5642" href="../Confluence/#5621" class="Bound">M</a><a id="5643" class="Symbol">}{</a><a id="5645" href="../Confluence/#5645" class="Bound">M′</a><a id="5647" class="Symbol">}</a> <a id="5649" href="../Confluence/#5649" class="Bound">p₁</a> <a id="5652" href="../Confluence/#5652" class="Bound">p₂</a><a id="5654" class="Symbol">)</a> <a id="5656" class="Symbol">=</a>
    <a id="5662" href="../Untyped/#11256" class="Function Operator">begin</a>
    <a id="5672" href="../Confluence/#5617" class="Bound">L</a> <a id="5674" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="5676" href="../Confluence/#5621" class="Bound">M</a>   <a id="5680" href="../Untyped/#21981" class="Function Operator">—↠⟨</a> <a id="5684" href="../Untyped/#22877" class="Function">appL-cong</a><a id="5693" class="Symbol">{</a><a id="5694" class="Argument">M</a> <a id="5696" class="Symbol">=</a> <a id="5698" href="../Confluence/#5621" class="Bound">M</a><a id="5699" class="Symbol">}</a> <a id="5701" class="Symbol">(</a><a id="5702" href="../Confluence/#5425" class="Function">par-betas</a> <a id="5712" href="../Confluence/#5649" class="Bound">p₁</a><a id="5714" class="Symbol">)</a> <a id="5716" href="../Untyped/#21981" class="Function Operator">⟩</a>
    <a id="5722" href="../Confluence/#5638" class="Bound">L′</a> <a id="5725" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="5727" href="../Confluence/#5621" class="Bound">M</a>  <a id="5730" href="../Untyped/#21981" class="Function Operator">—↠⟨</a> <a id="5734" href="../Untyped/#23646" class="Function">appR-cong</a> <a id="5744" class="Symbol">(</a><a id="5745" href="../Confluence/#5425" class="Function">par-betas</a> <a id="5755" href="../Confluence/#5652" class="Bound">p₂</a><a id="5757" class="Symbol">)</a> <a id="5759" href="../Untyped/#21981" class="Function Operator">⟩</a>
    <a id="5765" href="../Confluence/#5638" class="Bound">L′</a> <a id="5768" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="5770" href="../Confluence/#5645" class="Bound">M′</a>
    <a id="5777" href="../Untyped/#11100" class="InductiveConstructor Operator">∎</a>
<a id="5779" href="../Confluence/#5425" class="Function">par-betas</a> <a id="5789" class="Symbol">{</a><a id="5790" href="../Confluence/#5790" class="Bound">Γ</a><a id="5791" class="Symbol">}</a> <a id="5793" class="Symbol">{</a><a id="5794" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="5795" class="Symbol">}</a> <a id="5797" class="Symbol">{(</a><a id="5799" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="5801" href="../Confluence/#5801" class="Bound">N</a><a id="5802" class="Symbol">)</a> <a id="5804" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="5806" href="../Confluence/#5806" class="Bound">M</a><a id="5807" class="Symbol">}</a> <a id="5809" class="Symbol">(</a><a id="5810" href="../Confluence/#2950" class="InductiveConstructor">pbeta</a><a id="5815" class="Symbol">{</a><a id="5816" class="Argument">N′</a> <a id="5819" class="Symbol">=</a> <a id="5821" href="../Confluence/#5821" class="Bound">N′</a><a id="5823" class="Symbol">}{</a><a id="5825" class="Argument">M′</a> <a id="5828" class="Symbol">=</a> <a id="5830" href="../Confluence/#5830" class="Bound">M′</a><a id="5832" class="Symbol">}</a> <a id="5834" href="../Confluence/#5834" class="Bound">p₁</a> <a id="5837" href="../Confluence/#5837" class="Bound">p₂</a><a id="5839" class="Symbol">)</a> <a id="5841" class="Symbol">=</a>
    <a id="5847" href="../Untyped/#11256" class="Function Operator">begin</a>
    <a id="5857" class="Symbol">(</a><a id="5858" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="5860" href="../Confluence/#5801" class="Bound">N</a><a id="5861" class="Symbol">)</a> <a id="5863" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="5865" href="../Confluence/#5806" class="Bound">M</a>                    <a id="5886" href="../Untyped/#21981" class="Function Operator">—↠⟨</a> <a id="5890" href="../Untyped/#22877" class="Function">appL-cong</a><a id="5899" class="Symbol">{</a><a id="5900" class="Argument">M</a> <a id="5902" class="Symbol">=</a> <a id="5904" href="../Confluence/#5806" class="Bound">M</a><a id="5905" class="Symbol">}</a> <a id="5907" class="Symbol">(</a><a id="5908" href="../Untyped/#23874" class="Function">abs-cong</a> <a id="5917" class="Symbol">(</a><a id="5918" href="../Confluence/#5425" class="Function">par-betas</a> <a id="5928" href="../Confluence/#5834" class="Bound">p₁</a><a id="5930" class="Symbol">))</a> <a id="5933" href="../Untyped/#21981" class="Function Operator">⟩</a>
    <a id="5939" class="Symbol">(</a><a id="5940" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="5942" href="../Confluence/#5821" class="Bound">N′</a><a id="5944" class="Symbol">)</a> <a id="5946" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="5948" href="../Confluence/#5806" class="Bound">M</a>                   <a id="5968" href="../Untyped/#21981" class="Function Operator">—↠⟨</a> <a id="5972" href="../Untyped/#23646" class="Function">appR-cong</a><a id="5981" class="Symbol">{</a><a id="5982" class="Argument">L</a> <a id="5984" class="Symbol">=</a> <a id="5986" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="5988" href="../Confluence/#5821" class="Bound">N′</a><a id="5990" class="Symbol">}</a> <a id="5992" class="Symbol">(</a><a id="5993" href="../Confluence/#5425" class="Function">par-betas</a> <a id="6003" href="../Confluence/#5837" class="Bound">p₂</a><a id="6005" class="Symbol">)</a>  <a id="6008" href="../Untyped/#21981" class="Function Operator">⟩</a>
    <a id="6014" class="Symbol">(</a><a id="6015" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="6017" href="../Confluence/#5821" class="Bound">N′</a><a id="6019" class="Symbol">)</a> <a id="6021" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="6023" href="../Confluence/#5830" class="Bound">M′</a>                  <a id="6043" href="../Untyped/#11156" class="InductiveConstructor Operator">—→⟨</a> <a id="6047" href="../Untyped/#10160" class="InductiveConstructor">β</a> <a id="6049" href="../Untyped/#11156" class="InductiveConstructor Operator">⟩</a>
     <a id="6056" href="../Confluence/#5821" class="Bound">N′</a> <a id="6059" href="../Untyped/#7473" class="Function Operator">[</a> <a id="6061" href="../Confluence/#5830" class="Bound">M′</a> <a id="6064" href="../Untyped/#7473" class="Function Operator">]</a>
    <a id="6070" href="../Untyped/#11100" class="InductiveConstructor Operator">∎</a>
</pre>
<p>The proof is by induction on <code>M ⇛ N</code>.</p>
<ul>
<li><p>Suppose <code>x ⇛ x</code>. We immediately have <code>x —↠ x</code>.</p></li>
<li><p>Suppose <code>ƛ N ⇛ ƛ N′</code> because <code>N ⇛ N′</code>. By the induction hypothesis we have <code>N —↠ N′</code>. We conclude that <code>ƛ N —↠ ƛ N′</code> because <code>—↠</code> is a congruence.</p></li>
<li><p>Suppose <code>L · M ⇛ L′ · M′</code> because <code>L ⇛ L′</code> and <code>M ⇛ M′</code>. By the induction hypothesis, we have <code>L —↠ L′</code> and <code>M —↠ M′</code>. So <code>L · M —↠ L′ · M</code> and then <code>L′ · M  —↠ L′ · M′</code> because <code>—↠</code> is a congruence.</p></li>
<li><p>Suppose <code>(ƛ N) · M  ⇛  N′ [ M′ ]</code> because <code>N ⇛ N′</code> and <code>M ⇛ M′</code>. By similar reasoning, we have <code>(ƛ N) · M —↠ (ƛ N′) · M′</code> which we can following with the β reduction <code>(ƛ N′) · M′ —→ N′ [ M′ ]</code>.</p></li>
</ul>
<p>With this lemma in hand, we complete the proof that <code>M ⇛* N</code> implies <code>M —↠ N</code> with a simple induction on <code>M ⇛* N</code>.</p>
<pre class="Agda"><a id="pars-betas"></a><a id="6854" href="../Confluence/#6854" class="Function">pars-betas</a> <a id="6865" class="Symbol">:</a> <a id="6867" class="Symbol">∀{</a><a id="6869" href="../Confluence/#6869" class="Bound">Γ</a> <a id="6871" href="../Confluence/#6871" class="Bound">A</a><a id="6872" class="Symbol">}</a> <a id="6874" class="Symbol">{</a><a id="6875" href="../Confluence/#6875" class="Bound">M</a> <a id="6877" href="../Confluence/#6877" class="Bound">N</a> <a id="6879" class="Symbol">:</a> <a id="6881" href="../Confluence/#6869" class="Bound">Γ</a> <a id="6883" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="6885" href="../Confluence/#6871" class="Bound">A</a><a id="6886" class="Symbol">}</a>
  <a id="6890" class="Symbol">→</a> <a id="6892" href="../Confluence/#6875" class="Bound">M</a> <a id="6894" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="6897" href="../Confluence/#6877" class="Bound">N</a>
    <a id="6903" class="Comment">------</a>
  <a id="6912" class="Symbol">→</a> <a id="6914" href="../Confluence/#6875" class="Bound">M</a> <a id="6916" href="../Untyped/#11050" class="Datatype Operator">—↠</a> <a id="6919" href="../Confluence/#6877" class="Bound">N</a>
<a id="6921" href="../Confluence/#6854" class="Function">pars-betas</a> <a id="6932" class="Symbol">(</a><a id="6933" href="../Confluence/#6933" class="Bound">M₁</a> <a id="6936" href="../Confluence/#3804" class="InductiveConstructor Operator">∎</a><a id="6937" class="Symbol">)</a> <a id="6939" class="Symbol">=</a> <a id="6941" href="../Confluence/#6933" class="Bound">M₁</a> <a id="6944" href="../Untyped/#11100" class="InductiveConstructor Operator">∎</a>
<a id="6946" href="../Confluence/#6854" class="Function">pars-betas</a> <a id="6957" class="Symbol">(</a><a id="6958" href="../Confluence/#6958" class="Bound">L</a> <a id="6960" href="../Confluence/#3860" class="InductiveConstructor Operator">⇛⟨</a> <a id="6963" href="../Confluence/#6963" class="Bound">p</a> <a id="6965" href="../Confluence/#3860" class="InductiveConstructor Operator">⟩</a> <a id="6967" href="../Confluence/#6967" class="Bound">ps</a><a id="6969" class="Symbol">)</a> <a id="6971" class="Symbol">=</a> <a id="6973" href="../Untyped/#21711" class="Function">—↠-trans</a> <a id="6982" class="Symbol">(</a><a id="6983" href="../Confluence/#5425" class="Function">par-betas</a> <a id="6993" href="../Confluence/#6963" class="Bound">p</a><a id="6994" class="Symbol">)</a> <a id="6996" class="Symbol">(</a><a id="6997" href="../Confluence/#6854" class="Function">pars-betas</a> <a id="7008" href="../Confluence/#6967" class="Bound">ps</a><a id="7010" class="Symbol">)</a>
</pre>
<h2 id="substitution-lemma-for-parallel-reduction">Substitution lemma for parallel reduction</h2>
<p>Our next goal is to prove the diamond property for parallel reduction. But to do that, we need to prove that substitution respects parallel reduction. That is, if <code>N ⇛ N′</code> and <code>M ⇛ M′</code>, then <code>N [ M ] ⇛ N′ [ M′ ]</code>. We cannot prove this directly by induction, so we generalize it to: if <code>N ⇛ N′</code> and the substitution <code>σ</code> pointwise parallel reduces to <code>τ</code>, then <code>subst σ N ⇛ subst τ N′</code>. We define the notion of pointwise parallel reduction as follows.</p>
<pre class="Agda"><a id="par-subst"></a><a id="7519" href="../Confluence/#7519" class="Function">par-subst</a> <a id="7529" class="Symbol">:</a> <a id="7531" class="Symbol">∀{</a><a id="7533" href="../Confluence/#7533" class="Bound">Γ</a> <a id="7535" href="../Confluence/#7535" class="Bound">Δ</a><a id="7536" class="Symbol">}</a> <a id="7538" class="Symbol">→</a> <a id="7540" href="../Substitution/#2405" class="Function">Subst</a> <a id="7546" href="../Confluence/#7533" class="Bound">Γ</a> <a id="7548" href="../Confluence/#7535" class="Bound">Δ</a> <a id="7550" class="Symbol">→</a> <a id="7552" href="../Substitution/#2405" class="Function">Subst</a> <a id="7558" href="../Confluence/#7533" class="Bound">Γ</a> <a id="7560" href="../Confluence/#7535" class="Bound">Δ</a> <a id="7562" class="Symbol">→</a> <a id="7564" class="PrimitiveType">Set</a>
<a id="7568" href="../Confluence/#7519" class="Function">par-subst</a> <a id="7578" class="Symbol">{</a><a id="7579" href="../Confluence/#7579" class="Bound">Γ</a><a id="7580" class="Symbol">}{</a><a id="7582" href="../Confluence/#7582" class="Bound">Δ</a><a id="7583" class="Symbol">}</a> <a id="7585" href="../Confluence/#7585" class="Bound">σ</a> <a id="7587" href="../Confluence/#7587" class="Bound">σ′</a> <a id="7590" class="Symbol">=</a> <a id="7592" class="Symbol">∀{</a><a id="7594" href="../Confluence/#7594" class="Bound">A</a><a id="7595" class="Symbol">}{</a><a id="7597" href="../Confluence/#7597" class="Bound">x</a> <a id="7599" class="Symbol">:</a> <a id="7601" href="../Confluence/#7579" class="Bound">Γ</a> <a id="7603" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="7605" href="../Confluence/#7594" class="Bound">A</a><a id="7606" class="Symbol">}</a> <a id="7608" class="Symbol">→</a> <a id="7610" href="../Confluence/#7585" class="Bound">σ</a> <a id="7612" href="../Confluence/#7597" class="Bound">x</a> <a id="7614" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="7616" href="../Confluence/#7587" class="Bound">σ′</a> <a id="7619" href="../Confluence/#7597" class="Bound">x</a>
</pre>
<p>Because substitution depends on the extension function <code>exts</code>, which in turn relies on <code>rename</code>, we start with a version of the substitution lemma, called <code>par-rename</code>, that is specialized to renamings. The proof of <code>par-rename</code> relies on the fact that renaming and substitution commute with one another, which is a lemma that we import from Chapter <a href="../Substitution/">Substitution</a> and restate here.</p>
<pre class="Agda"><a id="rename-subst-commute"></a><a id="8031" href="../Confluence/#8031" class="Function">rename-subst-commute</a> <a id="8052" class="Symbol">:</a> <a id="8054" class="Symbol">∀{</a><a id="8056" href="../Confluence/#8056" class="Bound">Γ</a> <a id="8058" href="../Confluence/#8058" class="Bound">Δ</a><a id="8059" class="Symbol">}{</a><a id="8061" href="../Confluence/#8061" class="Bound">N</a> <a id="8063" class="Symbol">:</a> <a id="8065" href="../Confluence/#8056" class="Bound">Γ</a> <a id="8067" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="8069" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="8071" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="8073" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="8074" class="Symbol">}{</a><a id="8076" href="../Confluence/#8076" class="Bound">M</a> <a id="8078" class="Symbol">:</a> <a id="8080" href="../Confluence/#8056" class="Bound">Γ</a> <a id="8082" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="8084" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="8085" class="Symbol">}{</a><a id="8087" href="../Confluence/#8087" class="Bound">ρ</a> <a id="8089" class="Symbol">:</a> <a id="8091" href="../Substitution/#2192" class="Function">Rename</a> <a id="8098" href="../Confluence/#8056" class="Bound">Γ</a> <a id="8100" href="../Confluence/#8058" class="Bound">Δ</a> <a id="8102" class="Symbol">}</a>
    <a id="8108" class="Symbol">→</a> <a id="8110" class="Symbol">(</a><a id="8111" href="../Untyped/#6217" class="Function">rename</a> <a id="8118" class="Symbol">(</a><a id="8119" href="../Untyped/#5907" class="Function">ext</a> <a id="8123" href="../Confluence/#8087" class="Bound">ρ</a><a id="8124" class="Symbol">)</a> <a id="8126" href="../Confluence/#8061" class="Bound">N</a><a id="8127" class="Symbol">)</a> <a id="8129" href="../Untyped/#7473" class="Function Operator">[</a> <a id="8131" href="../Untyped/#6217" class="Function">rename</a> <a id="8138" href="../Confluence/#8087" class="Bound">ρ</a> <a id="8140" href="../Confluence/#8076" class="Bound">M</a> <a id="8142" href="../Untyped/#7473" class="Function Operator">]</a> <a id="8144" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="8146" href="../Untyped/#6217" class="Function">rename</a> <a id="8153" href="../Confluence/#8087" class="Bound">ρ</a> <a id="8155" class="Symbol">(</a><a id="8156" href="../Confluence/#8061" class="Bound">N</a> <a id="8158" href="../Untyped/#7473" class="Function Operator">[</a> <a id="8160" href="../Confluence/#8076" class="Bound">M</a> <a id="8162" href="../Untyped/#7473" class="Function Operator">]</a><a id="8163" class="Symbol">)</a>
<a id="8165" href="../Confluence/#8031" class="Function">rename-subst-commute</a> <a id="8186" class="Symbol">{</a><a id="8187" class="Argument">N</a> <a id="8189" class="Symbol">=</a> <a id="8191" href="../Confluence/#8191" class="Bound">N</a><a id="8192" class="Symbol">}</a> <a id="8194" class="Symbol">=</a> <a id="8196" href="../Substitution/#27914" class="Function">plfa.part2.Substitution.rename-subst-commute</a> <a id="8241" class="Symbol">{</a><a id="8242" class="Argument">N</a> <a id="8244" class="Symbol">=</a> <a id="8246" href="../Confluence/#8191" class="Bound">N</a><a id="8247" class="Symbol">}</a>
</pre>
<p>Now for the <code>par-rename</code> lemma.</p>
<pre class="Agda"><a id="par-rename"></a><a id="8291" href="../Confluence/#8291" class="Function">par-rename</a> <a id="8302" class="Symbol">:</a> <a id="8304" class="Symbol">∀{</a><a id="8306" href="../Confluence/#8306" class="Bound">Γ</a> <a id="8308" href="../Confluence/#8308" class="Bound">Δ</a> <a id="8310" href="../Confluence/#8310" class="Bound">A</a><a id="8311" class="Symbol">}</a> <a id="8313" class="Symbol">{</a><a id="8314" href="../Confluence/#8314" class="Bound">ρ</a> <a id="8316" class="Symbol">:</a> <a id="8318" href="../Substitution/#2192" class="Function">Rename</a> <a id="8325" href="../Confluence/#8306" class="Bound">Γ</a> <a id="8327" href="../Confluence/#8308" class="Bound">Δ</a><a id="8328" class="Symbol">}</a> <a id="8330" class="Symbol">{</a><a id="8331" href="../Confluence/#8331" class="Bound">M</a> <a id="8333" href="../Confluence/#8333" class="Bound">M′</a> <a id="8336" class="Symbol">:</a> <a id="8338" href="../Confluence/#8306" class="Bound">Γ</a> <a id="8340" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="8342" href="../Confluence/#8310" class="Bound">A</a><a id="8343" class="Symbol">}</a>
  <a id="8347" class="Symbol">→</a> <a id="8349" href="../Confluence/#8331" class="Bound">M</a> <a id="8351" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="8353" href="../Confluence/#8333" class="Bound">M′</a>
    <a id="8360" class="Comment">------------------------</a>
  <a id="8387" class="Symbol">→</a> <a id="8389" href="../Untyped/#6217" class="Function">rename</a> <a id="8396" href="../Confluence/#8314" class="Bound">ρ</a> <a id="8398" href="../Confluence/#8331" class="Bound">M</a> <a id="8400" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="8402" href="../Untyped/#6217" class="Function">rename</a> <a id="8409" href="../Confluence/#8314" class="Bound">ρ</a> <a id="8411" href="../Confluence/#8333" class="Bound">M′</a>
<a id="8414" href="../Confluence/#8291" class="Function">par-rename</a> <a id="8425" href="../Confluence/#2700" class="InductiveConstructor">pvar</a> <a id="8430" class="Symbol">=</a> <a id="8432" href="../Confluence/#2700" class="InductiveConstructor">pvar</a>
<a id="8437" href="../Confluence/#8291" class="Function">par-rename</a> <a id="8448" class="Symbol">(</a><a id="8449" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="8454" href="../Confluence/#8454" class="Bound">p</a><a id="8455" class="Symbol">)</a> <a id="8457" class="Symbol">=</a> <a id="8459" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="8464" class="Symbol">(</a><a id="8465" href="../Confluence/#8291" class="Function">par-rename</a> <a id="8476" href="../Confluence/#8454" class="Bound">p</a><a id="8477" class="Symbol">)</a>
<a id="8479" href="../Confluence/#8291" class="Function">par-rename</a> <a id="8490" class="Symbol">(</a><a id="8491" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="8496" href="../Confluence/#8496" class="Bound">p₁</a> <a id="8499" href="../Confluence/#8499" class="Bound">p₂</a><a id="8501" class="Symbol">)</a> <a id="8503" class="Symbol">=</a> <a id="8505" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="8510" class="Symbol">(</a><a id="8511" href="../Confluence/#8291" class="Function">par-rename</a> <a id="8522" href="../Confluence/#8496" class="Bound">p₁</a><a id="8524" class="Symbol">)</a> <a id="8526" class="Symbol">(</a><a id="8527" href="../Confluence/#8291" class="Function">par-rename</a> <a id="8538" href="../Confluence/#8499" class="Bound">p₂</a><a id="8540" class="Symbol">)</a>
<a id="8542" href="../Confluence/#8291" class="Function">par-rename</a> <a id="8553" class="Symbol">{</a><a id="8554" href="../Confluence/#8554" class="Bound">Γ</a><a id="8555" class="Symbol">}{</a><a id="8557" href="../Confluence/#8557" class="Bound">Δ</a><a id="8558" class="Symbol">}{</a><a id="8560" href="../Confluence/#8560" class="Bound">A</a><a id="8561" class="Symbol">}{</a><a id="8563" href="../Confluence/#8563" class="Bound">ρ</a><a id="8564" class="Symbol">}</a> <a id="8566" class="Symbol">(</a><a id="8567" href="../Confluence/#2950" class="InductiveConstructor">pbeta</a><a id="8572" class="Symbol">{</a><a id="8573" href="../Confluence/#8554" class="Bound">Γ</a><a id="8574" class="Symbol">}{</a><a id="8576" href="../Confluence/#8576" class="Bound">N</a><a id="8577" class="Symbol">}{</a><a id="8579" href="../Confluence/#8579" class="Bound">N′</a><a id="8581" class="Symbol">}{</a><a id="8583" href="../Confluence/#8583" class="Bound">M</a><a id="8584" class="Symbol">}{</a><a id="8586" href="../Confluence/#8586" class="Bound">M′</a><a id="8588" class="Symbol">}</a> <a id="8590" href="../Confluence/#8590" class="Bound">p₁</a> <a id="8593" href="../Confluence/#8593" class="Bound">p₂</a><a id="8595" class="Symbol">)</a>
    <a id="8601" class="Keyword">with</a> <a id="8606" href="../Confluence/#2950" class="InductiveConstructor">pbeta</a> <a id="8612" class="Symbol">(</a><a id="8613" href="../Confluence/#8291" class="Function">par-rename</a><a id="8623" class="Symbol">{</a><a id="8624" class="Argument">ρ</a> <a id="8626" class="Symbol">=</a> <a id="8628" href="../Untyped/#5907" class="Function">ext</a> <a id="8632" href="../Confluence/#8563" class="Bound">ρ</a><a id="8633" class="Symbol">}</a> <a id="8635" href="../Confluence/#8590" class="Bound">p₁</a><a id="8637" class="Symbol">)</a> <a id="8639" class="Symbol">(</a><a id="8640" href="../Confluence/#8291" class="Function">par-rename</a><a id="8650" class="Symbol">{</a><a id="8651" class="Argument">ρ</a> <a id="8653" class="Symbol">=</a> <a id="8655" href="../Confluence/#8563" class="Bound">ρ</a><a id="8656" class="Symbol">}</a> <a id="8658" href="../Confluence/#8593" class="Bound">p₂</a><a id="8660" class="Symbol">)</a>
<a id="8662" class="Symbol">...</a> <a id="8666" class="Symbol">|</a> <a id="8668" href="../Confluence/#8668" class="Bound">G</a> <a id="8670" class="Keyword">rewrite</a> <a id="8678" href="../Confluence/#8031" class="Function">rename-subst-commute</a><a id="8698" class="Symbol">{</a><a id="8699" class="Bound">Γ</a><a id="8700" class="Symbol">}{</a><a id="8702" class="Bound">Δ</a><a id="8703" class="Symbol">}{</a><a id="8705" class="Bound">N′</a><a id="8707" class="Symbol">}{</a><a id="8709" class="Bound">M′</a><a id="8711" class="Symbol">}{</a><a id="8713" class="Bound">ρ</a><a id="8714" class="Symbol">}</a> <a id="8716" class="Symbol">=</a> <a id="8718" href="../Confluence/#8668" class="Bound">G</a>

</pre>
<p>The proof is by induction on <code>M ⇛ M′</code>. The first three cases are straightforward so we just consider the last one for <code>pbeta</code>.</p>
<ul>
<li>Suppose <code>(ƛ N) · M  ⇛  N′ [ M′ ]</code> because <code>N ⇛ N′</code> and <code>M ⇛ M′</code>. By the induction hypothesis, we have <code>rename (ext ρ) N ⇛ rename (ext ρ) N′</code> and <code>rename ρ M ⇛ rename ρ M′</code>. So by <code>pbeta</code> we have <code>(ƛ rename (ext ρ) N) · (rename ρ M) ⇛ (rename (ext ρ) N) [ rename ρ M ]</code>. However, to conclude we instead need parallel reduction to <code>rename ρ (N [ M ])</code>. But thankfully, renaming and substitution commute with one another.</li>
</ul>
<p>With the <code>par-rename</code> lemma in hand, it is straightforward to show that extending substitutions preserves the pointwise parallel reduction relation.</p>
<pre class="Agda"><a id="par-subst-exts"></a><a id="9447" href="../Confluence/#9447" class="Function">par-subst-exts</a> <a id="9462" class="Symbol">:</a> <a id="9464" class="Symbol">∀{</a><a id="9466" href="../Confluence/#9466" class="Bound">Γ</a> <a id="9468" href="../Confluence/#9468" class="Bound">Δ</a><a id="9469" class="Symbol">}</a> <a id="9471" class="Symbol">{</a><a id="9472" href="../Confluence/#9472" class="Bound">σ</a> <a id="9474" href="../Confluence/#9474" class="Bound">τ</a> <a id="9476" class="Symbol">:</a> <a id="9478" href="../Substitution/#2405" class="Function">Subst</a> <a id="9484" href="../Confluence/#9466" class="Bound">Γ</a> <a id="9486" href="../Confluence/#9468" class="Bound">Δ</a><a id="9487" class="Symbol">}</a>
  <a id="9491" class="Symbol">→</a> <a id="9493" href="../Confluence/#7519" class="Function">par-subst</a> <a id="9503" href="../Confluence/#9472" class="Bound">σ</a> <a id="9505" href="../Confluence/#9474" class="Bound">τ</a>
    <a id="9511" class="Comment">------------------------------------------</a>
  <a id="9556" class="Symbol">→</a> <a id="9558" class="Symbol">∀{</a><a id="9560" href="../Confluence/#9560" class="Bound">B</a><a id="9561" class="Symbol">}</a> <a id="9563" class="Symbol">→</a> <a id="9565" href="../Confluence/#7519" class="Function">par-subst</a> <a id="9575" class="Symbol">(</a><a id="9576" href="../Untyped/#6653" class="Function">exts</a> <a id="9581" href="../Confluence/#9472" class="Bound">σ</a> <a id="9583" class="Symbol">{</a><a id="9584" class="Argument">B</a> <a id="9586" class="Symbol">=</a> <a id="9588" href="../Confluence/#9560" class="Bound">B</a><a id="9589" class="Symbol">})</a> <a id="9592" class="Symbol">(</a><a id="9593" href="../Untyped/#6653" class="Function">exts</a> <a id="9598" href="../Confluence/#9474" class="Bound">τ</a><a id="9599" class="Symbol">)</a>
<a id="9601" href="../Confluence/#9447" class="Function">par-subst-exts</a> <a id="9616" href="../Confluence/#9616" class="Bound">s</a> <a id="9618" class="Symbol">{</a><a id="9619" class="Argument">x</a> <a id="9621" class="Symbol">=</a> <a id="9623" href="../Untyped/#3539" class="InductiveConstructor">Z</a><a id="9624" class="Symbol">}</a> <a id="9626" class="Symbol">=</a> <a id="9628" href="../Confluence/#2700" class="InductiveConstructor">pvar</a>
<a id="9633" href="../Confluence/#9447" class="Function">par-subst-exts</a> <a id="9648" href="../Confluence/#9648" class="Bound">s</a> <a id="9650" class="Symbol">{</a><a id="9651" class="Argument">x</a> <a id="9653" class="Symbol">=</a> <a id="9655" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="9657" href="../Confluence/#9657" class="Bound">x</a><a id="9658" class="Symbol">}</a> <a id="9660" class="Symbol">=</a> <a id="9662" href="../Confluence/#8291" class="Function">par-rename</a> <a id="9673" href="../Confluence/#9648" class="Bound">s</a>
</pre>
<p>The next lemma that we need for proving that substitution respects parallel reduction is the following which states that simultaneous substitution commutes with single substitution. We import this lemma from Chapter <a href="../Substitution/">Substitution</a> and restate it below.</p>
<pre class="Agda"><a id="subst-commute"></a><a id="9954" href="../Confluence/#9954" class="Function">subst-commute</a> <a id="9968" class="Symbol">:</a> <a id="9970" class="Symbol">∀{</a><a id="9972" href="../Confluence/#9972" class="Bound">Γ</a> <a id="9974" href="../Confluence/#9974" class="Bound">Δ</a><a id="9975" class="Symbol">}{</a><a id="9977" href="../Confluence/#9977" class="Bound">N</a> <a id="9979" class="Symbol">:</a> <a id="9981" href="../Confluence/#9972" class="Bound">Γ</a> <a id="9983" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="9985" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="9987" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="9989" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="9990" class="Symbol">}{</a><a id="9992" href="../Confluence/#9992" class="Bound">M</a> <a id="9994" class="Symbol">:</a> <a id="9996" href="../Confluence/#9972" class="Bound">Γ</a> <a id="9998" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="10000" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="10001" class="Symbol">}{</a><a id="10003" href="../Confluence/#10003" class="Bound">σ</a> <a id="10005" class="Symbol">:</a> <a id="10007" href="../Substitution/#2405" class="Function">Subst</a> <a id="10013" href="../Confluence/#9972" class="Bound">Γ</a> <a id="10015" href="../Confluence/#9974" class="Bound">Δ</a> <a id="10017" class="Symbol">}</a>
  <a id="10021" class="Symbol">→</a> <a id="10023" href="../Untyped/#6945" class="Function">subst</a> <a id="10029" class="Symbol">(</a><a id="10030" href="../Untyped/#6653" class="Function">exts</a> <a id="10035" href="../Confluence/#10003" class="Bound">σ</a><a id="10036" class="Symbol">)</a> <a id="10038" href="../Confluence/#9977" class="Bound">N</a> <a id="10040" href="../Untyped/#7473" class="Function Operator">[</a> <a id="10042" href="../Untyped/#6945" class="Function">subst</a> <a id="10048" href="../Confluence/#10003" class="Bound">σ</a> <a id="10050" href="../Confluence/#9992" class="Bound">M</a> <a id="10052" href="../Untyped/#7473" class="Function Operator">]</a> <a id="10054" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="10056" href="../Untyped/#6945" class="Function">subst</a> <a id="10062" href="../Confluence/#10003" class="Bound">σ</a> <a id="10064" class="Symbol">(</a><a id="10065" href="../Confluence/#9977" class="Bound">N</a> <a id="10067" href="../Untyped/#7473" class="Function Operator">[</a> <a id="10069" href="../Confluence/#9992" class="Bound">M</a> <a id="10071" href="../Untyped/#7473" class="Function Operator">]</a><a id="10072" class="Symbol">)</a>
<a id="10074" href="../Confluence/#9954" class="Function">subst-commute</a> <a id="10088" class="Symbol">{</a><a id="10089" class="Argument">N</a> <a id="10091" class="Symbol">=</a> <a id="10093" href="../Confluence/#10093" class="Bound">N</a><a id="10094" class="Symbol">}</a> <a id="10096" class="Symbol">=</a> <a id="10098" href="../Substitution/#26373" class="Function">plfa.part2.Substitution.subst-commute</a> <a id="10136" class="Symbol">{</a><a id="10137" class="Argument">N</a> <a id="10139" class="Symbol">=</a> <a id="10141" href="../Confluence/#10093" class="Bound">N</a><a id="10142" class="Symbol">}</a>
</pre>
<p>We are ready to prove that substitution respects parallel reduction.</p>
<pre class="Agda"><a id="subst-par"></a><a id="10223" href="../Confluence/#10223" class="Function">subst-par</a> <a id="10233" class="Symbol">:</a> <a id="10235" class="Symbol">∀{</a><a id="10237" href="../Confluence/#10237" class="Bound">Γ</a> <a id="10239" href="../Confluence/#10239" class="Bound">Δ</a> <a id="10241" href="../Confluence/#10241" class="Bound">A</a><a id="10242" class="Symbol">}</a> <a id="10244" class="Symbol">{</a><a id="10245" href="../Confluence/#10245" class="Bound">σ</a> <a id="10247" href="../Confluence/#10247" class="Bound">τ</a> <a id="10249" class="Symbol">:</a> <a id="10251" href="../Substitution/#2405" class="Function">Subst</a> <a id="10257" href="../Confluence/#10237" class="Bound">Γ</a> <a id="10259" href="../Confluence/#10239" class="Bound">Δ</a><a id="10260" class="Symbol">}</a> <a id="10262" class="Symbol">{</a><a id="10263" href="../Confluence/#10263" class="Bound">M</a> <a id="10265" href="../Confluence/#10265" class="Bound">M′</a> <a id="10268" class="Symbol">:</a> <a id="10270" href="../Confluence/#10237" class="Bound">Γ</a> <a id="10272" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="10274" href="../Confluence/#10241" class="Bound">A</a><a id="10275" class="Symbol">}</a>
  <a id="10279" class="Symbol">→</a> <a id="10281" href="../Confluence/#7519" class="Function">par-subst</a> <a id="10291" href="../Confluence/#10245" class="Bound">σ</a> <a id="10293" href="../Confluence/#10247" class="Bound">τ</a>  <a id="10296" class="Symbol">→</a>  <a id="10299" href="../Confluence/#10263" class="Bound">M</a> <a id="10301" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="10303" href="../Confluence/#10265" class="Bound">M′</a>
    <a id="10310" class="Comment">--------------------------</a>
  <a id="10339" class="Symbol">→</a> <a id="10341" href="../Untyped/#6945" class="Function">subst</a> <a id="10347" href="../Confluence/#10245" class="Bound">σ</a> <a id="10349" href="../Confluence/#10263" class="Bound">M</a> <a id="10351" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="10353" href="../Untyped/#6945" class="Function">subst</a> <a id="10359" href="../Confluence/#10247" class="Bound">τ</a> <a id="10361" href="../Confluence/#10265" class="Bound">M′</a>
<a id="10364" href="../Confluence/#10223" class="Function">subst-par</a> <a id="10374" class="Symbol">{</a><a id="10375" href="../Confluence/#10375" class="Bound">Γ</a><a id="10376" class="Symbol">}</a> <a id="10378" class="Symbol">{</a><a id="10379" href="../Confluence/#10379" class="Bound">Δ</a><a id="10380" class="Symbol">}</a> <a id="10382" class="Symbol">{</a><a id="10383" href="../Confluence/#10383" class="Bound">A</a><a id="10384" class="Symbol">}</a> <a id="10386" class="Symbol">{</a><a id="10387" href="../Confluence/#10387" class="Bound">σ</a><a id="10388" class="Symbol">}</a> <a id="10390" class="Symbol">{</a><a id="10391" href="../Confluence/#10391" class="Bound">τ</a><a id="10392" class="Symbol">}</a> <a id="10394" class="Symbol">{</a><a id="10395" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="10397" href="../Confluence/#10397" class="Bound">x</a><a id="10398" class="Symbol">}</a> <a id="10400" href="../Confluence/#10400" class="Bound">s</a> <a id="10402" href="../Confluence/#2700" class="InductiveConstructor">pvar</a> <a id="10407" class="Symbol">=</a> <a id="10409" href="../Confluence/#10400" class="Bound">s</a>
<a id="10411" href="../Confluence/#10223" class="Function">subst-par</a> <a id="10421" class="Symbol">{</a><a id="10422" href="../Confluence/#10422" class="Bound">Γ</a><a id="10423" class="Symbol">}</a> <a id="10425" class="Symbol">{</a><a id="10426" href="../Confluence/#10426" class="Bound">Δ</a><a id="10427" class="Symbol">}</a> <a id="10429" class="Symbol">{</a><a id="10430" href="../Confluence/#10430" class="Bound">A</a><a id="10431" class="Symbol">}</a> <a id="10433" class="Symbol">{</a><a id="10434" href="../Confluence/#10434" class="Bound">σ</a><a id="10435" class="Symbol">}</a> <a id="10437" class="Symbol">{</a><a id="10438" href="../Confluence/#10438" class="Bound">τ</a><a id="10439" class="Symbol">}</a> <a id="10441" class="Symbol">{</a><a id="10442" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="10444" href="../Confluence/#10444" class="Bound">N</a><a id="10445" class="Symbol">}</a> <a id="10447" href="../Confluence/#10447" class="Bound">s</a> <a id="10449" class="Symbol">(</a><a id="10450" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="10455" href="../Confluence/#10455" class="Bound">p</a><a id="10456" class="Symbol">)</a> <a id="10458" class="Symbol">=</a>
  <a id="10462" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="10467" class="Symbol">(</a><a id="10468" href="../Confluence/#10223" class="Function">subst-par</a> <a id="10478" class="Symbol">{</a><a id="10479" class="Argument">σ</a> <a id="10481" class="Symbol">=</a> <a id="10483" href="../Untyped/#6653" class="Function">exts</a> <a id="10488" href="../Confluence/#10434" class="Bound">σ</a><a id="10489" class="Symbol">}</a> <a id="10491" class="Symbol">{</a><a id="10492" class="Argument">τ</a> <a id="10494" class="Symbol">=</a> <a id="10496" href="../Untyped/#6653" class="Function">exts</a> <a id="10501" href="../Confluence/#10438" class="Bound">τ</a><a id="10502" class="Symbol">}</a>
        <a id="10512" class="Symbol">(λ</a> <a id="10515" class="Symbol">{</a><a id="10516" href="../Confluence/#10516" class="Bound">A</a><a id="10517" class="Symbol">}{</a><a id="10519" href="../Confluence/#10519" class="Bound">x</a><a id="10520" class="Symbol">}</a> <a id="10522" class="Symbol">→</a> <a id="10524" href="../Confluence/#9447" class="Function">par-subst-exts</a> <a id="10539" href="../Confluence/#10447" class="Bound">s</a> <a id="10541" class="Symbol">{</a><a id="10542" class="Argument">x</a> <a id="10544" class="Symbol">=</a> <a id="10546" href="../Confluence/#10519" class="Bound">x</a><a id="10547" class="Symbol">})</a> <a id="10550" href="../Confluence/#10455" class="Bound">p</a><a id="10551" class="Symbol">)</a>
<a id="10553" href="../Confluence/#10223" class="Function">subst-par</a> <a id="10563" class="Symbol">{</a><a id="10564" href="../Confluence/#10564" class="Bound">Γ</a><a id="10565" class="Symbol">}</a> <a id="10567" class="Symbol">{</a><a id="10568" href="../Confluence/#10568" class="Bound">Δ</a><a id="10569" class="Symbol">}</a> <a id="10571" class="Symbol">{</a><a id="10572" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="10573" class="Symbol">}</a> <a id="10575" class="Symbol">{</a><a id="10576" href="../Confluence/#10576" class="Bound">σ</a><a id="10577" class="Symbol">}</a> <a id="10579" class="Symbol">{</a><a id="10580" href="../Confluence/#10580" class="Bound">τ</a><a id="10581" class="Symbol">}</a> <a id="10583" class="Symbol">{</a><a id="10584" href="../Confluence/#10584" class="Bound">L</a> <a id="10586" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="10588" href="../Confluence/#10588" class="Bound">M</a><a id="10589" class="Symbol">}</a> <a id="10591" href="../Confluence/#10591" class="Bound">s</a> <a id="10593" class="Symbol">(</a><a id="10594" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="10599" href="../Confluence/#10599" class="Bound">p₁</a> <a id="10602" href="../Confluence/#10602" class="Bound">p₂</a><a id="10604" class="Symbol">)</a> <a id="10606" class="Symbol">=</a>
  <a id="10610" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="10615" class="Symbol">(</a><a id="10616" href="../Confluence/#10223" class="Function">subst-par</a> <a id="10626" href="../Confluence/#10591" class="Bound">s</a> <a id="10628" href="../Confluence/#10599" class="Bound">p₁</a><a id="10630" class="Symbol">)</a> <a id="10632" class="Symbol">(</a><a id="10633" href="../Confluence/#10223" class="Function">subst-par</a> <a id="10643" href="../Confluence/#10591" class="Bound">s</a> <a id="10645" href="../Confluence/#10602" class="Bound">p₂</a><a id="10647" class="Symbol">)</a>
<a id="10649" href="../Confluence/#10223" class="Function">subst-par</a> <a id="10659" class="Symbol">{</a><a id="10660" href="../Confluence/#10660" class="Bound">Γ</a><a id="10661" class="Symbol">}</a> <a id="10663" class="Symbol">{</a><a id="10664" href="../Confluence/#10664" class="Bound">Δ</a><a id="10665" class="Symbol">}</a> <a id="10667" class="Symbol">{</a><a id="10668" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="10669" class="Symbol">}</a> <a id="10671" class="Symbol">{</a><a id="10672" href="../Confluence/#10672" class="Bound">σ</a><a id="10673" class="Symbol">}</a> <a id="10675" class="Symbol">{</a><a id="10676" href="../Confluence/#10676" class="Bound">τ</a><a id="10677" class="Symbol">}</a> <a id="10679" class="Symbol">{(</a><a id="10681" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="10683" href="../Confluence/#10683" class="Bound">N</a><a id="10684" class="Symbol">)</a> <a id="10686" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="10688" href="../Confluence/#10688" class="Bound">M</a><a id="10689" class="Symbol">}</a> <a id="10691" href="../Confluence/#10691" class="Bound">s</a> <a id="10693" class="Symbol">(</a><a id="10694" href="../Confluence/#2950" class="InductiveConstructor">pbeta</a><a id="10699" class="Symbol">{</a><a id="10700" class="Argument">N′</a> <a id="10703" class="Symbol">=</a> <a id="10705" href="../Confluence/#10705" class="Bound">N′</a><a id="10707" class="Symbol">}{</a><a id="10709" class="Argument">M′</a> <a id="10712" class="Symbol">=</a> <a id="10714" href="../Confluence/#10714" class="Bound">M′</a><a id="10716" class="Symbol">}</a> <a id="10718" href="../Confluence/#10718" class="Bound">p₁</a> <a id="10721" href="../Confluence/#10721" class="Bound">p₂</a><a id="10723" class="Symbol">)</a>
    <a id="10729" class="Keyword">with</a> <a id="10734" href="../Confluence/#2950" class="InductiveConstructor">pbeta</a> <a id="10740" class="Symbol">(</a><a id="10741" href="../Confluence/#10223" class="Function">subst-par</a><a id="10750" class="Symbol">{</a><a id="10751" class="Argument">σ</a> <a id="10753" class="Symbol">=</a> <a id="10755" href="../Untyped/#6653" class="Function">exts</a> <a id="10760" href="../Confluence/#10672" class="Bound">σ</a><a id="10761" class="Symbol">}{</a><a id="10763" class="Argument">τ</a> <a id="10765" class="Symbol">=</a> <a id="10767" href="../Untyped/#6653" class="Function">exts</a> <a id="10772" href="../Confluence/#10676" class="Bound">τ</a><a id="10773" class="Symbol">}{</a><a id="10775" class="Argument">M</a> <a id="10777" class="Symbol">=</a> <a id="10779" href="../Confluence/#10683" class="Bound">N</a><a id="10780" class="Symbol">}</a>
                        <a id="10806" class="Symbol">(λ{</a><a id="10809" href="../Confluence/#10809" class="Bound">A</a><a id="10810" class="Symbol">}{</a><a id="10812" href="../Confluence/#10812" class="Bound">x</a><a id="10813" class="Symbol">}</a> <a id="10815" class="Symbol">→</a> <a id="10817" href="../Confluence/#9447" class="Function">par-subst-exts</a> <a id="10832" href="../Confluence/#10691" class="Bound">s</a> <a id="10834" class="Symbol">{</a><a id="10835" class="Argument">x</a> <a id="10837" class="Symbol">=</a> <a id="10839" href="../Confluence/#10812" class="Bound">x</a><a id="10840" class="Symbol">})</a> <a id="10843" href="../Confluence/#10718" class="Bound">p₁</a><a id="10845" class="Symbol">)</a>
               <a id="10862" class="Symbol">(</a><a id="10863" href="../Confluence/#10223" class="Function">subst-par</a> <a id="10873" class="Symbol">{</a><a id="10874" class="Argument">σ</a> <a id="10876" class="Symbol">=</a> <a id="10878" href="../Confluence/#10672" class="Bound">σ</a><a id="10879" class="Symbol">}</a> <a id="10881" href="../Confluence/#10691" class="Bound">s</a> <a id="10883" href="../Confluence/#10721" class="Bound">p₂</a><a id="10885" class="Symbol">)</a>
<a id="10887" class="Symbol">...</a> <a id="10891" class="Symbol">|</a> <a id="10893" href="../Confluence/#10893" class="Bound">G</a> <a id="10895" class="Keyword">rewrite</a> <a id="10903" href="../Confluence/#9954" class="Function">subst-commute</a><a id="10916" class="Symbol">{</a><a id="10917" class="Argument">N</a> <a id="10919" class="Symbol">=</a> <a id="10921" class="Bound">N′</a><a id="10923" class="Symbol">}{</a><a id="10925" class="Argument">M</a> <a id="10927" class="Symbol">=</a> <a id="10929" class="Bound">M′</a><a id="10931" class="Symbol">}{</a><a id="10933" class="Argument">σ</a> <a id="10935" class="Symbol">=</a> <a id="10937" class="Bound">τ</a><a id="10938" class="Symbol">}</a> <a id="10940" class="Symbol">=</a> <a id="10942" href="../Confluence/#10893" class="Bound">G</a>
</pre>
<p>We proceed by induction on <code>M ⇛ M′</code>.</p>
<ul>
<li><p>Suppose <code>x ⇛ x</code>. We conclude that <code>σ x ⇛ τ x</code> using the premise <code>par-subst σ τ</code>.</p></li>
<li><p>Suppose <code>ƛ N ⇛ ƛ N′</code> because <code>N ⇛ N′</code>. To use the induction hypothesis, we need <code>par-subst (exts σ) (exts τ)</code>, which we obtain by <code>par-subst-exts</code>. So we have <code>subst (exts σ) N ⇛ subst (exts τ) N′</code> and conclude by rule <code>pabs</code>.</p></li>
<li><p>Suppose <code>L · M ⇛ L′ · M′</code> because <code>L ⇛ L′</code> and <code>M ⇛ M′</code>. By the induction hypothesis we have <code>subst σ L ⇛ subst τ L′</code> and <code>subst σ M ⇛ subst τ M′</code>, so we conclude by rule <code>papp</code>.</p></li>
<li><p>Suppose <code>(ƛ N) · M  ⇛  N′ [ M′ ]</code> because <code>N ⇛ N′</code> and <code>M ⇛ M′</code>. Again we obtain <code>par-subst (exts σ) (exts τ)</code> by <code>par-subst-exts</code>. So by the induction hypothesis, we have <code>subst (exts σ) N ⇛ subst (exts τ) N′</code> and <code>subst σ M ⇛ subst τ M′</code>. Then by rule <code>pbeta</code>, we have parallel reduction to <code>subst (exts τ) N′ [ subst τ M′ ]</code>. Substitution commutes with itself in the following sense. For any σ, N, and M, we have</p>
<pre><code>  (subst (exts σ) N) [ subst σ M ] ≡ subst σ (N [ M ])</code></pre>
<p>So we have parallel reduction to <code>subst τ (N′ [ M′ ])</code>.</p></li>
</ul>
<p>Of course, if <code>M ⇛ M′</code>, then <code>subst-zero M</code> pointwise parallel reduces to <code>subst-zero M′</code>.</p>
<pre class="Agda"><a id="par-subst-zero"></a><a id="12150" href="../Confluence/#12150" class="Function">par-subst-zero</a> <a id="12165" class="Symbol">:</a> <a id="12167" class="Symbol">∀{</a><a id="12169" href="../Confluence/#12169" class="Bound">Γ</a><a id="12170" class="Symbol">}{</a><a id="12172" href="../Confluence/#12172" class="Bound">A</a><a id="12173" class="Symbol">}{</a><a id="12175" href="../Confluence/#12175" class="Bound">M</a> <a id="12177" href="../Confluence/#12177" class="Bound">M′</a> <a id="12180" class="Symbol">:</a> <a id="12182" href="../Confluence/#12169" class="Bound">Γ</a> <a id="12184" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="12186" href="../Confluence/#12172" class="Bound">A</a><a id="12187" class="Symbol">}</a>
       <a id="12196" class="Symbol">→</a> <a id="12198" href="../Confluence/#12175" class="Bound">M</a> <a id="12200" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="12202" href="../Confluence/#12177" class="Bound">M′</a>
       <a id="12212" class="Symbol">→</a> <a id="12214" href="../Confluence/#7519" class="Function">par-subst</a> <a id="12224" class="Symbol">(</a><a id="12225" href="../Untyped/#7357" class="Function">subst-zero</a> <a id="12236" href="../Confluence/#12175" class="Bound">M</a><a id="12237" class="Symbol">)</a> <a id="12239" class="Symbol">(</a><a id="12240" href="../Untyped/#7357" class="Function">subst-zero</a> <a id="12251" href="../Confluence/#12177" class="Bound">M′</a><a id="12253" class="Symbol">)</a>
<a id="12255" href="../Confluence/#12150" class="Function">par-subst-zero</a> <a id="12270" class="Symbol">{</a><a id="12271" href="../Confluence/#12271" class="Bound">M</a><a id="12272" class="Symbol">}</a> <a id="12274" class="Symbol">{</a><a id="12275" href="../Confluence/#12275" class="Bound">M′</a><a id="12277" class="Symbol">}</a> <a id="12279" href="../Confluence/#12279" class="Bound">p</a> <a id="12281" class="Symbol">{</a><a id="12282" href="../Confluence/#12282" class="Bound">A</a><a id="12283" class="Symbol">}</a> <a id="12285" class="Symbol">{</a><a id="12286" href="../Untyped/#3539" class="InductiveConstructor">Z</a><a id="12287" class="Symbol">}</a> <a id="12289" class="Symbol">=</a> <a id="12291" href="../Confluence/#12279" class="Bound">p</a>
<a id="12293" href="../Confluence/#12150" class="Function">par-subst-zero</a> <a id="12308" class="Symbol">{</a><a id="12309" href="../Confluence/#12309" class="Bound">M</a><a id="12310" class="Symbol">}</a> <a id="12312" class="Symbol">{</a><a id="12313" href="../Confluence/#12313" class="Bound">M′</a><a id="12315" class="Symbol">}</a> <a id="12317" href="../Confluence/#12317" class="Bound">p</a> <a id="12319" class="Symbol">{</a><a id="12320" href="../Confluence/#12320" class="Bound">A</a><a id="12321" class="Symbol">}</a> <a id="12323" class="Symbol">{</a><a id="12324" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="12326" href="../Confluence/#12326" class="Bound">x</a><a id="12327" class="Symbol">}</a> <a id="12329" class="Symbol">=</a> <a id="12331" href="../Confluence/#2700" class="InductiveConstructor">pvar</a>
</pre>
<p>We conclude this section with the desired corollary, that substitution respects parallel reduction.</p>
<pre class="Agda"><a id="sub-par"></a><a id="12446" href="../Confluence/#12446" class="Function">sub-par</a> <a id="12454" class="Symbol">:</a> <a id="12456" class="Symbol">∀{</a><a id="12458" href="../Confluence/#12458" class="Bound">Γ</a> <a id="12460" href="../Confluence/#12460" class="Bound">A</a> <a id="12462" href="../Confluence/#12462" class="Bound">B</a><a id="12463" class="Symbol">}</a> <a id="12465" class="Symbol">{</a><a id="12466" href="../Confluence/#12466" class="Bound">N</a> <a id="12468" href="../Confluence/#12468" class="Bound">N′</a> <a id="12471" class="Symbol">:</a> <a id="12473" href="../Confluence/#12458" class="Bound">Γ</a> <a id="12475" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="12477" href="../Confluence/#12460" class="Bound">A</a> <a id="12479" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="12481" href="../Confluence/#12462" class="Bound">B</a><a id="12482" class="Symbol">}</a> <a id="12484" class="Symbol">{</a><a id="12485" href="../Confluence/#12485" class="Bound">M</a> <a id="12487" href="../Confluence/#12487" class="Bound">M′</a> <a id="12490" class="Symbol">:</a> <a id="12492" href="../Confluence/#12458" class="Bound">Γ</a> <a id="12494" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="12496" href="../Confluence/#12460" class="Bound">A</a><a id="12497" class="Symbol">}</a>
  <a id="12501" class="Symbol">→</a> <a id="12503" href="../Confluence/#12466" class="Bound">N</a> <a id="12505" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="12507" href="../Confluence/#12468" class="Bound">N′</a>
  <a id="12512" class="Symbol">→</a> <a id="12514" href="../Confluence/#12485" class="Bound">M</a> <a id="12516" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="12518" href="../Confluence/#12487" class="Bound">M′</a>
    <a id="12525" class="Comment">--------------------------</a>
  <a id="12554" class="Symbol">→</a> <a id="12556" href="../Confluence/#12466" class="Bound">N</a> <a id="12558" href="../Untyped/#7473" class="Function Operator">[</a> <a id="12560" href="../Confluence/#12485" class="Bound">M</a> <a id="12562" href="../Untyped/#7473" class="Function Operator">]</a> <a id="12564" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="12566" href="../Confluence/#12468" class="Bound">N′</a> <a id="12569" href="../Untyped/#7473" class="Function Operator">[</a> <a id="12571" href="../Confluence/#12487" class="Bound">M′</a> <a id="12574" href="../Untyped/#7473" class="Function Operator">]</a>
<a id="12576" href="../Confluence/#12446" class="Function">sub-par</a> <a id="12584" href="../Confluence/#12584" class="Bound">pn</a> <a id="12587" href="../Confluence/#12587" class="Bound">pm</a> <a id="12590" class="Symbol">=</a> <a id="12592" href="../Confluence/#10223" class="Function">subst-par</a> <a id="12602" class="Symbol">(</a><a id="12603" href="../Confluence/#12150" class="Function">par-subst-zero</a> <a id="12618" href="../Confluence/#12587" class="Bound">pm</a><a id="12620" class="Symbol">)</a> <a id="12622" href="../Confluence/#12584" class="Bound">pn</a>
</pre>
<h2 id="parallel-reduction-satisfies-the-diamond-property">Parallel reduction satisfies the diamond property</h2>
<p>The heart of the confluence proof is made of stone, or rather, of diamond! We show that parallel reduction satisfies the diamond property: that if <code>M ⇛ N</code> and <code>M ⇛ N′</code>, then <code>N ⇛ L</code> and <code>N′ ⇛ L</code> for some <code>L</code>. The typical proof is an induction on <code>M ⇛ N</code> and <code>M ⇛ N′</code> so that every possible pair gives rise to a witness <code>L</code> given by performing enough beta reductions in parallel.</p>
<p>However, a simpler approach is to perform as many beta reductions in parallel as possible on <code>M</code>, say <code>M ⁺</code>, and then show that <code>N</code> also parallel reduces to <code>M ⁺</code>. This is the idea of Takahashi’s <em>complete development</em>. The desired property may be illustrated as</p>
<pre><code>    M
   /|
  / |
 /  |
N   2
 \  |
  \ |
   \|
    M⁺</code></pre>
<p>where downward lines are instances of <code>⇛</code>, so we call it the <em>triangle property</em>.</p>
<pre class="Agda"><a id="_⁺"></a><a id="13509" href="../Confluence/#13509" class="Function Operator">_⁺</a> <a id="13512" class="Symbol">:</a> <a id="13514" class="Symbol">∀</a> <a id="13516" class="Symbol">{</a><a id="13517" href="../Confluence/#13517" class="Bound">Γ</a> <a id="13519" href="../Confluence/#13519" class="Bound">A</a><a id="13520" class="Symbol">}</a>
  <a id="13524" class="Symbol">→</a> <a id="13526" href="../Confluence/#13517" class="Bound">Γ</a> <a id="13528" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="13530" href="../Confluence/#13519" class="Bound">A</a> <a id="13532" class="Symbol">→</a> <a id="13534" href="../Confluence/#13517" class="Bound">Γ</a> <a id="13536" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="13538" href="../Confluence/#13519" class="Bound">A</a>
<a id="13540" class="Symbol">(</a><a id="13541" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="13543" href="../Confluence/#13543" class="Bound">x</a><a id="13544" class="Symbol">)</a> <a id="13546" href="../Confluence/#13509" class="Function Operator">⁺</a>       <a id="13554" class="Symbol">=</a>  <a id="13557" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="13559" href="../Confluence/#13543" class="Bound">x</a>
<a id="13561" class="Symbol">(</a><a id="13562" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="13564" href="../Confluence/#13564" class="Bound">M</a><a id="13565" class="Symbol">)</a> <a id="13567" href="../Confluence/#13509" class="Function Operator">⁺</a>       <a id="13575" class="Symbol">=</a> <a id="13577" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="13579" class="Symbol">(</a><a id="13580" href="../Confluence/#13564" class="Bound">M</a> <a id="13582" href="../Confluence/#13509" class="Function Operator">⁺</a><a id="13583" class="Symbol">)</a>
<a id="13585" class="Symbol">((</a><a id="13587" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="13589" href="../Confluence/#13589" class="Bound">N</a><a id="13590" class="Symbol">)</a> <a id="13592" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="13594" href="../Confluence/#13594" class="Bound">M</a><a id="13595" class="Symbol">)</a> <a id="13597" href="../Confluence/#13509" class="Function Operator">⁺</a> <a id="13599" class="Symbol">=</a> <a id="13601" href="../Confluence/#13589" class="Bound">N</a> <a id="13603" href="../Confluence/#13509" class="Function Operator">⁺</a> <a id="13605" href="../Untyped/#7473" class="Function Operator">[</a> <a id="13607" href="../Confluence/#13594" class="Bound">M</a> <a id="13609" href="../Confluence/#13509" class="Function Operator">⁺</a> <a id="13611" href="../Untyped/#7473" class="Function Operator">]</a>
<a id="13613" class="CatchallClause Symbol">(</a><a id="13614" href="../Confluence/#13614" class="CatchallClause Bound">L</a><a id="13615" class="CatchallClause"> </a><a id="13616" href="../Untyped/#4424" class="CatchallClause InductiveConstructor Operator">·</a><a id="13617" class="CatchallClause"> </a><a id="13618" href="../Confluence/#13618" class="CatchallClause Bound">M</a><a id="13619" class="CatchallClause Symbol">)</a><a id="13620" class="CatchallClause"> </a><a id="13621" href="../Confluence/#13509" class="CatchallClause Function Operator">⁺</a>     <a id="13627" class="Symbol">=</a> <a id="13629" href="../Confluence/#13614" class="Bound">L</a> <a id="13631" href="../Confluence/#13509" class="Function Operator">⁺</a> <a id="13633" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="13635" class="Symbol">(</a><a id="13636" href="../Confluence/#13618" class="Bound">M</a> <a id="13638" href="../Confluence/#13509" class="Function Operator">⁺</a><a id="13639" class="Symbol">)</a>

<a id="par-triangle"></a><a id="13642" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13655" class="Symbol">:</a> <a id="13657" class="Symbol">∀</a> <a id="13659" class="Symbol">{</a><a id="13660" href="../Confluence/#13660" class="Bound">Γ</a> <a id="13662" href="../Confluence/#13662" class="Bound">A</a><a id="13663" class="Symbol">}</a> <a id="13665" class="Symbol">{</a><a id="13666" href="../Confluence/#13666" class="Bound">M</a> <a id="13668" href="../Confluence/#13668" class="Bound">N</a> <a id="13670" class="Symbol">:</a> <a id="13672" href="../Confluence/#13660" class="Bound">Γ</a> <a id="13674" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="13676" href="../Confluence/#13662" class="Bound">A</a><a id="13677" class="Symbol">}</a>
  <a id="13681" class="Symbol">→</a> <a id="13683" href="../Confluence/#13666" class="Bound">M</a> <a id="13685" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="13687" href="../Confluence/#13668" class="Bound">N</a>
    <a id="13693" class="Comment">-------</a>
  <a id="13703" class="Symbol">→</a> <a id="13705" href="../Confluence/#13668" class="Bound">N</a> <a id="13707" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="13709" href="../Confluence/#13666" class="Bound">M</a> <a id="13711" href="../Confluence/#13509" class="Function Operator">⁺</a>
<a id="13713" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13726" href="../Confluence/#2700" class="InductiveConstructor">pvar</a>          <a id="13740" class="Symbol">=</a> <a id="13742" href="../Confluence/#2700" class="InductiveConstructor">pvar</a>
<a id="13747" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13760" class="Symbol">(</a><a id="13761" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="13766" href="../Confluence/#13766" class="Bound">p</a><a id="13767" class="Symbol">)</a>      <a id="13774" class="Symbol">=</a> <a id="13776" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="13781" class="Symbol">(</a><a id="13782" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13795" href="../Confluence/#13766" class="Bound">p</a><a id="13796" class="Symbol">)</a>
<a id="13798" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13811" class="Symbol">(</a><a id="13812" href="../Confluence/#2950" class="InductiveConstructor">pbeta</a> <a id="13818" href="../Confluence/#13818" class="Bound">p1</a> <a id="13821" href="../Confluence/#13821" class="Bound">p2</a><a id="13823" class="Symbol">)</a> <a id="13825" class="Symbol">=</a> <a id="13827" href="../Confluence/#12446" class="Function">sub-par</a> <a id="13835" class="Symbol">(</a><a id="13836" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13849" href="../Confluence/#13818" class="Bound">p1</a><a id="13851" class="Symbol">)</a> <a id="13853" class="Symbol">(</a><a id="13854" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13867" href="../Confluence/#13821" class="Bound">p2</a><a id="13869" class="Symbol">)</a>
<a id="13871" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13884" class="Symbol">(</a><a id="13885" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="13890" class="Symbol">{</a><a id="13891" class="Argument">L</a> <a id="13893" class="Symbol">=</a> <a id="13895" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="13897" class="Symbol">_</a> <a id="13899" class="Symbol">}</a> <a id="13901" class="Symbol">(</a><a id="13902" href="../Confluence/#2764" class="InductiveConstructor">pabs</a> <a id="13907" href="../Confluence/#13907" class="Bound">p1</a><a id="13909" class="Symbol">)</a> <a id="13911" href="../Confluence/#13911" class="Bound">p2</a><a id="13913" class="Symbol">)</a> <a id="13915" class="Symbol">=</a>
  <a id="13919" href="../Confluence/#2950" class="InductiveConstructor">pbeta</a> <a id="13925" class="Symbol">(</a><a id="13926" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13939" href="../Confluence/#13907" class="Bound">p1</a><a id="13941" class="Symbol">)</a> <a id="13943" class="Symbol">(</a><a id="13944" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13957" href="../Confluence/#13911" class="Bound">p2</a><a id="13959" class="Symbol">)</a>
<a id="13961" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="13974" class="Symbol">(</a><a id="13975" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="13980" class="Symbol">{</a><a id="13981" class="Argument">L</a> <a id="13983" class="Symbol">=</a> <a id="13985" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="13987" class="Symbol">_}</a>   <a id="13992" href="../Confluence/#13992" class="Bound">p1</a> <a id="13995" href="../Confluence/#13995" class="Bound">p2</a><a id="13997" class="Symbol">)</a> <a id="13999" class="Symbol">=</a> <a id="14001" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="14006" class="Symbol">(</a><a id="14007" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="14020" href="../Confluence/#13992" class="Bound">p1</a><a id="14022" class="Symbol">)</a> <a id="14024" class="Symbol">(</a><a id="14025" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="14038" href="../Confluence/#13995" class="Bound">p2</a><a id="14040" class="Symbol">)</a>
<a id="14042" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="14055" class="Symbol">(</a><a id="14056" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="14061" class="Symbol">{</a><a id="14062" class="Argument">L</a> <a id="14064" class="Symbol">=</a> <a id="14066" class="Symbol">_</a> <a id="14068" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="14070" class="Symbol">_}</a> <a id="14073" href="../Confluence/#14073" class="Bound">p1</a> <a id="14076" href="../Confluence/#14076" class="Bound">p2</a><a id="14078" class="Symbol">)</a> <a id="14080" class="Symbol">=</a> <a id="14082" href="../Confluence/#2844" class="InductiveConstructor">papp</a> <a id="14087" class="Symbol">(</a><a id="14088" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="14101" href="../Confluence/#14073" class="Bound">p1</a><a id="14103" class="Symbol">)</a> <a id="14105" class="Symbol">(</a><a id="14106" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="14119" href="../Confluence/#14076" class="Bound">p2</a><a id="14121" class="Symbol">)</a>
</pre>
<p>The proof of the triangle property is an induction on <code>M ⇛ N</code>.</p>
<ul>
<li><p>Suppose <code>x ⇛ x</code>. Clearly <code>x ⁺ = x</code>, so <code>x ⇛ x ⁺</code>.</p></li>
<li><p>Suppose <code>ƛ M ⇛ ƛ N</code>. By the induction hypothesis we have <code>N ⇛ M ⁺</code> and by definition <code>(λ M) ⁺ = λ (M ⁺)</code>, so we conclude that <code>λ N ⇛ λ   (M ⁺)</code>.</p></li>
<li><p>Suppose <code>(λ N) · M ⇛ N′ [ M′ ]</code>. By the induction hypothesis, we have <code>N′ ⇛ N ⁺</code> and <code>M′ ⇛ M ⁺</code>. Since substitution respects parallel reduction, it follows that <code>N′ [ M′ ] ⇛ N ⁺ [ M ⁺ ]</code>, but the right hand side is exactly <code>((λ N) · M) ⁺</code>, hence <code>N′ [ M′ ] ⇛ ((λ N) · M) ⁺</code>.</p></li>
<li><p>Suppose <code>(λ L) · M ⇛ (λ L′) · M′</code>. By the induction hypothesis we have <code>L′ ⇛ L ⁺</code> and <code>M′ ⇛ M ⁺</code>; by definition <code>((λ L) · M) ⁺ = L ⁺ [ M ⁺ ]</code>. It follows <code>(λ L′) · M′ ⇛ L ⁺ [ M ⁺ ]</code>.</p></li>
<li><p>Suppose <code>x · M ⇛ x · M′</code>. By the induction hypothesis we have <code>M′ ⇛ M ⁺</code> and <code>x ⇛ x ⁺</code> so that <code>x · M′ ⇛ x · M ⁺</code>. The remaining case is proved in the same way, so we ignore it. (As there is currently no way in Agda to expand the catch-all pattern in the definition of <code>_⁺</code> for us before checking the right-hand side, we have to write down the remaining case explicitly.)</p></li>
</ul>
<p>The diamond property then follows by halving the diamond into two triangles.</p>
<pre><code>    M
   /|\
  / | \
 /  |  \
N   2   N′
 \  |  /
  \ | /
   \|/
    M⁺</code></pre>
<p>That is, the diamond property is proved by applying the triangle property on each side with the same confluent term <code>M ⁺</code>.</p>
<pre class="Agda"><a id="par-diamond"></a><a id="15570" href="../Confluence/#15570" class="Function">par-diamond</a> <a id="15582" class="Symbol">:</a> <a id="15584" class="Symbol">∀{</a><a id="15586" href="../Confluence/#15586" class="Bound">Γ</a> <a id="15588" href="../Confluence/#15588" class="Bound">A</a><a id="15589" class="Symbol">}</a> <a id="15591" class="Symbol">{</a><a id="15592" href="../Confluence/#15592" class="Bound">M</a> <a id="15594" href="../Confluence/#15594" class="Bound">N</a> <a id="15596" href="../Confluence/#15596" class="Bound">N′</a> <a id="15599" class="Symbol">:</a> <a id="15601" href="../Confluence/#15586" class="Bound">Γ</a> <a id="15603" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="15605" href="../Confluence/#15588" class="Bound">A</a><a id="15606" class="Symbol">}</a>
  <a id="15610" class="Symbol">→</a> <a id="15612" href="../Confluence/#15592" class="Bound">M</a> <a id="15614" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="15616" href="../Confluence/#15594" class="Bound">N</a>
  <a id="15620" class="Symbol">→</a> <a id="15622" href="../Confluence/#15592" class="Bound">M</a> <a id="15624" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="15626" href="../Confluence/#15596" class="Bound">N′</a>
    <a id="15633" class="Comment">---------------------------------</a>
  <a id="15669" class="Symbol">→</a> <a id="15671" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="15674" href="../Confluence/#15674" class="Bound">L</a> <a id="15676" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="15678" href="../Confluence/#15586" class="Bound">Γ</a> <a id="15680" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="15682" href="../Confluence/#15588" class="Bound">A</a> <a id="15684" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="15686" class="Symbol">(</a><a id="15687" href="../Confluence/#15594" class="Bound">N</a> <a id="15689" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="15691" href="../Confluence/#15674" class="Bound">L</a><a id="15692" class="Symbol">)</a> <a id="15694" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="15696" class="Symbol">(</a><a id="15697" href="../Confluence/#15596" class="Bound">N′</a> <a id="15700" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="15702" href="../Confluence/#15674" class="Bound">L</a><a id="15703" class="Symbol">)</a>
<a id="15705" href="../Confluence/#15570" class="Function">par-diamond</a> <a id="15717" class="Symbol">{</a><a id="15718" class="Argument">M</a> <a id="15720" class="Symbol">=</a> <a id="15722" href="../Confluence/#15722" class="Bound">M</a><a id="15723" class="Symbol">}</a> <a id="15725" href="../Confluence/#15725" class="Bound">p1</a> <a id="15728" href="../Confluence/#15728" class="Bound">p2</a> <a id="15731" class="Symbol">=</a> <a id="15733" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="15735" href="../Confluence/#15722" class="Bound">M</a> <a id="15737" href="../Confluence/#13509" class="Function Operator">⁺</a> <a id="15739" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="15741" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="15743" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="15756" href="../Confluence/#15725" class="Bound">p1</a> <a id="15759" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="15761" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="15774" href="../Confluence/#15728" class="Bound">p2</a> <a id="15777" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="15779" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>This step is optional, though, in the presence of triangle property.</p>
<h4 id="exercise-practice">Exercise (practice)</h4>
<ul>
<li><p>Prove the diamond property <code>par-diamond</code> directly by induction on <code>M ⇛ N</code> and <code>M ⇛ N′</code>.</p></li>
<li><p>Draw pictures that represent the proofs of each of the six cases in the direct proof of <code>par-diamond</code>. The pictures should consist of nodes and directed edges, where each node is labeled with a term and each edge represents parallel reduction.</p></li>
</ul>
<h2 id="proof-of-confluence-for-parallel-reduction">Proof of confluence for parallel reduction</h2>
<p>As promised at the beginning, the proof that parallel reduction is confluent is easy now that we know it satisfies the triangle property. We just need to prove the strip lemma, which states that if <code>M ⇛ N</code> and <code>M ⇛* N′</code>, then <code>N ⇛* L</code> and <code>N′ ⇛ L</code> for some <code>L</code>. The following diagram illustrates the strip lemma</p>
<pre><code>    M
   / \
  1   *
 /     \
N       N′
 \     /
  *   1
   \ /
    L</code></pre>
<p>where downward lines are instances of <code>⇛</code> or <code>⇛*</code>, depending on how they are marked.</p>
<p>The proof of the strip lemma is a straightforward induction on <code>M ⇛* N′</code>, using the triangle property in the induction step.</p>
<pre class="Agda"><a id="strip"></a><a id="16910" href="../Confluence/#16910" class="Function">strip</a> <a id="16916" class="Symbol">:</a> <a id="16918" class="Symbol">∀{</a><a id="16920" href="../Confluence/#16920" class="Bound">Γ</a> <a id="16922" href="../Confluence/#16922" class="Bound">A</a><a id="16923" class="Symbol">}</a> <a id="16925" class="Symbol">{</a><a id="16926" href="../Confluence/#16926" class="Bound">M</a> <a id="16928" href="../Confluence/#16928" class="Bound">N</a> <a id="16930" href="../Confluence/#16930" class="Bound">N′</a> <a id="16933" class="Symbol">:</a> <a id="16935" href="../Confluence/#16920" class="Bound">Γ</a> <a id="16937" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="16939" href="../Confluence/#16922" class="Bound">A</a><a id="16940" class="Symbol">}</a>
  <a id="16944" class="Symbol">→</a> <a id="16946" href="../Confluence/#16926" class="Bound">M</a> <a id="16948" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="16950" href="../Confluence/#16928" class="Bound">N</a>
  <a id="16954" class="Symbol">→</a> <a id="16956" href="../Confluence/#16926" class="Bound">M</a> <a id="16958" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="16961" href="../Confluence/#16930" class="Bound">N′</a>
    <a id="16968" class="Comment">------------------------------------</a>
  <a id="17007" class="Symbol">→</a> <a id="17009" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="17012" href="../Confluence/#17012" class="Bound">L</a> <a id="17014" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="17016" href="../Confluence/#16920" class="Bound">Γ</a> <a id="17018" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="17020" href="../Confluence/#16922" class="Bound">A</a> <a id="17022" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="17024" class="Symbol">(</a><a id="17025" href="../Confluence/#16928" class="Bound">N</a> <a id="17027" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="17030" href="../Confluence/#17012" class="Bound">L</a><a id="17031" class="Symbol">)</a>  <a id="17034" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a>  <a id="17037" class="Symbol">(</a><a id="17038" href="../Confluence/#16930" class="Bound">N′</a> <a id="17041" href="../Confluence/#2651" class="Datatype Operator">⇛</a> <a id="17043" href="../Confluence/#17012" class="Bound">L</a><a id="17044" class="Symbol">)</a>
<a id="17046" href="../Confluence/#16910" class="Function">strip</a><a id="17051" class="Symbol">{</a><a id="17052" href="../Confluence/#17052" class="Bound">Γ</a><a id="17053" class="Symbol">}{</a><a id="17055" href="../Confluence/#17055" class="Bound">A</a><a id="17056" class="Symbol">}{</a><a id="17058" href="../Confluence/#17058" class="Bound">M</a><a id="17059" class="Symbol">}{</a><a id="17061" href="../Confluence/#17061" class="Bound">N</a><a id="17062" class="Symbol">}{</a><a id="17064" href="../Confluence/#17064" class="Bound">N′</a><a id="17066" class="Symbol">}</a> <a id="17068" href="../Confluence/#17068" class="Bound">mn</a> <a id="17071" class="Symbol">(</a><a id="17072" href="../Confluence/#17058" class="Bound">M</a> <a id="17074" href="../Confluence/#3804" class="InductiveConstructor Operator">∎</a><a id="17075" class="Symbol">)</a> <a id="17077" class="Symbol">=</a> <a id="17079" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17081" href="../Confluence/#17061" class="Bound">N</a> <a id="17083" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17085" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17087" href="../Confluence/#17061" class="Bound">N</a> <a id="17089" href="../Confluence/#3804" class="InductiveConstructor Operator">∎</a> <a id="17091" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17093" href="../Confluence/#17068" class="Bound">mn</a> <a id="17096" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="17098" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a>
<a id="17100" href="../Confluence/#16910" class="Function">strip</a><a id="17105" class="Symbol">{</a><a id="17106" href="../Confluence/#17106" class="Bound">Γ</a><a id="17107" class="Symbol">}{</a><a id="17109" href="../Confluence/#17109" class="Bound">A</a><a id="17110" class="Symbol">}{</a><a id="17112" href="../Confluence/#17112" class="Bound">M</a><a id="17113" class="Symbol">}{</a><a id="17115" href="../Confluence/#17115" class="Bound">N</a><a id="17116" class="Symbol">}{</a><a id="17118" href="../Confluence/#17118" class="Bound">N′</a><a id="17120" class="Symbol">}</a> <a id="17122" href="../Confluence/#17122" class="Bound">mn</a> <a id="17125" class="Symbol">(</a><a id="17126" href="../Confluence/#17112" class="Bound">M</a> <a id="17128" href="../Confluence/#3860" class="InductiveConstructor Operator">⇛⟨</a> <a id="17131" href="../Confluence/#17131" class="Bound">mm'</a> <a id="17135" href="../Confluence/#3860" class="InductiveConstructor Operator">⟩</a> <a id="17137" href="../Confluence/#17137" class="Bound">m'n'</a><a id="17141" class="Symbol">)</a>
  <a id="17145" class="Keyword">with</a> <a id="17150" href="../Confluence/#16910" class="Function">strip</a> <a id="17156" class="Symbol">(</a><a id="17157" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="17170" href="../Confluence/#17131" class="Bound">mm'</a><a id="17173" class="Symbol">)</a> <a id="17175" href="../Confluence/#17137" class="Bound">m'n'</a>
<a id="17180" class="Symbol">...</a> <a id="17184" class="Symbol">|</a> <a id="17186" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17188" href="../Confluence/#17188" class="Bound">L</a> <a id="17190" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17192" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17194" href="../Confluence/#17194" class="Bound">ll'</a> <a id="17198" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17200" href="../Confluence/#17200" class="Bound">n'l'</a> <a id="17205" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="17207" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="17209" class="Symbol">=</a> <a id="17211" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17213" href="../Confluence/#17188" class="Bound">L</a> <a id="17215" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17217" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17219" class="Bound">N</a> <a id="17221" href="../Confluence/#3860" class="InductiveConstructor Operator">⇛⟨</a> <a id="17224" href="../Confluence/#13642" class="Function">par-triangle</a> <a id="17237" class="Bound">mn</a> <a id="17240" href="../Confluence/#3860" class="InductiveConstructor Operator">⟩</a> <a id="17242" href="../Confluence/#17194" class="Bound">ll'</a> <a id="17246" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17248" href="../Confluence/#17200" class="Bound">n'l'</a> <a id="17253" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="17255" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>The proof of confluence for parallel reduction is now proved by induction on the sequence <code>M ⇛* N</code>, using the above lemma in the induction step.</p>
<pre class="Agda"><a id="par-confluence"></a><a id="17412" href="../Confluence/#17412" class="Function">par-confluence</a> <a id="17427" class="Symbol">:</a> <a id="17429" class="Symbol">∀{</a><a id="17431" href="../Confluence/#17431" class="Bound">Γ</a> <a id="17433" href="../Confluence/#17433" class="Bound">A</a><a id="17434" class="Symbol">}</a> <a id="17436" class="Symbol">{</a><a id="17437" href="../Confluence/#17437" class="Bound">L</a> <a id="17439" href="../Confluence/#17439" class="Bound">M₁</a> <a id="17442" href="../Confluence/#17442" class="Bound">M₂</a> <a id="17445" class="Symbol">:</a> <a id="17447" href="../Confluence/#17431" class="Bound">Γ</a> <a id="17449" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="17451" href="../Confluence/#17433" class="Bound">A</a><a id="17452" class="Symbol">}</a>
  <a id="17456" class="Symbol">→</a> <a id="17458" href="../Confluence/#17437" class="Bound">L</a> <a id="17460" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="17463" href="../Confluence/#17439" class="Bound">M₁</a>
  <a id="17468" class="Symbol">→</a> <a id="17470" href="../Confluence/#17437" class="Bound">L</a> <a id="17472" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="17475" href="../Confluence/#17442" class="Bound">M₂</a>
    <a id="17482" class="Comment">------------------------------------</a>
  <a id="17521" class="Symbol">→</a> <a id="17523" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="17526" href="../Confluence/#17526" class="Bound">N</a> <a id="17528" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="17530" href="../Confluence/#17431" class="Bound">Γ</a> <a id="17532" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="17534" href="../Confluence/#17433" class="Bound">A</a> <a id="17536" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="17538" class="Symbol">(</a><a id="17539" href="../Confluence/#17439" class="Bound">M₁</a> <a id="17542" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="17545" href="../Confluence/#17526" class="Bound">N</a><a id="17546" class="Symbol">)</a> <a id="17548" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="17550" class="Symbol">(</a><a id="17551" href="../Confluence/#17442" class="Bound">M₂</a> <a id="17554" href="../Confluence/#3754" class="Datatype Operator">⇛*</a> <a id="17557" href="../Confluence/#17526" class="Bound">N</a><a id="17558" class="Symbol">)</a>
<a id="17560" href="../Confluence/#17412" class="Function">par-confluence</a> <a id="17575" class="Symbol">{</a><a id="17576" href="../Confluence/#17576" class="Bound">Γ</a><a id="17577" class="Symbol">}{</a><a id="17579" href="../Confluence/#17579" class="Bound">A</a><a id="17580" class="Symbol">}{</a><a id="17582" href="../Confluence/#17582" class="Bound">L</a><a id="17583" class="Symbol">}{</a><a id="17585" class="DottedPattern Symbol">.</a><a id="17586" href="../Confluence/#17582" class="DottedPattern Bound">L</a><a id="17587" class="Symbol">}{</a><a id="17589" href="../Confluence/#17589" class="Bound">N</a><a id="17590" class="Symbol">}</a> <a id="17592" class="Symbol">(</a><a id="17593" href="../Confluence/#17582" class="Bound">L</a> <a id="17595" href="../Confluence/#3804" class="InductiveConstructor Operator">∎</a><a id="17596" class="Symbol">)</a> <a id="17598" href="../Confluence/#17598" class="Bound">L⇛*N</a> <a id="17603" class="Symbol">=</a> <a id="17605" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17607" href="../Confluence/#17589" class="Bound">N</a> <a id="17609" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17611" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17613" href="../Confluence/#17598" class="Bound">L⇛*N</a> <a id="17618" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17620" href="../Confluence/#17589" class="Bound">N</a> <a id="17622" href="../Confluence/#3804" class="InductiveConstructor Operator">∎</a> <a id="17624" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="17626" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a>
<a id="17628" href="../Confluence/#17412" class="Function">par-confluence</a> <a id="17643" class="Symbol">{</a><a id="17644" href="../Confluence/#17644" class="Bound">Γ</a><a id="17645" class="Symbol">}{</a><a id="17647" href="../Confluence/#17647" class="Bound">A</a><a id="17648" class="Symbol">}{</a><a id="17650" href="../Confluence/#17650" class="Bound">L</a><a id="17651" class="Symbol">}{</a><a id="17653" href="../Confluence/#17653" class="Bound">M₁′</a><a id="17656" class="Symbol">}{</a><a id="17658" href="../Confluence/#17658" class="Bound">M₂</a><a id="17660" class="Symbol">}</a> <a id="17662" class="Symbol">(</a><a id="17663" href="../Confluence/#17650" class="Bound">L</a> <a id="17665" href="../Confluence/#3860" class="InductiveConstructor Operator">⇛⟨</a> <a id="17668" href="../Confluence/#17668" class="Bound">L⇛M₁</a> <a id="17673" href="../Confluence/#3860" class="InductiveConstructor Operator">⟩</a> <a id="17675" href="../Confluence/#17675" class="Bound">M₁⇛*M₁′</a><a id="17682" class="Symbol">)</a> <a id="17684" href="../Confluence/#17684" class="Bound">L⇛*M₂</a>
    <a id="17694" class="Keyword">with</a> <a id="17699" href="../Confluence/#16910" class="Function">strip</a> <a id="17705" href="../Confluence/#17668" class="Bound">L⇛M₁</a> <a id="17710" href="../Confluence/#17684" class="Bound">L⇛*M₂</a>
<a id="17716" class="Symbol">...</a> <a id="17720" class="Symbol">|</a> <a id="17722" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17724" href="../Confluence/#17724" class="Bound">N</a> <a id="17726" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17728" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17730" href="../Confluence/#17730" class="Bound">M₁⇛*N</a> <a id="17736" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17738" href="../Confluence/#17738" class="Bound">M₂⇛N</a> <a id="17743" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="17745" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a>
      <a id="17753" class="Keyword">with</a> <a id="17758" href="../Confluence/#17412" class="Function">par-confluence</a> <a id="17773" class="Bound">M₁⇛*M₁′</a> <a id="17781" href="../Confluence/#17730" class="Bound">M₁⇛*N</a>
<a id="17787" class="Symbol">...</a>   <a id="17793" class="Symbol">|</a> <a id="17795" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17797" href="../Confluence/#17797" class="Bound">N′</a> <a id="17800" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17802" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17804" href="../Confluence/#17804" class="Bound">M₁′⇛*N′</a> <a id="17812" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17814" href="../Confluence/#17814" class="Bound">N⇛*N′</a> <a id="17820" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="17822" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="17824" class="Symbol">=</a>
        <a id="17834" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17836" href="../Confluence/#17797" class="Bound">N′</a> <a id="17839" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17841" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="17843" href="../Confluence/#17804" class="Bound">M₁′⇛*N′</a> <a id="17851" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="17853" class="Symbol">(</a><a id="17854" class="Bound">M₂</a> <a id="17857" href="../Confluence/#3860" class="InductiveConstructor Operator">⇛⟨</a> <a id="17860" class="Bound">M₂⇛N</a> <a id="17865" href="../Confluence/#3860" class="InductiveConstructor Operator">⟩</a> <a id="17867" href="../Confluence/#17814" class="Bound">N⇛*N′</a><a id="17872" class="Symbol">)</a> <a id="17874" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="17876" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>The step case may be illustrated as follows:</p>
<pre><code>        L
       / \
      1   *
     /     \
    M₁ (a)  M₂
   / \     /
  *   *   1
 /     \ /
M₁′(b)  N
 \     /
  *   *
   \ /
    N′</code></pre>
<p>where downward lines are instances of <code>⇛</code> or <code>⇛*</code>, depending on how they are marked. Here <code>(a)</code> holds by <code>strip</code> and <code>(b)</code> holds by induction.</p>
<h2 id="proof-of-confluence-for-reduction">Proof of confluence for reduction</h2>
<p>Confluence of reduction is a corollary of confluence for parallel reduction. From <code>L —↠ M₁</code> and <code>L —↠ M₂</code> we have <code>L ⇛* M₁</code> and <code>L ⇛* M₂</code> by <code>betas-pars</code>. Then by confluence we obtain some <code>L</code> such that <code>M₁ ⇛* N</code> and <code>M₂ ⇛* N</code>, from which we conclude that <code>M₁ —↠ N</code> and <code>M₂ —↠ N</code> by <code>pars-betas</code>.</p>
<pre class="Agda"><a id="confluence"></a><a id="18605" href="../Confluence/#18605" class="Function">confluence</a> <a id="18616" class="Symbol">:</a> <a id="18618" class="Symbol">∀{</a><a id="18620" href="../Confluence/#18620" class="Bound">Γ</a> <a id="18622" href="../Confluence/#18622" class="Bound">A</a><a id="18623" class="Symbol">}</a> <a id="18625" class="Symbol">{</a><a id="18626" href="../Confluence/#18626" class="Bound">L</a> <a id="18628" href="../Confluence/#18628" class="Bound">M₁</a> <a id="18631" href="../Confluence/#18631" class="Bound">M₂</a> <a id="18634" class="Symbol">:</a> <a id="18636" href="../Confluence/#18620" class="Bound">Γ</a> <a id="18638" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="18640" href="../Confluence/#18622" class="Bound">A</a><a id="18641" class="Symbol">}</a>
  <a id="18645" class="Symbol">→</a> <a id="18647" href="../Confluence/#18626" class="Bound">L</a> <a id="18649" href="../Untyped/#11050" class="Datatype Operator">—↠</a> <a id="18652" href="../Confluence/#18628" class="Bound">M₁</a>
  <a id="18657" class="Symbol">→</a> <a id="18659" href="../Confluence/#18626" class="Bound">L</a> <a id="18661" href="../Untyped/#11050" class="Datatype Operator">—↠</a> <a id="18664" href="../Confluence/#18631" class="Bound">M₂</a>
    <a id="18671" class="Comment">-----------------------------------</a>
  <a id="18709" class="Symbol">→</a> <a id="18711" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="18714" href="../Confluence/#18714" class="Bound">N</a> <a id="18716" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="18718" href="../Confluence/#18620" class="Bound">Γ</a> <a id="18720" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="18722" href="../Confluence/#18622" class="Bound">A</a> <a id="18724" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="18726" class="Symbol">(</a><a id="18727" href="../Confluence/#18628" class="Bound">M₁</a> <a id="18730" href="../Untyped/#11050" class="Datatype Operator">—↠</a> <a id="18733" href="../Confluence/#18714" class="Bound">N</a><a id="18734" class="Symbol">)</a> <a id="18736" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="18738" class="Symbol">(</a><a id="18739" href="../Confluence/#18631" class="Bound">M₂</a> <a id="18742" href="../Untyped/#11050" class="Datatype Operator">—↠</a> <a id="18745" href="../Confluence/#18714" class="Bound">N</a><a id="18746" class="Symbol">)</a>
<a id="18748" href="../Confluence/#18605" class="Function">confluence</a> <a id="18759" href="../Confluence/#18759" class="Bound">L↠M₁</a> <a id="18764" href="../Confluence/#18764" class="Bound">L↠M₂</a>
    <a id="18773" class="Keyword">with</a> <a id="18778" href="../Confluence/#17412" class="Function">par-confluence</a> <a id="18793" class="Symbol">(</a><a id="18794" href="../Confluence/#4956" class="Function">betas-pars</a> <a id="18805" href="../Confluence/#18759" class="Bound">L↠M₁</a><a id="18809" class="Symbol">)</a> <a id="18811" class="Symbol">(</a><a id="18812" href="../Confluence/#4956" class="Function">betas-pars</a> <a id="18823" href="../Confluence/#18764" class="Bound">L↠M₂</a><a id="18827" class="Symbol">)</a>
<a id="18829" class="Symbol">...</a> <a id="18833" class="Symbol">|</a> <a id="18835" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="18837" href="../Confluence/#18837" class="Bound">N</a> <a id="18839" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="18841" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="18843" href="../Confluence/#18843" class="Bound">M₁⇛N</a> <a id="18848" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="18850" href="../Confluence/#18850" class="Bound">M₂⇛N</a> <a id="18855" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="18857" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="18859" class="Symbol">=</a>
      <a id="18867" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="18869" href="../Confluence/#18837" class="Bound">N</a> <a id="18871" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="18873" href="../Confluence/#2250" class="InductiveConstructor Operator">⟨</a> <a id="18875" href="../Confluence/#6854" class="Function">pars-betas</a> <a id="18886" href="../Confluence/#18843" class="Bound">M₁⇛N</a> <a id="18891" href="../Confluence/#2250" class="InductiveConstructor Operator">,</a> <a id="18893" href="../Confluence/#6854" class="Function">pars-betas</a> <a id="18904" href="../Confluence/#18850" class="Bound">M₂⇛N</a> <a id="18909" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a> <a id="18911" href="../Confluence/#2250" class="InductiveConstructor Operator">⟩</a>
</pre>
<h2 id="notes">Notes</h2>
<p>Broadly speaking, this proof of confluence, based on parallel reduction, is due to W. Tait and P. Martin-Löf (see Barendregt 1984, Section 3.2). Details of the mechanization come from several sources. The <code>subst-par</code> lemma is the “strong substitutivity” lemma of Shafer, Tebbi, and Smolka (ITP 2015). The proofs of <code>par-triangle</code>, <code>strip</code>, and <code>par-confluence</code> are based on the notion of complete development by Takahashi (1995) and Pfenning’s 1992 technical report about the Church-Rosser theorem. In addition, we consulted Nipkow and Berghofer’s mechanization in Isabelle, which is based on an earlier article by Nipkow (JAR 1996).</p>
<h2 id="unicode">Unicode</h2>
<p>This chapter uses the following unicode:</p>
<pre><code>⇛  U+21DB  RIGHTWARDS TRIPLE ARROW (\r== or \Rrightarrow)
⁺  U+207A  SUPERSCRIPT PLUS SIGN   (\^+)</code></pre>
    </div>
    <nav class="pager">
    <ul class="pagination">
        
        <li><a class="pagelink" href="../Untyped/">上一章</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/part2/Confluence.lagda.md">源文件</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="../BigStep/">下一章</a></li>
        <li class="separator">&bullet;</li>
        
    </ul>
</nav>

</article>

            </div>
        </main>
        <footer class="site-footer h-card">
    <data class="u-url" href="../"></data>
    <div class="wrapper">
        <h2 class="footer-heading">编程语言基础：Agda 语言描述</h2>
        
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Philip Wadler</li>
                    <li>
                        
                        <a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/wadler" title="wadler"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;wadler</a></li>
    
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Wen Kokke</li>
                    <li>
                        
                        <a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/wenkokke" title="wenkokke"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;wenkokke</a></li>
    
    
    <li><a rel="me" href="https://twitter.com/wenkokke" title="wenkokke"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#twitter"></use></svg>&nbsp;wenkokke</a></li>
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Jeremy G. Siek</li>
                    <li>
                        
                        <a class="u-email" href="mailto:jsiek@indiana.edu">jsiek@indiana.edu</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/jsiek" title="jsiek"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;jsiek</a></li>
    
    
    <li><a rel="me" href="https://twitter.com/jeremysiek" title="jeremysiek"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#twitter"></use></svg>&nbsp;jeremysiek</a></li>
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        
        This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
    </div>
</footer>

    </body>
</html>
