<!DOCTYPE html>
<html lang="en">
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../public/css/style.css">
  
  <title>编程语言基础：Agda 语言描述 – Denotational</title>
  
  
  
</head>

    <body>
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="../">编程语言基础：Agda 语言描述</a>
        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="../">主页</a>
                <a class="page-link" href="../Announcements/">公告</a>
                <a class="page-link" href="../GettingStarted/">使用说明</a>
                <a class="page-link" href="../Citing/">引用</a>
                <a class="page-link" href="https://plfa.github.io/">English</a>
            </div>
        </nav>
    </div>
</header>

        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                <article class="post">
    <nav class="pager">
    <ul class="pagination">
        
        <li><a class="pagelink" href="../BigStep/">上一章</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/part3/Denotational.lagda.md">源文件</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="../Compositional/">下一章</a></li>
        <li class="separator">&bullet;</li>
        
    </ul>
</nav>

    <header class="post-header">
        <h1 class="post-title" id="denotational">Denotational: Denotational semantics of untyped lambda calculus</h1>
    </header>
    <div class="post-content">
        <pre class="Agda"><a id="186" class="Keyword">module</a> <a id="193" href="../Denotational/" class="Module">plfa.part3.Denotational</a> <a id="217" class="Keyword">where</a>
</pre>
<p>The lambda calculus is a language about <em>functions</em>, that is, mappings from input to output. In computing we often think of such mappings as being carried out by a sequence of operations that transform an input into an output. But functions can also be represented as data. For example, one can tabulate a function, that is, create a table where each row has two entries, an input and the corresponding output for the function. Function application is then the process of looking up the row for a given input and reading off the output.</p>
<p>We shall create a semantics for the untyped lambda calculus based on this idea of functions-as-tables. However, there are two difficulties that arise. First, functions often have an infinite domain, so it would seem that we would need infinitely long tables to represent functions. Second, in the lambda calculus, functions can be applied to functions. They can even be applied to themselves! So it would seem that the tables would contain cycles. One might start to worry that advanced techniques are necessary to address these issues, but fortunately this is not the case!</p>
<p>The first problem, of functions with infinite domains, is solved by observing that in the execution of a terminating program, each lambda abstraction will only be applied to a finite number of distinct arguments. (We come back later to discuss diverging programs.) This observation is another way of looking at Dana Scott’s insight that only continuous functions are needed to model the lambda calculus.</p>
<p>The second problem, that of self-application, is solved by relaxing the way in which we lookup an argument in a function’s table. Naively, one would look in the table for a row in which the input entry exactly matches the argument. In the case of self-application, this would require the table to contain a copy of itself. Impossible! (At least, it is impossible if we want to build tables using inductive data type definitions, which indeed we do.) Instead it is sufficient to find an input such that every row of the input appears as a row of the argument (that is, the input is a subset of the argument). In the case of self-application, the table only needs to contain a smaller copy of itself, which is fine.</p>
<p>With these two observations in hand, it is straightforward to write down a denotational semantics of the lambda calculus.</p>
<h2 id="imports">Imports</h2>
<pre class="Agda"><a id="2604" class="Keyword">open</a> <a id="2609" class="Keyword">import</a> <a id="2616" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="2631" class="Keyword">using</a> <a id="2637" class="Symbol">(</a><a id="2638" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Primitive.html#590" class="Primitive">lzero</a><a id="2643" class="Symbol">;</a> <a id="2645" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Primitive.html#606" class="Primitive">lsuc</a><a id="2649" class="Symbol">)</a>
<a id="2651" class="Keyword">open</a> <a id="2656" class="Keyword">import</a> <a id="2663" href="https://agda.github.io/agda-stdlib/v1.3/Data.Empty.html" class="Module">Data.Empty</a> <a id="2674" class="Keyword">using</a> <a id="2680" class="Symbol">(</a><a id="2681" href="https://agda.github.io/agda-stdlib/v1.3/Data.Empty.html#628" class="Function">⊥-elim</a><a id="2687" class="Symbol">)</a>
<a id="2689" class="Keyword">open</a> <a id="2694" class="Keyword">import</a> <a id="2701" href="https://agda.github.io/agda-stdlib/v1.3/Data.Nat.html" class="Module">Data.Nat</a> <a id="2710" class="Keyword">using</a> <a id="2716" class="Symbol">(</a><a id="2717" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="2718" class="Symbol">;</a> <a id="2720" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a><a id="2724" class="Symbol">;</a> <a id="2726" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a><a id="2729" class="Symbol">)</a>
<a id="2731" class="Keyword">open</a> <a id="2736" class="Keyword">import</a> <a id="2743" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html" class="Module">Data.Product</a> <a id="2756" class="Keyword">using</a> <a id="2762" class="Symbol">(</a><a id="2763" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">_×_</a><a id="2766" class="Symbol">;</a> <a id="2768" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#166" class="Record">Σ</a><a id="2769" class="Symbol">;</a> <a id="2771" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ-syntax</a><a id="2779" class="Symbol">;</a> <a id="2781" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1369" class="Function">∃</a><a id="2782" class="Symbol">;</a> <a id="2784" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1788" class="Function">∃-syntax</a><a id="2792" class="Symbol">;</a> <a id="2794" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a><a id="2799" class="Symbol">;</a> <a id="2801" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#264" class="Field">proj₂</a><a id="2806" class="Symbol">)</a>
  <a id="2810" class="Keyword">renaming</a> <a id="2819" class="Symbol">(</a><a id="2820" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="2824" class="Symbol">to</a> <a id="_,_"></a><a id="2827" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="2832" class="Symbol">)</a>
<a id="2834" class="Keyword">open</a> <a id="2839" class="Keyword">import</a> <a id="2846" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.html" class="Module">Data.Sum</a>
<a id="2855" class="Keyword">open</a> <a id="2860" class="Keyword">import</a> <a id="2867" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.html" class="Module">Data.Vec</a> <a id="2876" class="Keyword">using</a> <a id="2882" class="Symbol">(</a><a id="2883" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#959" class="Datatype">Vec</a><a id="2886" class="Symbol">;</a> <a id="2888" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#995" class="InductiveConstructor">[]</a><a id="2890" class="Symbol">;</a> <a id="2892" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">_∷_</a><a id="2895" class="Symbol">)</a>
<a id="2897" class="Keyword">open</a> <a id="2902" class="Keyword">import</a> <a id="2909" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="2949" class="Keyword">using</a> <a id="2955" class="Symbol">(</a><a id="2956" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="2959" class="Symbol">;</a> <a id="2961" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#840" class="Function Operator">_≢_</a><a id="2964" class="Symbol">;</a> <a id="2966" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="2970" class="Symbol">;</a> <a id="2972" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a><a id="2975" class="Symbol">;</a> <a id="2977" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#1131" class="Function">cong</a><a id="2981" class="Symbol">;</a> <a id="2983" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.html#1524" class="Function">cong₂</a><a id="2988" class="Symbol">;</a> <a id="2990" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.html#1396" class="Function">cong-app</a><a id="2998" class="Symbol">)</a>
<a id="3000" class="Keyword">open</a> <a id="3005" class="Keyword">import</a> <a id="3012" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="3029" class="Keyword">using</a> <a id="3035" class="Symbol">(</a><a id="3036" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#653" class="Function Operator">¬_</a><a id="3038" class="Symbol">)</a>
<a id="3040" class="Keyword">open</a> <a id="3045" class="Keyword">import</a> <a id="3052" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="3078" class="Keyword">using</a> <a id="3084" class="Symbol">(</a><a id="3085" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.Negation.html#858" class="Function">contradiction</a><a id="3098" class="Symbol">)</a>
<a id="3100" class="Keyword">open</a> <a id="3105" class="Keyword">import</a> <a id="3112" href="https://agda.github.io/agda-stdlib/v1.3/Function.html" class="Module">Function</a> <a id="3121" class="Keyword">using</a> <a id="3127" class="Symbol">(</a><a id="3128" href="https://agda.github.io/agda-stdlib/v1.3/Function.Base.html#992" class="Function Operator">_∘_</a><a id="3131" class="Symbol">)</a>
<a id="3133" class="Keyword">open</a> <a id="3138" class="Keyword">import</a> <a id="3145" href="../Untyped/" class="Module">plfa.part2.Untyped</a>
  <a id="3166" class="Keyword">using</a> <a id="3172" class="Symbol">(</a><a id="3173" href="../Untyped/#3135" class="Datatype">Context</a><a id="3180" class="Symbol">;</a> <a id="3182" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="3183" class="Symbol">;</a> <a id="3185" href="../Untyped/#3503" class="Datatype Operator">_∋_</a><a id="3188" class="Symbol">;</a> <a id="3190" href="../Untyped/#3157" class="InductiveConstructor">∅</a><a id="3191" class="Symbol">;</a> <a id="3193" href="../Untyped/#3173" class="InductiveConstructor Operator">_,_</a><a id="3196" class="Symbol">;</a> <a id="3198" href="../Untyped/#3539" class="InductiveConstructor">Z</a><a id="3199" class="Symbol">;</a> <a id="3201" href="../Untyped/#3584" class="InductiveConstructor Operator">S_</a><a id="3203" class="Symbol">;</a> <a id="3205" href="../Untyped/#4276" class="Datatype Operator">_⊢_</a><a id="3208" class="Symbol">;</a> <a id="3210" href="../Untyped/#4312" class="InductiveConstructor Operator">`_</a><a id="3212" class="Symbol">;</a> <a id="3214" href="../Untyped/#4424" class="InductiveConstructor Operator">_·_</a><a id="3217" class="Symbol">;</a> <a id="3219" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ_</a><a id="3221" class="Symbol">;</a>
         <a id="3232" href="../Untyped/#5093" class="Function Operator">#_</a><a id="3234" class="Symbol">;</a> <a id="3236" href="../Untyped/#5224" class="Function">twoᶜ</a><a id="3240" class="Symbol">;</a> <a id="3242" href="../Untyped/#5907" class="Function">ext</a><a id="3245" class="Symbol">;</a> <a id="3247" href="../Untyped/#6217" class="Function">rename</a><a id="3253" class="Symbol">;</a> <a id="3255" href="../Untyped/#6653" class="Function">exts</a><a id="3259" class="Symbol">;</a> <a id="3261" href="../Untyped/#6945" class="Function">subst</a><a id="3266" class="Symbol">;</a> <a id="3268" href="../Untyped/#7357" class="Function">subst-zero</a><a id="3278" class="Symbol">;</a> <a id="3280" href="../Untyped/#7473" class="Function Operator">_[_]</a><a id="3284" class="Symbol">)</a>
<a id="3286" class="Keyword">open</a> <a id="3291" class="Keyword">import</a> <a id="3298" href="../Substitution/" class="Module">plfa.part2.Substitution</a> <a id="3322" class="Keyword">using</a> <a id="3328" class="Symbol">(</a><a id="3329" href="../Substitution/#2192" class="Function">Rename</a><a id="3335" class="Symbol">;</a> <a id="3337" href="../Substitution/#1927" class="Postulate">extensionality</a><a id="3351" class="Symbol">;</a> <a id="3353" href="../Substitution/#17302" class="Function">rename-id</a><a id="3362" class="Symbol">)</a>
</pre>
<h2 id="values">Values</h2>
<p>The <code>Value</code> data type represents a finite portion of a function. We think of a value as a finite set of pairs that represent input-output mappings. The <code>Value</code> data type represents the set as a binary tree whose internal nodes are the union operator and whose leaves represent either a single mapping or the empty set.</p>
<ul>
<li><p>The ⊥ value provides no information about the computation.</p></li>
<li><p>A value of the form <code>v ↦ w</code> is a single input-output mapping, from input <code>v</code> to output <code>w</code>.</p></li>
<li><p>A value of the form <code>v ⊔ w</code> is a function that maps inputs to outputs according to both <code>v</code> and <code>w</code>. Think of it as taking the union of the two sets.</p></li>
</ul>
<pre class="Agda"><a id="4035" class="Keyword">infixr</a> <a id="4042" class="Number">7</a> <a id="4044" href="../Denotational/#4099" class="InductiveConstructor Operator">_↦_</a>
<a id="4048" class="Keyword">infixl</a> <a id="4055" class="Number">5</a> <a id="4057" href="../Denotational/#4129" class="InductiveConstructor Operator">_⊔_</a>

<a id="4062" class="Keyword">data</a> <a id="Value"></a><a id="4067" href="../Denotational/#4067" class="Datatype">Value</a> <a id="4073" class="Symbol">:</a> <a id="4075" class="PrimitiveType">Set</a> <a id="4079" class="Keyword">where</a>
  <a id="Value.⊥"></a><a id="4087" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="4089" class="Symbol">:</a> <a id="4091" href="../Denotational/#4067" class="Datatype">Value</a>
  <a id="Value._↦_"></a><a id="4099" href="../Denotational/#4099" class="InductiveConstructor Operator">_↦_</a> <a id="4103" class="Symbol">:</a> <a id="4105" href="../Denotational/#4067" class="Datatype">Value</a> <a id="4111" class="Symbol">→</a> <a id="4113" href="../Denotational/#4067" class="Datatype">Value</a> <a id="4119" class="Symbol">→</a> <a id="4121" href="../Denotational/#4067" class="Datatype">Value</a>
  <a id="Value._⊔_"></a><a id="4129" href="../Denotational/#4129" class="InductiveConstructor Operator">_⊔_</a> <a id="4133" class="Symbol">:</a> <a id="4135" href="../Denotational/#4067" class="Datatype">Value</a> <a id="4141" class="Symbol">→</a> <a id="4143" href="../Denotational/#4067" class="Datatype">Value</a> <a id="4149" class="Symbol">→</a> <a id="4151" href="../Denotational/#4067" class="Datatype">Value</a>
</pre>
<p>The <code>⊑</code> relation adapts the familiar notion of subset to the Value data type. This relation plays the key role in enabling self-application. There are two rules that are specific to functions, <code>⊑-fun</code> and <code>⊑-dist</code>, which we discuss below.</p>
<pre class="Agda"><a id="4406" class="Keyword">infix</a> <a id="4412" class="Number">4</a> <a id="4414" href="../Denotational/#4424" class="Datatype Operator">_⊑_</a>

<a id="4419" class="Keyword">data</a> <a id="_⊑_"></a><a id="4424" href="../Denotational/#4424" class="Datatype Operator">_⊑_</a> <a id="4428" class="Symbol">:</a> <a id="4430" href="../Denotational/#4067" class="Datatype">Value</a> <a id="4436" class="Symbol">→</a> <a id="4438" href="../Denotational/#4067" class="Datatype">Value</a> <a id="4444" class="Symbol">→</a> <a id="4446" class="PrimitiveType">Set</a> <a id="4450" class="Keyword">where</a>

  <a id="_⊑_.⊑-bot"></a><a id="4459" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a> <a id="4465" class="Symbol">:</a> <a id="4467" class="Symbol">∀</a> <a id="4469" class="Symbol">{</a><a id="4470" href="../Denotational/#4470" class="Bound">v</a><a id="4471" class="Symbol">}</a> <a id="4473" class="Symbol">→</a> <a id="4475" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="4477" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4479" href="../Denotational/#4470" class="Bound">v</a>

  <a id="_⊑_.⊑-conj-L"></a><a id="4484" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="4493" class="Symbol">:</a> <a id="4495" class="Symbol">∀</a> <a id="4497" class="Symbol">{</a><a id="4498" href="../Denotational/#4498" class="Bound">u</a> <a id="4500" href="../Denotational/#4500" class="Bound">v</a> <a id="4502" href="../Denotational/#4502" class="Bound">w</a><a id="4503" class="Symbol">}</a>
    <a id="4509" class="Symbol">→</a> <a id="4511" href="../Denotational/#4500" class="Bound">v</a> <a id="4513" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4515" href="../Denotational/#4498" class="Bound">u</a>
    <a id="4521" class="Symbol">→</a> <a id="4523" href="../Denotational/#4502" class="Bound">w</a> <a id="4525" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4527" href="../Denotational/#4498" class="Bound">u</a>
      <a id="4535" class="Comment">-----------</a>
    <a id="4551" class="Symbol">→</a> <a id="4553" class="Symbol">(</a><a id="4554" href="../Denotational/#4500" class="Bound">v</a> <a id="4556" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="4558" href="../Denotational/#4502" class="Bound">w</a><a id="4559" class="Symbol">)</a> <a id="4561" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4563" href="../Denotational/#4498" class="Bound">u</a>

  <a id="_⊑_.⊑-conj-R1"></a><a id="4568" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="4578" class="Symbol">:</a> <a id="4580" class="Symbol">∀</a> <a id="4582" class="Symbol">{</a><a id="4583" href="../Denotational/#4583" class="Bound">u</a> <a id="4585" href="../Denotational/#4585" class="Bound">v</a> <a id="4587" href="../Denotational/#4587" class="Bound">w</a><a id="4588" class="Symbol">}</a>
    <a id="4594" class="Symbol">→</a> <a id="4596" href="../Denotational/#4583" class="Bound">u</a> <a id="4598" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4600" href="../Denotational/#4585" class="Bound">v</a>
      <a id="4608" class="Comment">-----------</a>
    <a id="4624" class="Symbol">→</a> <a id="4626" href="../Denotational/#4583" class="Bound">u</a> <a id="4628" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4630" class="Symbol">(</a><a id="4631" href="../Denotational/#4585" class="Bound">v</a> <a id="4633" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="4635" href="../Denotational/#4587" class="Bound">w</a><a id="4636" class="Symbol">)</a>

  <a id="_⊑_.⊑-conj-R2"></a><a id="4641" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="4651" class="Symbol">:</a> <a id="4653" class="Symbol">∀</a> <a id="4655" class="Symbol">{</a><a id="4656" href="../Denotational/#4656" class="Bound">u</a> <a id="4658" href="../Denotational/#4658" class="Bound">v</a> <a id="4660" href="../Denotational/#4660" class="Bound">w</a><a id="4661" class="Symbol">}</a>
    <a id="4667" class="Symbol">→</a> <a id="4669" href="../Denotational/#4656" class="Bound">u</a> <a id="4671" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4673" href="../Denotational/#4660" class="Bound">w</a>
      <a id="4681" class="Comment">-----------</a>
    <a id="4697" class="Symbol">→</a> <a id="4699" href="../Denotational/#4656" class="Bound">u</a> <a id="4701" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4703" class="Symbol">(</a><a id="4704" href="../Denotational/#4658" class="Bound">v</a> <a id="4706" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="4708" href="../Denotational/#4660" class="Bound">w</a><a id="4709" class="Symbol">)</a>

  <a id="_⊑_.⊑-trans"></a><a id="4714" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="4722" class="Symbol">:</a> <a id="4724" class="Symbol">∀</a> <a id="4726" class="Symbol">{</a><a id="4727" href="../Denotational/#4727" class="Bound">u</a> <a id="4729" href="../Denotational/#4729" class="Bound">v</a> <a id="4731" href="../Denotational/#4731" class="Bound">w</a><a id="4732" class="Symbol">}</a>
    <a id="4738" class="Symbol">→</a> <a id="4740" href="../Denotational/#4727" class="Bound">u</a> <a id="4742" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4744" href="../Denotational/#4729" class="Bound">v</a>
    <a id="4750" class="Symbol">→</a> <a id="4752" href="../Denotational/#4729" class="Bound">v</a> <a id="4754" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4756" href="../Denotational/#4731" class="Bound">w</a>
      <a id="4764" class="Comment">-----</a>
    <a id="4774" class="Symbol">→</a> <a id="4776" href="../Denotational/#4727" class="Bound">u</a> <a id="4778" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4780" href="../Denotational/#4731" class="Bound">w</a>

  <a id="_⊑_.⊑-fun"></a><a id="4785" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="4791" class="Symbol">:</a> <a id="4793" class="Symbol">∀</a> <a id="4795" class="Symbol">{</a><a id="4796" href="../Denotational/#4796" class="Bound">v</a> <a id="4798" href="../Denotational/#4798" class="Bound">w</a> <a id="4800" href="../Denotational/#4800" class="Bound">v′</a> <a id="4803" href="../Denotational/#4803" class="Bound">w′</a><a id="4805" class="Symbol">}</a>
    <a id="4811" class="Symbol">→</a> <a id="4813" href="../Denotational/#4800" class="Bound">v′</a> <a id="4816" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4818" href="../Denotational/#4796" class="Bound">v</a>
    <a id="4824" class="Symbol">→</a> <a id="4826" href="../Denotational/#4798" class="Bound">w</a> <a id="4828" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4830" href="../Denotational/#4803" class="Bound">w′</a>
      <a id="4839" class="Comment">-------------------</a>
    <a id="4863" class="Symbol">→</a> <a id="4865" class="Symbol">(</a><a id="4866" href="../Denotational/#4796" class="Bound">v</a> <a id="4868" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="4870" href="../Denotational/#4798" class="Bound">w</a><a id="4871" class="Symbol">)</a> <a id="4873" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4875" class="Symbol">(</a><a id="4876" href="../Denotational/#4800" class="Bound">v′</a> <a id="4879" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="4881" href="../Denotational/#4803" class="Bound">w′</a><a id="4883" class="Symbol">)</a>

  <a id="_⊑_.⊑-dist"></a><a id="4888" href="../Denotational/#4888" class="InductiveConstructor">⊑-dist</a> <a id="4895" class="Symbol">:</a> <a id="4897" class="Symbol">∀{</a><a id="4899" href="../Denotational/#4899" class="Bound">v</a> <a id="4901" href="../Denotational/#4901" class="Bound">w</a> <a id="4903" href="../Denotational/#4903" class="Bound">w′</a><a id="4905" class="Symbol">}</a>
      <a id="4913" class="Comment">---------------------------------</a>
    <a id="4951" class="Symbol">→</a> <a id="4953" href="../Denotational/#4899" class="Bound">v</a> <a id="4955" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="4957" class="Symbol">(</a><a id="4958" href="../Denotational/#4901" class="Bound">w</a> <a id="4960" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="4962" href="../Denotational/#4903" class="Bound">w′</a><a id="4964" class="Symbol">)</a> <a id="4966" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="4968" class="Symbol">(</a><a id="4969" href="../Denotational/#4899" class="Bound">v</a> <a id="4971" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="4973" href="../Denotational/#4901" class="Bound">w</a><a id="4974" class="Symbol">)</a> <a id="4976" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="4978" class="Symbol">(</a><a id="4979" href="../Denotational/#4899" class="Bound">v</a> <a id="4981" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="4983" href="../Denotational/#4903" class="Bound">w′</a><a id="4985" class="Symbol">)</a>
</pre>
<p>The first five rules are straightforward. The rule <code>⊑-fun</code> captures when it is OK to match a higher-order argument <code>v′ ↦ w′</code> to a table entry whose input is <code>v ↦ w</code>. Considering a call to the higher-order argument. It is OK to pass a larger argument than expected, so <code>v</code> can be larger than <code>v′</code>. Also, it is OK to disregard some of the output, so <code>w</code> can be smaller than <code>w′</code>. The rule <code>⊑-dist</code> says that if you have two entries for the same input, then you can combine them into a single entry and joins the two outputs.</p>
<p>The <code>⊑</code> relation is reflexive.</p>
<pre class="Agda"><a id="⊑-refl"></a><a id="5554" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="5561" class="Symbol">:</a> <a id="5563" class="Symbol">∀</a> <a id="5565" class="Symbol">{</a><a id="5566" href="../Denotational/#5566" class="Bound">v</a><a id="5567" class="Symbol">}</a> <a id="5569" class="Symbol">→</a> <a id="5571" href="../Denotational/#5566" class="Bound">v</a> <a id="5573" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="5575" href="../Denotational/#5566" class="Bound">v</a>
<a id="5577" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="5584" class="Symbol">{</a><a id="5585" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="5586" class="Symbol">}</a> <a id="5588" class="Symbol">=</a> <a id="5590" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a>
<a id="5596" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="5603" class="Symbol">{</a><a id="5604" href="../Denotational/#5604" class="Bound">v</a> <a id="5606" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="5608" href="../Denotational/#5608" class="Bound">v′</a><a id="5610" class="Symbol">}</a> <a id="5612" class="Symbol">=</a> <a id="5614" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="5620" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="5627" href="../Denotational/#5554" class="Function">⊑-refl</a>
<a id="5634" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="5641" class="Symbol">{</a><a id="5642" href="../Denotational/#5642" class="Bound">v₁</a> <a id="5645" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="5647" href="../Denotational/#5647" class="Bound">v₂</a><a id="5649" class="Symbol">}</a> <a id="5651" class="Symbol">=</a> <a id="5653" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="5662" class="Symbol">(</a><a id="5663" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="5673" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="5679" class="Symbol">)</a> <a id="5681" class="Symbol">(</a><a id="5682" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="5692" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="5698" class="Symbol">)</a>
</pre>
<p>The <code>⊔</code> operation is monotonic with respect to <code>⊑</code>, that is, given two larger values it produces a larger value.</p>
<pre class="Agda"><a id="⊔⊑⊔"></a><a id="5823" href="../Denotational/#5823" class="Function">⊔⊑⊔</a> <a id="5827" class="Symbol">:</a> <a id="5829" class="Symbol">∀</a> <a id="5831" class="Symbol">{</a><a id="5832" href="../Denotational/#5832" class="Bound">v</a> <a id="5834" href="../Denotational/#5834" class="Bound">w</a> <a id="5836" href="../Denotational/#5836" class="Bound">v′</a> <a id="5839" href="../Denotational/#5839" class="Bound">w′</a><a id="5841" class="Symbol">}</a>
  <a id="5845" class="Symbol">→</a> <a id="5847" href="../Denotational/#5832" class="Bound">v</a> <a id="5849" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="5851" href="../Denotational/#5836" class="Bound">v′</a>  <a id="5855" class="Symbol">→</a>  <a id="5858" href="../Denotational/#5834" class="Bound">w</a> <a id="5860" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="5862" href="../Denotational/#5839" class="Bound">w′</a>
    <a id="5869" class="Comment">-----------------------</a>
  <a id="5895" class="Symbol">→</a> <a id="5897" class="Symbol">(</a><a id="5898" href="../Denotational/#5832" class="Bound">v</a> <a id="5900" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="5902" href="../Denotational/#5834" class="Bound">w</a><a id="5903" class="Symbol">)</a> <a id="5905" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="5907" class="Symbol">(</a><a id="5908" href="../Denotational/#5836" class="Bound">v′</a> <a id="5911" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="5913" href="../Denotational/#5839" class="Bound">w′</a><a id="5915" class="Symbol">)</a>
<a id="5917" href="../Denotational/#5823" class="Function">⊔⊑⊔</a> <a id="5921" href="../Denotational/#5921" class="Bound">d₁</a> <a id="5924" href="../Denotational/#5924" class="Bound">d₂</a> <a id="5927" class="Symbol">=</a> <a id="5929" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="5938" class="Symbol">(</a><a id="5939" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="5949" href="../Denotational/#5921" class="Bound">d₁</a><a id="5951" class="Symbol">)</a> <a id="5953" class="Symbol">(</a><a id="5954" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="5964" href="../Denotational/#5924" class="Bound">d₂</a><a id="5966" class="Symbol">)</a>
</pre>
<p>The <code>⊑-dist</code> rule can be used to combine two entries even when the input values are not identical. One can first combine the two inputs using ⊔ and then apply the <code>⊑-dist</code> rule to obtain the following property.</p>
<pre class="Agda"><a id="⊔↦⊔-dist"></a><a id="6189" href="../Denotational/#6189" class="Function">⊔↦⊔-dist</a> <a id="6198" class="Symbol">:</a> <a id="6200" class="Symbol">∀{</a><a id="6202" href="../Denotational/#6202" class="Bound">v</a> <a id="6204" href="../Denotational/#6204" class="Bound">v′</a> <a id="6207" href="../Denotational/#6207" class="Bound">w</a> <a id="6209" href="../Denotational/#6209" class="Bound">w′</a> <a id="6212" class="Symbol">:</a> <a id="6214" href="../Denotational/#4067" class="Datatype">Value</a><a id="6219" class="Symbol">}</a>
  <a id="6223" class="Symbol">→</a> <a id="6225" class="Symbol">(</a><a id="6226" href="../Denotational/#6202" class="Bound">v</a> <a id="6228" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="6230" href="../Denotational/#6204" class="Bound">v′</a><a id="6232" class="Symbol">)</a> <a id="6234" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="6236" class="Symbol">(</a><a id="6237" href="../Denotational/#6207" class="Bound">w</a> <a id="6239" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="6241" href="../Denotational/#6209" class="Bound">w′</a><a id="6243" class="Symbol">)</a> <a id="6245" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="6247" class="Symbol">(</a><a id="6248" href="../Denotational/#6202" class="Bound">v</a> <a id="6250" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="6252" href="../Denotational/#6207" class="Bound">w</a><a id="6253" class="Symbol">)</a> <a id="6255" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="6257" class="Symbol">(</a><a id="6258" href="../Denotational/#6204" class="Bound">v′</a> <a id="6261" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="6263" href="../Denotational/#6209" class="Bound">w′</a><a id="6265" class="Symbol">)</a>
<a id="6267" href="../Denotational/#6189" class="Function">⊔↦⊔-dist</a> <a id="6276" class="Symbol">=</a> <a id="6278" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="6286" href="../Denotational/#4888" class="InductiveConstructor">⊑-dist</a> <a id="6293" class="Symbol">(</a><a id="6294" href="../Denotational/#5823" class="Function">⊔⊑⊔</a> <a id="6298" class="Symbol">(</a><a id="6299" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="6305" class="Symbol">(</a><a id="6306" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="6316" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="6322" class="Symbol">)</a> <a id="6324" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="6330" class="Symbol">)</a>
                            <a id="6360" class="Symbol">(</a><a id="6361" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="6367" class="Symbol">(</a><a id="6368" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="6378" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="6384" class="Symbol">)</a> <a id="6386" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="6392" class="Symbol">))</a>
</pre>
<!--
 [PLW: above might read more nicely if we introduce inequational reasoning.]
 -->
<p>If the join <code>u ⊔ v</code> is less than another value <code>w</code>, then both <code>u</code> and <code>v</code> are less than <code>w</code>.</p>
<pre class="Agda"><a id="⊔⊑-invL"></a><a id="6586" href="../Denotational/#6586" class="Function">⊔⊑-invL</a> <a id="6594" class="Symbol">:</a> <a id="6596" class="Symbol">∀{</a><a id="6598" href="../Denotational/#6598" class="Bound">u</a> <a id="6600" href="../Denotational/#6600" class="Bound">v</a> <a id="6602" href="../Denotational/#6602" class="Bound">w</a> <a id="6604" class="Symbol">:</a> <a id="6606" href="../Denotational/#4067" class="Datatype">Value</a><a id="6611" class="Symbol">}</a>
  <a id="6615" class="Symbol">→</a> <a id="6617" href="../Denotational/#6598" class="Bound">u</a> <a id="6619" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="6621" href="../Denotational/#6600" class="Bound">v</a> <a id="6623" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="6625" href="../Denotational/#6602" class="Bound">w</a>
    <a id="6631" class="Comment">---------</a>
  <a id="6643" class="Symbol">→</a> <a id="6645" href="../Denotational/#6598" class="Bound">u</a> <a id="6647" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="6649" href="../Denotational/#6602" class="Bound">w</a>
<a id="6651" href="../Denotational/#6586" class="Function">⊔⊑-invL</a> <a id="6659" class="Symbol">(</a><a id="6660" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="6669" href="../Denotational/#6669" class="Bound">lt1</a> <a id="6673" href="../Denotational/#6673" class="Bound">lt2</a><a id="6676" class="Symbol">)</a> <a id="6678" class="Symbol">=</a> <a id="6680" href="../Denotational/#6669" class="Bound">lt1</a>
<a id="6684" href="../Denotational/#6586" class="Function">⊔⊑-invL</a> <a id="6692" class="Symbol">(</a><a id="6693" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="6703" href="../Denotational/#6703" class="Bound">lt</a><a id="6705" class="Symbol">)</a> <a id="6707" class="Symbol">=</a> <a id="6709" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="6719" class="Symbol">(</a><a id="6720" href="../Denotational/#6586" class="Function">⊔⊑-invL</a> <a id="6728" href="../Denotational/#6703" class="Bound">lt</a><a id="6730" class="Symbol">)</a>
<a id="6732" href="../Denotational/#6586" class="Function">⊔⊑-invL</a> <a id="6740" class="Symbol">(</a><a id="6741" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="6751" href="../Denotational/#6751" class="Bound">lt</a><a id="6753" class="Symbol">)</a> <a id="6755" class="Symbol">=</a> <a id="6757" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="6767" class="Symbol">(</a><a id="6768" href="../Denotational/#6586" class="Function">⊔⊑-invL</a> <a id="6776" href="../Denotational/#6751" class="Bound">lt</a><a id="6778" class="Symbol">)</a>
<a id="6780" href="../Denotational/#6586" class="Function">⊔⊑-invL</a> <a id="6788" class="Symbol">(</a><a id="6789" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="6797" href="../Denotational/#6797" class="Bound">lt1</a> <a id="6801" href="../Denotational/#6801" class="Bound">lt2</a><a id="6804" class="Symbol">)</a> <a id="6806" class="Symbol">=</a> <a id="6808" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="6816" class="Symbol">(</a><a id="6817" href="../Denotational/#6586" class="Function">⊔⊑-invL</a> <a id="6825" href="../Denotational/#6797" class="Bound">lt1</a><a id="6828" class="Symbol">)</a> <a id="6830" href="../Denotational/#6801" class="Bound">lt2</a>

<a id="⊔⊑-invR"></a><a id="6835" href="../Denotational/#6835" class="Function">⊔⊑-invR</a> <a id="6843" class="Symbol">:</a> <a id="6845" class="Symbol">∀{</a><a id="6847" href="../Denotational/#6847" class="Bound">u</a> <a id="6849" href="../Denotational/#6849" class="Bound">v</a> <a id="6851" href="../Denotational/#6851" class="Bound">w</a> <a id="6853" class="Symbol">:</a> <a id="6855" href="../Denotational/#4067" class="Datatype">Value</a><a id="6860" class="Symbol">}</a>
  <a id="6864" class="Symbol">→</a> <a id="6866" href="../Denotational/#6847" class="Bound">u</a> <a id="6868" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="6870" href="../Denotational/#6849" class="Bound">v</a> <a id="6872" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="6874" href="../Denotational/#6851" class="Bound">w</a>
    <a id="6880" class="Comment">---------</a>
  <a id="6892" class="Symbol">→</a> <a id="6894" href="../Denotational/#6849" class="Bound">v</a> <a id="6896" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="6898" href="../Denotational/#6851" class="Bound">w</a>
<a id="6900" href="../Denotational/#6835" class="Function">⊔⊑-invR</a> <a id="6908" class="Symbol">(</a><a id="6909" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="6918" href="../Denotational/#6918" class="Bound">lt1</a> <a id="6922" href="../Denotational/#6922" class="Bound">lt2</a><a id="6925" class="Symbol">)</a> <a id="6927" class="Symbol">=</a> <a id="6929" href="../Denotational/#6922" class="Bound">lt2</a>
<a id="6933" href="../Denotational/#6835" class="Function">⊔⊑-invR</a> <a id="6941" class="Symbol">(</a><a id="6942" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="6952" href="../Denotational/#6952" class="Bound">lt</a><a id="6954" class="Symbol">)</a> <a id="6956" class="Symbol">=</a> <a id="6958" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="6968" class="Symbol">(</a><a id="6969" href="../Denotational/#6835" class="Function">⊔⊑-invR</a> <a id="6977" href="../Denotational/#6952" class="Bound">lt</a><a id="6979" class="Symbol">)</a>
<a id="6981" href="../Denotational/#6835" class="Function">⊔⊑-invR</a> <a id="6989" class="Symbol">(</a><a id="6990" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="7000" href="../Denotational/#7000" class="Bound">lt</a><a id="7002" class="Symbol">)</a> <a id="7004" class="Symbol">=</a> <a id="7006" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="7016" class="Symbol">(</a><a id="7017" href="../Denotational/#6835" class="Function">⊔⊑-invR</a> <a id="7025" href="../Denotational/#7000" class="Bound">lt</a><a id="7027" class="Symbol">)</a>
<a id="7029" href="../Denotational/#6835" class="Function">⊔⊑-invR</a> <a id="7037" class="Symbol">(</a><a id="7038" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="7046" href="../Denotational/#7046" class="Bound">lt1</a> <a id="7050" href="../Denotational/#7050" class="Bound">lt2</a><a id="7053" class="Symbol">)</a> <a id="7055" class="Symbol">=</a> <a id="7057" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="7065" class="Symbol">(</a><a id="7066" href="../Denotational/#6835" class="Function">⊔⊑-invR</a> <a id="7074" href="../Denotational/#7046" class="Bound">lt1</a><a id="7077" class="Symbol">)</a> <a id="7079" href="../Denotational/#7050" class="Bound">lt2</a>
</pre>
<h2 id="environments">Environments</h2>
<p>An environment gives meaning to the free variables in a term by mapping variables to values.</p>
<pre class="Agda"><a id="Env"></a><a id="7204" href="../Denotational/#7204" class="Function">Env</a> <a id="7208" class="Symbol">:</a> <a id="7210" href="../Untyped/#3135" class="Datatype">Context</a> <a id="7218" class="Symbol">→</a> <a id="7220" class="PrimitiveType">Set</a>
<a id="7224" href="../Denotational/#7204" class="Function">Env</a> <a id="7228" href="../Denotational/#7228" class="Bound">Γ</a> <a id="7230" class="Symbol">=</a> <a id="7232" class="Symbol">∀</a> <a id="7234" class="Symbol">(</a><a id="7235" href="../Denotational/#7235" class="Bound">x</a> <a id="7237" class="Symbol">:</a> <a id="7239" href="../Denotational/#7228" class="Bound">Γ</a> <a id="7241" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="7243" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="7244" class="Symbol">)</a> <a id="7246" class="Symbol">→</a> <a id="7248" href="../Denotational/#4067" class="Datatype">Value</a>
</pre>
We have the empty environment, and we can extend an environment.
<pre class="Agda"><a id="`∅"></a><a id="7328" href="../Denotational/#7328" class="Function">`∅</a> <a id="7331" class="Symbol">:</a> <a id="7333" href="../Denotational/#7204" class="Function">Env</a> <a id="7337" href="../Untyped/#3157" class="InductiveConstructor">∅</a>
<a id="7339" href="../Denotational/#7328" class="Function">`∅</a> <a id="7342" class="Symbol">()</a>

<a id="7346" class="Keyword">infixl</a> <a id="7353" class="Number">5</a> <a id="7355" href="../Denotational/#7361" class="Function Operator">_`,_</a>

<a id="_`,_"></a><a id="7361" href="../Denotational/#7361" class="Function Operator">_`,_</a> <a id="7366" class="Symbol">:</a> <a id="7368" class="Symbol">∀</a> <a id="7370" class="Symbol">{</a><a id="7371" href="../Denotational/#7371" class="Bound">Γ</a><a id="7372" class="Symbol">}</a> <a id="7374" class="Symbol">→</a> <a id="7376" href="../Denotational/#7204" class="Function">Env</a> <a id="7380" href="../Denotational/#7371" class="Bound">Γ</a> <a id="7382" class="Symbol">→</a> <a id="7384" href="../Denotational/#4067" class="Datatype">Value</a> <a id="7390" class="Symbol">→</a> <a id="7392" href="../Denotational/#7204" class="Function">Env</a> <a id="7396" class="Symbol">(</a><a id="7397" href="../Denotational/#7371" class="Bound">Γ</a> <a id="7399" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="7401" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="7402" class="Symbol">)</a>
<a id="7404" class="Symbol">(</a><a id="7405" href="../Denotational/#7405" class="Bound">γ</a> <a id="7407" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="7410" href="../Denotational/#7410" class="Bound">v</a><a id="7411" class="Symbol">)</a> <a id="7413" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="7415" class="Symbol">=</a> <a id="7417" href="../Denotational/#7410" class="Bound">v</a>
<a id="7419" class="Symbol">(</a><a id="7420" href="../Denotational/#7420" class="Bound">γ</a> <a id="7422" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="7425" href="../Denotational/#7425" class="Bound">v</a><a id="7426" class="Symbol">)</a> <a id="7428" class="Symbol">(</a><a id="7429" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="7431" href="../Denotational/#7431" class="Bound">x</a><a id="7432" class="Symbol">)</a> <a id="7434" class="Symbol">=</a> <a id="7436" href="../Denotational/#7420" class="Bound">γ</a> <a id="7438" href="../Denotational/#7431" class="Bound">x</a>
</pre>
We can recover the previous environment from an extended environment, and the last value. Putting them together again takes us back to where we started.
<pre class="Agda"><a id="init"></a><a id="7602" href="../Denotational/#7602" class="Function">init</a> <a id="7607" class="Symbol">:</a> <a id="7609" class="Symbol">∀</a> <a id="7611" class="Symbol">{</a><a id="7612" href="../Denotational/#7612" class="Bound">Γ</a><a id="7613" class="Symbol">}</a> <a id="7615" class="Symbol">→</a> <a id="7617" href="../Denotational/#7204" class="Function">Env</a> <a id="7621" class="Symbol">(</a><a id="7622" href="../Denotational/#7612" class="Bound">Γ</a> <a id="7624" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="7626" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="7627" class="Symbol">)</a> <a id="7629" class="Symbol">→</a> <a id="7631" href="../Denotational/#7204" class="Function">Env</a> <a id="7635" href="../Denotational/#7612" class="Bound">Γ</a>
<a id="7637" href="../Denotational/#7602" class="Function">init</a> <a id="7642" href="../Denotational/#7642" class="Bound">γ</a> <a id="7644" href="../Denotational/#7644" class="Bound">x</a> <a id="7646" class="Symbol">=</a> <a id="7648" href="../Denotational/#7642" class="Bound">γ</a> <a id="7650" class="Symbol">(</a><a id="7651" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="7653" href="../Denotational/#7644" class="Bound">x</a><a id="7654" class="Symbol">)</a>

<a id="last"></a><a id="7657" href="../Denotational/#7657" class="Function">last</a> <a id="7662" class="Symbol">:</a> <a id="7664" class="Symbol">∀</a> <a id="7666" class="Symbol">{</a><a id="7667" href="../Denotational/#7667" class="Bound">Γ</a><a id="7668" class="Symbol">}</a> <a id="7670" class="Symbol">→</a> <a id="7672" href="../Denotational/#7204" class="Function">Env</a> <a id="7676" class="Symbol">(</a><a id="7677" href="../Denotational/#7667" class="Bound">Γ</a> <a id="7679" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="7681" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="7682" class="Symbol">)</a> <a id="7684" class="Symbol">→</a> <a id="7686" href="../Denotational/#4067" class="Datatype">Value</a>
<a id="7692" href="../Denotational/#7657" class="Function">last</a> <a id="7697" href="../Denotational/#7697" class="Bound">γ</a> <a id="7699" class="Symbol">=</a> <a id="7701" href="../Denotational/#7697" class="Bound">γ</a> <a id="7703" href="../Untyped/#3539" class="InductiveConstructor">Z</a>

<a id="init-last"></a><a id="7706" href="../Denotational/#7706" class="Function">init-last</a> <a id="7716" class="Symbol">:</a> <a id="7718" class="Symbol">∀</a> <a id="7720" class="Symbol">{</a><a id="7721" href="../Denotational/#7721" class="Bound">Γ</a><a id="7722" class="Symbol">}</a> <a id="7724" class="Symbol">→</a> <a id="7726" class="Symbol">(</a><a id="7727" href="../Denotational/#7727" class="Bound">γ</a> <a id="7729" class="Symbol">:</a> <a id="7731" href="../Denotational/#7204" class="Function">Env</a> <a id="7735" class="Symbol">(</a><a id="7736" href="../Denotational/#7721" class="Bound">Γ</a> <a id="7738" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="7740" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="7741" class="Symbol">))</a> <a id="7744" class="Symbol">→</a> <a id="7746" href="../Denotational/#7727" class="Bound">γ</a> <a id="7748" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="7750" class="Symbol">(</a><a id="7751" href="../Denotational/#7602" class="Function">init</a> <a id="7756" href="../Denotational/#7727" class="Bound">γ</a> <a id="7758" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="7761" href="../Denotational/#7657" class="Function">last</a> <a id="7766" href="../Denotational/#7727" class="Bound">γ</a><a id="7767" class="Symbol">)</a>
<a id="7769" href="../Denotational/#7706" class="Function">init-last</a> <a id="7779" class="Symbol">{</a><a id="7780" href="../Denotational/#7780" class="Bound">Γ</a><a id="7781" class="Symbol">}</a> <a id="7783" href="../Denotational/#7783" class="Bound">γ</a> <a id="7785" class="Symbol">=</a> <a id="7787" href="../Substitution/#1927" class="Postulate">extensionality</a> <a id="7802" href="../Denotational/#7816" class="Function">lemma</a>
  <a id="7810" class="Keyword">where</a> <a id="7816" href="../Denotational/#7816" class="Function">lemma</a> <a id="7822" class="Symbol">:</a> <a id="7824" class="Symbol">∀</a> <a id="7826" class="Symbol">(</a><a id="7827" href="../Denotational/#7827" class="Bound">x</a> <a id="7829" class="Symbol">:</a> <a id="7831" href="../Denotational/#7780" class="Bound">Γ</a> <a id="7833" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="7835" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="7837" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="7839" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="7840" class="Symbol">)</a> <a id="7842" class="Symbol">→</a> <a id="7844" href="../Denotational/#7783" class="Bound">γ</a> <a id="7846" href="../Denotational/#7827" class="Bound">x</a> <a id="7848" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="7850" class="Symbol">(</a><a id="7851" href="../Denotational/#7602" class="Function">init</a> <a id="7856" href="../Denotational/#7783" class="Bound">γ</a> <a id="7858" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="7861" href="../Denotational/#7657" class="Function">last</a> <a id="7866" href="../Denotational/#7783" class="Bound">γ</a><a id="7867" class="Symbol">)</a> <a id="7869" href="../Denotational/#7827" class="Bound">x</a>
        <a id="7879" href="../Denotational/#7816" class="Function">lemma</a> <a id="7885" href="../Untyped/#3539" class="InductiveConstructor">Z</a>      <a id="7892" class="Symbol">=</a>  <a id="7895" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
        <a id="7908" href="../Denotational/#7816" class="Function">lemma</a> <a id="7914" class="Symbol">(</a><a id="7915" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="7917" href="../Denotational/#7917" class="Bound">x</a><a id="7918" class="Symbol">)</a>  <a id="7921" class="Symbol">=</a>  <a id="7924" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
<p>We extend the <code>⊑</code> relation point-wise to environments with the following definition.</p>
<pre class="Agda"><a id="_`⊑_"></a><a id="8024" href="../Denotational/#8024" class="Function Operator">_`⊑_</a> <a id="8029" class="Symbol">:</a> <a id="8031" class="Symbol">∀</a> <a id="8033" class="Symbol">{</a><a id="8034" href="../Denotational/#8034" class="Bound">Γ</a><a id="8035" class="Symbol">}</a> <a id="8037" class="Symbol">→</a> <a id="8039" href="../Denotational/#7204" class="Function">Env</a> <a id="8043" href="../Denotational/#8034" class="Bound">Γ</a> <a id="8045" class="Symbol">→</a> <a id="8047" href="../Denotational/#7204" class="Function">Env</a> <a id="8051" href="../Denotational/#8034" class="Bound">Γ</a> <a id="8053" class="Symbol">→</a> <a id="8055" class="PrimitiveType">Set</a>
<a id="8059" href="../Denotational/#8024" class="Function Operator">_`⊑_</a> <a id="8064" class="Symbol">{</a><a id="8065" href="../Denotational/#8065" class="Bound">Γ</a><a id="8066" class="Symbol">}</a> <a id="8068" href="../Denotational/#8068" class="Bound">γ</a> <a id="8070" href="../Denotational/#8070" class="Bound">δ</a> <a id="8072" class="Symbol">=</a> <a id="8074" class="Symbol">∀</a> <a id="8076" class="Symbol">(</a><a id="8077" href="../Denotational/#8077" class="Bound">x</a> <a id="8079" class="Symbol">:</a> <a id="8081" href="../Denotational/#8065" class="Bound">Γ</a> <a id="8083" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="8085" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="8086" class="Symbol">)</a> <a id="8088" class="Symbol">→</a> <a id="8090" href="../Denotational/#8068" class="Bound">γ</a> <a id="8092" href="../Denotational/#8077" class="Bound">x</a> <a id="8094" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="8096" href="../Denotational/#8070" class="Bound">δ</a> <a id="8098" href="../Denotational/#8077" class="Bound">x</a>
</pre>
<p>We define a bottom environment and a join operator on environments, which takes the point-wise join of their values.</p>
<pre class="Agda"><a id="`⊥"></a><a id="8227" href="../Denotational/#8227" class="Function">`⊥</a> <a id="8230" class="Symbol">:</a> <a id="8232" class="Symbol">∀</a> <a id="8234" class="Symbol">{</a><a id="8235" href="../Denotational/#8235" class="Bound">Γ</a><a id="8236" class="Symbol">}</a> <a id="8238" class="Symbol">→</a> <a id="8240" href="../Denotational/#7204" class="Function">Env</a> <a id="8244" href="../Denotational/#8235" class="Bound">Γ</a>
<a id="8246" href="../Denotational/#8227" class="Function">`⊥</a> <a id="8249" href="../Denotational/#8249" class="Bound">x</a> <a id="8251" class="Symbol">=</a> <a id="8253" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>

<a id="_`⊔_"></a><a id="8256" href="../Denotational/#8256" class="Function Operator">_`⊔_</a> <a id="8261" class="Symbol">:</a> <a id="8263" class="Symbol">∀</a> <a id="8265" class="Symbol">{</a><a id="8266" href="../Denotational/#8266" class="Bound">Γ</a><a id="8267" class="Symbol">}</a> <a id="8269" class="Symbol">→</a> <a id="8271" href="../Denotational/#7204" class="Function">Env</a> <a id="8275" href="../Denotational/#8266" class="Bound">Γ</a> <a id="8277" class="Symbol">→</a> <a id="8279" href="../Denotational/#7204" class="Function">Env</a> <a id="8283" href="../Denotational/#8266" class="Bound">Γ</a> <a id="8285" class="Symbol">→</a> <a id="8287" href="../Denotational/#7204" class="Function">Env</a> <a id="8291" href="../Denotational/#8266" class="Bound">Γ</a>
<a id="8293" class="Symbol">(</a><a id="8294" href="../Denotational/#8294" class="Bound">γ</a> <a id="8296" href="../Denotational/#8256" class="Function Operator">`⊔</a> <a id="8299" href="../Denotational/#8299" class="Bound">δ</a><a id="8300" class="Symbol">)</a> <a id="8302" href="../Denotational/#8302" class="Bound">x</a> <a id="8304" class="Symbol">=</a> <a id="8306" href="../Denotational/#8294" class="Bound">γ</a> <a id="8308" href="../Denotational/#8302" class="Bound">x</a> <a id="8310" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="8312" href="../Denotational/#8299" class="Bound">δ</a> <a id="8314" href="../Denotational/#8302" class="Bound">x</a>
</pre>
<p>The <code>⊑-refl</code>, <code>⊑-conj-R1</code>, and <code>⊑-conj-R2</code> rules lift to environments. So the join of two environments <code>γ</code> and <code>δ</code> is greater than the first environment <code>γ</code> or the second environment <code>δ</code>.</p>
<pre class="Agda"><a id="`⊑-refl"></a><a id="8515" href="../Denotational/#8515" class="Function">`⊑-refl</a> <a id="8523" class="Symbol">:</a> <a id="8525" class="Symbol">∀</a> <a id="8527" class="Symbol">{</a><a id="8528" href="../Denotational/#8528" class="Bound">Γ</a><a id="8529" class="Symbol">}</a> <a id="8531" class="Symbol">{</a><a id="8532" href="../Denotational/#8532" class="Bound">γ</a> <a id="8534" class="Symbol">:</a> <a id="8536" href="../Denotational/#7204" class="Function">Env</a> <a id="8540" href="../Denotational/#8528" class="Bound">Γ</a><a id="8541" class="Symbol">}</a> <a id="8543" class="Symbol">→</a> <a id="8545" href="../Denotational/#8532" class="Bound">γ</a> <a id="8547" href="../Denotational/#8024" class="Function Operator">`⊑</a> <a id="8550" href="../Denotational/#8532" class="Bound">γ</a>
<a id="8552" href="../Denotational/#8515" class="Function">`⊑-refl</a> <a id="8560" class="Symbol">{</a><a id="8561" href="../Denotational/#8561" class="Bound">Γ</a><a id="8562" class="Symbol">}</a> <a id="8564" class="Symbol">{</a><a id="8565" href="../Denotational/#8565" class="Bound">γ</a><a id="8566" class="Symbol">}</a> <a id="8568" href="../Denotational/#8568" class="Bound">x</a> <a id="8570" class="Symbol">=</a> <a id="8572" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="8579" class="Symbol">{</a><a id="8580" href="../Denotational/#8565" class="Bound">γ</a> <a id="8582" href="../Denotational/#8568" class="Bound">x</a><a id="8583" class="Symbol">}</a>

<a id="⊑-env-conj-R1"></a><a id="8586" href="../Denotational/#8586" class="Function">⊑-env-conj-R1</a> <a id="8600" class="Symbol">:</a> <a id="8602" class="Symbol">∀</a> <a id="8604" class="Symbol">{</a><a id="8605" href="../Denotational/#8605" class="Bound">Γ</a><a id="8606" class="Symbol">}</a> <a id="8608" class="Symbol">→</a> <a id="8610" class="Symbol">(</a><a id="8611" href="../Denotational/#8611" class="Bound">γ</a> <a id="8613" class="Symbol">:</a> <a id="8615" href="../Denotational/#7204" class="Function">Env</a> <a id="8619" href="../Denotational/#8605" class="Bound">Γ</a><a id="8620" class="Symbol">)</a> <a id="8622" class="Symbol">→</a> <a id="8624" class="Symbol">(</a><a id="8625" href="../Denotational/#8625" class="Bound">δ</a> <a id="8627" class="Symbol">:</a> <a id="8629" href="../Denotational/#7204" class="Function">Env</a> <a id="8633" href="../Denotational/#8605" class="Bound">Γ</a><a id="8634" class="Symbol">)</a> <a id="8636" class="Symbol">→</a> <a id="8638" href="../Denotational/#8611" class="Bound">γ</a> <a id="8640" href="../Denotational/#8024" class="Function Operator">`⊑</a> <a id="8643" class="Symbol">(</a><a id="8644" href="../Denotational/#8611" class="Bound">γ</a> <a id="8646" href="../Denotational/#8256" class="Function Operator">`⊔</a> <a id="8649" href="../Denotational/#8625" class="Bound">δ</a><a id="8650" class="Symbol">)</a>
<a id="8652" href="../Denotational/#8586" class="Function">⊑-env-conj-R1</a> <a id="8666" href="../Denotational/#8666" class="Bound">γ</a> <a id="8668" href="../Denotational/#8668" class="Bound">δ</a> <a id="8670" href="../Denotational/#8670" class="Bound">x</a> <a id="8672" class="Symbol">=</a> <a id="8674" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="8684" href="../Denotational/#5554" class="Function">⊑-refl</a>

<a id="⊑-env-conj-R2"></a><a id="8692" href="../Denotational/#8692" class="Function">⊑-env-conj-R2</a> <a id="8706" class="Symbol">:</a> <a id="8708" class="Symbol">∀</a> <a id="8710" class="Symbol">{</a><a id="8711" href="../Denotational/#8711" class="Bound">Γ</a><a id="8712" class="Symbol">}</a> <a id="8714" class="Symbol">→</a> <a id="8716" class="Symbol">(</a><a id="8717" href="../Denotational/#8717" class="Bound">γ</a> <a id="8719" class="Symbol">:</a> <a id="8721" href="../Denotational/#7204" class="Function">Env</a> <a id="8725" href="../Denotational/#8711" class="Bound">Γ</a><a id="8726" class="Symbol">)</a> <a id="8728" class="Symbol">→</a> <a id="8730" class="Symbol">(</a><a id="8731" href="../Denotational/#8731" class="Bound">δ</a> <a id="8733" class="Symbol">:</a> <a id="8735" href="../Denotational/#7204" class="Function">Env</a> <a id="8739" href="../Denotational/#8711" class="Bound">Γ</a><a id="8740" class="Symbol">)</a> <a id="8742" class="Symbol">→</a> <a id="8744" href="../Denotational/#8731" class="Bound">δ</a> <a id="8746" href="../Denotational/#8024" class="Function Operator">`⊑</a> <a id="8749" class="Symbol">(</a><a id="8750" href="../Denotational/#8717" class="Bound">γ</a> <a id="8752" href="../Denotational/#8256" class="Function Operator">`⊔</a> <a id="8755" href="../Denotational/#8731" class="Bound">δ</a><a id="8756" class="Symbol">)</a>
<a id="8758" href="../Denotational/#8692" class="Function">⊑-env-conj-R2</a> <a id="8772" href="../Denotational/#8772" class="Bound">γ</a> <a id="8774" href="../Denotational/#8774" class="Bound">δ</a> <a id="8776" href="../Denotational/#8776" class="Bound">x</a> <a id="8778" class="Symbol">=</a> <a id="8780" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="8790" href="../Denotational/#5554" class="Function">⊑-refl</a>
</pre>
<h2 id="denotational-semantics">Denotational Semantics</h2>
<p>We define the semantics with a judgment of the form <code>ρ ⊢ M ↓ v</code>, where <code>ρ</code> is the environment, <code>M</code> the program, and <code>v</code> is a result value. For readers familiar with big-step semantics, this notation will feel quite natural, but don’t let the similarity fool you. There are subtle but important differences! So here is the definition of the semantics, which we discuss in detail in the following paragraphs.</p>
<pre class="Agda"><a id="9242" class="Keyword">infix</a> <a id="9248" class="Number">3</a> <a id="9250" href="../Denotational/#9262" class="Datatype Operator">_⊢_↓_</a>

<a id="9257" class="Keyword">data</a> <a id="_⊢_↓_"></a><a id="9262" href="../Denotational/#9262" class="Datatype Operator">_⊢_↓_</a> <a id="9268" class="Symbol">:</a> <a id="9270" class="Symbol">∀{</a><a id="9272" href="../Denotational/#9272" class="Bound">Γ</a><a id="9273" class="Symbol">}</a> <a id="9275" class="Symbol">→</a> <a id="9277" href="../Denotational/#7204" class="Function">Env</a> <a id="9281" href="../Denotational/#9272" class="Bound">Γ</a> <a id="9283" class="Symbol">→</a> <a id="9285" class="Symbol">(</a><a id="9286" href="../Denotational/#9272" class="Bound">Γ</a> <a id="9288" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="9290" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="9291" class="Symbol">)</a> <a id="9293" class="Symbol">→</a> <a id="9295" href="../Denotational/#4067" class="Datatype">Value</a> <a id="9301" class="Symbol">→</a> <a id="9303" class="PrimitiveType">Set</a> <a id="9307" class="Keyword">where</a>

  <a id="_⊢_↓_.var"></a><a id="9316" href="../Denotational/#9316" class="InductiveConstructor">var</a> <a id="9320" class="Symbol">:</a> <a id="9322" class="Symbol">∀</a> <a id="9324" class="Symbol">{</a><a id="9325" href="../Denotational/#9325" class="Bound">Γ</a><a id="9326" class="Symbol">}</a> <a id="9328" class="Symbol">{</a><a id="9329" href="../Denotational/#9329" class="Bound">γ</a> <a id="9331" class="Symbol">:</a> <a id="9333" href="../Denotational/#7204" class="Function">Env</a> <a id="9337" href="../Denotational/#9325" class="Bound">Γ</a><a id="9338" class="Symbol">}</a> <a id="9340" class="Symbol">{</a><a id="9341" href="../Denotational/#9341" class="Bound">x</a><a id="9342" class="Symbol">}</a>
      <a id="9350" class="Comment">---------------</a>
    <a id="9370" class="Symbol">→</a> <a id="9372" href="../Denotational/#9329" class="Bound">γ</a> <a id="9374" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9376" class="Symbol">(</a><a id="9377" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="9379" href="../Denotational/#9341" class="Bound">x</a><a id="9380" class="Symbol">)</a> <a id="9382" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9384" href="../Denotational/#9329" class="Bound">γ</a> <a id="9386" href="../Denotational/#9341" class="Bound">x</a>

  <a id="_⊢_↓_.↦-elim"></a><a id="9391" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="9398" class="Symbol">:</a> <a id="9400" class="Symbol">∀</a> <a id="9402" class="Symbol">{</a><a id="9403" href="../Denotational/#9403" class="Bound">Γ</a><a id="9404" class="Symbol">}</a> <a id="9406" class="Symbol">{</a><a id="9407" href="../Denotational/#9407" class="Bound">γ</a> <a id="9409" class="Symbol">:</a> <a id="9411" href="../Denotational/#7204" class="Function">Env</a> <a id="9415" href="../Denotational/#9403" class="Bound">Γ</a><a id="9416" class="Symbol">}</a> <a id="9418" class="Symbol">{</a><a id="9419" href="../Denotational/#9419" class="Bound">L</a> <a id="9421" href="../Denotational/#9421" class="Bound">M</a> <a id="9423" href="../Denotational/#9423" class="Bound">v</a> <a id="9425" href="../Denotational/#9425" class="Bound">w</a><a id="9426" class="Symbol">}</a>
    <a id="9432" class="Symbol">→</a> <a id="9434" href="../Denotational/#9407" class="Bound">γ</a> <a id="9436" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9438" href="../Denotational/#9419" class="Bound">L</a> <a id="9440" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9442" class="Symbol">(</a><a id="9443" href="../Denotational/#9423" class="Bound">v</a> <a id="9445" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="9447" href="../Denotational/#9425" class="Bound">w</a><a id="9448" class="Symbol">)</a>
    <a id="9454" class="Symbol">→</a> <a id="9456" href="../Denotational/#9407" class="Bound">γ</a> <a id="9458" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9460" href="../Denotational/#9421" class="Bound">M</a> <a id="9462" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9464" href="../Denotational/#9423" class="Bound">v</a>
      <a id="9472" class="Comment">---------------</a>
    <a id="9492" class="Symbol">→</a> <a id="9494" href="../Denotational/#9407" class="Bound">γ</a> <a id="9496" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9498" class="Symbol">(</a><a id="9499" href="../Denotational/#9419" class="Bound">L</a> <a id="9501" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="9503" href="../Denotational/#9421" class="Bound">M</a><a id="9504" class="Symbol">)</a> <a id="9506" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9508" href="../Denotational/#9425" class="Bound">w</a>

  <a id="_⊢_↓_.↦-intro"></a><a id="9513" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="9521" class="Symbol">:</a> <a id="9523" class="Symbol">∀</a> <a id="9525" class="Symbol">{</a><a id="9526" href="../Denotational/#9526" class="Bound">Γ</a><a id="9527" class="Symbol">}</a> <a id="9529" class="Symbol">{</a><a id="9530" href="../Denotational/#9530" class="Bound">γ</a> <a id="9532" class="Symbol">:</a> <a id="9534" href="../Denotational/#7204" class="Function">Env</a> <a id="9538" href="../Denotational/#9526" class="Bound">Γ</a><a id="9539" class="Symbol">}</a> <a id="9541" class="Symbol">{</a><a id="9542" href="../Denotational/#9542" class="Bound">N</a> <a id="9544" href="../Denotational/#9544" class="Bound">v</a> <a id="9546" href="../Denotational/#9546" class="Bound">w</a><a id="9547" class="Symbol">}</a>
    <a id="9553" class="Symbol">→</a> <a id="9555" href="../Denotational/#9530" class="Bound">γ</a> <a id="9557" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="9560" href="../Denotational/#9544" class="Bound">v</a> <a id="9562" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9564" href="../Denotational/#9542" class="Bound">N</a> <a id="9566" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9568" href="../Denotational/#9546" class="Bound">w</a>
      <a id="9576" class="Comment">-------------------</a>
    <a id="9600" class="Symbol">→</a> <a id="9602" href="../Denotational/#9530" class="Bound">γ</a> <a id="9604" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9606" class="Symbol">(</a><a id="9607" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="9609" href="../Denotational/#9542" class="Bound">N</a><a id="9610" class="Symbol">)</a> <a id="9612" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9614" class="Symbol">(</a><a id="9615" href="../Denotational/#9544" class="Bound">v</a> <a id="9617" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="9619" href="../Denotational/#9546" class="Bound">w</a><a id="9620" class="Symbol">)</a>

  <a id="_⊢_↓_.⊥-intro"></a><a id="9625" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a> <a id="9633" class="Symbol">:</a> <a id="9635" class="Symbol">∀</a> <a id="9637" class="Symbol">{</a><a id="9638" href="../Denotational/#9638" class="Bound">Γ</a><a id="9639" class="Symbol">}</a> <a id="9641" class="Symbol">{</a><a id="9642" href="../Denotational/#9642" class="Bound">γ</a> <a id="9644" class="Symbol">:</a> <a id="9646" href="../Denotational/#7204" class="Function">Env</a> <a id="9650" href="../Denotational/#9638" class="Bound">Γ</a><a id="9651" class="Symbol">}</a> <a id="9653" class="Symbol">{</a><a id="9654" href="../Denotational/#9654" class="Bound">M</a><a id="9655" class="Symbol">}</a>
      <a id="9663" class="Comment">---------</a>
    <a id="9677" class="Symbol">→</a> <a id="9679" href="../Denotational/#9642" class="Bound">γ</a> <a id="9681" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9683" href="../Denotational/#9654" class="Bound">M</a> <a id="9685" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9687" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>

  <a id="_⊢_↓_.⊔-intro"></a><a id="9692" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="9700" class="Symbol">:</a> <a id="9702" class="Symbol">∀</a> <a id="9704" class="Symbol">{</a><a id="9705" href="../Denotational/#9705" class="Bound">Γ</a><a id="9706" class="Symbol">}</a> <a id="9708" class="Symbol">{</a><a id="9709" href="../Denotational/#9709" class="Bound">γ</a> <a id="9711" class="Symbol">:</a> <a id="9713" href="../Denotational/#7204" class="Function">Env</a> <a id="9717" href="../Denotational/#9705" class="Bound">Γ</a><a id="9718" class="Symbol">}</a> <a id="9720" class="Symbol">{</a><a id="9721" href="../Denotational/#9721" class="Bound">M</a> <a id="9723" href="../Denotational/#9723" class="Bound">v</a> <a id="9725" href="../Denotational/#9725" class="Bound">w</a><a id="9726" class="Symbol">}</a>
    <a id="9732" class="Symbol">→</a> <a id="9734" href="../Denotational/#9709" class="Bound">γ</a> <a id="9736" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9738" href="../Denotational/#9721" class="Bound">M</a> <a id="9740" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9742" href="../Denotational/#9723" class="Bound">v</a>
    <a id="9748" class="Symbol">→</a> <a id="9750" href="../Denotational/#9709" class="Bound">γ</a> <a id="9752" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9754" href="../Denotational/#9721" class="Bound">M</a> <a id="9756" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9758" href="../Denotational/#9725" class="Bound">w</a>
      <a id="9766" class="Comment">---------------</a>
    <a id="9786" class="Symbol">→</a> <a id="9788" href="../Denotational/#9709" class="Bound">γ</a> <a id="9790" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9792" href="../Denotational/#9721" class="Bound">M</a> <a id="9794" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9796" class="Symbol">(</a><a id="9797" href="../Denotational/#9723" class="Bound">v</a> <a id="9799" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="9801" href="../Denotational/#9725" class="Bound">w</a><a id="9802" class="Symbol">)</a>

  <a id="_⊢_↓_.sub"></a><a id="9807" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="9811" class="Symbol">:</a> <a id="9813" class="Symbol">∀</a> <a id="9815" class="Symbol">{</a><a id="9816" href="../Denotational/#9816" class="Bound">Γ</a><a id="9817" class="Symbol">}</a> <a id="9819" class="Symbol">{</a><a id="9820" href="../Denotational/#9820" class="Bound">γ</a> <a id="9822" class="Symbol">:</a> <a id="9824" href="../Denotational/#7204" class="Function">Env</a> <a id="9828" href="../Denotational/#9816" class="Bound">Γ</a><a id="9829" class="Symbol">}</a> <a id="9831" class="Symbol">{</a><a id="9832" href="../Denotational/#9832" class="Bound">M</a> <a id="9834" href="../Denotational/#9834" class="Bound">v</a> <a id="9836" href="../Denotational/#9836" class="Bound">w</a><a id="9837" class="Symbol">}</a>
    <a id="9843" class="Symbol">→</a> <a id="9845" href="../Denotational/#9820" class="Bound">γ</a> <a id="9847" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9849" href="../Denotational/#9832" class="Bound">M</a> <a id="9851" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9853" href="../Denotational/#9834" class="Bound">v</a>
    <a id="9859" class="Symbol">→</a> <a id="9861" href="../Denotational/#9836" class="Bound">w</a> <a id="9863" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="9865" href="../Denotational/#9834" class="Bound">v</a>
      <a id="9873" class="Comment">---------</a>
    <a id="9887" class="Symbol">→</a> <a id="9889" href="../Denotational/#9820" class="Bound">γ</a> <a id="9891" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="9893" href="../Denotational/#9832" class="Bound">M</a> <a id="9895" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="9897" href="../Denotational/#9836" class="Bound">w</a>
</pre>
<p>Consider the rule for lambda abstractions, <code>↦-intro</code>. It says that a lambda abstraction results in a single-entry table that maps the input <code>v</code> to the output <code>w</code>, provided that evaluating the body in an environment with <code>v</code> bound to its parameter produces the output <code>w</code>. As a simple example of this rule, we can see that the identity function maps <code>⊥</code> to <code>⊥</code> and also that it maps <code>⊥ ↦ ⊥</code> to <code>⊥ ↦ ⊥</code>.</p>
<pre class="Agda"><a id="id"></a><a id="10312" href="../Denotational/#10312" class="Function">id</a> <a id="10315" class="Symbol">:</a> <a id="10317" href="../Untyped/#3157" class="InductiveConstructor">∅</a> <a id="10319" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="10321" href="../Untyped/#2870" class="InductiveConstructor">★</a>
<a id="10323" href="../Denotational/#10312" class="Function">id</a> <a id="10326" class="Symbol">=</a> <a id="10328" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="10330" href="../Untyped/#5093" class="Function Operator">#</a> <a id="10332" class="Number">0</a>
</pre>
<pre class="Agda"><a id="denot-id1"></a><a id="10343" href="../Denotational/#10343" class="Function">denot-id1</a> <a id="10353" class="Symbol">:</a> <a id="10355" class="Symbol">∀</a> <a id="10357" class="Symbol">{</a><a id="10358" href="../Denotational/#10358" class="Bound">γ</a><a id="10359" class="Symbol">}</a> <a id="10361" class="Symbol">→</a> <a id="10363" href="../Denotational/#10358" class="Bound">γ</a> <a id="10365" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="10367" href="../Denotational/#10312" class="Function">id</a> <a id="10370" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="10372" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="10374" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="10376" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>
<a id="10378" href="../Denotational/#10343" class="Function">denot-id1</a> <a id="10388" class="Symbol">=</a> <a id="10390" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="10398" href="../Denotational/#9316" class="InductiveConstructor">var</a>

<a id="denot-id2"></a><a id="10403" href="../Denotational/#10403" class="Function">denot-id2</a> <a id="10413" class="Symbol">:</a> <a id="10415" class="Symbol">∀</a> <a id="10417" class="Symbol">{</a><a id="10418" href="../Denotational/#10418" class="Bound">γ</a><a id="10419" class="Symbol">}</a> <a id="10421" class="Symbol">→</a> <a id="10423" href="../Denotational/#10418" class="Bound">γ</a> <a id="10425" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="10427" href="../Denotational/#10312" class="Function">id</a> <a id="10430" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="10432" class="Symbol">(</a><a id="10433" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="10435" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="10437" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="10438" class="Symbol">)</a> <a id="10440" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="10442" class="Symbol">(</a><a id="10443" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="10445" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="10447" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="10448" class="Symbol">)</a>
<a id="10450" href="../Denotational/#10403" class="Function">denot-id2</a> <a id="10460" class="Symbol">=</a> <a id="10462" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="10470" href="../Denotational/#9316" class="InductiveConstructor">var</a>
</pre>
<p>Of course, we will need tables with many rows to capture the meaning of lambda abstractions. These can be constructed using the <code>⊔-intro</code> rule. If term M (typically a lambda abstraction) can produce both tables <code>v</code> and <code>w</code>, then it produces the combined table <code>v ⊔ w</code>. One can take an operational view of the rules <code>↦-intro</code> and <code>⊔-intro</code> by imagining that when an interpreter first comes to a lambda abstraction, it pre-evaluates the function on a bunch of randomly chosen arguments, using many instances of the rule <code>↦-intro</code>, and then joins them into a big table using many instances of the rule <code>⊔-intro</code>. In the following we show that the identity function produces a table containing both of the previous results, <code>⊥ ↦ ⊥</code> and <code>(⊥ ↦ ⊥) ↦ (⊥ ↦ ⊥)</code>.</p>
<pre class="Agda"><a id="denot-id3"></a><a id="11238" href="../Denotational/#11238" class="Function">denot-id3</a> <a id="11248" class="Symbol">:</a> <a id="11250" href="../Denotational/#7328" class="Function">`∅</a> <a id="11253" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="11255" href="../Denotational/#10312" class="Function">id</a> <a id="11258" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="11260" class="Symbol">(</a><a id="11261" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="11263" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="11265" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="11266" class="Symbol">)</a> <a id="11268" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="11270" class="Symbol">(</a><a id="11271" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="11273" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="11275" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="11276" class="Symbol">)</a> <a id="11278" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="11280" class="Symbol">(</a><a id="11281" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="11283" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="11285" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="11286" class="Symbol">)</a>
<a id="11288" href="../Denotational/#11238" class="Function">denot-id3</a> <a id="11298" class="Symbol">=</a> <a id="11300" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="11308" href="../Denotational/#10343" class="Function">denot-id1</a> <a id="11318" href="../Denotational/#10403" class="Function">denot-id2</a>
</pre>
<p>We most often think of the judgment <code>γ ⊢ M ↓ v</code> as taking the environment <code>γ</code> and term <code>M</code> as input, producing the result <code>v</code>. However, it is worth emphasizing that the semantics is a <em>relation</em>. The above results for the identity function show that the same environment and term can be mapped to different results. However, the results for a given <code>γ</code> and <code>M</code> are not <em>too</em> different, they are all finite approximations of the same function. Perhaps a better way of thinking about the judgment <code>γ ⊢ M ↓ v</code> is that the <code>γ</code>, <code>M</code>, and <code>v</code> are all inputs and the semantics either confirms or denies whether <code>v</code> is an accurate partial description of the result of <code>M</code> in environment <code>γ</code>.</p>
<p>Next we consider the meaning of function application as given by the <code>↦-elim</code> rule. In the premise of the rule we have that <code>L</code> maps <code>v</code> to <code>w</code>. So if <code>M</code> produces <code>v</code>, then the application of <code>L</code> to <code>M</code> produces <code>w</code>.</p>
<p>As an example of function application and the <code>↦-elim</code> rule, we apply the identity function to itself. Indeed, we have both that <code>∅ ⊢ id ↓ (u ↦ u) ↦ (u ↦ u)</code> and also <code>∅ ⊢ id ↓ (u ↦ u)</code>, so we can apply the rule <code>↦-elim</code>.</p>
<pre class="Agda"><a id="id-app-id"></a><a id="12467" href="../Denotational/#12467" class="Function">id-app-id</a> <a id="12477" class="Symbol">:</a> <a id="12479" class="Symbol">∀</a> <a id="12481" class="Symbol">{</a><a id="12482" href="../Denotational/#12482" class="Bound">u</a> <a id="12484" class="Symbol">:</a> <a id="12486" href="../Denotational/#4067" class="Datatype">Value</a><a id="12491" class="Symbol">}</a> <a id="12493" class="Symbol">→</a> <a id="12495" href="../Denotational/#7328" class="Function">`∅</a> <a id="12498" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="12500" href="../Denotational/#10312" class="Function">id</a> <a id="12503" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="12505" href="../Denotational/#10312" class="Function">id</a> <a id="12508" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="12510" class="Symbol">(</a><a id="12511" href="../Denotational/#12482" class="Bound">u</a> <a id="12513" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="12515" href="../Denotational/#12482" class="Bound">u</a><a id="12516" class="Symbol">)</a>
<a id="12518" href="../Denotational/#12467" class="Function">id-app-id</a> <a id="12528" class="Symbol">{</a><a id="12529" href="../Denotational/#12529" class="Bound">u</a><a id="12530" class="Symbol">}</a> <a id="12532" class="Symbol">=</a> <a id="12534" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="12541" class="Symbol">(</a><a id="12542" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="12550" href="../Denotational/#9316" class="InductiveConstructor">var</a><a id="12553" class="Symbol">)</a> <a id="12555" class="Symbol">(</a><a id="12556" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="12564" href="../Denotational/#9316" class="InductiveConstructor">var</a><a id="12567" class="Symbol">)</a>
</pre>
<p>Next we revisit the Church numeral two: <code>λ f. λ u. (f (f u))</code>. This function has two parameters: a function <code>f</code> and an arbitrary value <code>u</code>, and it applies <code>f</code> twice. So <code>f</code> must map <code>u</code> to some value, which we’ll name <code>v</code>. Then for the second application, <code>f</code> must map <code>v</code> to some value. Let’s name it <code>w</code>. So the function’s table must include two entries, both <code>u ↦ v</code> and <code>v ↦ w</code>. For each application of the table, we extract the appropriate entry from it using the <code>sub</code> rule. In particular, we use the ⊑-conj-R1 and ⊑-conj-R2 to select <code>u ↦ v</code> and <code>v ↦ w</code>, respectively, from the table <code>u ↦ v ⊔ v ↦ w</code>. So the meaning of twoᶜ is that it takes this table and parameter <code>u</code>, and it returns <code>w</code>. Indeed we derive this as follows.</p>
<pre class="Agda"><a id="denot-twoᶜ"></a><a id="13313" href="../Denotational/#13313" class="Function">denot-twoᶜ</a> <a id="13324" class="Symbol">:</a> <a id="13326" class="Symbol">∀{</a><a id="13328" href="../Denotational/#13328" class="Bound">u</a> <a id="13330" href="../Denotational/#13330" class="Bound">v</a> <a id="13332" href="../Denotational/#13332" class="Bound">w</a> <a id="13334" class="Symbol">:</a> <a id="13336" href="../Denotational/#4067" class="Datatype">Value</a><a id="13341" class="Symbol">}</a> <a id="13343" class="Symbol">→</a> <a id="13345" href="../Denotational/#7328" class="Function">`∅</a> <a id="13348" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="13350" href="../Untyped/#5224" class="Function">twoᶜ</a> <a id="13355" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="13357" class="Symbol">((</a><a id="13359" href="../Denotational/#13328" class="Bound">u</a> <a id="13361" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13363" href="../Denotational/#13330" class="Bound">v</a> <a id="13365" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="13367" href="../Denotational/#13330" class="Bound">v</a> <a id="13369" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13371" href="../Denotational/#13332" class="Bound">w</a><a id="13372" class="Symbol">)</a> <a id="13374" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13376" href="../Denotational/#13328" class="Bound">u</a> <a id="13378" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13380" href="../Denotational/#13332" class="Bound">w</a><a id="13381" class="Symbol">)</a>
<a id="13383" href="../Denotational/#13313" class="Function">denot-twoᶜ</a> <a id="13394" class="Symbol">{</a><a id="13395" href="../Denotational/#13395" class="Bound">u</a><a id="13396" class="Symbol">}{</a><a id="13398" href="../Denotational/#13398" class="Bound">v</a><a id="13399" class="Symbol">}{</a><a id="13401" href="../Denotational/#13401" class="Bound">w</a><a id="13402" class="Symbol">}</a> <a id="13404" class="Symbol">=</a>
  <a id="13408" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="13416" class="Symbol">(</a><a id="13417" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="13425" class="Symbol">(</a><a id="13426" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="13433" class="Symbol">(</a><a id="13434" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="13438" href="../Denotational/#9316" class="InductiveConstructor">var</a> <a id="13442" href="../Denotational/#13484" class="Function">lt1</a><a id="13445" class="Symbol">)</a> <a id="13447" class="Symbol">(</a><a id="13448" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="13455" class="Symbol">(</a><a id="13456" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="13460" href="../Denotational/#9316" class="InductiveConstructor">var</a> <a id="13464" href="../Denotational/#13567" class="Function">lt2</a><a id="13467" class="Symbol">)</a> <a id="13469" href="../Denotational/#9316" class="InductiveConstructor">var</a><a id="13472" class="Symbol">)))</a>
  <a id="13478" class="Keyword">where</a> <a id="13484" href="../Denotational/#13484" class="Function">lt1</a> <a id="13488" class="Symbol">:</a> <a id="13490" href="../Denotational/#13398" class="Bound">v</a> <a id="13492" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13494" href="../Denotational/#13401" class="Bound">w</a> <a id="13496" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="13498" href="../Denotational/#13395" class="Bound">u</a> <a id="13500" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13502" href="../Denotational/#13398" class="Bound">v</a> <a id="13504" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="13506" href="../Denotational/#13398" class="Bound">v</a> <a id="13508" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13510" href="../Denotational/#13401" class="Bound">w</a>
        <a id="13520" href="../Denotational/#13484" class="Function">lt1</a> <a id="13524" class="Symbol">=</a> <a id="13526" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="13536" class="Symbol">(</a><a id="13537" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="13543" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="13550" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="13556" class="Symbol">)</a>

        <a id="13567" href="../Denotational/#13567" class="Function">lt2</a> <a id="13571" class="Symbol">:</a> <a id="13573" href="../Denotational/#13395" class="Bound">u</a> <a id="13575" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13577" href="../Denotational/#13398" class="Bound">v</a> <a id="13579" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="13581" href="../Denotational/#13395" class="Bound">u</a> <a id="13583" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13585" href="../Denotational/#13398" class="Bound">v</a> <a id="13587" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="13589" href="../Denotational/#13398" class="Bound">v</a> <a id="13591" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="13593" href="../Denotational/#13401" class="Bound">w</a>
        <a id="13603" href="../Denotational/#13567" class="Function">lt2</a> <a id="13607" class="Symbol">=</a> <a id="13609" class="Symbol">(</a><a id="13610" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="13620" class="Symbol">(</a><a id="13621" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="13627" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="13634" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="13640" class="Symbol">))</a>
</pre>
<p>Next we have a classic example of self application: <code>Δ = λx. (x x)</code>. The input value for <code>x</code> needs to be a table, and it needs to have an entry that maps a smaller version of itself, call it <code>v</code>, to some value <code>w</code>. So the input value looks like <code>v ↦ w ⊔ v</code>. Of course, then the output of <code>Δ</code> is <code>w</code>. The derivation is given below. The first occurrences of <code>x</code> evaluates to <code>v ↦ w</code>, the second occurrence of <code>x</code> evaluates to <code>v</code>, and then the result of the application is <code>w</code>.</p>
<pre class="Agda"><a id="Δ"></a><a id="14131" href="../Denotational/#14131" class="Function">Δ</a> <a id="14133" class="Symbol">:</a> <a id="14135" href="../Untyped/#3157" class="InductiveConstructor">∅</a> <a id="14137" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="14139" href="../Untyped/#2870" class="InductiveConstructor">★</a>
<a id="14141" href="../Denotational/#14131" class="Function">Δ</a> <a id="14143" class="Symbol">=</a> <a id="14145" class="Symbol">(</a><a id="14146" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="14148" class="Symbol">(</a><a id="14149" href="../Untyped/#5093" class="Function Operator">#</a> <a id="14151" class="Number">0</a><a id="14152" class="Symbol">)</a> <a id="14154" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="14156" class="Symbol">(</a><a id="14157" href="../Untyped/#5093" class="Function Operator">#</a> <a id="14159" class="Number">0</a><a id="14160" class="Symbol">))</a>

<a id="denot-Δ"></a><a id="14164" href="../Denotational/#14164" class="Function">denot-Δ</a> <a id="14172" class="Symbol">:</a> <a id="14174" class="Symbol">∀</a> <a id="14176" class="Symbol">{</a><a id="14177" href="../Denotational/#14177" class="Bound">v</a> <a id="14179" href="../Denotational/#14179" class="Bound">w</a><a id="14180" class="Symbol">}</a> <a id="14182" class="Symbol">→</a> <a id="14184" href="../Denotational/#7328" class="Function">`∅</a> <a id="14187" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="14189" href="../Denotational/#14131" class="Function">Δ</a> <a id="14191" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="14193" class="Symbol">((</a><a id="14195" href="../Denotational/#14177" class="Bound">v</a> <a id="14197" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="14199" href="../Denotational/#14179" class="Bound">w</a> <a id="14201" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="14203" href="../Denotational/#14177" class="Bound">v</a><a id="14204" class="Symbol">)</a> <a id="14206" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="14208" href="../Denotational/#14179" class="Bound">w</a><a id="14209" class="Symbol">)</a>
<a id="14211" href="../Denotational/#14164" class="Function">denot-Δ</a> <a id="14219" class="Symbol">=</a> <a id="14221" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="14229" class="Symbol">(</a><a id="14230" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="14237" class="Symbol">(</a><a id="14238" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="14242" href="../Denotational/#9316" class="InductiveConstructor">var</a> <a id="14246" class="Symbol">(</a><a id="14247" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="14257" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="14263" class="Symbol">))</a>
                          <a id="14292" class="Symbol">(</a><a id="14293" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="14297" href="../Denotational/#9316" class="InductiveConstructor">var</a> <a id="14301" class="Symbol">(</a><a id="14302" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="14312" href="../Denotational/#5554" class="Function">⊑-refl</a><a id="14318" class="Symbol">)))</a>
</pre>
<p>One might worry whether this semantics can deal with diverging programs. The <code>⊥</code> value and the <code>⊥-intro</code> rule provide a way to handle them. (The <code>⊥-intro</code> rule is also what enables β reduction on non-terminating arguments.) The classic <code>Ω</code> program is a particularly simple program that diverges. It applies <code>Δ</code> to itself. The semantics assigns to <code>Ω</code> the meaning <code>⊥</code>. There are several ways to derive this, we shall start with one that makes use of the <code>⊔-intro</code> rule. First, <code>denot-Δ</code> tells us that <code>Δ</code> evaluates to <code>((⊥ ↦ ⊥) ⊔ ⊥) ↦ ⊥</code> (choose <code>v₁ = v₂ = ⊥</code>). Next, <code>Δ</code> also evaluates to <code>⊥ ↦ ⊥</code> by use of <code>↦-intro</code> and <code>⊥-intro</code> and to <code>⊥</code> by <code>⊥-intro</code>. As we saw previously, whenever we can show that a program evaluates to two values, we can apply <code>⊔-intro</code> to join them together, so <code>Δ</code> evaluates to <code>(⊥ ↦ ⊥) ⊔ ⊥</code>. This matches the input of the first occurrence of <code>Δ</code>, so we can conclude that the result of the application is <code>⊥</code>.</p>
<pre class="Agda"><a id="Ω"></a><a id="15273" href="../Denotational/#15273" class="Function">Ω</a> <a id="15275" class="Symbol">:</a> <a id="15277" href="../Untyped/#3157" class="InductiveConstructor">∅</a> <a id="15279" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="15281" href="../Untyped/#2870" class="InductiveConstructor">★</a>
<a id="15283" href="../Denotational/#15273" class="Function">Ω</a> <a id="15285" class="Symbol">=</a> <a id="15287" href="../Denotational/#14131" class="Function">Δ</a> <a id="15289" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="15291" href="../Denotational/#14131" class="Function">Δ</a>

<a id="denot-Ω"></a><a id="15294" href="../Denotational/#15294" class="Function">denot-Ω</a> <a id="15302" class="Symbol">:</a> <a id="15304" href="../Denotational/#7328" class="Function">`∅</a> <a id="15307" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="15309" href="../Denotational/#15273" class="Function">Ω</a> <a id="15311" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="15313" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>
<a id="15315" href="../Denotational/#15294" class="Function">denot-Ω</a> <a id="15323" class="Symbol">=</a> <a id="15325" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="15332" href="../Denotational/#14164" class="Function">denot-Δ</a> <a id="15340" class="Symbol">(</a><a id="15341" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="15349" class="Symbol">(</a><a id="15350" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="15358" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a><a id="15365" class="Symbol">)</a> <a id="15367" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a><a id="15374" class="Symbol">)</a>
</pre>
<p>A shorter derivation of the same result is by just one use of the <code>⊥-intro</code> rule.</p>
<pre class="Agda"><a id="denot-Ω'"></a><a id="15468" href="../Denotational/#15468" class="Function">denot-Ω'</a> <a id="15477" class="Symbol">:</a> <a id="15479" href="../Denotational/#7328" class="Function">`∅</a> <a id="15482" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="15484" href="../Denotational/#15273" class="Function">Ω</a> <a id="15486" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="15488" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>
<a id="15490" href="../Denotational/#15468" class="Function">denot-Ω'</a> <a id="15499" class="Symbol">=</a> <a id="15501" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a>
</pre>
<p>Just because one can derive <code>∅ ⊢ M ↓ ⊥</code> for some closed term <code>M</code> doesn’t mean that <code>M</code> necessarily diverges. There may be other derivations that conclude with <code>M</code> producing some more informative value. However, if the only thing that a term evaluates to is <code>⊥</code>, then it indeed diverges.</p>
<p>An attentive reader may have noticed a disconnect earlier in the way we planned to solve the self-application problem and the actual <code>↦-elim</code> rule for application. We said at the beginning that we would relax the notion of table lookup, allowing an argument to match an input entry if the argument is equal or greater than the input entry. Instead, the <code>↦-elim</code> rule seems to require an exact match. However, because of the <code>sub</code> rule, application really does allow larger arguments.</p>
<pre class="Agda"><a id="↦-elim2"></a><a id="16293" href="../Denotational/#16293" class="Function">↦-elim2</a> <a id="16301" class="Symbol">:</a> <a id="16303" class="Symbol">∀</a> <a id="16305" class="Symbol">{</a><a id="16306" href="../Denotational/#16306" class="Bound">Γ</a><a id="16307" class="Symbol">}</a> <a id="16309" class="Symbol">{</a><a id="16310" href="../Denotational/#16310" class="Bound">γ</a> <a id="16312" class="Symbol">:</a> <a id="16314" href="../Denotational/#7204" class="Function">Env</a> <a id="16318" href="../Denotational/#16306" class="Bound">Γ</a><a id="16319" class="Symbol">}</a> <a id="16321" class="Symbol">{</a><a id="16322" href="../Denotational/#16322" class="Bound">M₁</a> <a id="16325" href="../Denotational/#16325" class="Bound">M₂</a> <a id="16328" href="../Denotational/#16328" class="Bound">v₁</a> <a id="16331" href="../Denotational/#16331" class="Bound">v₂</a> <a id="16334" href="../Denotational/#16334" class="Bound">v₃</a><a id="16336" class="Symbol">}</a>
  <a id="16340" class="Symbol">→</a> <a id="16342" href="../Denotational/#16310" class="Bound">γ</a> <a id="16344" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="16346" href="../Denotational/#16322" class="Bound">M₁</a> <a id="16349" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="16351" class="Symbol">(</a><a id="16352" href="../Denotational/#16328" class="Bound">v₁</a> <a id="16355" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="16357" href="../Denotational/#16334" class="Bound">v₃</a><a id="16359" class="Symbol">)</a>
  <a id="16363" class="Symbol">→</a> <a id="16365" href="../Denotational/#16310" class="Bound">γ</a> <a id="16367" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="16369" href="../Denotational/#16325" class="Bound">M₂</a> <a id="16372" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="16374" href="../Denotational/#16331" class="Bound">v₂</a>
  <a id="16379" class="Symbol">→</a> <a id="16381" href="../Denotational/#16328" class="Bound">v₁</a> <a id="16384" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="16386" href="../Denotational/#16331" class="Bound">v₂</a>
    <a id="16393" class="Comment">------------------</a>
  <a id="16414" class="Symbol">→</a> <a id="16416" href="../Denotational/#16310" class="Bound">γ</a> <a id="16418" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="16420" class="Symbol">(</a><a id="16421" href="../Denotational/#16322" class="Bound">M₁</a> <a id="16424" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="16426" href="../Denotational/#16325" class="Bound">M₂</a><a id="16428" class="Symbol">)</a> <a id="16430" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="16432" href="../Denotational/#16334" class="Bound">v₃</a>
<a id="16435" href="../Denotational/#16293" class="Function">↦-elim2</a> <a id="16443" href="../Denotational/#16443" class="Bound">d₁</a> <a id="16446" href="../Denotational/#16446" class="Bound">d₂</a> <a id="16449" href="../Denotational/#16449" class="Bound">lt</a> <a id="16452" class="Symbol">=</a> <a id="16454" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="16461" href="../Denotational/#16443" class="Bound">d₁</a> <a id="16464" class="Symbol">(</a><a id="16465" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="16469" href="../Denotational/#16446" class="Bound">d₂</a> <a id="16472" href="../Denotational/#16449" class="Bound">lt</a><a id="16474" class="Symbol">)</a>
</pre>
<h4 id="exercise-denot-plusᶜ-practice">Exercise <code>denot-plusᶜ</code> (practice)</h4>
<p>What is a denotation for <code>plusᶜ</code>? That is, find a value <code>v</code> (other than <code>⊥</code>) such that <code>∅ ⊢ plusᶜ ↓ v</code>. Also, give the proof of <code>∅ ⊢ plusᶜ ↓ v</code> for your choice of <code>v</code>.</p>
<pre class="Agda"><a id="16694" class="Comment">-- Your code goes here</a>
</pre>
<h2 id="denotations-and-denotational-equality">Denotations and denotational equality</h2>
<p>Next we define a notion of denotational equality based on the above semantics. Its statement makes use of an if-and-only-if, which we define as follows.</p>
<pre class="Agda"><a id="_iff_"></a><a id="16923" href="../Denotational/#16923" class="Function Operator">_iff_</a> <a id="16929" class="Symbol">:</a> <a id="16931" class="PrimitiveType">Set</a> <a id="16935" class="Symbol">→</a> <a id="16937" class="PrimitiveType">Set</a> <a id="16941" class="Symbol">→</a> <a id="16943" class="PrimitiveType">Set</a>
<a id="16947" href="../Denotational/#16947" class="Bound">P</a> <a id="16949" href="../Denotational/#16923" class="Function Operator">iff</a> <a id="16953" href="../Denotational/#16953" class="Bound">Q</a> <a id="16955" class="Symbol">=</a> <a id="16957" class="Symbol">(</a><a id="16958" href="../Denotational/#16947" class="Bound">P</a> <a id="16960" class="Symbol">→</a> <a id="16962" href="../Denotational/#16953" class="Bound">Q</a><a id="16963" class="Symbol">)</a> <a id="16965" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="16967" class="Symbol">(</a><a id="16968" href="../Denotational/#16953" class="Bound">Q</a> <a id="16970" class="Symbol">→</a> <a id="16972" href="../Denotational/#16947" class="Bound">P</a><a id="16973" class="Symbol">)</a>
</pre>
<p>Another way to view the denotational semantics is as a function that maps a term to a relation from environments to values. That is, the <em>denotation</em> of a term is a relation from environments to values.</p>
<pre class="Agda"><a id="Denotation"></a><a id="17189" href="../Denotational/#17189" class="Function">Denotation</a> <a id="17200" class="Symbol">:</a> <a id="17202" href="../Untyped/#3135" class="Datatype">Context</a> <a id="17210" class="Symbol">→</a> <a id="17212" class="PrimitiveType">Set₁</a>
<a id="17217" href="../Denotational/#17189" class="Function">Denotation</a> <a id="17228" href="../Denotational/#17228" class="Bound">Γ</a> <a id="17230" class="Symbol">=</a> <a id="17232" class="Symbol">(</a><a id="17233" href="../Denotational/#7204" class="Function">Env</a> <a id="17237" href="../Denotational/#17228" class="Bound">Γ</a> <a id="17239" class="Symbol">→</a> <a id="17241" href="../Denotational/#4067" class="Datatype">Value</a> <a id="17247" class="Symbol">→</a> <a id="17249" class="PrimitiveType">Set</a><a id="17252" class="Symbol">)</a>
</pre>
<p>The following function ℰ gives this alternative view of the semantics, which really just amounts to changing the order of the parameters.</p>
<pre class="Agda"><a id="ℰ"></a><a id="17402" href="../Denotational/#17402" class="Function">ℰ</a> <a id="17404" class="Symbol">:</a> <a id="17406" class="Symbol">∀{</a><a id="17408" href="../Denotational/#17408" class="Bound">Γ</a><a id="17409" class="Symbol">}</a> <a id="17411" class="Symbol">→</a> <a id="17413" class="Symbol">(</a><a id="17414" href="../Denotational/#17414" class="Bound">M</a> <a id="17416" class="Symbol">:</a> <a id="17418" href="../Denotational/#17408" class="Bound">Γ</a> <a id="17420" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="17422" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="17423" class="Symbol">)</a> <a id="17425" class="Symbol">→</a> <a id="17427" href="../Denotational/#17189" class="Function">Denotation</a> <a id="17438" href="../Denotational/#17408" class="Bound">Γ</a>
<a id="17440" href="../Denotational/#17402" class="Function">ℰ</a> <a id="17442" href="../Denotational/#17442" class="Bound">M</a> <a id="17444" class="Symbol">=</a> <a id="17446" class="Symbol">λ</a> <a id="17448" href="../Denotational/#17448" class="Bound">γ</a> <a id="17450" href="../Denotational/#17450" class="Bound">v</a> <a id="17452" class="Symbol">→</a> <a id="17454" href="../Denotational/#17448" class="Bound">γ</a> <a id="17456" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="17458" href="../Denotational/#17442" class="Bound">M</a> <a id="17460" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="17462" href="../Denotational/#17450" class="Bound">v</a>
</pre>
<p>In general, two denotations are equal when they produce the same values in the same environment.</p>
<pre class="Agda"><a id="17571" class="Keyword">infix</a> <a id="17577" class="Number">3</a> <a id="17579" href="../Denotational/#17584" class="Function Operator">_≃_</a>

<a id="_≃_"></a><a id="17584" href="../Denotational/#17584" class="Function Operator">_≃_</a> <a id="17588" class="Symbol">:</a> <a id="17590" class="Symbol">∀</a> <a id="17592" class="Symbol">{</a><a id="17593" href="../Denotational/#17593" class="Bound">Γ</a><a id="17594" class="Symbol">}</a> <a id="17596" class="Symbol">→</a> <a id="17598" class="Symbol">(</a><a id="17599" href="../Denotational/#17189" class="Function">Denotation</a> <a id="17610" href="../Denotational/#17593" class="Bound">Γ</a><a id="17611" class="Symbol">)</a> <a id="17613" class="Symbol">→</a> <a id="17615" class="Symbol">(</a><a id="17616" href="../Denotational/#17189" class="Function">Denotation</a> <a id="17627" href="../Denotational/#17593" class="Bound">Γ</a><a id="17628" class="Symbol">)</a> <a id="17630" class="Symbol">→</a> <a id="17632" class="PrimitiveType">Set</a>
<a id="17636" class="Symbol">(</a><a id="17637" href="../Denotational/#17584" class="Function Operator">_≃_</a> <a id="17641" class="Symbol">{</a><a id="17642" href="../Denotational/#17642" class="Bound">Γ</a><a id="17643" class="Symbol">}</a> <a id="17645" href="../Denotational/#17645" class="Bound">D₁</a> <a id="17648" href="../Denotational/#17648" class="Bound">D₂</a><a id="17650" class="Symbol">)</a> <a id="17652" class="Symbol">=</a> <a id="17654" class="Symbol">(</a><a id="17655" href="../Denotational/#17655" class="Bound">γ</a> <a id="17657" class="Symbol">:</a> <a id="17659" href="../Denotational/#7204" class="Function">Env</a> <a id="17663" href="../Denotational/#17642" class="Bound">Γ</a><a id="17664" class="Symbol">)</a> <a id="17666" class="Symbol">→</a> <a id="17668" class="Symbol">(</a><a id="17669" href="../Denotational/#17669" class="Bound">v</a> <a id="17671" class="Symbol">:</a> <a id="17673" href="../Denotational/#4067" class="Datatype">Value</a><a id="17678" class="Symbol">)</a> <a id="17680" class="Symbol">→</a> <a id="17682" href="../Denotational/#17645" class="Bound">D₁</a> <a id="17685" href="../Denotational/#17655" class="Bound">γ</a> <a id="17687" href="../Denotational/#17669" class="Bound">v</a> <a id="17689" href="../Denotational/#16923" class="Function Operator">iff</a> <a id="17693" href="../Denotational/#17648" class="Bound">D₂</a> <a id="17696" href="../Denotational/#17655" class="Bound">γ</a> <a id="17698" href="../Denotational/#17669" class="Bound">v</a>
</pre>
<p>Denotational equality is an equivalence relation.</p>
<pre class="Agda"><a id="≃-refl"></a><a id="17760" href="../Denotational/#17760" class="Function">≃-refl</a> <a id="17767" class="Symbol">:</a> <a id="17769" class="Symbol">∀</a> <a id="17771" class="Symbol">{</a><a id="17772" href="../Denotational/#17772" class="Bound">Γ</a> <a id="17774" class="Symbol">:</a> <a id="17776" href="../Untyped/#3135" class="Datatype">Context</a><a id="17783" class="Symbol">}</a> <a id="17785" class="Symbol">→</a> <a id="17787" class="Symbol">{</a><a id="17788" href="../Denotational/#17788" class="Bound">M</a> <a id="17790" class="Symbol">:</a> <a id="17792" href="../Denotational/#17189" class="Function">Denotation</a> <a id="17803" href="../Denotational/#17772" class="Bound">Γ</a><a id="17804" class="Symbol">}</a>
  <a id="17808" class="Symbol">→</a> <a id="17810" href="../Denotational/#17788" class="Bound">M</a> <a id="17812" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="17814" href="../Denotational/#17788" class="Bound">M</a>
<a id="17816" href="../Denotational/#17760" class="Function">≃-refl</a> <a id="17823" href="../Denotational/#17823" class="Bound">γ</a> <a id="17825" href="../Denotational/#17825" class="Bound">v</a> <a id="17827" class="Symbol">=</a> <a id="17829" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="17831" class="Symbol">(λ</a> <a id="17834" href="../Denotational/#17834" class="Bound">x</a> <a id="17836" class="Symbol">→</a> <a id="17838" href="../Denotational/#17834" class="Bound">x</a><a id="17839" class="Symbol">)</a> <a id="17841" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="17843" class="Symbol">(λ</a> <a id="17846" href="../Denotational/#17846" class="Bound">x</a> <a id="17848" class="Symbol">→</a> <a id="17850" href="../Denotational/#17846" class="Bound">x</a><a id="17851" class="Symbol">)</a> <a id="17853" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>

<a id="≃-sym"></a><a id="17856" href="../Denotational/#17856" class="Function">≃-sym</a> <a id="17862" class="Symbol">:</a> <a id="17864" class="Symbol">∀</a> <a id="17866" class="Symbol">{</a><a id="17867" href="../Denotational/#17867" class="Bound">Γ</a> <a id="17869" class="Symbol">:</a> <a id="17871" href="../Untyped/#3135" class="Datatype">Context</a><a id="17878" class="Symbol">}</a> <a id="17880" class="Symbol">→</a> <a id="17882" class="Symbol">{</a><a id="17883" href="../Denotational/#17883" class="Bound">M</a> <a id="17885" href="../Denotational/#17885" class="Bound">N</a> <a id="17887" class="Symbol">:</a> <a id="17889" href="../Denotational/#17189" class="Function">Denotation</a> <a id="17900" href="../Denotational/#17867" class="Bound">Γ</a><a id="17901" class="Symbol">}</a>
  <a id="17905" class="Symbol">→</a> <a id="17907" href="../Denotational/#17883" class="Bound">M</a> <a id="17909" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="17911" href="../Denotational/#17885" class="Bound">N</a>
    <a id="17917" class="Comment">-----</a>
  <a id="17925" class="Symbol">→</a> <a id="17927" href="../Denotational/#17885" class="Bound">N</a> <a id="17929" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="17931" href="../Denotational/#17883" class="Bound">M</a>
<a id="17933" href="../Denotational/#17856" class="Function">≃-sym</a> <a id="17939" href="../Denotational/#17939" class="Bound">eq</a> <a id="17942" href="../Denotational/#17942" class="Bound">γ</a> <a id="17944" href="../Denotational/#17944" class="Bound">v</a> <a id="17946" class="Symbol">=</a> <a id="17948" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="17950" class="Symbol">(</a><a id="17951" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="17957" class="Symbol">(</a><a id="17958" href="../Denotational/#17939" class="Bound">eq</a> <a id="17961" href="../Denotational/#17942" class="Bound">γ</a> <a id="17963" href="../Denotational/#17944" class="Bound">v</a><a id="17964" class="Symbol">))</a> <a id="17967" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="17969" class="Symbol">(</a><a id="17970" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="17976" class="Symbol">(</a><a id="17977" href="../Denotational/#17939" class="Bound">eq</a> <a id="17980" href="../Denotational/#17942" class="Bound">γ</a> <a id="17982" href="../Denotational/#17944" class="Bound">v</a><a id="17983" class="Symbol">))</a> <a id="17986" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>

<a id="≃-trans"></a><a id="17989" href="../Denotational/#17989" class="Function">≃-trans</a> <a id="17997" class="Symbol">:</a> <a id="17999" class="Symbol">∀</a> <a id="18001" class="Symbol">{</a><a id="18002" href="../Denotational/#18002" class="Bound">Γ</a> <a id="18004" class="Symbol">:</a> <a id="18006" href="../Untyped/#3135" class="Datatype">Context</a><a id="18013" class="Symbol">}</a> <a id="18015" class="Symbol">→</a> <a id="18017" class="Symbol">{</a><a id="18018" href="../Denotational/#18018" class="Bound">M₁</a> <a id="18021" href="../Denotational/#18021" class="Bound">M₂</a> <a id="18024" href="../Denotational/#18024" class="Bound">M₃</a> <a id="18027" class="Symbol">:</a> <a id="18029" href="../Denotational/#17189" class="Function">Denotation</a> <a id="18040" href="../Denotational/#18002" class="Bound">Γ</a><a id="18041" class="Symbol">}</a>
  <a id="18045" class="Symbol">→</a> <a id="18047" href="../Denotational/#18018" class="Bound">M₁</a> <a id="18050" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="18052" href="../Denotational/#18021" class="Bound">M₂</a>
  <a id="18057" class="Symbol">→</a> <a id="18059" href="../Denotational/#18021" class="Bound">M₂</a> <a id="18062" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="18064" href="../Denotational/#18024" class="Bound">M₃</a>
    <a id="18071" class="Comment">-------</a>
  <a id="18081" class="Symbol">→</a> <a id="18083" href="../Denotational/#18018" class="Bound">M₁</a> <a id="18086" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="18088" href="../Denotational/#18024" class="Bound">M₃</a>
<a id="18091" href="../Denotational/#17989" class="Function">≃-trans</a> <a id="18099" href="../Denotational/#18099" class="Bound">eq1</a> <a id="18103" href="../Denotational/#18103" class="Bound">eq2</a> <a id="18107" href="../Denotational/#18107" class="Bound">γ</a> <a id="18109" href="../Denotational/#18109" class="Bound">v</a> <a id="18111" class="Symbol">=</a> <a id="18113" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="18115" class="Symbol">(λ</a> <a id="18118" href="../Denotational/#18118" class="Bound">z</a> <a id="18120" class="Symbol">→</a> <a id="18122" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="18128" class="Symbol">(</a><a id="18129" href="../Denotational/#18103" class="Bound">eq2</a> <a id="18133" href="../Denotational/#18107" class="Bound">γ</a> <a id="18135" href="../Denotational/#18109" class="Bound">v</a><a id="18136" class="Symbol">)</a> <a id="18138" class="Symbol">(</a><a id="18139" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="18145" class="Symbol">(</a><a id="18146" href="../Denotational/#18099" class="Bound">eq1</a> <a id="18150" href="../Denotational/#18107" class="Bound">γ</a> <a id="18152" href="../Denotational/#18109" class="Bound">v</a><a id="18153" class="Symbol">)</a> <a id="18155" href="../Denotational/#18118" class="Bound">z</a><a id="18156" class="Symbol">))</a> <a id="18159" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a>
                        <a id="18185" class="Symbol">(λ</a> <a id="18188" href="../Denotational/#18188" class="Bound">z</a> <a id="18190" class="Symbol">→</a> <a id="18192" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="18198" class="Symbol">(</a><a id="18199" href="../Denotational/#18099" class="Bound">eq1</a> <a id="18203" href="../Denotational/#18107" class="Bound">γ</a> <a id="18205" href="../Denotational/#18109" class="Bound">v</a><a id="18206" class="Symbol">)</a> <a id="18208" class="Symbol">(</a><a id="18209" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="18215" class="Symbol">(</a><a id="18216" href="../Denotational/#18103" class="Bound">eq2</a> <a id="18220" href="../Denotational/#18107" class="Bound">γ</a> <a id="18222" href="../Denotational/#18109" class="Bound">v</a><a id="18223" class="Symbol">)</a> <a id="18225" href="../Denotational/#18188" class="Bound">z</a><a id="18226" class="Symbol">))</a> <a id="18229" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>Two terms <code>M</code> and <code>N</code> are denotational equal when their denotations are equal, that is, <code>ℰ M ≃ ℰ N</code>.</p>
<p>The following submodule introduces equational reasoning for the <code>≃</code> relation.</p>
<!--

JGS: I couldn't get this to work. The definitions here were accepted
by Agda, but then the uses in the Compositional chapter got rejected.

denotation-setoid : Context → Setoid (lsuc lzero) lzero
denotation-setoid Γ = record
  { Carrier = Denotation Γ
  ; _≈_ = _≃_
  ; isEquivalence = record { refl = ≃-refl ; sym = ≃-sym ; trans = ≃-trans } }
-->
<!--
  The following went inside the module ≃-Reasoning:

  open import Relation.Binary.Reasoning.Setoid (denotation-setoid Γ)
    renaming (begin_ to start_; _≈⟨_⟩_ to _≃⟨_⟩_; _∎ to _☐) public
-->
<pre class="Agda">
<a id="18975" class="Keyword">module</a> <a id="≃-Reasoning"></a><a id="18982" href="../Denotational/#18982" class="Module">≃-Reasoning</a> <a id="18994" class="Symbol">{</a><a id="18995" href="../Denotational/#18995" class="Bound">Γ</a> <a id="18997" class="Symbol">:</a> <a id="18999" href="../Untyped/#3135" class="Datatype">Context</a><a id="19006" class="Symbol">}</a> <a id="19008" class="Keyword">where</a>

  <a id="19017" class="Keyword">infix</a>  <a id="19024" class="Number">1</a> <a id="19026" href="../Denotational/#19074" class="Function Operator">start_</a>
  <a id="19035" class="Keyword">infixr</a> <a id="19042" class="Number">2</a> <a id="19044" href="../Denotational/#19305" class="Function Operator">_≃⟨⟩_</a> <a id="19050" href="../Denotational/#19165" class="Function Operator">_≃⟨_⟩_</a>
  <a id="19059" class="Keyword">infix</a>  <a id="19066" class="Number">3</a> <a id="19068" href="../Denotational/#19412" class="Function Operator">_☐</a>

  <a id="≃-Reasoning.start_"></a><a id="19074" href="../Denotational/#19074" class="Function Operator">start_</a> <a id="19081" class="Symbol">:</a> <a id="19083" class="Symbol">∀</a> <a id="19085" class="Symbol">{</a><a id="19086" href="../Denotational/#19086" class="Bound">x</a> <a id="19088" href="../Denotational/#19088" class="Bound">y</a> <a id="19090" class="Symbol">:</a> <a id="19092" href="../Denotational/#17189" class="Function">Denotation</a> <a id="19103" href="../Denotational/#18995" class="Bound">Γ</a><a id="19104" class="Symbol">}</a>
    <a id="19110" class="Symbol">→</a> <a id="19112" href="../Denotational/#19086" class="Bound">x</a> <a id="19114" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="19116" href="../Denotational/#19088" class="Bound">y</a>
      <a id="19124" class="Comment">-----</a>
    <a id="19134" class="Symbol">→</a> <a id="19136" href="../Denotational/#19086" class="Bound">x</a> <a id="19138" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="19140" href="../Denotational/#19088" class="Bound">y</a>
  <a id="19144" href="../Denotational/#19074" class="Function Operator">start</a> <a id="19150" href="../Denotational/#19150" class="Bound">x≃y</a>  <a id="19155" class="Symbol">=</a>  <a id="19158" href="../Denotational/#19150" class="Bound">x≃y</a>

  <a id="≃-Reasoning._≃⟨_⟩_"></a><a id="19165" href="../Denotational/#19165" class="Function Operator">_≃⟨_⟩_</a> <a id="19172" class="Symbol">:</a> <a id="19174" class="Symbol">∀</a> <a id="19176" class="Symbol">(</a><a id="19177" href="../Denotational/#19177" class="Bound">x</a> <a id="19179" class="Symbol">:</a> <a id="19181" href="../Denotational/#17189" class="Function">Denotation</a> <a id="19192" href="../Denotational/#18995" class="Bound">Γ</a><a id="19193" class="Symbol">)</a> <a id="19195" class="Symbol">{</a><a id="19196" href="../Denotational/#19196" class="Bound">y</a> <a id="19198" href="../Denotational/#19198" class="Bound">z</a> <a id="19200" class="Symbol">:</a> <a id="19202" href="../Denotational/#17189" class="Function">Denotation</a> <a id="19213" href="../Denotational/#18995" class="Bound">Γ</a><a id="19214" class="Symbol">}</a>
    <a id="19220" class="Symbol">→</a> <a id="19222" href="../Denotational/#19177" class="Bound">x</a> <a id="19224" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="19226" href="../Denotational/#19196" class="Bound">y</a>
    <a id="19232" class="Symbol">→</a> <a id="19234" href="../Denotational/#19196" class="Bound">y</a> <a id="19236" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="19238" href="../Denotational/#19198" class="Bound">z</a>
      <a id="19246" class="Comment">-----</a>
    <a id="19256" class="Symbol">→</a> <a id="19258" href="../Denotational/#19177" class="Bound">x</a> <a id="19260" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="19262" href="../Denotational/#19198" class="Bound">z</a>
  <a id="19266" class="Symbol">(</a><a id="19267" href="../Denotational/#19267" class="Bound">x</a> <a id="19269" href="../Denotational/#19165" class="Function Operator">≃⟨</a> <a id="19272" href="../Denotational/#19272" class="Bound">x≃y</a> <a id="19276" href="../Denotational/#19165" class="Function Operator">⟩</a> <a id="19278" href="../Denotational/#19278" class="Bound">y≃z</a><a id="19281" class="Symbol">)</a> <a id="19283" class="Symbol">=</a>  <a id="19286" href="../Denotational/#17989" class="Function">≃-trans</a> <a id="19294" href="../Denotational/#19272" class="Bound">x≃y</a> <a id="19298" href="../Denotational/#19278" class="Bound">y≃z</a>

  <a id="≃-Reasoning._≃⟨⟩_"></a><a id="19305" href="../Denotational/#19305" class="Function Operator">_≃⟨⟩_</a> <a id="19311" class="Symbol">:</a> <a id="19313" class="Symbol">∀</a> <a id="19315" class="Symbol">(</a><a id="19316" href="../Denotational/#19316" class="Bound">x</a> <a id="19318" class="Symbol">:</a> <a id="19320" href="../Denotational/#17189" class="Function">Denotation</a> <a id="19331" href="../Denotational/#18995" class="Bound">Γ</a><a id="19332" class="Symbol">)</a> <a id="19334" class="Symbol">{</a><a id="19335" href="../Denotational/#19335" class="Bound">y</a> <a id="19337" class="Symbol">:</a> <a id="19339" href="../Denotational/#17189" class="Function">Denotation</a> <a id="19350" href="../Denotational/#18995" class="Bound">Γ</a><a id="19351" class="Symbol">}</a>
    <a id="19357" class="Symbol">→</a> <a id="19359" href="../Denotational/#19316" class="Bound">x</a> <a id="19361" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="19363" href="../Denotational/#19335" class="Bound">y</a>
      <a id="19371" class="Comment">-----</a>
    <a id="19381" class="Symbol">→</a> <a id="19383" href="../Denotational/#19316" class="Bound">x</a> <a id="19385" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="19387" href="../Denotational/#19335" class="Bound">y</a>
  <a id="19391" href="../Denotational/#19391" class="Bound">x</a> <a id="19393" href="../Denotational/#19305" class="Function Operator">≃⟨⟩</a> <a id="19397" href="../Denotational/#19397" class="Bound">x≃y</a>  <a id="19402" class="Symbol">=</a>  <a id="19405" href="../Denotational/#19397" class="Bound">x≃y</a>

  <a id="≃-Reasoning._☐"></a><a id="19412" href="../Denotational/#19412" class="Function Operator">_☐</a> <a id="19415" class="Symbol">:</a> <a id="19417" class="Symbol">∀</a> <a id="19419" class="Symbol">(</a><a id="19420" href="../Denotational/#19420" class="Bound">x</a> <a id="19422" class="Symbol">:</a> <a id="19424" href="../Denotational/#17189" class="Function">Denotation</a> <a id="19435" href="../Denotational/#18995" class="Bound">Γ</a><a id="19436" class="Symbol">)</a>
      <a id="19444" class="Comment">-----</a>
    <a id="19454" class="Symbol">→</a> <a id="19456" href="../Denotational/#19420" class="Bound">x</a> <a id="19458" href="../Denotational/#17584" class="Function Operator">≃</a> <a id="19460" href="../Denotational/#19420" class="Bound">x</a>
  <a id="19464" class="Symbol">(</a><a id="19465" href="../Denotational/#19465" class="Bound">x</a> <a id="19467" href="../Denotational/#19412" class="Function Operator">☐</a><a id="19468" class="Symbol">)</a>  <a id="19471" class="Symbol">=</a>  <a id="19474" href="../Denotational/#17760" class="Function">≃-refl</a>
</pre>
<h2 id="road-map-for-the-following-chapters">Road map for the following chapters</h2>
<p>The subsequent chapters prove that the denotational semantics has several desirable properties. First, we prove that the semantics is compositional, i.e., that the denotation of a term is a function of the denotations of its subterms. To do this we shall prove equations of the following shape.</p>
<pre><code>ℰ (` x) ≃ ...
ℰ (ƛ M) ≃ ... ℰ M ...
ℰ (M · N) ≃ ... ℰ M ... ℰ N ...</code></pre>
<p>The compositionality property is not trivial because the semantics we have defined includes three rules that are not syntax directed: <code>⊥-intro</code>, <code>⊔-intro</code>, and <code>sub</code>. The above equations suggest that the denotational semantics can be defined as a recursive function, and indeed, we give such a definition and prove that it is equivalent to ℰ.</p>
<p>Next we investigate whether the denotational semantics and the reduction semantics are equivalent. Recall that the job of a language semantics is to describe the observable behavior of a given program <code>M</code>. For the lambda calculus there are several choices that one can make, but they usually boil down to a single bit of information:</p>
<ul>
<li>divergence: the program <code>M</code> executes forever.</li>
<li>termination: the program <code>M</code> halts.</li>
</ul>
<p>We can characterize divergence and termination in terms of reduction.</p>
<ul>
<li>divergence: <code>¬ (M —↠ ƛ N)</code> for any term <code>N</code>.</li>
<li>termination: <code>M —↠ ƛ N</code> for some term <code>N</code>.</li>
</ul>
<p>We can also characterize divergence and termination using denotations.</p>
<ul>
<li>divergence: <code>¬ (∅ ⊢ M ↓ v ↦ w)</code> for any <code>v</code> and <code>w</code>.</li>
<li>termination: <code>∅ ⊢ M ↓ v ↦ w</code> for some <code>v</code> and <code>w</code>.</li>
</ul>
<p>Alternatively, we can use the denotation function <code>ℰ</code>.</p>
<ul>
<li>divergence: <code>¬ (ℰ M ≃ ℰ (ƛ N))</code> for any term <code>N</code>.</li>
<li>termination: <code>ℰ M ≃ ℰ (ƛ N)</code> for some term <code>N</code>.</li>
</ul>
<p>So the question is whether the reduction semantics and denotational semantics are equivalent.</p>
<pre><code>(∃ N. M —↠ ƛ N)  iff  (∃ N. ℰ M ≃ ℰ (ƛ N))</code></pre>
<p>We address each direction of the equivalence in the second and third chapters. In the second chapter we prove that reduction to a lambda abstraction implies denotational equality to a lambda abstraction. This property is called the <em>soundness</em> in the literature.</p>
<pre><code>M —↠ ƛ N  implies  ℰ M ≃ ℰ (ƛ N)</code></pre>
<p>In the third chapter we prove that denotational equality to a lambda abstraction implies reduction to a lambda abstraction. This property is called <em>adequacy</em> in the literature.</p>
<pre><code>ℰ M ≃ ℰ (ƛ N)  implies M —↠ ƛ N′ for some N′</code></pre>
<p>The fourth chapter applies the results of the three preceding chapters (compositionality, soundness, and adequacy) to prove that denotational equality implies a property called <em>contextual equivalence</em>. This property is important because it justifies the use of denotational equality in proving the correctness of program transformations such as performance optimizations.</p>
<p>The proofs of all of these properties rely on some basic results about the denotational semantics, which we establish in the rest of this chapter. We start with some lemmas about renaming, which are quite similar to the renaming lemmas that we have seen in previous chapters. We conclude with a proof of an important inversion lemma for the less-than relation regarding function values.</p>
<h2 id="renaming-preserves-denotations">Renaming preserves denotations</h2>
<p>We shall prove that renaming variables, and changing the environment accordingly, preserves the meaning of a term. We generalize the renaming lemma to allow the values in the new environment to be the same or larger than the original values. This generalization is useful in proving that reduction implies denotational equality.</p>
<p>As before, we need an extension lemma to handle the case where we proceed underneath a lambda abstraction. Suppose that <code>ρ</code> is a renaming that maps variables in <code>γ</code> into variables with equal or larger values in <code>δ</code>. This lemmas says that extending the renaming producing a renaming <code>ext r</code> that maps <code>γ , v</code> to <code>δ , v</code>.</p>
<pre class="Agda"><a id="ext-⊑"></a><a id="23317" href="../Denotational/#23317" class="Function">ext-⊑</a> <a id="23323" class="Symbol">:</a> <a id="23325" class="Symbol">∀</a> <a id="23327" class="Symbol">{</a><a id="23328" href="../Denotational/#23328" class="Bound">Γ</a> <a id="23330" href="../Denotational/#23330" class="Bound">Δ</a> <a id="23332" href="../Denotational/#23332" class="Bound">v</a><a id="23333" class="Symbol">}</a> <a id="23335" class="Symbol">{</a><a id="23336" href="../Denotational/#23336" class="Bound">γ</a> <a id="23338" class="Symbol">:</a> <a id="23340" href="../Denotational/#7204" class="Function">Env</a> <a id="23344" href="../Denotational/#23328" class="Bound">Γ</a><a id="23345" class="Symbol">}</a> <a id="23347" class="Symbol">{</a><a id="23348" href="../Denotational/#23348" class="Bound">δ</a> <a id="23350" class="Symbol">:</a> <a id="23352" href="../Denotational/#7204" class="Function">Env</a> <a id="23356" href="../Denotational/#23330" class="Bound">Δ</a><a id="23357" class="Symbol">}</a>
  <a id="23361" class="Symbol">→</a> <a id="23363" class="Symbol">(</a><a id="23364" href="../Denotational/#23364" class="Bound">ρ</a> <a id="23366" class="Symbol">:</a> <a id="23368" href="../Substitution/#2192" class="Function">Rename</a> <a id="23375" href="../Denotational/#23328" class="Bound">Γ</a> <a id="23377" href="../Denotational/#23330" class="Bound">Δ</a><a id="23378" class="Symbol">)</a>
  <a id="23382" class="Symbol">→</a> <a id="23384" href="../Denotational/#23336" class="Bound">γ</a> <a id="23386" href="../Denotational/#8024" class="Function Operator">`⊑</a> <a id="23389" class="Symbol">(</a><a id="23390" href="../Denotational/#23348" class="Bound">δ</a> <a id="23392" href="https://agda.github.io/agda-stdlib/v1.3/Function.Base.html#992" class="Function Operator">∘</a> <a id="23394" href="../Denotational/#23364" class="Bound">ρ</a><a id="23395" class="Symbol">)</a>
    <a id="23401" class="Comment">------------------------------</a>
  <a id="23434" class="Symbol">→</a> <a id="23436" class="Symbol">(</a><a id="23437" href="../Denotational/#23336" class="Bound">γ</a> <a id="23439" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="23442" href="../Denotational/#23332" class="Bound">v</a><a id="23443" class="Symbol">)</a> <a id="23445" href="../Denotational/#8024" class="Function Operator">`⊑</a> <a id="23448" class="Symbol">((</a><a id="23450" href="../Denotational/#23348" class="Bound">δ</a> <a id="23452" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="23455" href="../Denotational/#23332" class="Bound">v</a><a id="23456" class="Symbol">)</a> <a id="23458" href="https://agda.github.io/agda-stdlib/v1.3/Function.Base.html#992" class="Function Operator">∘</a> <a id="23460" href="../Untyped/#5907" class="Function">ext</a> <a id="23464" href="../Denotational/#23364" class="Bound">ρ</a><a id="23465" class="Symbol">)</a>
<a id="23467" href="../Denotational/#23317" class="Function">ext-⊑</a> <a id="23473" href="../Denotational/#23473" class="Bound">ρ</a> <a id="23475" href="../Denotational/#23475" class="Bound">lt</a> <a id="23478" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="23480" class="Symbol">=</a> <a id="23482" href="../Denotational/#5554" class="Function">⊑-refl</a>
<a id="23489" href="../Denotational/#23317" class="Function">ext-⊑</a> <a id="23495" href="../Denotational/#23495" class="Bound">ρ</a> <a id="23497" href="../Denotational/#23497" class="Bound">lt</a> <a id="23500" class="Symbol">(</a><a id="23501" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="23503" href="../Denotational/#23503" class="Bound">n′</a><a id="23505" class="Symbol">)</a> <a id="23507" class="Symbol">=</a> <a id="23509" href="../Denotational/#23497" class="Bound">lt</a> <a id="23512" href="../Denotational/#23503" class="Bound">n′</a>
</pre>
<p>We proceed by cases on the de Bruijn index <code>n</code>.</p>
<ul>
<li><p>If it is <code>Z</code>, then we just need to show that <code>v ≡ v</code>, which we have by <code>refl</code>.</p></li>
<li><p>If it is <code>S n′</code>, then the goal simplifies to <code>γ n′ ≡ δ (ρ n′)</code>, which is an instance of the premise.</p></li>
</ul>
<p>Now for the renaming lemma. Suppose we have a renaming that maps variables in <code>γ</code> into variables with the same values in <code>δ</code>. If <code>M</code> results in <code>v</code> when evaluated in environment <code>γ</code>, then applying the renaming to <code>M</code> produces a program that results in the same value <code>v</code> when evaluated in <code>δ</code>.</p>
<pre class="Agda"><a id="rename-pres"></a><a id="24057" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24069" class="Symbol">:</a> <a id="24071" class="Symbol">∀</a> <a id="24073" class="Symbol">{</a><a id="24074" href="../Denotational/#24074" class="Bound">Γ</a> <a id="24076" href="../Denotational/#24076" class="Bound">Δ</a> <a id="24078" href="../Denotational/#24078" class="Bound">v</a><a id="24079" class="Symbol">}</a> <a id="24081" class="Symbol">{</a><a id="24082" href="../Denotational/#24082" class="Bound">γ</a> <a id="24084" class="Symbol">:</a> <a id="24086" href="../Denotational/#7204" class="Function">Env</a> <a id="24090" href="../Denotational/#24074" class="Bound">Γ</a><a id="24091" class="Symbol">}</a> <a id="24093" class="Symbol">{</a><a id="24094" href="../Denotational/#24094" class="Bound">δ</a> <a id="24096" class="Symbol">:</a> <a id="24098" href="../Denotational/#7204" class="Function">Env</a> <a id="24102" href="../Denotational/#24076" class="Bound">Δ</a><a id="24103" class="Symbol">}</a> <a id="24105" class="Symbol">{</a><a id="24106" href="../Denotational/#24106" class="Bound">M</a> <a id="24108" class="Symbol">:</a> <a id="24110" href="../Denotational/#24074" class="Bound">Γ</a> <a id="24112" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="24114" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="24115" class="Symbol">}</a>
  <a id="24119" class="Symbol">→</a> <a id="24121" class="Symbol">(</a><a id="24122" href="../Denotational/#24122" class="Bound">ρ</a> <a id="24124" class="Symbol">:</a> <a id="24126" href="../Substitution/#2192" class="Function">Rename</a> <a id="24133" href="../Denotational/#24074" class="Bound">Γ</a> <a id="24135" href="../Denotational/#24076" class="Bound">Δ</a><a id="24136" class="Symbol">)</a>
  <a id="24140" class="Symbol">→</a> <a id="24142" href="../Denotational/#24082" class="Bound">γ</a> <a id="24144" href="../Denotational/#8024" class="Function Operator">`⊑</a> <a id="24147" class="Symbol">(</a><a id="24148" href="../Denotational/#24094" class="Bound">δ</a> <a id="24150" href="https://agda.github.io/agda-stdlib/v1.3/Function.Base.html#992" class="Function Operator">∘</a> <a id="24152" href="../Denotational/#24122" class="Bound">ρ</a><a id="24153" class="Symbol">)</a>
  <a id="24157" class="Symbol">→</a> <a id="24159" href="../Denotational/#24082" class="Bound">γ</a> <a id="24161" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="24163" href="../Denotational/#24106" class="Bound">M</a> <a id="24165" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="24167" href="../Denotational/#24078" class="Bound">v</a>
    <a id="24173" class="Comment">---------------------</a>
  <a id="24197" class="Symbol">→</a> <a id="24199" href="../Denotational/#24094" class="Bound">δ</a> <a id="24201" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="24203" class="Symbol">(</a><a id="24204" href="../Untyped/#6217" class="Function">rename</a> <a id="24211" href="../Denotational/#24122" class="Bound">ρ</a> <a id="24213" href="../Denotational/#24106" class="Bound">M</a><a id="24214" class="Symbol">)</a> <a id="24216" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="24218" href="../Denotational/#24078" class="Bound">v</a>
<a id="24220" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24232" href="../Denotational/#24232" class="Bound">ρ</a> <a id="24234" href="../Denotational/#24234" class="Bound">lt</a> <a id="24237" class="Symbol">(</a><a id="24238" href="../Denotational/#9316" class="InductiveConstructor">var</a> <a id="24242" class="Symbol">{</a><a id="24243" class="Argument">x</a> <a id="24245" class="Symbol">=</a> <a id="24247" href="../Denotational/#24247" class="Bound">x</a><a id="24248" class="Symbol">})</a> <a id="24251" class="Symbol">=</a> <a id="24253" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="24257" href="../Denotational/#9316" class="InductiveConstructor">var</a> <a id="24261" class="Symbol">(</a><a id="24262" href="../Denotational/#24234" class="Bound">lt</a> <a id="24265" href="../Denotational/#24247" class="Bound">x</a><a id="24266" class="Symbol">)</a>
<a id="24268" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24280" href="../Denotational/#24280" class="Bound">ρ</a> <a id="24282" href="../Denotational/#24282" class="Bound">lt</a> <a id="24285" class="Symbol">(</a><a id="24286" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="24293" href="../Denotational/#24293" class="Bound">d</a> <a id="24295" href="../Denotational/#24295" class="Bound">d₁</a><a id="24297" class="Symbol">)</a> <a id="24299" class="Symbol">=</a>
   <a id="24304" href="../Denotational/#9391" class="InductiveConstructor">↦-elim</a> <a id="24311" class="Symbol">(</a><a id="24312" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24324" href="../Denotational/#24280" class="Bound">ρ</a> <a id="24326" href="../Denotational/#24282" class="Bound">lt</a> <a id="24329" href="../Denotational/#24293" class="Bound">d</a><a id="24330" class="Symbol">)</a> <a id="24332" class="Symbol">(</a><a id="24333" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24345" href="../Denotational/#24280" class="Bound">ρ</a> <a id="24347" href="../Denotational/#24282" class="Bound">lt</a> <a id="24350" href="../Denotational/#24295" class="Bound">d₁</a><a id="24352" class="Symbol">)</a>
<a id="24354" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24366" href="../Denotational/#24366" class="Bound">ρ</a> <a id="24368" href="../Denotational/#24368" class="Bound">lt</a> <a id="24371" class="Symbol">(</a><a id="24372" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="24380" href="../Denotational/#24380" class="Bound">d</a><a id="24381" class="Symbol">)</a> <a id="24383" class="Symbol">=</a>
   <a id="24388" href="../Denotational/#9513" class="InductiveConstructor">↦-intro</a> <a id="24396" class="Symbol">(</a><a id="24397" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24409" class="Symbol">(</a><a id="24410" href="../Untyped/#5907" class="Function">ext</a> <a id="24414" href="../Denotational/#24366" class="Bound">ρ</a><a id="24415" class="Symbol">)</a> <a id="24417" class="Symbol">(</a><a id="24418" href="../Denotational/#23317" class="Function">ext-⊑</a> <a id="24424" href="../Denotational/#24366" class="Bound">ρ</a> <a id="24426" href="../Denotational/#24368" class="Bound">lt</a><a id="24428" class="Symbol">)</a> <a id="24430" href="../Denotational/#24380" class="Bound">d</a><a id="24431" class="Symbol">)</a>
<a id="24433" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24445" href="../Denotational/#24445" class="Bound">ρ</a> <a id="24447" href="../Denotational/#24447" class="Bound">lt</a> <a id="24450" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a> <a id="24458" class="Symbol">=</a> <a id="24460" href="../Denotational/#9625" class="InductiveConstructor">⊥-intro</a>
<a id="24468" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24480" href="../Denotational/#24480" class="Bound">ρ</a> <a id="24482" href="../Denotational/#24482" class="Bound">lt</a> <a id="24485" class="Symbol">(</a><a id="24486" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="24494" href="../Denotational/#24494" class="Bound">d</a> <a id="24496" href="../Denotational/#24496" class="Bound">d₁</a><a id="24498" class="Symbol">)</a> <a id="24500" class="Symbol">=</a>
   <a id="24505" href="../Denotational/#9692" class="InductiveConstructor">⊔-intro</a> <a id="24513" class="Symbol">(</a><a id="24514" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24526" href="../Denotational/#24480" class="Bound">ρ</a> <a id="24528" href="../Denotational/#24482" class="Bound">lt</a> <a id="24531" href="../Denotational/#24494" class="Bound">d</a><a id="24532" class="Symbol">)</a> <a id="24534" class="Symbol">(</a><a id="24535" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24547" href="../Denotational/#24480" class="Bound">ρ</a> <a id="24549" href="../Denotational/#24482" class="Bound">lt</a> <a id="24552" href="../Denotational/#24496" class="Bound">d₁</a><a id="24554" class="Symbol">)</a>
<a id="24556" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24568" href="../Denotational/#24568" class="Bound">ρ</a> <a id="24570" href="../Denotational/#24570" class="Bound">lt</a> <a id="24573" class="Symbol">(</a><a id="24574" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="24578" href="../Denotational/#24578" class="Bound">d</a> <a id="24580" href="../Denotational/#24580" class="Bound">lt′</a><a id="24583" class="Symbol">)</a> <a id="24585" class="Symbol">=</a>
   <a id="24590" href="../Denotational/#9807" class="InductiveConstructor">sub</a> <a id="24594" class="Symbol">(</a><a id="24595" href="../Denotational/#24057" class="Function">rename-pres</a> <a id="24607" href="../Denotational/#24568" class="Bound">ρ</a> <a id="24609" href="../Denotational/#24570" class="Bound">lt</a> <a id="24612" href="../Denotational/#24578" class="Bound">d</a><a id="24613" class="Symbol">)</a> <a id="24615" href="../Denotational/#24580" class="Bound">lt′</a>
</pre>
<p>The proof is by induction on the semantics of <code>M</code>. As you can see, all of the cases are trivial except the cases for variables and lambda.</p>
<ul>
<li><p>For a variable <code>x</code>, we make use of the premise to show that <code>γ x ≡ δ (ρ x)</code>.</p></li>
<li><p>For a lambda abstraction, the induction hypothesis requires us to extend the renaming. We do so, and use the <code>ext-⊑</code> lemma to show that the extended renaming maps variables to ones with equivalent values.</p></li>
</ul>
<h2 id="environment-strengthening-and-identity-renaming">Environment strengthening and identity renaming</h2>
<p>We shall need a corollary of the renaming lemma that says that replacing the environment with a larger one (a stronger one) does not change whether a term <code>M</code> results in particular value <code>v</code>. In particular, if <code>γ ⊢ M ↓ v</code> and <code>γ ⊑ δ</code>, then <code>δ ⊢ M ↓ v</code>. What does this have to do with renaming? It’s renaming with the identity function. We apply the renaming lemma with the identity renaming, which gives us <code>δ ⊢ rename (λ {A} x → x) M ↓ v</code>, and then we apply the <code>rename-id</code> lemma to obtain <code>δ ⊢ M ↓ v</code>.</p>
<pre class="Agda"><a id="⊑-env"></a><a id="25626" href="../Denotational/#25626" class="Function">⊑-env</a> <a id="25632" class="Symbol">:</a> <a id="25634" class="Symbol">∀</a> <a id="25636" class="Symbol">{</a><a id="25637" href="../Denotational/#25637" class="Bound">Γ</a><a id="25638" class="Symbol">}</a> <a id="25640" class="Symbol">{</a><a id="25641" href="../Denotational/#25641" class="Bound">γ</a> <a id="25643" class="Symbol">:</a> <a id="25645" href="../Denotational/#7204" class="Function">Env</a> <a id="25649" href="../Denotational/#25637" class="Bound">Γ</a><a id="25650" class="Symbol">}</a> <a id="25652" class="Symbol">{</a><a id="25653" href="../Denotational/#25653" class="Bound">δ</a> <a id="25655" class="Symbol">:</a> <a id="25657" href="../Denotational/#7204" class="Function">Env</a> <a id="25661" href="../Denotational/#25637" class="Bound">Γ</a><a id="25662" class="Symbol">}</a> <a id="25664" class="Symbol">{</a><a id="25665" href="../Denotational/#25665" class="Bound">M</a> <a id="25667" href="../Denotational/#25667" class="Bound">v</a><a id="25668" class="Symbol">}</a>
  <a id="25672" class="Symbol">→</a> <a id="25674" href="../Denotational/#25641" class="Bound">γ</a> <a id="25676" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="25678" href="../Denotational/#25665" class="Bound">M</a> <a id="25680" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="25682" href="../Denotational/#25667" class="Bound">v</a>
  <a id="25686" class="Symbol">→</a> <a id="25688" href="../Denotational/#25641" class="Bound">γ</a> <a id="25690" href="../Denotational/#8024" class="Function Operator">`⊑</a> <a id="25693" href="../Denotational/#25653" class="Bound">δ</a>
    <a id="25699" class="Comment">----------</a>
  <a id="25712" class="Symbol">→</a> <a id="25714" href="../Denotational/#25653" class="Bound">δ</a> <a id="25716" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="25718" href="../Denotational/#25665" class="Bound">M</a> <a id="25720" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="25722" href="../Denotational/#25667" class="Bound">v</a>
<a id="25724" href="../Denotational/#25626" class="Function">⊑-env</a><a id="25729" class="Symbol">{</a><a id="25730" href="../Denotational/#25730" class="Bound">Γ</a><a id="25731" class="Symbol">}{</a><a id="25733" href="../Denotational/#25733" class="Bound">γ</a><a id="25734" class="Symbol">}{</a><a id="25736" href="../Denotational/#25736" class="Bound">δ</a><a id="25737" class="Symbol">}{</a><a id="25739" href="../Denotational/#25739" class="Bound">M</a><a id="25740" class="Symbol">}{</a><a id="25742" href="../Denotational/#25742" class="Bound">v</a><a id="25743" class="Symbol">}</a> <a id="25745" href="../Denotational/#25745" class="Bound">d</a> <a id="25747" href="../Denotational/#25747" class="Bound">lt</a>
      <a id="25756" class="Keyword">with</a> <a id="25761" href="../Denotational/#24057" class="Function">rename-pres</a><a id="25772" class="Symbol">{</a><a id="25773" href="../Denotational/#25730" class="Bound">Γ</a><a id="25774" class="Symbol">}{</a><a id="25776" href="../Denotational/#25730" class="Bound">Γ</a><a id="25777" class="Symbol">}{</a><a id="25779" href="../Denotational/#25742" class="Bound">v</a><a id="25780" class="Symbol">}{</a><a id="25782" href="../Denotational/#25733" class="Bound">γ</a><a id="25783" class="Symbol">}{</a><a id="25785" href="../Denotational/#25736" class="Bound">δ</a><a id="25786" class="Symbol">}{</a><a id="25788" href="../Denotational/#25739" class="Bound">M</a><a id="25789" class="Symbol">}</a> <a id="25791" class="Symbol">(λ</a> <a id="25794" class="Symbol">{</a><a id="25795" href="../Denotational/#25795" class="Bound">A</a><a id="25796" class="Symbol">}</a> <a id="25798" href="../Denotational/#25798" class="Bound">x</a> <a id="25800" class="Symbol">→</a> <a id="25802" href="../Denotational/#25798" class="Bound">x</a><a id="25803" class="Symbol">)</a> <a id="25805" href="../Denotational/#25747" class="Bound">lt</a> <a id="25808" href="../Denotational/#25745" class="Bound">d</a>
<a id="25810" class="Symbol">...</a> <a id="25814" class="Symbol">|</a> <a id="25816" href="../Denotational/#25816" class="Bound">δ⊢id[M]↓v</a> <a id="25826" class="Keyword">rewrite</a> <a id="25834" href="../Substitution/#17302" class="Function">rename-id</a> <a id="25844" class="Symbol">{</a><a id="25845" class="Bound">Γ</a><a id="25846" class="Symbol">}{</a><a id="25848" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="25849" class="Symbol">}{</a><a id="25851" class="Bound">M</a><a id="25852" class="Symbol">}</a> <a id="25854" class="Symbol">=</a>
      <a id="25862" href="../Denotational/#25816" class="Bound">δ⊢id[M]↓v</a>
</pre>
<p>In the proof that substitution reflects denotations, in the case for lambda abstraction, we use a minor variation of <code>⊑-env</code>, in which just the last element of the environment gets larger.</p>
<pre class="Agda"><a id="up-env"></a><a id="26071" href="../Denotational/#26071" class="Function">up-env</a> <a id="26078" class="Symbol">:</a> <a id="26080" class="Symbol">∀</a> <a id="26082" class="Symbol">{</a><a id="26083" href="../Denotational/#26083" class="Bound">Γ</a><a id="26084" class="Symbol">}</a> <a id="26086" class="Symbol">{</a><a id="26087" href="../Denotational/#26087" class="Bound">γ</a> <a id="26089" class="Symbol">:</a> <a id="26091" href="../Denotational/#7204" class="Function">Env</a> <a id="26095" href="../Denotational/#26083" class="Bound">Γ</a><a id="26096" class="Symbol">}</a> <a id="26098" class="Symbol">{</a><a id="26099" href="../Denotational/#26099" class="Bound">M</a> <a id="26101" href="../Denotational/#26101" class="Bound">v</a> <a id="26103" href="../Denotational/#26103" class="Bound">u₁</a> <a id="26106" href="../Denotational/#26106" class="Bound">u₂</a><a id="26108" class="Symbol">}</a>
  <a id="26112" class="Symbol">→</a> <a id="26114" class="Symbol">(</a><a id="26115" href="../Denotational/#26087" class="Bound">γ</a> <a id="26117" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="26120" href="../Denotational/#26103" class="Bound">u₁</a><a id="26122" class="Symbol">)</a> <a id="26124" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="26126" href="../Denotational/#26099" class="Bound">M</a> <a id="26128" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="26130" href="../Denotational/#26101" class="Bound">v</a>
  <a id="26134" class="Symbol">→</a> <a id="26136" href="../Denotational/#26103" class="Bound">u₁</a> <a id="26139" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="26141" href="../Denotational/#26106" class="Bound">u₂</a>
    <a id="26148" class="Comment">-----------------</a>
  <a id="26168" class="Symbol">→</a> <a id="26170" class="Symbol">(</a><a id="26171" href="../Denotational/#26087" class="Bound">γ</a> <a id="26173" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="26176" href="../Denotational/#26106" class="Bound">u₂</a><a id="26178" class="Symbol">)</a> <a id="26180" href="../Denotational/#9262" class="Datatype Operator">⊢</a> <a id="26182" href="../Denotational/#26099" class="Bound">M</a> <a id="26184" href="../Denotational/#9262" class="Datatype Operator">↓</a> <a id="26186" href="../Denotational/#26101" class="Bound">v</a>
<a id="26188" href="../Denotational/#26071" class="Function">up-env</a> <a id="26195" href="../Denotational/#26195" class="Bound">d</a> <a id="26197" href="../Denotational/#26197" class="Bound">lt</a> <a id="26200" class="Symbol">=</a> <a id="26202" href="../Denotational/#25626" class="Function">⊑-env</a> <a id="26208" href="../Denotational/#26195" class="Bound">d</a> <a id="26210" class="Symbol">(</a><a id="26211" href="../Denotational/#26232" class="Function">ext-le</a> <a id="26218" href="../Denotational/#26197" class="Bound">lt</a><a id="26220" class="Symbol">)</a>
  <a id="26224" class="Keyword">where</a>
  <a id="26232" href="../Denotational/#26232" class="Function">ext-le</a> <a id="26239" class="Symbol">:</a> <a id="26241" class="Symbol">∀</a> <a id="26243" class="Symbol">{</a><a id="26244" href="../Denotational/#26244" class="Bound">γ</a> <a id="26246" href="../Denotational/#26246" class="Bound">u₁</a> <a id="26249" href="../Denotational/#26249" class="Bound">u₂</a><a id="26251" class="Symbol">}</a> <a id="26253" class="Symbol">→</a> <a id="26255" href="../Denotational/#26246" class="Bound">u₁</a> <a id="26258" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="26260" href="../Denotational/#26249" class="Bound">u₂</a> <a id="26263" class="Symbol">→</a> <a id="26265" class="Symbol">(</a><a id="26266" href="../Denotational/#26244" class="Bound">γ</a> <a id="26268" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="26271" href="../Denotational/#26246" class="Bound">u₁</a><a id="26273" class="Symbol">)</a> <a id="26275" href="../Denotational/#8024" class="Function Operator">`⊑</a> <a id="26278" class="Symbol">(</a><a id="26279" href="../Denotational/#26244" class="Bound">γ</a> <a id="26281" href="../Denotational/#7361" class="Function Operator">`,</a> <a id="26284" href="../Denotational/#26249" class="Bound">u₂</a><a id="26286" class="Symbol">)</a>
  <a id="26290" href="../Denotational/#26232" class="Function">ext-le</a> <a id="26297" href="../Denotational/#26297" class="Bound">lt</a> <a id="26300" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="26302" class="Symbol">=</a> <a id="26304" href="../Denotational/#26297" class="Bound">lt</a>
  <a id="26309" href="../Denotational/#26232" class="Function">ext-le</a> <a id="26316" href="../Denotational/#26316" class="Bound">lt</a> <a id="26319" class="Symbol">(</a><a id="26320" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="26322" href="../Denotational/#26322" class="Bound">n</a><a id="26323" class="Symbol">)</a> <a id="26325" class="Symbol">=</a> <a id="26327" href="../Denotational/#5554" class="Function">⊑-refl</a>
</pre>
<h4 id="exercise-denot-church-recommended">Exercise <code>denot-church</code> (recommended)</h4>
<p>Church numerals are more general than natural numbers in that they represent paths. A path consists of <code>n</code> edges and <code>n + 1</code> vertices. We store the vertices in a vector of length <code>n + 1</code> in reverse order. The edges in the path map the ith vertex to the <code>i + 1</code> vertex. The following function <code>D^suc</code> (for denotation of successor) constructs a table whose entries are all the edges in the path.</p>
<pre class="Agda"><a id="D^suc"></a><a id="26782" href="../Denotational/#26782" class="Function">D^suc</a> <a id="26788" class="Symbol">:</a> <a id="26790" class="Symbol">(</a><a id="26791" href="../Denotational/#26791" class="Bound">n</a> <a id="26793" class="Symbol">:</a> <a id="26795" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="26796" class="Symbol">)</a> <a id="26798" class="Symbol">→</a> <a id="26800" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="26804" href="../Denotational/#4067" class="Datatype">Value</a> <a id="26810" class="Symbol">(</a><a id="26811" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="26815" href="../Denotational/#26791" class="Bound">n</a><a id="26816" class="Symbol">)</a> <a id="26818" class="Symbol">→</a> <a id="26820" href="../Denotational/#4067" class="Datatype">Value</a>
<a id="26826" href="../Denotational/#26782" class="Function">D^suc</a> <a id="26832" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a> <a id="26837" class="Symbol">(</a><a id="26838" href="../Denotational/#26838" class="Bound">a[0]</a> <a id="26843" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="26845" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#995" class="InductiveConstructor">[]</a><a id="26847" class="Symbol">)</a> <a id="26849" class="Symbol">=</a> <a id="26851" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>
<a id="26853" href="../Denotational/#26782" class="Function">D^suc</a> <a id="26859" class="Symbol">(</a><a id="26860" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="26864" href="../Denotational/#26864" class="Bound">i</a><a id="26865" class="Symbol">)</a> <a id="26867" class="Symbol">(</a><a id="26868" href="../Denotational/#26868" class="Bound">a[i+1]</a> <a id="26875" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="26877" href="../Denotational/#26877" class="Bound">a[i]</a> <a id="26882" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="26884" href="../Denotational/#26884" class="Bound">ls</a><a id="26886" class="Symbol">)</a> <a id="26888" class="Symbol">=</a>  <a id="26891" href="../Denotational/#26877" class="Bound">a[i]</a> <a id="26896" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="26898" href="../Denotational/#26868" class="Bound">a[i+1]</a>  <a id="26906" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a>  <a id="26909" href="../Denotational/#26782" class="Function">D^suc</a> <a id="26915" href="../Denotational/#26864" class="Bound">i</a> <a id="26917" class="Symbol">(</a><a id="26918" href="../Denotational/#26877" class="Bound">a[i]</a> <a id="26923" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="26925" href="../Denotational/#26884" class="Bound">ls</a><a id="26927" class="Symbol">)</a>
</pre>
<p>We use the following auxiliary function to obtain the last element of a non-empty vector. (This formulation is more convenient for our purposes than the one in the Agda standard library.)</p>
<pre class="Agda"><a id="vec-last"></a><a id="27127" href="../Denotational/#27127" class="Function">vec-last</a> <a id="27136" class="Symbol">:</a> <a id="27138" class="Symbol">∀{</a><a id="27140" href="../Denotational/#27140" class="Bound">n</a> <a id="27142" class="Symbol">:</a> <a id="27144" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="27145" class="Symbol">}</a> <a id="27147" class="Symbol">→</a> <a id="27149" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="27153" href="../Denotational/#4067" class="Datatype">Value</a> <a id="27159" class="Symbol">(</a><a id="27160" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="27164" href="../Denotational/#27140" class="Bound">n</a><a id="27165" class="Symbol">)</a> <a id="27167" class="Symbol">→</a> <a id="27169" href="../Denotational/#4067" class="Datatype">Value</a>
<a id="27175" href="../Denotational/#27127" class="Function">vec-last</a> <a id="27184" class="Symbol">{</a><a id="27185" class="Number">0</a><a id="27186" class="Symbol">}</a> <a id="27188" class="Symbol">(</a><a id="27189" href="../Denotational/#27189" class="Bound">a</a> <a id="27191" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="27193" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#995" class="InductiveConstructor">[]</a><a id="27195" class="Symbol">)</a> <a id="27197" class="Symbol">=</a> <a id="27199" href="../Denotational/#27189" class="Bound">a</a>
<a id="27201" href="../Denotational/#27127" class="Function">vec-last</a> <a id="27210" class="Symbol">{</a><a id="27211" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="27215" href="../Denotational/#27215" class="Bound">n</a><a id="27216" class="Symbol">}</a> <a id="27218" class="Symbol">(</a><a id="27219" href="../Denotational/#27219" class="Bound">a</a> <a id="27221" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="27223" href="../Denotational/#27223" class="Bound">b</a> <a id="27225" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="27227" href="../Denotational/#27227" class="Bound">ls</a><a id="27229" class="Symbol">)</a> <a id="27231" class="Symbol">=</a> <a id="27233" href="../Denotational/#27127" class="Function">vec-last</a> <a id="27242" class="Symbol">(</a><a id="27243" href="../Denotational/#27223" class="Bound">b</a> <a id="27245" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="27247" href="../Denotational/#27227" class="Bound">ls</a><a id="27249" class="Symbol">)</a>
</pre>
<p>The function <code>Dᶜ</code> computes the denotation of the nth Church numeral for a given path.</p>
<pre class="Agda"><a id="Dᶜ"></a><a id="27347" href="../Denotational/#27347" class="Function">Dᶜ</a> <a id="27350" class="Symbol">:</a> <a id="27352" class="Symbol">(</a><a id="27353" href="../Denotational/#27353" class="Bound">n</a> <a id="27355" class="Symbol">:</a> <a id="27357" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="27358" class="Symbol">)</a> <a id="27360" class="Symbol">→</a> <a id="27362" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="27366" href="../Denotational/#4067" class="Datatype">Value</a> <a id="27372" class="Symbol">(</a><a id="27373" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="27377" href="../Denotational/#27353" class="Bound">n</a><a id="27378" class="Symbol">)</a> <a id="27380" class="Symbol">→</a> <a id="27382" href="../Denotational/#4067" class="Datatype">Value</a>
<a id="27388" href="../Denotational/#27347" class="Function">Dᶜ</a> <a id="27391" href="../Denotational/#27391" class="Bound">n</a> <a id="27393" class="Symbol">(</a><a id="27394" href="../Denotational/#27394" class="Bound">a[n]</a> <a id="27399" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="27401" href="../Denotational/#27401" class="Bound">ls</a><a id="27403" class="Symbol">)</a> <a id="27405" class="Symbol">=</a> <a id="27407" class="Symbol">(</a><a id="27408" href="../Denotational/#26782" class="Function">D^suc</a> <a id="27414" href="../Denotational/#27391" class="Bound">n</a> <a id="27416" class="Symbol">(</a><a id="27417" href="../Denotational/#27394" class="Bound">a[n]</a> <a id="27422" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="27424" href="../Denotational/#27401" class="Bound">ls</a><a id="27426" class="Symbol">))</a> <a id="27429" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="27431" class="Symbol">(</a><a id="27432" href="../Denotational/#27127" class="Function">vec-last</a> <a id="27441" class="Symbol">(</a><a id="27442" href="../Denotational/#27394" class="Bound">a[n]</a> <a id="27447" href="https://agda.github.io/agda-stdlib/v1.3/Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="27449" href="../Denotational/#27401" class="Bound">ls</a><a id="27451" class="Symbol">))</a> <a id="27454" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="27456" href="../Denotational/#27394" class="Bound">a[n]</a>
</pre>
<ul>
<li><p>The Church numeral for 0 ignores its first argument and returns its second argument, so for the singleton path consisting of just <code>a[0]</code>, its denotation is</p>
<pre><code>  ⊥ ↦ a[0] ↦ a[0]</code></pre></li>
<li><p>The Church numeral for <code>suc n</code> takes two arguments: a successor function whose denotation is given by <code>D^suc</code>, and the start of the path (last of the vector). It returns the <code>n + 1</code> vertex in the path.</p>
<pre><code>  (D^suc (suc n) (a[n+1] ∷ a[n] ∷ ls)) ↦ (vec-last (a[n] ∷ ls)) ↦ a[n+1]</code></pre></li>
</ul>
<p>The exercise is to prove that for any path <code>ls</code>, the meaning of the Church numeral <code>n</code> is <code>Dᶜ n ls</code>.</p>
<p>To facilitate talking about arbitrary Church numerals, the following <code>church</code> function builds the term for the nth Church numeral, using the auxiliary function <code>apply-n</code>.</p>
<pre class="Agda"><a id="apply-n"></a><a id="28223" href="../Denotational/#28223" class="Function">apply-n</a> <a id="28231" class="Symbol">:</a> <a id="28233" class="Symbol">(</a><a id="28234" href="../Denotational/#28234" class="Bound">n</a> <a id="28236" class="Symbol">:</a> <a id="28238" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="28239" class="Symbol">)</a> <a id="28241" class="Symbol">→</a> <a id="28243" href="../Untyped/#3157" class="InductiveConstructor">∅</a> <a id="28245" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="28247" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="28249" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="28251" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="28253" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="28255" href="../Untyped/#2870" class="InductiveConstructor">★</a>
<a id="28257" href="../Denotational/#28223" class="Function">apply-n</a> <a id="28265" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a> <a id="28270" class="Symbol">=</a> <a id="28272" href="../Untyped/#5093" class="Function Operator">#</a> <a id="28274" class="Number">0</a>
<a id="28276" href="../Denotational/#28223" class="Function">apply-n</a> <a id="28284" class="Symbol">(</a><a id="28285" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="28289" href="../Denotational/#28289" class="Bound">n</a><a id="28290" class="Symbol">)</a> <a id="28292" class="Symbol">=</a> <a id="28294" href="../Untyped/#5093" class="Function Operator">#</a> <a id="28296" class="Number">1</a> <a id="28298" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="28300" href="../Denotational/#28223" class="Function">apply-n</a> <a id="28308" href="../Denotational/#28289" class="Bound">n</a>

<a id="church"></a><a id="28311" href="../Denotational/#28311" class="Function">church</a> <a id="28318" class="Symbol">:</a> <a id="28320" class="Symbol">(</a><a id="28321" href="../Denotational/#28321" class="Bound">n</a> <a id="28323" class="Symbol">:</a> <a id="28325" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="28326" class="Symbol">)</a> <a id="28328" class="Symbol">→</a> <a id="28330" href="../Untyped/#3157" class="InductiveConstructor">∅</a> <a id="28332" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="28334" href="../Untyped/#2870" class="InductiveConstructor">★</a>
<a id="28336" href="../Denotational/#28311" class="Function">church</a> <a id="28343" href="../Denotational/#28343" class="Bound">n</a> <a id="28345" class="Symbol">=</a> <a id="28347" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="28349" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="28351" href="../Denotational/#28223" class="Function">apply-n</a> <a id="28359" href="../Denotational/#28343" class="Bound">n</a>
</pre>
<p>Prove the following theorem.</p>
<pre><code>denot-church : ∀{n : ℕ}{ls : Vec Value (suc n)}
   → `∅ ⊢ church n ↓ Dᶜ n ls</code></pre>
<pre class="Agda"><a id="28486" class="Comment">-- Your code goes here</a>
</pre>
<h2 id="inversion-of-the-less-than-relation-for-functions">Inversion of the less-than relation for functions</h2>
<p>What can we deduce from knowing that a function <code>v ↦ w</code> is less than some value <code>u</code>? What can we deduce about <code>u</code>? The answer to this question is called the inversion property of less-than for functions. This question is not easy to answer because of the <code>⊑-dist</code> rule, which relates a function on the left to a pair of functions on the right. So <code>u</code> may include several functions that, as a group, relate to <code>v ↦ w</code>. Furthermore, because of the rules <code>⊑-conj-R1</code> and <code>⊑-conj-R2</code>, there may be other values inside <code>u</code>, such as <code>⊥</code>, that have nothing to do with <code>v ↦ w</code>. But in general, we can deduce that <code>u</code> includes a collection of functions where the join of their domains is less than <code>v</code> and the join of their codomains is greater than <code>w</code>.</p>
<p>To precisely state and prove this inversion property, we need to define what it means for a value to <em>include</em> a collection of values. We also need to define how to compute the join of their domains and codomains.</p>
<h3 id="value-membership-and-inclusion">Value membership and inclusion</h3>
<p>Recall that we think of a value as a set of entries with the join operator <code>v ⊔ w</code> acting like set union. The function value <code>v ↦ w</code> and bottom value <code>⊥</code> constitute the two kinds of elements of the set. (In other contexts one can instead think of <code>⊥</code> as the empty set, but here we must think of it as an element.) We write <code>u ∈ v</code> to say that <code>u</code> is an element of <code>v</code>, as defined below.</p>
<pre class="Agda"><a id="29963" class="Keyword">infix</a> <a id="29969" class="Number">5</a> <a id="29971" href="../Denotational/#29976" class="Function Operator">_∈_</a>

<a id="_∈_"></a><a id="29976" href="../Denotational/#29976" class="Function Operator">_∈_</a> <a id="29980" class="Symbol">:</a> <a id="29982" href="../Denotational/#4067" class="Datatype">Value</a> <a id="29988" class="Symbol">→</a> <a id="29990" href="../Denotational/#4067" class="Datatype">Value</a> <a id="29996" class="Symbol">→</a> <a id="29998" class="PrimitiveType">Set</a>
<a id="30002" href="../Denotational/#30002" class="Bound">u</a> <a id="30004" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="30006" href="../Denotational/#4087" class="InductiveConstructor">⊥</a> <a id="30008" class="Symbol">=</a> <a id="30010" href="../Denotational/#30002" class="Bound">u</a> <a id="30012" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="30014" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>
<a id="30016" href="../Denotational/#30016" class="Bound">u</a> <a id="30018" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="30020" href="../Denotational/#30020" class="Bound">v</a> <a id="30022" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="30024" href="../Denotational/#30024" class="Bound">w</a> <a id="30026" class="Symbol">=</a> <a id="30028" href="../Denotational/#30016" class="Bound">u</a> <a id="30030" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="30032" href="../Denotational/#30020" class="Bound">v</a> <a id="30034" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="30036" href="../Denotational/#30024" class="Bound">w</a>
<a id="30038" href="../Denotational/#30038" class="Bound">u</a> <a id="30040" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="30042" class="Symbol">(</a><a id="30043" href="../Denotational/#30043" class="Bound">v</a> <a id="30045" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="30047" href="../Denotational/#30047" class="Bound">w</a><a id="30048" class="Symbol">)</a> <a id="30050" class="Symbol">=</a> <a id="30052" href="../Denotational/#30038" class="Bound">u</a> <a id="30054" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="30056" href="../Denotational/#30043" class="Bound">v</a> <a id="30058" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#728" class="Datatype Operator">⊎</a> <a id="30060" href="../Denotational/#30038" class="Bound">u</a> <a id="30062" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="30064" href="../Denotational/#30047" class="Bound">w</a>
</pre>
<p>So we can represent a collection of values simply as a value. We write <code>v ⊆ w</code> to say that all the elements of <code>v</code> are also in <code>w</code>.</p>
<pre class="Agda"><a id="30209" class="Keyword">infix</a> <a id="30215" class="Number">5</a> <a id="30217" href="../Denotational/#30222" class="Function Operator">_⊆_</a>

<a id="_⊆_"></a><a id="30222" href="../Denotational/#30222" class="Function Operator">_⊆_</a> <a id="30226" class="Symbol">:</a> <a id="30228" href="../Denotational/#4067" class="Datatype">Value</a> <a id="30234" class="Symbol">→</a> <a id="30236" href="../Denotational/#4067" class="Datatype">Value</a> <a id="30242" class="Symbol">→</a> <a id="30244" class="PrimitiveType">Set</a>
<a id="30248" href="../Denotational/#30248" class="Bound">v</a> <a id="30250" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="30252" href="../Denotational/#30252" class="Bound">w</a> <a id="30254" class="Symbol">=</a> <a id="30256" class="Symbol">∀{</a><a id="30258" href="../Denotational/#30258" class="Bound">u</a><a id="30259" class="Symbol">}</a> <a id="30261" class="Symbol">→</a> <a id="30263" href="../Denotational/#30258" class="Bound">u</a> <a id="30265" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="30267" href="../Denotational/#30248" class="Bound">v</a> <a id="30269" class="Symbol">→</a> <a id="30271" href="../Denotational/#30258" class="Bound">u</a> <a id="30273" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="30275" href="../Denotational/#30252" class="Bound">w</a>
</pre>
<p>The notions of membership and inclusion for values are closely related to the less-than relation. They are narrower relations in that they imply the less-than relation but not the other way around.</p>
<pre class="Agda"><a id="∈→⊑"></a><a id="30485" href="../Denotational/#30485" class="Function">∈→⊑</a> <a id="30489" class="Symbol">:</a> <a id="30491" class="Symbol">∀{</a><a id="30493" href="../Denotational/#30493" class="Bound">u</a> <a id="30495" href="../Denotational/#30495" class="Bound">v</a> <a id="30497" class="Symbol">:</a> <a id="30499" href="../Denotational/#4067" class="Datatype">Value</a><a id="30504" class="Symbol">}</a>
    <a id="30510" class="Symbol">→</a> <a id="30512" href="../Denotational/#30493" class="Bound">u</a> <a id="30514" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="30516" href="../Denotational/#30495" class="Bound">v</a>
      <a id="30524" class="Comment">-----</a>
    <a id="30534" class="Symbol">→</a> <a id="30536" href="../Denotational/#30493" class="Bound">u</a> <a id="30538" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="30540" href="../Denotational/#30495" class="Bound">v</a>
<a id="30542" href="../Denotational/#30485" class="Function">∈→⊑</a> <a id="30546" class="Symbol">{</a><a id="30547" class="DottedPattern Symbol">.</a><a id="30548" href="../Denotational/#4087" class="DottedPattern InductiveConstructor">⊥</a><a id="30549" class="Symbol">}</a> <a id="30551" class="Symbol">{</a><a id="30552" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="30553" class="Symbol">}</a> <a id="30555" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="30560" class="Symbol">=</a> <a id="30562" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a>
<a id="30568" href="../Denotational/#30485" class="Function">∈→⊑</a> <a id="30572" class="Symbol">{</a><a id="30573" href="../Denotational/#30573" class="Bound">v</a> <a id="30575" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="30577" href="../Denotational/#30577" class="Bound">w</a><a id="30578" class="Symbol">}</a> <a id="30580" class="Symbol">{</a><a id="30581" href="../Denotational/#30573" class="Bound">v</a> <a id="30583" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="30585" href="../Denotational/#30577" class="Bound">w</a><a id="30586" class="Symbol">}</a> <a id="30588" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="30593" class="Symbol">=</a> <a id="30595" href="../Denotational/#5554" class="Function">⊑-refl</a>
<a id="30602" href="../Denotational/#30485" class="Function">∈→⊑</a> <a id="30606" class="Symbol">{</a><a id="30607" href="../Denotational/#30607" class="Bound">u</a><a id="30608" class="Symbol">}</a> <a id="30610" class="Symbol">{</a><a id="30611" href="../Denotational/#30611" class="Bound">v</a> <a id="30613" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="30615" href="../Denotational/#30615" class="Bound">w</a><a id="30616" class="Symbol">}</a> <a id="30618" class="Symbol">(</a><a id="30619" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="30624" href="../Denotational/#30624" class="Bound">x</a><a id="30625" class="Symbol">)</a> <a id="30627" class="Symbol">=</a> <a id="30629" href="../Denotational/#4568" class="InductiveConstructor">⊑-conj-R1</a> <a id="30639" class="Symbol">(</a><a id="30640" href="../Denotational/#30485" class="Function">∈→⊑</a> <a id="30644" href="../Denotational/#30624" class="Bound">x</a><a id="30645" class="Symbol">)</a>
<a id="30647" href="../Denotational/#30485" class="Function">∈→⊑</a> <a id="30651" class="Symbol">{</a><a id="30652" href="../Denotational/#30652" class="Bound">u</a><a id="30653" class="Symbol">}</a> <a id="30655" class="Symbol">{</a><a id="30656" href="../Denotational/#30656" class="Bound">v</a> <a id="30658" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="30660" href="../Denotational/#30660" class="Bound">w</a><a id="30661" class="Symbol">}</a> <a id="30663" class="Symbol">(</a><a id="30664" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="30669" href="../Denotational/#30669" class="Bound">y</a><a id="30670" class="Symbol">)</a> <a id="30672" class="Symbol">=</a> <a id="30674" href="../Denotational/#4641" class="InductiveConstructor">⊑-conj-R2</a> <a id="30684" class="Symbol">(</a><a id="30685" href="../Denotational/#30485" class="Function">∈→⊑</a> <a id="30689" href="../Denotational/#30669" class="Bound">y</a><a id="30690" class="Symbol">)</a>

<a id="⊆→⊑"></a><a id="30693" href="../Denotational/#30693" class="Function">⊆→⊑</a> <a id="30697" class="Symbol">:</a> <a id="30699" class="Symbol">∀{</a><a id="30701" href="../Denotational/#30701" class="Bound">u</a> <a id="30703" href="../Denotational/#30703" class="Bound">v</a> <a id="30705" class="Symbol">:</a> <a id="30707" href="../Denotational/#4067" class="Datatype">Value</a><a id="30712" class="Symbol">}</a>
    <a id="30718" class="Symbol">→</a> <a id="30720" href="../Denotational/#30701" class="Bound">u</a> <a id="30722" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="30724" href="../Denotational/#30703" class="Bound">v</a>
      <a id="30732" class="Comment">-----</a>
    <a id="30742" class="Symbol">→</a> <a id="30744" href="../Denotational/#30701" class="Bound">u</a> <a id="30746" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="30748" href="../Denotational/#30703" class="Bound">v</a>
<a id="30750" href="../Denotational/#30693" class="Function">⊆→⊑</a> <a id="30754" class="Symbol">{</a><a id="30755" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="30756" class="Symbol">}</a> <a id="30758" href="../Denotational/#30758" class="Bound">s</a> <a id="30760" class="Keyword">with</a> <a id="30765" href="../Denotational/#30758" class="Bound">s</a> <a id="30767" class="Symbol">{</a><a id="30768" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="30769" class="Symbol">}</a> <a id="30771" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="30776" class="Symbol">...</a> <a id="30780" class="Symbol">|</a> <a id="30782" href="../Denotational/#30782" class="Bound">x</a> <a id="30784" class="Symbol">=</a> <a id="30786" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a>
<a id="30792" href="../Denotational/#30693" class="Function">⊆→⊑</a> <a id="30796" class="Symbol">{</a><a id="30797" href="../Denotational/#30797" class="Bound">u</a> <a id="30799" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="30801" href="../Denotational/#30801" class="Bound">u′</a><a id="30803" class="Symbol">}</a> <a id="30805" href="../Denotational/#30805" class="Bound">s</a> <a id="30807" class="Keyword">with</a> <a id="30812" href="../Denotational/#30805" class="Bound">s</a> <a id="30814" class="Symbol">{</a><a id="30815" href="../Denotational/#30797" class="Bound">u</a> <a id="30817" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="30819" href="../Denotational/#30801" class="Bound">u′</a><a id="30821" class="Symbol">}</a> <a id="30823" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="30828" class="Symbol">...</a> <a id="30832" class="Symbol">|</a> <a id="30834" href="../Denotational/#30834" class="Bound">x</a> <a id="30836" class="Symbol">=</a> <a id="30838" href="../Denotational/#30485" class="Function">∈→⊑</a> <a id="30842" href="../Denotational/#30834" class="Bound">x</a>
<a id="30844" href="../Denotational/#30693" class="Function">⊆→⊑</a> <a id="30848" class="Symbol">{</a><a id="30849" href="../Denotational/#30849" class="Bound">u</a> <a id="30851" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="30853" href="../Denotational/#30853" class="Bound">u′</a><a id="30855" class="Symbol">}</a> <a id="30857" href="../Denotational/#30857" class="Bound">s</a> <a id="30859" class="Symbol">=</a> <a id="30861" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="30870" class="Symbol">(</a><a id="30871" href="../Denotational/#30693" class="Function">⊆→⊑</a> <a id="30875" class="Symbol">(λ</a> <a id="30878" href="../Denotational/#30878" class="Bound">z</a> <a id="30880" class="Symbol">→</a> <a id="30882" href="../Denotational/#30857" class="Bound">s</a> <a id="30884" class="Symbol">(</a><a id="30885" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="30890" href="../Denotational/#30878" class="Bound">z</a><a id="30891" class="Symbol">)))</a> <a id="30895" class="Symbol">(</a><a id="30896" href="../Denotational/#30693" class="Function">⊆→⊑</a> <a id="30900" class="Symbol">(λ</a> <a id="30903" href="../Denotational/#30903" class="Bound">z</a> <a id="30905" class="Symbol">→</a> <a id="30907" href="../Denotational/#30857" class="Bound">s</a> <a id="30909" class="Symbol">(</a><a id="30910" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="30915" href="../Denotational/#30903" class="Bound">z</a><a id="30916" class="Symbol">)))</a>
</pre>
<p>We shall also need some inversion principles for value inclusion. If the union of <code>u</code> and <code>v</code> is included in <code>w</code>, then of course both <code>u</code> and <code>v</code> are each included in <code>w</code>.</p>
<pre class="Agda"><a id="⊔⊆-inv"></a><a id="31103" href="../Denotational/#31103" class="Function">⊔⊆-inv</a> <a id="31110" class="Symbol">:</a> <a id="31112" class="Symbol">∀{</a><a id="31114" href="../Denotational/#31114" class="Bound">u</a> <a id="31116" href="../Denotational/#31116" class="Bound">v</a> <a id="31118" href="../Denotational/#31118" class="Bound">w</a> <a id="31120" class="Symbol">:</a> <a id="31122" href="../Denotational/#4067" class="Datatype">Value</a><a id="31127" class="Symbol">}</a>
       <a id="31136" class="Symbol">→</a> <a id="31138" class="Symbol">(</a><a id="31139" href="../Denotational/#31114" class="Bound">u</a> <a id="31141" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="31143" href="../Denotational/#31116" class="Bound">v</a><a id="31144" class="Symbol">)</a> <a id="31146" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="31148" href="../Denotational/#31118" class="Bound">w</a>
         <a id="31159" class="Comment">---------------</a>
       <a id="31182" class="Symbol">→</a> <a id="31184" href="../Denotational/#31114" class="Bound">u</a> <a id="31186" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="31188" href="../Denotational/#31118" class="Bound">w</a>  <a id="31191" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a>  <a id="31194" href="../Denotational/#31116" class="Bound">v</a> <a id="31196" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="31198" href="../Denotational/#31118" class="Bound">w</a>
<a id="31200" href="../Denotational/#31103" class="Function">⊔⊆-inv</a> <a id="31207" href="../Denotational/#31207" class="Bound">uvw</a> <a id="31211" class="Symbol">=</a> <a id="31213" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="31215" class="Symbol">(λ</a> <a id="31218" href="../Denotational/#31218" class="Bound">x</a> <a id="31220" class="Symbol">→</a> <a id="31222" href="../Denotational/#31207" class="Bound">uvw</a> <a id="31226" class="Symbol">(</a><a id="31227" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="31232" href="../Denotational/#31218" class="Bound">x</a><a id="31233" class="Symbol">))</a> <a id="31236" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="31238" class="Symbol">(λ</a> <a id="31241" href="../Denotational/#31241" class="Bound">x</a> <a id="31243" class="Symbol">→</a> <a id="31245" href="../Denotational/#31207" class="Bound">uvw</a> <a id="31249" class="Symbol">(</a><a id="31250" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="31255" href="../Denotational/#31241" class="Bound">x</a><a id="31256" class="Symbol">))</a> <a id="31259" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>In our value representation, the function value <code>v ↦ w</code> is both an element and also a singleton set. So if <code>v ↦ w</code> is a subset of <code>u</code>, then <code>v ↦ w</code> must be a member of <code>u</code>.</p>
<pre class="Agda"><a id="↦⊆→∈"></a><a id="31444" href="../Denotational/#31444" class="Function">↦⊆→∈</a> <a id="31449" class="Symbol">:</a> <a id="31451" class="Symbol">∀{</a><a id="31453" href="../Denotational/#31453" class="Bound">v</a> <a id="31455" href="../Denotational/#31455" class="Bound">w</a> <a id="31457" href="../Denotational/#31457" class="Bound">u</a> <a id="31459" class="Symbol">:</a> <a id="31461" href="../Denotational/#4067" class="Datatype">Value</a><a id="31466" class="Symbol">}</a>
     <a id="31473" class="Symbol">→</a> <a id="31475" href="../Denotational/#31453" class="Bound">v</a> <a id="31477" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="31479" href="../Denotational/#31455" class="Bound">w</a> <a id="31481" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="31483" href="../Denotational/#31457" class="Bound">u</a>
       <a id="31492" class="Comment">---------</a>
     <a id="31507" class="Symbol">→</a> <a id="31509" href="../Denotational/#31453" class="Bound">v</a> <a id="31511" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="31513" href="../Denotational/#31455" class="Bound">w</a> <a id="31515" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="31517" href="../Denotational/#31457" class="Bound">u</a>
<a id="31519" href="../Denotational/#31444" class="Function">↦⊆→∈</a> <a id="31524" href="../Denotational/#31524" class="Bound">incl</a> <a id="31529" class="Symbol">=</a> <a id="31531" href="../Denotational/#31524" class="Bound">incl</a> <a id="31536" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
<h3 id="function-values">Function values</h3>
<p>To identify collections of functions, we define the following two predicates. We write <code>Fun u</code> if <code>u</code> is a function value, that is, if <code>u ≡ v ↦ w</code> for some values <code>v</code> and <code>w</code>. We write <code>all-funs v</code> if all the elements of <code>v</code> are functions.</p>
<pre class="Agda"><a id="31813" class="Keyword">data</a> <a id="Fun"></a><a id="31818" href="../Denotational/#31818" class="Datatype">Fun</a> <a id="31822" class="Symbol">:</a> <a id="31824" href="../Denotational/#4067" class="Datatype">Value</a> <a id="31830" class="Symbol">→</a> <a id="31832" class="PrimitiveType">Set</a> <a id="31836" class="Keyword">where</a>
  <a id="Fun.fun"></a><a id="31844" href="../Denotational/#31844" class="InductiveConstructor">fun</a> <a id="31848" class="Symbol">:</a> <a id="31850" class="Symbol">∀{</a><a id="31852" href="../Denotational/#31852" class="Bound">u</a> <a id="31854" href="../Denotational/#31854" class="Bound">v</a> <a id="31856" href="../Denotational/#31856" class="Bound">w</a><a id="31857" class="Symbol">}</a> <a id="31859" class="Symbol">→</a> <a id="31861" href="../Denotational/#31852" class="Bound">u</a> <a id="31863" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="31865" class="Symbol">(</a><a id="31866" href="../Denotational/#31854" class="Bound">v</a> <a id="31868" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="31870" href="../Denotational/#31856" class="Bound">w</a><a id="31871" class="Symbol">)</a> <a id="31873" class="Symbol">→</a> <a id="31875" href="../Denotational/#31818" class="Datatype">Fun</a> <a id="31879" href="../Denotational/#31852" class="Bound">u</a>

<a id="all-funs"></a><a id="31882" href="../Denotational/#31882" class="Function">all-funs</a> <a id="31891" class="Symbol">:</a> <a id="31893" href="../Denotational/#4067" class="Datatype">Value</a> <a id="31899" class="Symbol">→</a> <a id="31901" class="PrimitiveType">Set</a>
<a id="31905" href="../Denotational/#31882" class="Function">all-funs</a> <a id="31914" href="../Denotational/#31914" class="Bound">v</a> <a id="31916" class="Symbol">=</a> <a id="31918" class="Symbol">∀{</a><a id="31920" href="../Denotational/#31920" class="Bound">u</a><a id="31921" class="Symbol">}</a> <a id="31923" class="Symbol">→</a> <a id="31925" href="../Denotational/#31920" class="Bound">u</a> <a id="31927" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="31929" href="../Denotational/#31914" class="Bound">v</a> <a id="31931" class="Symbol">→</a> <a id="31933" href="../Denotational/#31818" class="Datatype">Fun</a> <a id="31937" href="../Denotational/#31920" class="Bound">u</a>
</pre>
<p>The value <code>⊥</code> is not a function.</p>
<pre class="Agda"><a id="¬Fun⊥"></a><a id="31982" href="../Denotational/#31982" class="Function">¬Fun⊥</a> <a id="31988" class="Symbol">:</a> <a id="31990" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#653" class="Function Operator">¬</a> <a id="31992" class="Symbol">(</a><a id="31993" href="../Denotational/#31818" class="Datatype">Fun</a> <a id="31997" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="31998" class="Symbol">)</a>
<a id="32000" href="../Denotational/#31982" class="Function">¬Fun⊥</a> <a id="32006" class="Symbol">(</a><a id="32007" href="../Denotational/#31844" class="InductiveConstructor">fun</a> <a id="32011" class="Symbol">())</a>
</pre>
<p>In our values-as-sets representation, our sets always include at least one element. Thus, if all the elements are functions, there is at least one that is a function.</p>
<pre class="Agda"><a id="all-funs∈"></a><a id="32192" href="../Denotational/#32192" class="Function">all-funs∈</a> <a id="32202" class="Symbol">:</a> <a id="32204" class="Symbol">∀{</a><a id="32206" href="../Denotational/#32206" class="Bound">u</a><a id="32207" class="Symbol">}</a>
      <a id="32215" class="Symbol">→</a> <a id="32217" href="../Denotational/#31882" class="Function">all-funs</a> <a id="32226" href="../Denotational/#32206" class="Bound">u</a>
      <a id="32234" class="Symbol">→</a> <a id="32236" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="32239" href="../Denotational/#32239" class="Bound">v</a> <a id="32241" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="32243" href="../Denotational/#4067" class="Datatype">Value</a> <a id="32249" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="32251" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="32254" href="../Denotational/#32254" class="Bound">w</a> <a id="32256" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="32258" href="../Denotational/#4067" class="Datatype">Value</a> <a id="32264" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="32266" href="../Denotational/#32239" class="Bound">v</a> <a id="32268" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="32270" href="../Denotational/#32254" class="Bound">w</a> <a id="32272" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="32274" href="../Denotational/#32206" class="Bound">u</a>
<a id="32276" href="../Denotational/#32192" class="Function">all-funs∈</a> <a id="32286" class="Symbol">{</a><a id="32287" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="32288" class="Symbol">}</a> <a id="32290" href="../Denotational/#32290" class="Bound">f</a> <a id="32292" class="Keyword">with</a> <a id="32297" href="../Denotational/#32290" class="Bound">f</a> <a id="32299" class="Symbol">{</a><a id="32300" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="32301" class="Symbol">}</a> <a id="32303" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="32308" class="Symbol">...</a> <a id="32312" class="Symbol">|</a> <a id="32314" href="../Denotational/#31844" class="InductiveConstructor">fun</a> <a id="32318" class="Symbol">()</a>
<a id="32321" href="../Denotational/#32192" class="Function">all-funs∈</a> <a id="32331" class="Symbol">{</a><a id="32332" href="../Denotational/#32332" class="Bound">v</a> <a id="32334" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="32336" href="../Denotational/#32336" class="Bound">w</a><a id="32337" class="Symbol">}</a> <a id="32339" href="../Denotational/#32339" class="Bound">f</a> <a id="32341" class="Symbol">=</a> <a id="32343" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="32345" href="../Denotational/#32332" class="Bound">v</a> <a id="32347" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="32349" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="32351" href="../Denotational/#32336" class="Bound">w</a> <a id="32353" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="32355" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="32360" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="32362" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
<a id="32364" href="../Denotational/#32192" class="Function">all-funs∈</a> <a id="32374" class="Symbol">{</a><a id="32375" href="../Denotational/#32375" class="Bound">u</a> <a id="32377" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="32379" href="../Denotational/#32379" class="Bound">u′</a><a id="32381" class="Symbol">}</a> <a id="32383" href="../Denotational/#32383" class="Bound">f</a>
    <a id="32389" class="Keyword">with</a> <a id="32394" href="../Denotational/#32192" class="Function">all-funs∈</a> <a id="32404" class="Symbol">(λ</a> <a id="32407" href="../Denotational/#32407" class="Bound">z</a> <a id="32409" class="Symbol">→</a> <a id="32411" href="../Denotational/#32383" class="Bound">f</a> <a id="32413" class="Symbol">(</a><a id="32414" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="32419" href="../Denotational/#32407" class="Bound">z</a><a id="32420" class="Symbol">))</a>
<a id="32423" class="Symbol">...</a> <a id="32427" class="Symbol">|</a> <a id="32429" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="32431" href="../Denotational/#32431" class="Bound">v</a> <a id="32433" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="32435" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="32437" href="../Denotational/#32437" class="Bound">w</a> <a id="32439" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="32441" href="../Denotational/#32441" class="Bound">m</a> <a id="32443" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="32445" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="32447" class="Symbol">=</a> <a id="32449" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="32451" href="../Denotational/#32431" class="Bound">v</a> <a id="32453" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="32455" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="32457" href="../Denotational/#32437" class="Bound">w</a> <a id="32459" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="32461" class="Symbol">(</a><a id="32462" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="32467" href="../Denotational/#32441" class="Bound">m</a><a id="32468" class="Symbol">)</a> <a id="32470" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="32472" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
</pre>
<h3 id="domains-and-codomains">Domains and codomains</h3>
<p>Returning to our goal, the inversion principle for less-than a function, we want to show that <code>v ↦ w ⊑ u</code> implies that <code>u</code> includes a set of function values such that the join of their domains is less than <code>v</code> and the join of their codomains is greater than <code>w</code>.</p>
<p>To this end we define the following <code>⨆dom</code> and <code>⨆cod</code> functions. Given some value <code>u</code> (that represents a set of entries), <code>⨆dom u</code> returns the join of their domains and <code>⨆cod u</code> returns the join of their codomains.</p>
<pre class="Agda"><a id="⨆dom"></a><a id="32992" href="../Denotational/#32992" class="Function">⨆dom</a> <a id="32997" class="Symbol">:</a> <a id="32999" class="Symbol">(</a><a id="33000" href="../Denotational/#33000" class="Bound">u</a> <a id="33002" class="Symbol">:</a> <a id="33004" href="../Denotational/#4067" class="Datatype">Value</a><a id="33009" class="Symbol">)</a> <a id="33011" class="Symbol">→</a> <a id="33013" href="../Denotational/#4067" class="Datatype">Value</a>
<a id="33019" href="../Denotational/#32992" class="Function">⨆dom</a> <a id="33024" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>  <a id="33027" class="Symbol">=</a> <a id="33029" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>
<a id="33031" href="../Denotational/#32992" class="Function">⨆dom</a> <a id="33036" class="Symbol">(</a><a id="33037" href="../Denotational/#33037" class="Bound">v</a> <a id="33039" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="33041" href="../Denotational/#33041" class="Bound">w</a><a id="33042" class="Symbol">)</a> <a id="33044" class="Symbol">=</a> <a id="33046" href="../Denotational/#33037" class="Bound">v</a>
<a id="33048" href="../Denotational/#32992" class="Function">⨆dom</a> <a id="33053" class="Symbol">(</a><a id="33054" href="../Denotational/#33054" class="Bound">u</a> <a id="33056" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="33058" href="../Denotational/#33058" class="Bound">u′</a><a id="33060" class="Symbol">)</a> <a id="33062" class="Symbol">=</a> <a id="33064" href="../Denotational/#32992" class="Function">⨆dom</a> <a id="33069" href="../Denotational/#33054" class="Bound">u</a> <a id="33071" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="33073" href="../Denotational/#32992" class="Function">⨆dom</a> <a id="33078" href="../Denotational/#33058" class="Bound">u′</a>

<a id="⨆cod"></a><a id="33082" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="33087" class="Symbol">:</a> <a id="33089" class="Symbol">(</a><a id="33090" href="../Denotational/#33090" class="Bound">u</a> <a id="33092" class="Symbol">:</a> <a id="33094" href="../Denotational/#4067" class="Datatype">Value</a><a id="33099" class="Symbol">)</a> <a id="33101" class="Symbol">→</a> <a id="33103" href="../Denotational/#4067" class="Datatype">Value</a>
<a id="33109" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="33114" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>  <a id="33117" class="Symbol">=</a> <a id="33119" href="../Denotational/#4087" class="InductiveConstructor">⊥</a>
<a id="33121" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="33126" class="Symbol">(</a><a id="33127" href="../Denotational/#33127" class="Bound">v</a> <a id="33129" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="33131" href="../Denotational/#33131" class="Bound">w</a><a id="33132" class="Symbol">)</a> <a id="33134" class="Symbol">=</a> <a id="33136" href="../Denotational/#33131" class="Bound">w</a>
<a id="33138" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="33143" class="Symbol">(</a><a id="33144" href="../Denotational/#33144" class="Bound">u</a> <a id="33146" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="33148" href="../Denotational/#33148" class="Bound">u′</a><a id="33150" class="Symbol">)</a> <a id="33152" class="Symbol">=</a> <a id="33154" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="33159" href="../Denotational/#33144" class="Bound">u</a> <a id="33161" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="33163" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="33168" href="../Denotational/#33148" class="Bound">u′</a>
</pre>
<p>We need just one property each for <code>⨆dom</code> and <code>⨆cod</code>. Given a collection of functions represented by value <code>u</code>, and an entry <code>v ↦ w ∈ u</code>, we know that <code>v</code> is included in the domain of <code>v</code>.</p>
<pre class="Agda"><a id="↦∈→⊆⨆dom"></a><a id="33371" href="../Denotational/#33371" class="Function">↦∈→⊆⨆dom</a> <a id="33380" class="Symbol">:</a> <a id="33382" class="Symbol">∀{</a><a id="33384" href="../Denotational/#33384" class="Bound">u</a> <a id="33386" href="../Denotational/#33386" class="Bound">v</a> <a id="33388" href="../Denotational/#33388" class="Bound">w</a> <a id="33390" class="Symbol">:</a> <a id="33392" href="../Denotational/#4067" class="Datatype">Value</a><a id="33397" class="Symbol">}</a>
          <a id="33409" class="Symbol">→</a> <a id="33411" href="../Denotational/#31882" class="Function">all-funs</a> <a id="33420" href="../Denotational/#33384" class="Bound">u</a>  <a id="33423" class="Symbol">→</a>  <a id="33426" class="Symbol">(</a><a id="33427" href="../Denotational/#33386" class="Bound">v</a> <a id="33429" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="33431" href="../Denotational/#33388" class="Bound">w</a><a id="33432" class="Symbol">)</a> <a id="33434" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="33436" href="../Denotational/#33384" class="Bound">u</a>
            <a id="33450" class="Comment">----------------------</a>
          <a id="33483" class="Symbol">→</a> <a id="33485" href="../Denotational/#33386" class="Bound">v</a> <a id="33487" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="33489" href="../Denotational/#32992" class="Function">⨆dom</a> <a id="33494" href="../Denotational/#33384" class="Bound">u</a>
<a id="33496" href="../Denotational/#33371" class="Function">↦∈→⊆⨆dom</a> <a id="33505" class="Symbol">{</a><a id="33506" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="33507" class="Symbol">}</a> <a id="33509" href="../Denotational/#33509" class="Bound">fg</a> <a id="33512" class="Symbol">()</a> <a id="33515" href="../Denotational/#33515" class="Bound">u∈v</a>
<a id="33519" href="../Denotational/#33371" class="Function">↦∈→⊆⨆dom</a> <a id="33528" class="Symbol">{</a><a id="33529" href="../Denotational/#33529" class="Bound">v</a> <a id="33531" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="33533" href="../Denotational/#33533" class="Bound">w</a><a id="33534" class="Symbol">}</a> <a id="33536" href="../Denotational/#33536" class="Bound">fg</a> <a id="33539" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="33544" href="../Denotational/#33544" class="Bound">u∈v</a> <a id="33548" class="Symbol">=</a> <a id="33550" href="../Denotational/#33544" class="Bound">u∈v</a>
<a id="33554" href="../Denotational/#33371" class="Function">↦∈→⊆⨆dom</a> <a id="33563" class="Symbol">{</a><a id="33564" href="../Denotational/#33564" class="Bound">u</a> <a id="33566" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="33568" href="../Denotational/#33568" class="Bound">u′</a><a id="33570" class="Symbol">}</a> <a id="33572" href="../Denotational/#33572" class="Bound">fg</a> <a id="33575" class="Symbol">(</a><a id="33576" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="33581" href="../Denotational/#33581" class="Bound">v↦w∈u</a><a id="33586" class="Symbol">)</a> <a id="33588" href="../Denotational/#33588" class="Bound">u∈v</a> <a id="33592" class="Symbol">=</a>
   <a id="33597" class="Keyword">let</a> <a id="33601" href="../Denotational/#33601" class="Bound">ih</a> <a id="33604" class="Symbol">=</a> <a id="33606" href="../Denotational/#33371" class="Function">↦∈→⊆⨆dom</a> <a id="33615" class="Symbol">(λ</a> <a id="33618" href="../Denotational/#33618" class="Bound">z</a> <a id="33620" class="Symbol">→</a> <a id="33622" href="../Denotational/#33572" class="Bound">fg</a> <a id="33625" class="Symbol">(</a><a id="33626" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="33631" href="../Denotational/#33618" class="Bound">z</a><a id="33632" class="Symbol">))</a> <a id="33635" href="../Denotational/#33581" class="Bound">v↦w∈u</a> <a id="33641" class="Keyword">in</a>
   <a id="33647" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="33652" class="Symbol">(</a><a id="33653" href="../Denotational/#33601" class="Bound">ih</a> <a id="33656" href="../Denotational/#33588" class="Bound">u∈v</a><a id="33659" class="Symbol">)</a>
<a id="33661" href="../Denotational/#33371" class="Function">↦∈→⊆⨆dom</a> <a id="33670" class="Symbol">{</a><a id="33671" href="../Denotational/#33671" class="Bound">u</a> <a id="33673" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="33675" href="../Denotational/#33675" class="Bound">u′</a><a id="33677" class="Symbol">}</a> <a id="33679" href="../Denotational/#33679" class="Bound">fg</a> <a id="33682" class="Symbol">(</a><a id="33683" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="33688" href="../Denotational/#33688" class="Bound">v↦w∈u′</a><a id="33694" class="Symbol">)</a> <a id="33696" href="../Denotational/#33696" class="Bound">u∈v</a> <a id="33700" class="Symbol">=</a>
   <a id="33705" class="Keyword">let</a> <a id="33709" href="../Denotational/#33709" class="Bound">ih</a> <a id="33712" class="Symbol">=</a> <a id="33714" href="../Denotational/#33371" class="Function">↦∈→⊆⨆dom</a> <a id="33723" class="Symbol">(λ</a> <a id="33726" href="../Denotational/#33726" class="Bound">z</a> <a id="33728" class="Symbol">→</a> <a id="33730" href="../Denotational/#33679" class="Bound">fg</a> <a id="33733" class="Symbol">(</a><a id="33734" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="33739" href="../Denotational/#33726" class="Bound">z</a><a id="33740" class="Symbol">))</a> <a id="33743" href="../Denotational/#33688" class="Bound">v↦w∈u′</a> <a id="33750" class="Keyword">in</a>
   <a id="33756" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="33761" class="Symbol">(</a><a id="33762" href="../Denotational/#33709" class="Bound">ih</a> <a id="33765" href="../Denotational/#33696" class="Bound">u∈v</a><a id="33768" class="Symbol">)</a>
</pre>
<p>Regarding <code>⨆cod</code>, suppose we have a collection of functions represented by <code>u</code>, but all of them are just copies of <code>v ↦ w</code>. Then the <code>⨆cod u</code> is included in <code>w</code>.</p>
<pre class="Agda"><a id="⊆↦→⨆cod⊆"></a><a id="33943" href="../Denotational/#33943" class="Function">⊆↦→⨆cod⊆</a> <a id="33952" class="Symbol">:</a> <a id="33954" class="Symbol">∀{</a><a id="33956" href="../Denotational/#33956" class="Bound">u</a> <a id="33958" href="../Denotational/#33958" class="Bound">v</a> <a id="33960" href="../Denotational/#33960" class="Bound">w</a> <a id="33962" class="Symbol">:</a> <a id="33964" href="../Denotational/#4067" class="Datatype">Value</a><a id="33969" class="Symbol">}</a>
        <a id="33979" class="Symbol">→</a> <a id="33981" href="../Denotational/#33956" class="Bound">u</a> <a id="33983" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="33985" href="../Denotational/#33958" class="Bound">v</a> <a id="33987" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="33989" href="../Denotational/#33960" class="Bound">w</a>
          <a id="34001" class="Comment">---------</a>
        <a id="34019" class="Symbol">→</a> <a id="34021" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="34026" href="../Denotational/#33956" class="Bound">u</a> <a id="34028" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="34030" href="../Denotational/#33960" class="Bound">w</a>
<a id="34032" href="../Denotational/#33943" class="Function">⊆↦→⨆cod⊆</a> <a id="34041" class="Symbol">{</a><a id="34042" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="34043" class="Symbol">}</a> <a id="34045" href="../Denotational/#34045" class="Bound">s</a> <a id="34047" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="34052" class="Keyword">with</a> <a id="34057" href="../Denotational/#34045" class="Bound">s</a> <a id="34059" class="Symbol">{</a><a id="34060" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="34061" class="Symbol">}</a> <a id="34063" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="34068" class="Symbol">...</a> <a id="34072" class="Symbol">|</a> <a id="34074" class="Symbol">()</a>
<a id="34077" href="../Denotational/#33943" class="Function">⊆↦→⨆cod⊆</a> <a id="34086" class="Symbol">{</a><a id="34087" href="../Denotational/#34087" class="Bound">C</a> <a id="34089" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="34091" href="../Denotational/#34091" class="Bound">C′</a><a id="34093" class="Symbol">}</a> <a id="34095" href="../Denotational/#34095" class="Bound">s</a> <a id="34097" href="../Denotational/#34097" class="Bound">m</a> <a id="34099" class="Keyword">with</a> <a id="34104" href="../Denotational/#34095" class="Bound">s</a> <a id="34106" class="Symbol">{</a><a id="34107" href="../Denotational/#34087" class="Bound">C</a> <a id="34109" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="34111" href="../Denotational/#34091" class="Bound">C′</a><a id="34113" class="Symbol">}</a> <a id="34115" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="34120" class="Symbol">...</a> <a id="34124" class="Symbol">|</a> <a id="34126" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="34131" class="Symbol">=</a> <a id="34133" class="Bound">m</a>
<a id="34135" href="../Denotational/#33943" class="Function">⊆↦→⨆cod⊆</a> <a id="34144" class="Symbol">{</a><a id="34145" href="../Denotational/#34145" class="Bound">u</a> <a id="34147" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="34149" href="../Denotational/#34149" class="Bound">u′</a><a id="34151" class="Symbol">}</a> <a id="34153" href="../Denotational/#34153" class="Bound">s</a> <a id="34155" class="Symbol">(</a><a id="34156" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="34161" href="../Denotational/#34161" class="Bound">x</a><a id="34162" class="Symbol">)</a> <a id="34164" class="Symbol">=</a> <a id="34166" href="../Denotational/#33943" class="Function">⊆↦→⨆cod⊆</a> <a id="34175" class="Symbol">(λ</a> <a id="34178" class="Symbol">{</a><a id="34179" href="../Denotational/#34179" class="Bound">C</a><a id="34180" class="Symbol">}</a> <a id="34182" href="../Denotational/#34182" class="Bound">z</a> <a id="34184" class="Symbol">→</a> <a id="34186" href="../Denotational/#34153" class="Bound">s</a> <a id="34188" class="Symbol">(</a><a id="34189" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="34194" href="../Denotational/#34182" class="Bound">z</a><a id="34195" class="Symbol">))</a> <a id="34198" href="../Denotational/#34161" class="Bound">x</a>
<a id="34200" href="../Denotational/#33943" class="Function">⊆↦→⨆cod⊆</a> <a id="34209" class="Symbol">{</a><a id="34210" href="../Denotational/#34210" class="Bound">u</a> <a id="34212" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="34214" href="../Denotational/#34214" class="Bound">u′</a><a id="34216" class="Symbol">}</a> <a id="34218" href="../Denotational/#34218" class="Bound">s</a> <a id="34220" class="Symbol">(</a><a id="34221" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="34226" href="../Denotational/#34226" class="Bound">y</a><a id="34227" class="Symbol">)</a> <a id="34229" class="Symbol">=</a> <a id="34231" href="../Denotational/#33943" class="Function">⊆↦→⨆cod⊆</a> <a id="34240" class="Symbol">(λ</a> <a id="34243" class="Symbol">{</a><a id="34244" href="../Denotational/#34244" class="Bound">C</a><a id="34245" class="Symbol">}</a> <a id="34247" href="../Denotational/#34247" class="Bound">z</a> <a id="34249" class="Symbol">→</a> <a id="34251" href="../Denotational/#34218" class="Bound">s</a> <a id="34253" class="Symbol">(</a><a id="34254" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="34259" href="../Denotational/#34247" class="Bound">z</a><a id="34260" class="Symbol">))</a> <a id="34263" href="../Denotational/#34226" class="Bound">y</a>
</pre>
<p>With the <code>⨆dom</code> and <code>⨆cod</code> functions in hand, we can make precise the conclusion of the inversion principle for functions, which we package into the following predicate named <code>factor</code>. We say that <code>v ↦ w</code> <em>factors</em> <code>u</code> into <code>u′</code> if <code>u′</code> is a included in <code>u</code>, if <code>u′</code> contains only functions, its domain is less than <code>v</code>, and its codomain is greater than <code>w</code>.</p>
<pre class="Agda"><a id="factor"></a><a id="34634" href="../Denotational/#34634" class="Function">factor</a> <a id="34641" class="Symbol">:</a> <a id="34643" class="Symbol">(</a><a id="34644" href="../Denotational/#34644" class="Bound">u</a> <a id="34646" class="Symbol">:</a> <a id="34648" href="../Denotational/#4067" class="Datatype">Value</a><a id="34653" class="Symbol">)</a> <a id="34655" class="Symbol">→</a> <a id="34657" class="Symbol">(</a><a id="34658" href="../Denotational/#34658" class="Bound">u′</a> <a id="34661" class="Symbol">:</a> <a id="34663" href="../Denotational/#4067" class="Datatype">Value</a><a id="34668" class="Symbol">)</a> <a id="34670" class="Symbol">→</a> <a id="34672" class="Symbol">(</a><a id="34673" href="../Denotational/#34673" class="Bound">v</a> <a id="34675" class="Symbol">:</a> <a id="34677" href="../Denotational/#4067" class="Datatype">Value</a><a id="34682" class="Symbol">)</a> <a id="34684" class="Symbol">→</a> <a id="34686" class="Symbol">(</a><a id="34687" href="../Denotational/#34687" class="Bound">w</a> <a id="34689" class="Symbol">:</a> <a id="34691" href="../Denotational/#4067" class="Datatype">Value</a><a id="34696" class="Symbol">)</a> <a id="34698" class="Symbol">→</a> <a id="34700" class="PrimitiveType">Set</a>
<a id="34704" href="../Denotational/#34634" class="Function">factor</a> <a id="34711" href="../Denotational/#34711" class="Bound">u</a> <a id="34713" href="../Denotational/#34713" class="Bound">u′</a> <a id="34716" href="../Denotational/#34716" class="Bound">v</a> <a id="34718" href="../Denotational/#34718" class="Bound">w</a> <a id="34720" class="Symbol">=</a> <a id="34722" href="../Denotational/#31882" class="Function">all-funs</a> <a id="34731" href="../Denotational/#34713" class="Bound">u′</a>  <a id="34735" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a>  <a id="34738" href="../Denotational/#34713" class="Bound">u′</a> <a id="34741" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="34743" href="../Denotational/#34711" class="Bound">u</a>  <a id="34746" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a>  <a id="34749" href="../Denotational/#32992" class="Function">⨆dom</a> <a id="34754" href="../Denotational/#34713" class="Bound">u′</a> <a id="34757" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="34759" href="../Denotational/#34716" class="Bound">v</a>  <a id="34762" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a>  <a id="34765" href="../Denotational/#34718" class="Bound">w</a> <a id="34767" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="34769" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="34774" href="../Denotational/#34713" class="Bound">u′</a>
</pre>
<p>So the inversion principle for functions can be stated as</p>
<pre><code>  v ↦ w ⊑ u
  ---------------
→ factor u u′ v w</code></pre>
<p>We prove the inversion principle for functions by induction on the derivation of the less-than relation. To make the induction hypothesis stronger, we broaden the premise <code>v ↦ w ⊑ u</code> to <code>u₁ ⊑ u₂</code>, and strengthen the conclusion to say that for <em>every</em> function value <code>v ↦ w ∈ u₁</code>, we have that <code>v ↦ w</code> factors <code>u₂</code> into some value <code>u₃</code>.</p>
<pre><code>→ u₁ ⊑ u₂
  ------------------------------------------------------
→ ∀{v w} → v ↦ w ∈ u₁ → Σ[ u₃ ∈ Value ] factor u₂ u₃ v w</code></pre>
<h3 id="inversion-of-less-than-for-functions-the-case-for--trans">Inversion of less-than for functions, the case for ⊑-trans</h3>
<p>The crux of the proof is the case for <code>⊑-trans</code>.</p>
<pre><code>u₁ ⊑ u   u ⊑ u₂
--------------- (⊑-trans)
    u₁ ⊑ u₂</code></pre>
<p>By the induction hypothesis for <code>u₁ ⊑ u</code>, we know that <code>v ↦ w factors u into u′</code>, for some value <code>u′</code>, so we have <code>all-funs u′</code> and <code>u′ ⊆ u</code>. By the induction hypothesis for <code>u ⊑ u₂</code>, we know that for any <code>v′ ↦ w′ ∈ u</code>, <code>v′ ↦ w′</code> factors <code>u₂</code> into <code>u₃</code>. With these facts in hand, we proceed by induction on <code>u′</code> to prove that <code>(⨆dom u′) ↦ (⨆cod u′)</code> factors <code>u₂</code> into <code>u₃</code>. We discuss each case of the proof in the text below.</p>
<pre class="Agda"><a id="sub-inv-trans"></a><a id="35990" href="../Denotational/#35990" class="Function">sub-inv-trans</a> <a id="36004" class="Symbol">:</a> <a id="36006" class="Symbol">∀{</a><a id="36008" href="../Denotational/#36008" class="Bound">u′</a> <a id="36011" href="../Denotational/#36011" class="Bound">u₂</a> <a id="36014" href="../Denotational/#36014" class="Bound">u</a> <a id="36016" class="Symbol">:</a> <a id="36018" href="../Denotational/#4067" class="Datatype">Value</a><a id="36023" class="Symbol">}</a>
    <a id="36029" class="Symbol">→</a> <a id="36031" href="../Denotational/#31882" class="Function">all-funs</a> <a id="36040" href="../Denotational/#36008" class="Bound">u′</a>  <a id="36044" class="Symbol">→</a>  <a id="36047" href="../Denotational/#36008" class="Bound">u′</a> <a id="36050" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="36052" href="../Denotational/#36014" class="Bound">u</a>
    <a id="36058" class="Symbol">→</a> <a id="36060" class="Symbol">(∀{</a><a id="36063" href="../Denotational/#36063" class="Bound">v′</a> <a id="36066" href="../Denotational/#36066" class="Bound">w′</a><a id="36068" class="Symbol">}</a> <a id="36070" class="Symbol">→</a> <a id="36072" href="../Denotational/#36063" class="Bound">v′</a> <a id="36075" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="36077" href="../Denotational/#36066" class="Bound">w′</a> <a id="36080" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="36082" href="../Denotational/#36014" class="Bound">u</a> <a id="36084" class="Symbol">→</a> <a id="36086" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="36089" href="../Denotational/#36089" class="Bound">u₃</a> <a id="36092" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="36094" href="../Denotational/#4067" class="Datatype">Value</a> <a id="36100" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="36102" href="../Denotational/#34634" class="Function">factor</a> <a id="36109" href="../Denotational/#36011" class="Bound">u₂</a> <a id="36112" href="../Denotational/#36089" class="Bound">u₃</a> <a id="36115" href="../Denotational/#36063" class="Bound">v′</a> <a id="36118" href="../Denotational/#36066" class="Bound">w′</a><a id="36120" class="Symbol">)</a>
      <a id="36128" class="Comment">---------------------------------------------------------------</a>
    <a id="36196" class="Symbol">→</a> <a id="36198" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="36201" href="../Denotational/#36201" class="Bound">u₃</a> <a id="36204" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="36206" href="../Denotational/#4067" class="Datatype">Value</a> <a id="36212" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="36214" href="../Denotational/#34634" class="Function">factor</a> <a id="36221" href="../Denotational/#36011" class="Bound">u₂</a> <a id="36224" href="../Denotational/#36201" class="Bound">u₃</a> <a id="36227" class="Symbol">(</a><a id="36228" href="../Denotational/#32992" class="Function">⨆dom</a> <a id="36233" href="../Denotational/#36008" class="Bound">u′</a><a id="36235" class="Symbol">)</a> <a id="36237" class="Symbol">(</a><a id="36238" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="36243" href="../Denotational/#36008" class="Bound">u′</a><a id="36245" class="Symbol">)</a>
<a id="36247" href="../Denotational/#35990" class="Function">sub-inv-trans</a> <a id="36261" class="Symbol">{</a><a id="36262" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="36263" class="Symbol">}</a> <a id="36265" class="Symbol">{</a><a id="36266" href="../Denotational/#36266" class="Bound">u₂</a><a id="36268" class="Symbol">}</a> <a id="36270" class="Symbol">{</a><a id="36271" href="../Denotational/#36271" class="Bound">u</a><a id="36272" class="Symbol">}</a> <a id="36274" href="../Denotational/#36274" class="Bound">fu′</a> <a id="36278" href="../Denotational/#36278" class="Bound">u′⊆u</a> <a id="36283" href="../Denotational/#36283" class="Bound">IH</a> <a id="36286" class="Symbol">=</a>
   <a id="36291" href="https://agda.github.io/agda-stdlib/v1.3/Data.Empty.html#628" class="Function">⊥-elim</a> <a id="36298" class="Symbol">(</a><a id="36299" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.Negation.html#858" class="Function">contradiction</a> <a id="36313" class="Symbol">(</a><a id="36314" href="../Denotational/#36274" class="Bound">fu′</a> <a id="36318" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="36322" class="Symbol">)</a> <a id="36324" href="../Denotational/#31982" class="Function">¬Fun⊥</a><a id="36329" class="Symbol">)</a>
<a id="36331" href="../Denotational/#35990" class="Function">sub-inv-trans</a> <a id="36345" class="Symbol">{</a><a id="36346" href="../Denotational/#36346" class="Bound">u₁′</a> <a id="36350" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="36352" href="../Denotational/#36352" class="Bound">u₂′</a><a id="36355" class="Symbol">}</a> <a id="36357" class="Symbol">{</a><a id="36358" href="../Denotational/#36358" class="Bound">u₂</a><a id="36360" class="Symbol">}</a> <a id="36362" class="Symbol">{</a><a id="36363" href="../Denotational/#36363" class="Bound">u</a><a id="36364" class="Symbol">}</a> <a id="36366" href="../Denotational/#36366" class="Bound">fg</a> <a id="36369" href="../Denotational/#36369" class="Bound">u′⊆u</a> <a id="36374" href="../Denotational/#36374" class="Bound">IH</a> <a id="36377" class="Symbol">=</a> <a id="36379" href="../Denotational/#36374" class="Bound">IH</a> <a id="36382" class="Symbol">(</a><a id="36383" href="../Denotational/#31444" class="Function">↦⊆→∈</a> <a id="36388" href="../Denotational/#36369" class="Bound">u′⊆u</a><a id="36392" class="Symbol">)</a>
<a id="36394" href="../Denotational/#35990" class="Function">sub-inv-trans</a> <a id="36408" class="Symbol">{</a><a id="36409" href="../Denotational/#36409" class="Bound">u₁′</a> <a id="36413" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="36415" href="../Denotational/#36415" class="Bound">u₂′</a><a id="36418" class="Symbol">}</a> <a id="36420" class="Symbol">{</a><a id="36421" href="../Denotational/#36421" class="Bound">u₂</a><a id="36423" class="Symbol">}</a> <a id="36425" class="Symbol">{</a><a id="36426" href="../Denotational/#36426" class="Bound">u</a><a id="36427" class="Symbol">}</a> <a id="36429" href="../Denotational/#36429" class="Bound">fg</a> <a id="36432" href="../Denotational/#36432" class="Bound">u′⊆u</a> <a id="36437" href="../Denotational/#36437" class="Bound">IH</a>
    <a id="36444" class="Keyword">with</a> <a id="36449" href="../Denotational/#31103" class="Function">⊔⊆-inv</a> <a id="36456" href="../Denotational/#36432" class="Bound">u′⊆u</a>
<a id="36461" class="Symbol">...</a> <a id="36465" class="Symbol">|</a> <a id="36467" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36469" href="../Denotational/#36469" class="Bound">u₁′⊆u</a> <a id="36475" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36477" href="../Denotational/#36477" class="Bound">u₂′⊆u</a> <a id="36483" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
    <a id="36489" class="Keyword">with</a> <a id="36494" href="../Denotational/#35990" class="Function">sub-inv-trans</a> <a id="36508" class="Symbol">{</a><a id="36509" class="Bound">u₁′</a><a id="36512" class="Symbol">}</a> <a id="36514" class="Symbol">{</a><a id="36515" class="Bound">u₂</a><a id="36517" class="Symbol">}</a> <a id="36519" class="Symbol">{</a><a id="36520" class="Bound">u</a><a id="36521" class="Symbol">}</a> <a id="36523" class="Symbol">(λ</a> <a id="36526" class="Symbol">{</a><a id="36527" href="../Denotational/#36527" class="Bound">v′</a><a id="36529" class="Symbol">}</a> <a id="36531" href="../Denotational/#36531" class="Bound">z</a> <a id="36533" class="Symbol">→</a> <a id="36535" class="Bound">fg</a> <a id="36538" class="Symbol">(</a><a id="36539" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="36544" href="../Denotational/#36531" class="Bound">z</a><a id="36545" class="Symbol">))</a> <a id="36548" href="../Denotational/#36469" class="Bound">u₁′⊆u</a> <a id="36554" class="Bound">IH</a>
       <a id="36564" class="Symbol">|</a> <a id="36566" href="../Denotational/#35990" class="Function">sub-inv-trans</a> <a id="36580" class="Symbol">{</a><a id="36581" class="Bound">u₂′</a><a id="36584" class="Symbol">}</a> <a id="36586" class="Symbol">{</a><a id="36587" class="Bound">u₂</a><a id="36589" class="Symbol">}</a> <a id="36591" class="Symbol">{</a><a id="36592" class="Bound">u</a><a id="36593" class="Symbol">}</a> <a id="36595" class="Symbol">(λ</a> <a id="36598" class="Symbol">{</a><a id="36599" href="../Denotational/#36599" class="Bound">v′</a><a id="36601" class="Symbol">}</a> <a id="36603" href="../Denotational/#36603" class="Bound">z</a> <a id="36605" class="Symbol">→</a> <a id="36607" class="Bound">fg</a> <a id="36610" class="Symbol">(</a><a id="36611" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="36616" href="../Denotational/#36603" class="Bound">z</a><a id="36617" class="Symbol">))</a> <a id="36620" href="../Denotational/#36477" class="Bound">u₂′⊆u</a> <a id="36626" class="Bound">IH</a>
<a id="36629" class="Symbol">...</a> <a id="36633" class="Symbol">|</a> <a id="36635" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36637" href="../Denotational/#36637" class="Bound">u₃₁</a> <a id="36641" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36643" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36645" href="../Denotational/#36645" class="Bound">fu21'</a> <a id="36651" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36653" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36655" href="../Denotational/#36655" class="Bound">u₃₁⊆u₂</a> <a id="36662" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36664" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36666" href="../Denotational/#36666" class="Bound">du₃₁⊑du₁′</a> <a id="36676" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36678" href="../Denotational/#36678" class="Bound">cu₁′⊑cu₃₁</a> <a id="36688" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36690" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36692" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36694" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
    <a id="36700" class="Symbol">|</a> <a id="36702" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36704" href="../Denotational/#36704" class="Bound">u₃₂</a> <a id="36708" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36710" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36712" href="../Denotational/#36712" class="Bound">fu22'</a> <a id="36718" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36720" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36722" href="../Denotational/#36722" class="Bound">u₃₂⊆u₂</a> <a id="36729" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36731" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36733" href="../Denotational/#36733" class="Bound">du₃₂⊑du₂′</a> <a id="36743" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36745" href="../Denotational/#36745" class="Bound">cu₁′⊑cu₃₂</a> <a id="36755" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36757" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36759" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36761" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36763" class="Symbol">=</a>
      <a id="36771" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36773" class="Symbol">(</a><a id="36774" href="../Denotational/#36637" class="Bound">u₃₁</a> <a id="36778" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="36780" href="../Denotational/#36704" class="Bound">u₃₂</a><a id="36783" class="Symbol">)</a> <a id="36785" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36787" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36789" href="../Denotational/#36891" class="Function">fu₂′</a> <a id="36794" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="36796" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36798" href="../Denotational/#37030" class="Function">u₂′⊆u₂</a> <a id="36805" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a>
      <a id="36813" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="36815" href="../Denotational/#5823" class="Function">⊔⊑⊔</a> <a id="36819" href="../Denotational/#36666" class="Bound">du₃₁⊑du₁′</a> <a id="36829" href="../Denotational/#36733" class="Bound">du₃₂⊑du₂′</a> <a id="36839" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a>
        <a id="36849" href="../Denotational/#5823" class="Function">⊔⊑⊔</a> <a id="36853" href="../Denotational/#36678" class="Bound">cu₁′⊑cu₃₁</a> <a id="36863" href="../Denotational/#36745" class="Bound">cu₁′⊑cu₃₂</a> <a id="36873" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36875" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36877" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="36879" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
    <a id="36885" class="Keyword">where</a> <a id="36891" href="../Denotational/#36891" class="Function">fu₂′</a> <a id="36896" class="Symbol">:</a> <a id="36898" class="Symbol">{</a><a id="36899" href="../Denotational/#36899" class="Bound">v′</a> <a id="36902" class="Symbol">:</a> <a id="36904" href="../Denotational/#4067" class="Datatype">Value</a><a id="36909" class="Symbol">}</a> <a id="36911" class="Symbol">→</a> <a id="36913" href="../Denotational/#36899" class="Bound">v′</a> <a id="36916" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="36918" href="../Denotational/#36637" class="Bound">u₃₁</a> <a id="36922" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#728" class="Datatype Operator">⊎</a> <a id="36924" href="../Denotational/#36899" class="Bound">v′</a> <a id="36927" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="36929" href="../Denotational/#36704" class="Bound">u₃₂</a> <a id="36933" class="Symbol">→</a> <a id="36935" href="../Denotational/#31818" class="Datatype">Fun</a> <a id="36939" href="../Denotational/#36899" class="Bound">v′</a>
          <a id="36952" href="../Denotational/#36891" class="Function">fu₂′</a> <a id="36957" class="Symbol">{</a><a id="36958" href="../Denotational/#36958" class="Bound">v′</a><a id="36960" class="Symbol">}</a> <a id="36962" class="Symbol">(</a><a id="36963" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="36968" href="../Denotational/#36968" class="Bound">x</a><a id="36969" class="Symbol">)</a> <a id="36971" class="Symbol">=</a> <a id="36973" href="../Denotational/#36645" class="Bound">fu21'</a> <a id="36979" href="../Denotational/#36968" class="Bound">x</a>
          <a id="36991" href="../Denotational/#36891" class="Function">fu₂′</a> <a id="36996" class="Symbol">{</a><a id="36997" href="../Denotational/#36997" class="Bound">v′</a><a id="36999" class="Symbol">}</a> <a id="37001" class="Symbol">(</a><a id="37002" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="37007" href="../Denotational/#37007" class="Bound">y</a><a id="37008" class="Symbol">)</a> <a id="37010" class="Symbol">=</a> <a id="37012" href="../Denotational/#36712" class="Bound">fu22'</a> <a id="37018" href="../Denotational/#37007" class="Bound">y</a>
          <a id="37030" href="../Denotational/#37030" class="Function">u₂′⊆u₂</a> <a id="37037" class="Symbol">:</a> <a id="37039" class="Symbol">{</a><a id="37040" href="../Denotational/#37040" class="Bound">C</a> <a id="37042" class="Symbol">:</a> <a id="37044" href="../Denotational/#4067" class="Datatype">Value</a><a id="37049" class="Symbol">}</a> <a id="37051" class="Symbol">→</a> <a id="37053" href="../Denotational/#37040" class="Bound">C</a> <a id="37055" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="37057" href="../Denotational/#36637" class="Bound">u₃₁</a> <a id="37061" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#728" class="Datatype Operator">⊎</a> <a id="37063" href="../Denotational/#37040" class="Bound">C</a> <a id="37065" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="37067" href="../Denotational/#36704" class="Bound">u₃₂</a> <a id="37071" class="Symbol">→</a> <a id="37073" href="../Denotational/#37040" class="Bound">C</a> <a id="37075" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="37077" class="Bound">u₂</a>
          <a id="37090" href="../Denotational/#37030" class="Function">u₂′⊆u₂</a> <a id="37097" class="Symbol">{</a><a id="37098" href="../Denotational/#37098" class="Bound">C</a><a id="37099" class="Symbol">}</a> <a id="37101" class="Symbol">(</a><a id="37102" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="37107" href="../Denotational/#37107" class="Bound">x</a><a id="37108" class="Symbol">)</a> <a id="37110" class="Symbol">=</a> <a id="37112" href="../Denotational/#36655" class="Bound">u₃₁⊆u₂</a> <a id="37119" href="../Denotational/#37107" class="Bound">x</a>
          <a id="37131" href="../Denotational/#37030" class="Function">u₂′⊆u₂</a> <a id="37138" class="Symbol">{</a><a id="37139" href="../Denotational/#37139" class="Bound">C</a><a id="37140" class="Symbol">}</a> <a id="37142" class="Symbol">(</a><a id="37143" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="37148" href="../Denotational/#37148" class="Bound">y</a><a id="37149" class="Symbol">)</a> <a id="37151" class="Symbol">=</a> <a id="37153" href="../Denotational/#36722" class="Bound">u₃₂⊆u₂</a> <a id="37160" href="../Denotational/#37148" class="Bound">y</a>
</pre>
<ul>
<li><p>Suppose <code>u′ ≡ ⊥</code>. Then we have a contradiction because it is not the case that <code>Fun ⊥</code>.</p></li>
<li><p>Suppose <code>u′ ≡ u₁′ ↦ u₂′</code>. Then <code>u₁′ ↦ u₂′ ∈ u</code> and we can apply the premise (the induction hypothesis from <code>u ⊑ u₂</code>) to obtain that <code>u₁′ ↦ u₂′</code> factors of <code>u₂ into u₂′</code>. This case is complete because <code>⨆dom u′ ≡ u₁′</code> and <code>⨆cod u′ ≡ u₂′</code>.</p></li>
<li><p>Suppose <code>u′ ≡ u₁′ ⊔ u₂′</code>. Then we have <code>u₁′ ⊆ u</code> and <code>u₂′ ⊆ u</code>. We also have <code>all-funs u₁′</code> and <code>all-funs u₂′</code>, so we can apply the induction hypothesis for both <code>u₁′</code> and <code>u₂′</code>. So there exists values <code>u₃₁</code> and <code>u₃₂</code> such that <code>(⨆dom u₁′) ↦ (⨆cod u₁′)</code> factors <code>u</code> into <code>u₃₁</code> and <code>(⨆dom u₂′) ↦ (⨆cod u₂′)</code> factors <code>u</code> into <code>u₃₂</code>. We will show that <code>(⨆dom u) ↦ (⨆cod u)</code> factors <code>u</code> into <code>u₃₁ ⊔ u₃₂</code>. So we need to show that</p>
<pre><code>  ⨆dom (u₃₁ ⊔ u₃₂) ⊑ ⨆dom (u₁′ ⊔ u₂′)
  ⨆cod (u₁′ ⊔ u₂′) ⊑ ⨆cod (u₃₁ ⊔ u₃₂)</code></pre>
<p>But those both follow directly from the factoring of <code>u</code> into <code>u₃₁</code> and <code>u₃₂</code>, using the monotonicity of <code>⊔</code> with respect to <code>⊑</code>.</p></li>
</ul>
<h3 id="inversion-of-less-than-for-functions">Inversion of less-than for functions</h3>
<p>We come to the proof of the main lemma concerning the inversion of less-than for functions. We show that if <code>u₁ ⊑ u₂</code>, then for any <code>v ↦ w ∈ u₁</code>, we can factor <code>u₂</code> into <code>u₃</code> according to <code>v ↦ w</code>. We proceed by induction on the derivation of <code>u₁ ⊑ u₂</code>, and describe each case in the text after the Agda proof.</p>
<pre class="Agda"><a id="sub-inv"></a><a id="38528" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="38536" class="Symbol">:</a> <a id="38538" class="Symbol">∀{</a><a id="38540" href="../Denotational/#38540" class="Bound">u₁</a> <a id="38543" href="../Denotational/#38543" class="Bound">u₂</a> <a id="38546" class="Symbol">:</a> <a id="38548" href="../Denotational/#4067" class="Datatype">Value</a><a id="38553" class="Symbol">}</a>
        <a id="38563" class="Symbol">→</a> <a id="38565" href="../Denotational/#38540" class="Bound">u₁</a> <a id="38568" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="38570" href="../Denotational/#38543" class="Bound">u₂</a>
        <a id="38581" class="Symbol">→</a> <a id="38583" class="Symbol">∀{</a><a id="38585" href="../Denotational/#38585" class="Bound">v</a> <a id="38587" href="../Denotational/#38587" class="Bound">w</a><a id="38588" class="Symbol">}</a> <a id="38590" class="Symbol">→</a> <a id="38592" href="../Denotational/#38585" class="Bound">v</a> <a id="38594" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="38596" href="../Denotational/#38587" class="Bound">w</a> <a id="38598" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="38600" href="../Denotational/#38540" class="Bound">u₁</a>
          <a id="38613" class="Comment">-------------------------------------</a>
        <a id="38659" class="Symbol">→</a> <a id="38661" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="38664" href="../Denotational/#38664" class="Bound">u₃</a> <a id="38667" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="38669" href="../Denotational/#4067" class="Datatype">Value</a> <a id="38675" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="38677" href="../Denotational/#34634" class="Function">factor</a> <a id="38684" href="../Denotational/#38543" class="Bound">u₂</a> <a id="38687" href="../Denotational/#38664" class="Bound">u₃</a> <a id="38690" href="../Denotational/#38585" class="Bound">v</a> <a id="38692" href="../Denotational/#38587" class="Bound">w</a>
<a id="38694" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="38702" class="Symbol">{</a><a id="38703" href="../Denotational/#4087" class="InductiveConstructor">⊥</a><a id="38704" class="Symbol">}</a> <a id="38706" class="Symbol">{</a><a id="38707" href="../Denotational/#38707" class="Bound">u₂</a><a id="38709" class="Symbol">}</a> <a id="38711" href="../Denotational/#4459" class="InductiveConstructor">⊑-bot</a> <a id="38717" class="Symbol">{</a><a id="38718" href="../Denotational/#38718" class="Bound">v</a><a id="38719" class="Symbol">}</a> <a id="38721" class="Symbol">{</a><a id="38722" href="../Denotational/#38722" class="Bound">w</a><a id="38723" class="Symbol">}</a> <a id="38725" class="Symbol">()</a>
<a id="38728" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="38736" class="Symbol">{</a><a id="38737" href="../Denotational/#38737" class="Bound">u₁₁</a> <a id="38741" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="38743" href="../Denotational/#38743" class="Bound">u₁₂</a><a id="38746" class="Symbol">}</a> <a id="38748" class="Symbol">{</a><a id="38749" href="../Denotational/#38749" class="Bound">u₂</a><a id="38751" class="Symbol">}</a> <a id="38753" class="Symbol">(</a><a id="38754" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="38763" href="../Denotational/#38763" class="Bound">lt1</a> <a id="38767" href="../Denotational/#38767" class="Bound">lt2</a><a id="38770" class="Symbol">)</a> <a id="38772" class="Symbol">{</a><a id="38773" href="../Denotational/#38773" class="Bound">v</a><a id="38774" class="Symbol">}</a> <a id="38776" class="Symbol">{</a><a id="38777" href="../Denotational/#38777" class="Bound">w</a><a id="38778" class="Symbol">}</a> <a id="38780" class="Symbol">(</a><a id="38781" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="38786" href="../Denotational/#38786" class="Bound">x</a><a id="38787" class="Symbol">)</a> <a id="38789" class="Symbol">=</a> <a id="38791" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="38799" href="../Denotational/#38763" class="Bound">lt1</a> <a id="38803" href="../Denotational/#38786" class="Bound">x</a>
<a id="38805" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="38813" class="Symbol">{</a><a id="38814" href="../Denotational/#38814" class="Bound">u₁₁</a> <a id="38818" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="38820" href="../Denotational/#38820" class="Bound">u₁₂</a><a id="38823" class="Symbol">}</a> <a id="38825" class="Symbol">{</a><a id="38826" href="../Denotational/#38826" class="Bound">u₂</a><a id="38828" class="Symbol">}</a> <a id="38830" class="Symbol">(</a><a id="38831" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="38840" href="../Denotational/#38840" class="Bound">lt1</a> <a id="38844" href="../Denotational/#38844" class="Bound">lt2</a><a id="38847" class="Symbol">)</a> <a id="38849" class="Symbol">{</a><a id="38850" href="../Denotational/#38850" class="Bound">v</a><a id="38851" class="Symbol">}</a> <a id="38853" class="Symbol">{</a><a id="38854" href="../Denotational/#38854" class="Bound">w</a><a id="38855" class="Symbol">}</a> <a id="38857" class="Symbol">(</a><a id="38858" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="38863" href="../Denotational/#38863" class="Bound">y</a><a id="38864" class="Symbol">)</a> <a id="38866" class="Symbol">=</a> <a id="38868" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="38876" href="../Denotational/#38844" class="Bound">lt2</a> <a id="38880" href="../Denotational/#38863" class="Bound">y</a>
<a id="38882" href="../Denotational/#38528" class="CatchallClause Function">sub-inv</a><a id="38889" class="CatchallClause"> </a><a id="38890" class="CatchallClause Symbol">{</a><a id="38891" href="../Denotational/#38891" class="CatchallClause Bound">u₁</a><a id="38893" class="CatchallClause Symbol">}</a><a id="38894" class="CatchallClause"> </a><a id="38895" class="CatchallClause Symbol">{</a><a id="38896" href="../Denotational/#38896" class="CatchallClause Bound">u₂₁</a><a id="38899" class="CatchallClause"> </a><a id="38900" href="../Denotational/#4129" class="CatchallClause InductiveConstructor Operator">⊔</a><a id="38901" class="CatchallClause"> </a><a id="38902" href="../Denotational/#38902" class="CatchallClause Bound">u₂₂</a><a id="38905" class="CatchallClause Symbol">}</a><a id="38906" class="CatchallClause"> </a><a id="38907" class="CatchallClause Symbol">(</a><a id="38908" href="../Denotational/#4568" class="CatchallClause InductiveConstructor">⊑-conj-R1</a><a id="38917" class="CatchallClause"> </a><a id="38918" href="../Denotational/#38918" class="CatchallClause Bound">lt</a><a id="38920" class="CatchallClause Symbol">)</a><a id="38921" class="CatchallClause"> </a><a id="38922" class="CatchallClause Symbol">{</a><a id="38923" href="../Denotational/#38923" class="CatchallClause Bound">v</a><a id="38924" class="CatchallClause Symbol">}</a><a id="38925" class="CatchallClause"> </a><a id="38926" class="CatchallClause Symbol">{</a><a id="38927" href="../Denotational/#38927" class="CatchallClause Bound">w</a><a id="38928" class="CatchallClause Symbol">}</a><a id="38929" class="CatchallClause"> </a><a id="38930" href="../Denotational/#38930" class="CatchallClause Bound">m</a>
    <a id="38936" class="Keyword">with</a> <a id="38941" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="38949" href="../Denotational/#38918" class="Bound">lt</a> <a id="38952" href="../Denotational/#38930" class="Bound">m</a>
<a id="38954" class="Symbol">...</a> <a id="38958" class="Symbol">|</a> <a id="38960" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="38962" href="../Denotational/#38962" class="Bound">u₃₁</a> <a id="38966" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="38968" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="38970" href="../Denotational/#38970" class="Bound">fu₃₁</a> <a id="38975" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="38977" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="38979" href="../Denotational/#38979" class="Bound">u₃₁⊆u₂₁</a> <a id="38987" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="38989" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="38991" href="../Denotational/#38991" class="Bound">domu₃₁⊑v</a> <a id="39000" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39002" href="../Denotational/#39002" class="Bound">w⊑codu₃₁</a> <a id="39011" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39013" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39015" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39017" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39019" class="Symbol">=</a>
      <a id="39027" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39029" href="../Denotational/#38962" class="Bound">u₃₁</a> <a id="39033" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39035" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39037" href="../Denotational/#38970" class="Bound">fu₃₁</a> <a id="39042" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39044" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39046" class="Symbol">(λ</a> <a id="39049" class="Symbol">{</a><a id="39050" href="../Denotational/#39050" class="Bound">w</a><a id="39051" class="Symbol">}</a> <a id="39053" href="../Denotational/#39053" class="Bound">z</a> <a id="39055" class="Symbol">→</a> <a id="39057" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="39062" class="Symbol">(</a><a id="39063" href="../Denotational/#38979" class="Bound">u₃₁⊆u₂₁</a> <a id="39071" href="../Denotational/#39053" class="Bound">z</a><a id="39072" class="Symbol">))</a> <a id="39075" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a>
                                   <a id="39112" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39114" href="../Denotational/#38991" class="Bound">domu₃₁⊑v</a> <a id="39123" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39125" href="../Denotational/#39002" class="Bound">w⊑codu₃₁</a> <a id="39134" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39136" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39138" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39140" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
<a id="39142" href="../Denotational/#38528" class="CatchallClause Function">sub-inv</a><a id="39149" class="CatchallClause"> </a><a id="39150" class="CatchallClause Symbol">{</a><a id="39151" href="../Denotational/#39151" class="CatchallClause Bound">u₁</a><a id="39153" class="CatchallClause Symbol">}</a><a id="39154" class="CatchallClause"> </a><a id="39155" class="CatchallClause Symbol">{</a><a id="39156" href="../Denotational/#39156" class="CatchallClause Bound">u₂₁</a><a id="39159" class="CatchallClause"> </a><a id="39160" href="../Denotational/#4129" class="CatchallClause InductiveConstructor Operator">⊔</a><a id="39161" class="CatchallClause"> </a><a id="39162" href="../Denotational/#39162" class="CatchallClause Bound">u₂₂</a><a id="39165" class="CatchallClause Symbol">}</a><a id="39166" class="CatchallClause"> </a><a id="39167" class="CatchallClause Symbol">(</a><a id="39168" href="../Denotational/#4641" class="CatchallClause InductiveConstructor">⊑-conj-R2</a><a id="39177" class="CatchallClause"> </a><a id="39178" href="../Denotational/#39178" class="CatchallClause Bound">lt</a><a id="39180" class="CatchallClause Symbol">)</a><a id="39181" class="CatchallClause"> </a><a id="39182" class="CatchallClause Symbol">{</a><a id="39183" href="../Denotational/#39183" class="CatchallClause Bound">v</a><a id="39184" class="CatchallClause Symbol">}</a><a id="39185" class="CatchallClause"> </a><a id="39186" class="CatchallClause Symbol">{</a><a id="39187" href="../Denotational/#39187" class="CatchallClause Bound">w</a><a id="39188" class="CatchallClause Symbol">}</a><a id="39189" class="CatchallClause"> </a><a id="39190" href="../Denotational/#39190" class="CatchallClause Bound">m</a>
    <a id="39196" class="Keyword">with</a> <a id="39201" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="39209" href="../Denotational/#39178" class="Bound">lt</a> <a id="39212" href="../Denotational/#39190" class="Bound">m</a>
<a id="39214" class="Symbol">...</a> <a id="39218" class="Symbol">|</a> <a id="39220" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39222" href="../Denotational/#39222" class="Bound">u₃₂</a> <a id="39226" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39228" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39230" href="../Denotational/#39230" class="Bound">fu₃₂</a> <a id="39235" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39237" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39239" href="../Denotational/#39239" class="Bound">u₃₂⊆u₂₂</a> <a id="39247" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39249" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39251" href="../Denotational/#39251" class="Bound">domu₃₂⊑v</a> <a id="39260" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39262" href="../Denotational/#39262" class="Bound">w⊑codu₃₂</a> <a id="39271" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39273" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39275" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39277" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39279" class="Symbol">=</a>
      <a id="39287" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39289" href="../Denotational/#39222" class="Bound">u₃₂</a> <a id="39293" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39295" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39297" href="../Denotational/#39230" class="Bound">fu₃₂</a> <a id="39302" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39304" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39306" class="Symbol">(λ</a> <a id="39309" class="Symbol">{</a><a id="39310" href="../Denotational/#39310" class="Bound">C</a><a id="39311" class="Symbol">}</a> <a id="39313" href="../Denotational/#39313" class="Bound">z</a> <a id="39315" class="Symbol">→</a> <a id="39317" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="39322" class="Symbol">(</a><a id="39323" href="../Denotational/#39239" class="Bound">u₃₂⊆u₂₂</a> <a id="39331" href="../Denotational/#39313" class="Bound">z</a><a id="39332" class="Symbol">))</a> <a id="39335" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a>
                                   <a id="39372" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39374" href="../Denotational/#39251" class="Bound">domu₃₂⊑v</a> <a id="39383" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39385" href="../Denotational/#39262" class="Bound">w⊑codu₃₂</a> <a id="39394" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39396" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39398" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39400" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
<a id="39402" href="../Denotational/#38528" class="CatchallClause Function">sub-inv</a><a id="39409" class="CatchallClause"> </a><a id="39410" class="CatchallClause Symbol">{</a><a id="39411" href="../Denotational/#39411" class="CatchallClause Bound">u₁</a><a id="39413" class="CatchallClause Symbol">}</a><a id="39414" class="CatchallClause"> </a><a id="39415" class="CatchallClause Symbol">{</a><a id="39416" href="../Denotational/#39416" class="CatchallClause Bound">u₂</a><a id="39418" class="CatchallClause Symbol">}</a><a id="39419" class="CatchallClause"> </a><a id="39420" class="CatchallClause Symbol">(</a><a id="39421" href="../Denotational/#4714" class="CatchallClause InductiveConstructor">⊑-trans</a><a id="39428" class="CatchallClause Symbol">{</a><a id="39429" class="CatchallClause Argument">v</a><a id="39430" class="CatchallClause"> </a><a id="39431" class="CatchallClause Symbol">=</a><a id="39432" class="CatchallClause"> </a><a id="39433" href="../Denotational/#39433" class="CatchallClause Bound">u</a><a id="39434" class="CatchallClause Symbol">}</a><a id="39435" class="CatchallClause"> </a><a id="39436" href="../Denotational/#39436" class="CatchallClause Bound">u₁⊑u</a><a id="39440" class="CatchallClause"> </a><a id="39441" href="../Denotational/#39441" class="CatchallClause Bound">u⊑u₂</a><a id="39445" class="CatchallClause Symbol">)</a><a id="39446" class="CatchallClause"> </a><a id="39447" class="CatchallClause Symbol">{</a><a id="39448" href="../Denotational/#39448" class="CatchallClause Bound">v</a><a id="39449" class="CatchallClause Symbol">}</a><a id="39450" class="CatchallClause"> </a><a id="39451" class="CatchallClause Symbol">{</a><a id="39452" href="../Denotational/#39452" class="CatchallClause Bound">w</a><a id="39453" class="CatchallClause Symbol">}</a><a id="39454" class="CatchallClause"> </a><a id="39455" href="../Denotational/#39455" class="CatchallClause Bound">v↦w∈u₁</a>
    <a id="39466" class="Keyword">with</a> <a id="39471" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="39479" href="../Denotational/#39436" class="Bound">u₁⊑u</a> <a id="39484" href="../Denotational/#39455" class="Bound">v↦w∈u₁</a>
<a id="39491" class="Symbol">...</a> <a id="39495" class="Symbol">|</a> <a id="39497" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39499" href="../Denotational/#39499" class="Bound">u′</a> <a id="39502" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39504" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39506" href="../Denotational/#39506" class="Bound">fu′</a> <a id="39510" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39512" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39514" href="../Denotational/#39514" class="Bound">u′⊆u</a> <a id="39519" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39521" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39523" href="../Denotational/#39523" class="Bound">domu′⊑v</a> <a id="39531" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39533" href="../Denotational/#39533" class="Bound">w⊑codu′</a> <a id="39541" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39543" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39545" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39547" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
    <a id="39553" class="Keyword">with</a> <a id="39558" href="../Denotational/#35990" class="Function">sub-inv-trans</a> <a id="39572" class="Symbol">{</a><a id="39573" href="../Denotational/#39499" class="Bound">u′</a><a id="39575" class="Symbol">}</a> <a id="39577" href="../Denotational/#39506" class="Bound">fu′</a> <a id="39581" href="../Denotational/#39514" class="Bound">u′⊆u</a> <a id="39586" class="Symbol">(</a><a id="39587" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="39595" class="Bound">u⊑u₂</a><a id="39599" class="Symbol">)</a>
<a id="39601" class="Symbol">...</a> <a id="39605" class="Symbol">|</a> <a id="39607" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39609" href="../Denotational/#39609" class="Bound">u₃</a> <a id="39612" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39614" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39616" href="../Denotational/#39616" class="Bound">fu₃</a> <a id="39620" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39622" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39624" href="../Denotational/#39624" class="Bound">u₃⊆u₂</a> <a id="39630" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39632" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39634" href="../Denotational/#39634" class="Bound">domu₃⊑domu′</a> <a id="39646" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39648" href="../Denotational/#39648" class="Bound">codu′⊑codu₃</a> <a id="39660" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39662" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39664" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39666" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39668" class="Symbol">=</a>
      <a id="39676" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39678" href="../Denotational/#39609" class="Bound">u₃</a> <a id="39681" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39683" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39685" href="../Denotational/#39616" class="Bound">fu₃</a> <a id="39689" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39691" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39693" href="../Denotational/#39624" class="Bound">u₃⊆u₂</a> <a id="39699" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39701" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39703" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="39711" href="../Denotational/#39634" class="Bound">domu₃⊑domu′</a> <a id="39723" class="Bound">domu′⊑v</a> <a id="39731" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a>
                                    <a id="39769" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="39777" class="Bound">w⊑codu′</a> <a id="39785" href="../Denotational/#39648" class="Bound">codu′⊑codu₃</a> <a id="39797" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39799" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39801" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39803" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
<a id="39805" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="39813" class="Symbol">{</a><a id="39814" href="../Denotational/#39814" class="Bound">u₁₁</a> <a id="39818" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="39820" href="../Denotational/#39820" class="Bound">u₁₂</a><a id="39823" class="Symbol">}</a> <a id="39825" class="Symbol">{</a><a id="39826" href="../Denotational/#39826" class="Bound">u₂₁</a> <a id="39830" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="39832" href="../Denotational/#39832" class="Bound">u₂₂</a><a id="39835" class="Symbol">}</a> <a id="39837" class="Symbol">(</a><a id="39838" href="../Denotational/#4785" class="InductiveConstructor">⊑-fun</a> <a id="39844" href="../Denotational/#39844" class="Bound">lt1</a> <a id="39848" href="../Denotational/#39848" class="Bound">lt2</a><a id="39851" class="Symbol">)</a> <a id="39853" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="39858" class="Symbol">=</a>
    <a id="39864" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39866" href="../Denotational/#39826" class="Bound">u₂₁</a> <a id="39870" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="39872" href="../Denotational/#39832" class="Bound">u₂₂</a> <a id="39876" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39878" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39880" class="Symbol">(λ</a> <a id="39883" class="Symbol">{</a><a id="39884" href="../Denotational/#39884" class="Bound">w</a><a id="39885" class="Symbol">}</a> <a id="39887" class="Symbol">→</a> <a id="39889" href="../Denotational/#31844" class="InductiveConstructor">fun</a><a id="39892" class="Symbol">)</a> <a id="39894" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39896" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39898" class="Symbol">(λ</a> <a id="39901" class="Symbol">{</a><a id="39902" href="../Denotational/#39902" class="Bound">C</a><a id="39903" class="Symbol">}</a> <a id="39905" href="../Denotational/#39905" class="Bound">z</a> <a id="39907" class="Symbol">→</a> <a id="39909" href="../Denotational/#39905" class="Bound">z</a><a id="39910" class="Symbol">)</a> <a id="39912" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39914" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="39916" href="../Denotational/#39844" class="Bound">lt1</a> <a id="39920" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="39922" href="../Denotational/#39848" class="Bound">lt2</a> <a id="39926" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39928" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39930" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="39932" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
<a id="39934" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="39942" class="Symbol">{</a><a id="39943" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="39947" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="39949" class="Symbol">(</a><a id="39950" href="../Denotational/#39950" class="Bound">u₂₂</a> <a id="39954" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="39956" href="../Denotational/#39956" class="Bound">u₂₃</a><a id="39959" class="Symbol">)}</a> <a id="39962" class="Symbol">{</a><a id="39963" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="39967" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="39969" href="../Denotational/#39950" class="Bound">u₂₂</a> <a id="39973" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="39975" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="39979" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="39981" href="../Denotational/#39956" class="Bound">u₂₃</a><a id="39984" class="Symbol">}</a> <a id="39986" href="../Denotational/#4888" class="InductiveConstructor">⊑-dist</a>
    <a id="39997" class="Symbol">{</a><a id="39998" class="DottedPattern Symbol">.</a><a id="39999" href="../Denotational/#39943" class="DottedPattern Bound">u₂₁</a><a id="40002" class="Symbol">}</a> <a id="40004" class="Symbol">{</a><a id="40005" class="DottedPattern Symbol">.(</a><a id="40007" href="../Denotational/#39950" class="DottedPattern Bound">u₂₂</a> <a id="40011" href="../Denotational/#4129" class="DottedPattern InductiveConstructor Operator">⊔</a> <a id="40013" href="../Denotational/#39956" class="DottedPattern Bound">u₂₃</a><a id="40016" class="DottedPattern Symbol">)</a><a id="40017" class="Symbol">}</a> <a id="40019" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="40024" class="Symbol">=</a>
    <a id="40030" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="40032" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="40036" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="40038" href="../Denotational/#39950" class="Bound">u₂₂</a> <a id="40042" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="40044" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="40048" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="40050" href="../Denotational/#39956" class="Bound">u₂₃</a> <a id="40054" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="40056" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="40058" href="../Denotational/#40118" class="Function">f</a> <a id="40060" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="40062" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="40064" href="../Denotational/#40217" class="Function">g</a> <a id="40066" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="40068" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="40070" href="../Denotational/#4484" class="InductiveConstructor">⊑-conj-L</a> <a id="40079" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="40086" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="40093" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="40095" href="../Denotational/#5554" class="Function">⊑-refl</a> <a id="40102" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="40104" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="40106" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="40108" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
  <a id="40112" class="Keyword">where</a> <a id="40118" href="../Denotational/#40118" class="Function">f</a> <a id="40120" class="Symbol">:</a> <a id="40122" href="../Denotational/#31882" class="Function">all-funs</a> <a id="40131" class="Symbol">(</a><a id="40132" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="40136" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="40138" href="../Denotational/#39950" class="Bound">u₂₂</a> <a id="40142" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="40144" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="40148" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="40150" href="../Denotational/#39956" class="Bound">u₂₃</a><a id="40153" class="Symbol">)</a>
        <a id="40163" href="../Denotational/#40118" class="Function">f</a> <a id="40165" class="Symbol">(</a><a id="40166" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="40171" href="../Denotational/#40171" class="Bound">x</a><a id="40172" class="Symbol">)</a> <a id="40174" class="Symbol">=</a> <a id="40176" href="../Denotational/#31844" class="InductiveConstructor">fun</a> <a id="40180" href="../Denotational/#40171" class="Bound">x</a>
        <a id="40190" href="../Denotational/#40118" class="Function">f</a> <a id="40192" class="Symbol">(</a><a id="40193" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="40198" href="../Denotational/#40198" class="Bound">y</a><a id="40199" class="Symbol">)</a> <a id="40201" class="Symbol">=</a> <a id="40203" href="../Denotational/#31844" class="InductiveConstructor">fun</a> <a id="40207" href="../Denotational/#40198" class="Bound">y</a>
        <a id="40217" href="../Denotational/#40217" class="Function">g</a> <a id="40219" class="Symbol">:</a> <a id="40221" class="Symbol">(</a><a id="40222" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="40226" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="40228" href="../Denotational/#39950" class="Bound">u₂₂</a> <a id="40232" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="40234" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="40238" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="40240" href="../Denotational/#39956" class="Bound">u₂₃</a><a id="40243" class="Symbol">)</a> <a id="40245" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="40247" class="Symbol">(</a><a id="40248" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="40252" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="40254" href="../Denotational/#39950" class="Bound">u₂₂</a> <a id="40258" href="../Denotational/#4129" class="InductiveConstructor Operator">⊔</a> <a id="40260" href="../Denotational/#39943" class="Bound">u₂₁</a> <a id="40264" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="40266" href="../Denotational/#39956" class="Bound">u₂₃</a><a id="40269" class="Symbol">)</a>
        <a id="40279" href="../Denotational/#40217" class="Function">g</a> <a id="40281" class="Symbol">(</a><a id="40282" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="40287" href="../Denotational/#40287" class="Bound">x</a><a id="40288" class="Symbol">)</a> <a id="40290" class="Symbol">=</a> <a id="40292" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a> <a id="40297" href="../Denotational/#40287" class="Bound">x</a>
        <a id="40307" href="../Denotational/#40217" class="Function">g</a> <a id="40309" class="Symbol">(</a><a id="40310" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="40315" href="../Denotational/#40315" class="Bound">y</a><a id="40316" class="Symbol">)</a> <a id="40318" class="Symbol">=</a> <a id="40320" href="https://agda.github.io/agda-stdlib/v1.3/Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a> <a id="40325" href="../Denotational/#40315" class="Bound">y</a>
</pre>
<p>Let <code>v</code> and <code>w</code> be arbitrary values.</p>
<ul>
<li><p>Case <code>⊑-bot</code>. So <code>u₁ ≡ ⊥</code>. We have <code>v ↦ w ∈ ⊥</code>, but that is impossible.</p></li>
<li><p>Case <code>⊑-conj-L</code>.</p>
<pre><code>  u₁₁ ⊑ u₂   u₁₂ ⊑ u₂
  -------------------
  u₁₁ ⊔ u₁₂ ⊑ u₂</code></pre>
<p>Given that <code>v ↦ w ∈ u₁₁ ⊔ u₁₂</code>, there are two subcases to consider.</p>
<ul>
<li><p>Subcase <code>v ↦ w ∈ u₁₁</code>. We conclude by the induction hypothesis for <code>u₁₁ ⊑ u₂</code>.</p></li>
<li><p>Subcase <code>v ↦ w ∈ u₁₂</code>. We conclude by the induction hypothesis for <code>u₁₂ ⊑ u₂</code>.</p></li>
</ul></li>
<li><p>Case <code>⊑-conj-R1</code>.</p>
<pre><code>  u₁ ⊑ u₂₁
  --------------
  u₁ ⊑ u₂₁ ⊔ u₂₂</code></pre>
<p>Given that <code>v ↦ w ∈ u₁</code>, the induction hypothesis for <code>u₁ ⊑ u₂₁</code> gives us that <code>v ↦ w</code> factors <code>u₂₁</code> into <code>u₃₁</code> for some <code>u₃₁</code>. To show that <code>v ↦ w</code> also factors <code>u₂₁ ⊔ u₂₂</code> into <code>u₃₁</code>, we just need to show that <code>u₃₁ ⊆ u₂₁ ⊔ u₂₂</code>, but that follows directly from <code>u₃₁ ⊆ u₂₁</code>.</p></li>
<li><p>Case <code>⊑-conj-R2</code>. This case follows by reasoning similar to the case for <code>⊑-conj-R1</code>.</p></li>
<li><p>Case <code>⊑-trans</code>.</p>
<pre><code>  u₁ ⊑ u   u ⊑ u₂
  ---------------
      u₁ ⊑ u₂</code></pre>
<p>By the induction hypothesis for <code>u₁ ⊑ u</code>, we know that <code>v ↦ w</code> factors <code>u</code> into <code>u′</code>, for some value <code>u′</code>, so we have <code>all-funs u′</code> and <code>u′ ⊆ u</code>. By the induction hypothesis for <code>u ⊑ u₂</code>, we know that for any <code>v′ ↦ w′ ∈ u</code>, <code>v′ ↦ w′</code> factors <code>u₂</code>. Now we apply the lemma sub-inv-trans, which gives us some <code>u₃</code> such that <code>(⨆dom u′) ↦ (⨆cod u′)</code> factors <code>u₂</code> into <code>u₃</code>. We show that <code>v ↦ w</code> also factors <code>u₂</code> into <code>u₃</code>. From <code>⨆dom u₃ ⊑ ⨆dom u′</code> and <code>⨆dom u′ ⊑ v</code>, we have <code>⨆dom u₃ ⊑ v</code>. From <code>w ⊑ ⨆cod u′</code> and <code>⨆cod u′ ⊑ ⨆cod u₃</code>, we have <code>w ⊑ ⨆cod u₃</code>, and this case is complete.</p></li>
<li><p>Case <code>⊑-fun</code>.</p>
<pre><code>  u₂₁ ⊑ u₁₁  u₁₂ ⊑ u₂₂
  ---------------------
  u₁₁ ↦ u₁₂ ⊑ u₂₁ ↦ u₂₂</code></pre>
<p>Given that <code>v ↦ w ∈ u₁₁ ↦ u₁₂</code>, we have <code>v ≡ u₁₁</code> and <code>w ≡ u₁₂</code>. We show that <code>u₁₁ ↦ u₁₂</code> factors <code>u₂₁ ↦ u₂₂</code> into itself. We need to show that <code>⨆dom (u₂₁ ↦ u₂₂) ⊑ u₁₁</code> and <code>u₁₂ ⊑ ⨆cod (u₂₁ ↦ u₂₂)</code>, but that is equivalent to our premises <code>u₂₁ ⊑ u₁₁</code> and <code>u₁₂ ⊑ u₂₂</code>.</p></li>
<li><p>Case <code>⊑-dist</code>.</p>
<pre><code>  ---------------------------------------------
  u₂₁ ↦ (u₂₂ ⊔ u₂₃) ⊑ (u₂₁ ↦ u₂₂) ⊔ (u₂₁ ↦ u₂₃)</code></pre>
<p>Given that <code>v ↦ w ∈ u₂₁ ↦ (u₂₂ ⊔ u₂₃)</code>, we have <code>v ≡ u₂₁</code> and <code>w ≡ u₂₂ ⊔ u₂₃</code>. We show that <code>u₂₁ ↦ (u₂₂ ⊔ u₂₃)</code> factors <code>(u₂₁ ↦ u₂₂) ⊔ (u₂₁ ↦ u₂₃)</code> into itself. We have <code>u₂₁ ⊔ u₂₁ ⊑ u₂₁</code>, and also <code>u₂₂ ⊔ u₂₃ ⊑ u₂₂ ⊔ u₂₃</code>, so the proof is complete.</p></li>
</ul>
<p>We conclude this section with two corollaries of the sub-inv lemma. First, we have the following property that is convenient to use in later proofs. We specialize the premise to just <code>v ↦ w ⊑ u₁</code> and we modify the conclusion to say that for every <code>v′ ↦ w′ ∈ u₂</code>, we have <code>v′ ⊑ v</code>.</p>
<pre class="Agda"><a id="sub-inv-fun"></a><a id="43001" href="../Denotational/#43001" class="Function">sub-inv-fun</a> <a id="43013" class="Symbol">:</a> <a id="43015" class="Symbol">∀{</a><a id="43017" href="../Denotational/#43017" class="Bound">v</a> <a id="43019" href="../Denotational/#43019" class="Bound">w</a> <a id="43021" href="../Denotational/#43021" class="Bound">u₁</a> <a id="43024" class="Symbol">:</a> <a id="43026" href="../Denotational/#4067" class="Datatype">Value</a><a id="43031" class="Symbol">}</a>
    <a id="43037" class="Symbol">→</a> <a id="43039" class="Symbol">(</a><a id="43040" href="../Denotational/#43017" class="Bound">v</a> <a id="43042" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="43044" href="../Denotational/#43019" class="Bound">w</a><a id="43045" class="Symbol">)</a> <a id="43047" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="43049" href="../Denotational/#43021" class="Bound">u₁</a>
      <a id="43058" class="Comment">-----------------------------------------------------</a>
    <a id="43116" class="Symbol">→</a> <a id="43118" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="43121" href="../Denotational/#43121" class="Bound">u₂</a> <a id="43124" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="43126" href="../Denotational/#4067" class="Datatype">Value</a> <a id="43132" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="43134" href="../Denotational/#31882" class="Function">all-funs</a> <a id="43143" href="../Denotational/#43121" class="Bound">u₂</a> <a id="43146" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="43148" href="../Denotational/#43121" class="Bound">u₂</a> <a id="43151" href="../Denotational/#30222" class="Function Operator">⊆</a> <a id="43153" href="../Denotational/#43021" class="Bound">u₁</a>
        <a id="43164" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="43166" class="Symbol">(∀{</a><a id="43169" href="../Denotational/#43169" class="Bound">v′</a> <a id="43172" href="../Denotational/#43172" class="Bound">w′</a><a id="43174" class="Symbol">}</a> <a id="43176" class="Symbol">→</a> <a id="43178" class="Symbol">(</a><a id="43179" href="../Denotational/#43169" class="Bound">v′</a> <a id="43182" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="43184" href="../Denotational/#43172" class="Bound">w′</a><a id="43186" class="Symbol">)</a> <a id="43188" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="43190" href="../Denotational/#43121" class="Bound">u₂</a> <a id="43193" class="Symbol">→</a> <a id="43195" href="../Denotational/#43169" class="Bound">v′</a> <a id="43198" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="43200" href="../Denotational/#43017" class="Bound">v</a><a id="43201" class="Symbol">)</a> <a id="43203" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="43205" href="../Denotational/#43019" class="Bound">w</a> <a id="43207" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="43209" href="../Denotational/#33082" class="Function">⨆cod</a> <a id="43214" href="../Denotational/#43121" class="Bound">u₂</a>
<a id="43217" href="../Denotational/#43001" class="Function">sub-inv-fun</a><a id="43228" class="Symbol">{</a><a id="43229" href="../Denotational/#43229" class="Bound">v</a><a id="43230" class="Symbol">}{</a><a id="43232" href="../Denotational/#43232" class="Bound">w</a><a id="43233" class="Symbol">}{</a><a id="43235" href="../Denotational/#43235" class="Bound">u₁</a><a id="43237" class="Symbol">}</a> <a id="43239" href="../Denotational/#43239" class="Bound">abc</a>
    <a id="43247" class="Keyword">with</a> <a id="43252" href="../Denotational/#38528" class="Function">sub-inv</a> <a id="43260" href="../Denotational/#43239" class="Bound">abc</a> <a id="43264" class="Symbol">{</a><a id="43265" href="../Denotational/#43229" class="Bound">v</a><a id="43266" class="Symbol">}{</a><a id="43268" href="../Denotational/#43232" class="Bound">w</a><a id="43269" class="Symbol">}</a> <a id="43271" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="43276" class="Symbol">...</a> <a id="43280" class="Symbol">|</a> <a id="43282" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43284" href="../Denotational/#43284" class="Bound">u₂</a> <a id="43287" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43289" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43291" href="../Denotational/#43291" class="Bound">f</a> <a id="43293" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43295" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43297" href="../Denotational/#43297" class="Bound">u₂⊆u₁</a> <a id="43303" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43305" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43307" href="../Denotational/#43307" class="Bound">db</a> <a id="43310" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43312" href="../Denotational/#43312" class="Bound">cc</a> <a id="43315" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43317" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43319" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43321" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43323" class="Symbol">=</a>
      <a id="43331" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43333" href="../Denotational/#43284" class="Bound">u₂</a> <a id="43336" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43338" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43340" href="../Denotational/#43291" class="Bound">f</a> <a id="43342" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43344" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43346" href="../Denotational/#43297" class="Bound">u₂⊆u₁</a> <a id="43352" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43354" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43356" href="../Denotational/#43380" class="Function">G</a> <a id="43358" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43360" href="../Denotational/#43312" class="Bound">cc</a> <a id="43363" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43365" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43367" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43369" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
   <a id="43374" class="Keyword">where</a> <a id="43380" href="../Denotational/#43380" class="Function">G</a> <a id="43382" class="Symbol">:</a> <a id="43384" class="Symbol">∀{</a><a id="43386" href="../Denotational/#43386" class="Bound">D</a> <a id="43388" href="../Denotational/#43388" class="Bound">E</a><a id="43389" class="Symbol">}</a> <a id="43391" class="Symbol">→</a> <a id="43393" class="Symbol">(</a><a id="43394" href="../Denotational/#43386" class="Bound">D</a> <a id="43396" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="43398" href="../Denotational/#43388" class="Bound">E</a><a id="43399" class="Symbol">)</a> <a id="43401" href="../Denotational/#29976" class="Function Operator">∈</a> <a id="43403" href="../Denotational/#43284" class="Bound">u₂</a> <a id="43406" class="Symbol">→</a> <a id="43408" href="../Denotational/#43386" class="Bound">D</a> <a id="43410" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="43412" class="Bound">v</a>
         <a id="43423" href="../Denotational/#43380" class="Function">G</a><a id="43424" class="Symbol">{</a><a id="43425" href="../Denotational/#43425" class="Bound">D</a><a id="43426" class="Symbol">}{</a><a id="43428" href="../Denotational/#43428" class="Bound">E</a><a id="43429" class="Symbol">}</a> <a id="43431" href="../Denotational/#43431" class="Bound">m</a> <a id="43433" class="Symbol">=</a> <a id="43435" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="43443" class="Symbol">(</a><a id="43444" href="../Denotational/#30693" class="Function">⊆→⊑</a> <a id="43448" class="Symbol">(</a><a id="43449" href="../Denotational/#33371" class="Function">↦∈→⊆⨆dom</a> <a id="43458" href="../Denotational/#43291" class="Bound">f</a> <a id="43460" href="../Denotational/#43431" class="Bound">m</a><a id="43461" class="Symbol">))</a> <a id="43464" href="../Denotational/#43307" class="Bound">db</a>
</pre>
<p>The second corollary is the inversion rule that one would expect for less-than with functions on the left and right-hand sides.</p>
<pre class="Agda"><a id="↦⊑↦-inv"></a><a id="43605" href="../Denotational/#43605" class="Function">↦⊑↦-inv</a> <a id="43613" class="Symbol">:</a> <a id="43615" class="Symbol">∀{</a><a id="43617" href="../Denotational/#43617" class="Bound">v</a> <a id="43619" href="../Denotational/#43619" class="Bound">w</a> <a id="43621" href="../Denotational/#43621" class="Bound">v′</a> <a id="43624" href="../Denotational/#43624" class="Bound">w′</a><a id="43626" class="Symbol">}</a>
        <a id="43636" class="Symbol">→</a> <a id="43638" href="../Denotational/#43617" class="Bound">v</a> <a id="43640" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="43642" href="../Denotational/#43619" class="Bound">w</a> <a id="43644" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="43646" href="../Denotational/#43621" class="Bound">v′</a> <a id="43649" href="../Denotational/#4099" class="InductiveConstructor Operator">↦</a> <a id="43651" href="../Denotational/#43624" class="Bound">w′</a>
          <a id="43664" class="Comment">-----------------</a>
        <a id="43690" class="Symbol">→</a> <a id="43692" href="../Denotational/#43621" class="Bound">v′</a> <a id="43695" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="43697" href="../Denotational/#43617" class="Bound">v</a> <a id="43699" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="43701" href="../Denotational/#43619" class="Bound">w</a> <a id="43703" href="../Denotational/#4424" class="Datatype Operator">⊑</a> <a id="43705" href="../Denotational/#43624" class="Bound">w′</a>
<a id="43708" href="../Denotational/#43605" class="Function">↦⊑↦-inv</a><a id="43715" class="Symbol">{</a><a id="43716" href="../Denotational/#43716" class="Bound">v</a><a id="43717" class="Symbol">}{</a><a id="43719" href="../Denotational/#43719" class="Bound">w</a><a id="43720" class="Symbol">}{</a><a id="43722" href="../Denotational/#43722" class="Bound">v′</a><a id="43724" class="Symbol">}{</a><a id="43726" href="../Denotational/#43726" class="Bound">w′</a><a id="43728" class="Symbol">}</a> <a id="43730" href="../Denotational/#43730" class="Bound">lt</a>
    <a id="43737" class="Keyword">with</a> <a id="43742" href="../Denotational/#43001" class="Function">sub-inv-fun</a> <a id="43754" href="../Denotational/#43730" class="Bound">lt</a>
<a id="43757" class="Symbol">...</a> <a id="43761" class="Symbol">|</a> <a id="43763" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43765" href="../Denotational/#43765" class="Bound">Γ</a> <a id="43767" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43769" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43771" href="../Denotational/#43771" class="Bound">f</a> <a id="43773" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43775" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43777" href="../Denotational/#43777" class="Bound">Γ⊆v34</a> <a id="43783" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43785" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43787" href="../Denotational/#43787" class="Bound">lt1</a> <a id="43791" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43793" href="../Denotational/#43793" class="Bound">lt2</a> <a id="43797" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43799" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43801" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43803" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
    <a id="43809" class="Keyword">with</a> <a id="43814" href="../Denotational/#32192" class="Function">all-funs∈</a> <a id="43824" href="../Denotational/#43771" class="Bound">f</a>
<a id="43826" class="Symbol">...</a> <a id="43830" class="Symbol">|</a> <a id="43832" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43834" href="../Denotational/#43834" class="Bound">u</a> <a id="43836" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43838" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43840" href="../Denotational/#43840" class="Bound">u′</a> <a id="43843" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43845" href="../Denotational/#43845" class="Bound">u↦u′∈Γ</a> <a id="43852" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a> <a id="43854" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
    <a id="43860" class="Keyword">with</a> <a id="43865" class="Bound">Γ⊆v34</a> <a id="43871" href="../Denotational/#43845" class="Bound">u↦u′∈Γ</a>
<a id="43878" class="Symbol">...</a> <a id="43882" class="Symbol">|</a> <a id="43884" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="43889" class="Symbol">=</a>
  <a id="43893" class="Keyword">let</a> <a id="43897" href="../Denotational/#43897" class="Bound">⨆codΓ⊆w′</a> <a id="43906" class="Symbol">=</a> <a id="43908" href="../Denotational/#33943" class="Function">⊆↦→⨆cod⊆</a> <a id="43917" class="Bound">Γ⊆v34</a> <a id="43923" class="Keyword">in</a>
  <a id="43928" href="../Denotational/#2827" class="InductiveConstructor Operator">⟨</a> <a id="43930" class="Bound">lt1</a> <a id="43934" class="Bound">u↦u′∈Γ</a> <a id="43941" href="../Denotational/#2827" class="InductiveConstructor Operator">,</a> <a id="43943" href="../Denotational/#4714" class="InductiveConstructor">⊑-trans</a> <a id="43951" class="Bound">lt2</a> <a id="43955" class="Symbol">(</a><a id="43956" href="../Denotational/#30693" class="Function">⊆→⊑</a> <a id="43960" href="../Denotational/#43897" class="Bound">⨆codΓ⊆w′</a><a id="43968" class="Symbol">)</a> <a id="43970" href="../Denotational/#2827" class="InductiveConstructor Operator">⟩</a>
</pre>
<h2 id="notes">Notes</h2>
<p>The denotational semantics presented in this chapter is an example of a <em>filter model</em> (Barendregt, Coppo, Dezani-Ciancaglini, 1983). Filter models use type systems with intersection types to precisely characterize runtime behavior (Coppo, Dezani-Ciancaglini, and Salle, 1979). The notation that we use in this chapter is not that of type systems and intersection types, but the <code>Value</code> data type is isomorphic to types (<code>↦</code> is <code>→</code>, <code>⊔</code> is <code>∧</code>, <code>⊥</code> is <code>⊤</code>), the <code>⊑</code> relation is the inverse of subtyping <code>&lt;:</code>, and the evaluation relation <code>ρ ⊢ M ↓ v</code> is isomorphic to a type system. Write <code>Γ</code> instead of <code>ρ</code>, <code>A</code> instead of <code>v</code>, and replace <code>↓</code> with <code>:</code> and one has a typing judgement <code>Γ ⊢ M : A</code>. By varying the definition of subtyping and using different choices of type atoms, intersection type systems provide semantics for many different untyped λ calculi, from full beta to the lazy and call-by-value calculi (Alessi, Barbanera, and Dezani-Ciancaglini, 2006) (Rocca and Paolini, 2004). The denotational semantics in this chapter corresponds to the BCD system (Barendregt, Coppo, Dezani-Ciancaglini, 1983). Part 3 of the book <em>Lambda Calculus with Types</em> describes a framework for intersection type systems that enables results similar to the ones in this chapter, but for the entire family of intersection type systems (Barendregt, Dekkers, and Statman, 2013).</p>
<p>The two ideas of using finite tables to represent functions and of relaxing table lookup to enable self application first appeared in a technical report by Gordon Plotkin (1972) and are later described in an article in Theoretical Computer Science (Plotkin 1993). In that work, the inductive definition of <code>Value</code> is a bit different than the one we use:</p>
<pre><code>Value = C + ℘f(Value) × ℘f(Value)</code></pre>
<p>where <code>C</code> is a set of constants and <code>℘f</code> means finite powerset. The pairs in <code>℘f(Value) × ℘f(Value)</code> represent input-output mappings, just as in this chapter. The finite powersets are used to enable a function table to appear in the input and in the output. These differences amount to changing where the recursion appears in the definition of <code>Value</code>. Plotkin’s model is an example of a <em>graph model</em> of the untyped lambda calculus (Barendregt, 1984). In a graph model, the semantics is presented as a function from programs and environments to (possibly infinite) sets of values. The semantics in this chapter is instead defined as a relation, but set-valued functions are isomorphic to relations. Indeed, we present the semantics as a function in the next chapter and prove that it is equivalent to the relational version.</p>
<p>Dana Scott’s ℘(ω) (1976) and Engeler’s B(A) (1981) are two more examples of graph models. Both use the following inductive definition of <code>Value</code>.</p>
<pre><code>Value = C + ℘f(Value) × Value</code></pre>
<p>The use of <code>Value</code> instead of <code>℘f(Value)</code> in the output does not restrict expressiveness compared to Plotkin’s model because the semantics use sets of values and a pair of sets <code>(V, V′)</code> can be represented as a set of pairs <code>{ (V, v′) | v′ ∈ V′ }</code>. In Scott’s ℘(ω), the above values are mapped to and from the natural numbers using a kind of Godel encoding.</p>
<h2 id="references">References</h2>
<ul>
<li><p>Intersection Types and Lambda Models. Fabio Alessi, Franco Barbanera, and Mariangiola Dezani-Ciancaglini, Theoretical Compututer Science, vol. 355, pages 108-126, 2006.</p></li>
<li><p>The Lambda Calculus. H.P. Barendregt, 1984.</p></li>
<li><p>A filter lambda model and the completeness of type assignment. Henk Barendregt, Mario Coppo, and Mariangiola Dezani-Ciancaglini, Journal of Symbolic Logic, vol. 48, pages 931-940, 1983.</p></li>
<li><p>Lambda Calculus with Types. Henk Barendregt, Wil Dekkers, and Richard Statman, Cambridge University Press, Perspectives in Logic,</p>
<ol>
<li></li>
</ol></li>
<li><p>Functional characterization of some semantic equalities inside λ-calculus. Mario Coppo, Mariangiola Dezani-Ciancaglini, and Patrick Salle, in Sixth Colloquium on Automata, Languages and Programming. Springer, pages 133–146, 1979.</p></li>
<li><p>Algebras and combinators. Erwin Engeler, Algebra Universalis, vol. 13, pages 389-392, 1981.</p></li>
<li><p>A Set-Theoretical Definition of Application. Gordon D. Plotkin, University of Edinburgh, Technical Report MIP-R-95, 1972.</p></li>
<li><p>Set-theoretical and other elementary models of the λ-calculus. Gordon D. Plotkin, Theoretical Computer Science, vol. 121, pages 351-409, 1993.</p></li>
<li><p>The Parametric Lambda Calculus. Simona Ronchi Della Rocca and Luca Paolini, Springer, 2004.</p></li>
<li><p>Data Types as Lattices. Dana Scott, SIAM Journal on Computing, vol. 5, pages 522-587, 1976.</p></li>
</ul>
<h2 id="unicode">Unicode</h2>
<p>This chapter uses the following unicode:</p>
<pre><code>⊥  U+22A5  UP TACK (\bot)
↦  U+21A6  RIGHTWARDS ARROW FROM BAR (\mapsto)
⊔  U+2294  SQUARE CUP (\lub)
⊑  U+2291  SQUARE IMAGE OF OR EQUAL TO (\sqsubseteq)
⨆ U+2A06  N-ARY SQUARE UNION OPERATOR (\Lub)
⊢  U+22A2  RIGHT TACK (\|- or \vdash)
↓  U+2193  DOWNWARDS ARROW (\d)
ᶜ  U+1D9C  MODIFIER LETTER SMALL C (\^c)
ℰ  U+2130  SCRIPT CAPITAL E (\McE)
≃  U+2243  ASYMPTOTICALLY EQUAL TO (\~- or \simeq)
∈  U+2208  ELEMENT OF (\in)
⊆  U+2286  SUBSET OF OR EQUAL TO (\sub= or \subseteq)</code></pre>
    </div>
    <nav class="pager">
    <ul class="pagination">
        
        <li><a class="pagelink" href="../BigStep/">上一章</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/part3/Denotational.lagda.md">源文件</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="../Compositional/">下一章</a></li>
        <li class="separator">&bullet;</li>
        
    </ul>
</nav>

</article>

            </div>
        </main>
        <footer class="site-footer h-card">
    <data class="u-url" href="../"></data>
    <div class="wrapper">
        <h2 class="footer-heading">编程语言基础：Agda 语言描述</h2>
        
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Philip Wadler</li>
                    <li>
                        
                        <a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/wadler" title="wadler"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;wadler</a></li>
    
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Wen Kokke</li>
                    <li>
                        
                        <a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/wenkokke" title="wenkokke"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;wenkokke</a></li>
    
    
    <li><a rel="me" href="https://twitter.com/wenkokke" title="wenkokke"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#twitter"></use></svg>&nbsp;wenkokke</a></li>
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Jeremy G. Siek</li>
                    <li>
                        
                        <a class="u-email" href="mailto:jsiek@indiana.edu">jsiek@indiana.edu</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/jsiek" title="jsiek"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;jsiek</a></li>
    
    
    <li><a rel="me" href="https://twitter.com/jeremysiek" title="jeremysiek"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#twitter"></use></svg>&nbsp;jeremysiek</a></li>
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        
        This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
    </div>
</footer>

    </body>
</html>
