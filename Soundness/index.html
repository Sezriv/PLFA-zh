<!DOCTYPE html>
<html lang="en">
    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../public/css/style.css">
  
  <title>编程语言基础：Agda 语言描述 – Soundness</title>
  
  
  
</head>

    <body>
        <header class="site-header">
    <div class="wrapper">
        <a class="site-title" href="../">编程语言基础：Agda 语言描述</a>
        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="../">主页</a>
                <a class="page-link" href="../Announcements/">公告</a>
                <a class="page-link" href="../GettingStarted/">使用说明</a>
                <a class="page-link" href="../Citing/">引用</a>
                <a class="page-link" href="https://plfa.github.io/">English</a>
            </div>
        </nav>
    </div>
</header>

        <main class="page-content" aria-label="Content">
            <div class="wrapper">
                <article class="post">
    <nav class="pager">
    <ul class="pagination">
        
        <li><a class="pagelink" href="../Compositional/">上一章</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/part3/Soundness.lagda.md">源文件</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="../Adequacy/">下一章</a></li>
        <li class="separator">&bullet;</li>
        
    </ul>
</nav>

    <header class="post-header">
        <h1 class="post-title" id="soundness">Soundness: Soundness of reduction with respect to denotational semantics</h1>
    </header>
    <div class="post-content">
        <pre class="Agda"><a id="193" class="Keyword">module</a> <a id="200" href="../Soundness/" class="Module">plfa.part3.Soundness</a> <a id="221" class="Keyword">where</a>
</pre>
<h2 id="introduction">Introduction</h2>
<p>In this chapter we prove that the reduction semantics is sound with respect to the denotational semantics, i.e., for any term L</p>
<pre><code>L —↠ ƛ N  implies  ℰ L ≃ ℰ (ƛ N)</code></pre>
<p>The proof is by induction on the reduction sequence, so the main lemma concerns a single reduction step. We prove that if any term <code>M</code> steps to a term <code>N</code>, then <code>M</code> and <code>N</code> are denotationally equal. We shall prove each direction of this if-and-only-if separately. One direction will look just like a type preservation proof. The other direction is like proving type preservation for reduction going in reverse. Recall that type preservation is sometimes called subject reduction. Preservation in reverse is a well-known property and is called <em>subject expansion</em>. It is also well-known that subject expansion is false for most typed lambda calculi!</p>
<h2 id="imports">Imports</h2>
<pre class="Agda"><a id="1085" class="Keyword">open</a> <a id="1090" class="Keyword">import</a> <a id="1097" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="1137" class="Keyword">using</a> <a id="1143" class="Symbol">(</a><a id="1144" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="1147" class="Symbol">;</a> <a id="1149" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#840" class="Function Operator">_≢_</a><a id="1152" class="Symbol">;</a> <a id="1154" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="1158" class="Symbol">;</a> <a id="1160" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a><a id="1163" class="Symbol">;</a> <a id="1165" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#1131" class="Function">cong</a><a id="1169" class="Symbol">;</a> <a id="1171" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.html#1524" class="Function">cong₂</a><a id="1176" class="Symbol">;</a> <a id="1178" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.html#1396" class="Function">cong-app</a><a id="1186" class="Symbol">)</a>
<a id="1188" class="Keyword">open</a> <a id="1193" class="Keyword">import</a> <a id="1200" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html" class="Module">Data.Product</a> <a id="1213" class="Keyword">using</a> <a id="1219" class="Symbol">(</a><a id="1220" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">_×_</a><a id="1223" class="Symbol">;</a> <a id="1225" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#166" class="Record">Σ</a><a id="1226" class="Symbol">;</a> <a id="1228" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ-syntax</a><a id="1236" class="Symbol">;</a> <a id="1238" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1369" class="Function">∃</a><a id="1239" class="Symbol">;</a> <a id="1241" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1788" class="Function">∃-syntax</a><a id="1249" class="Symbol">;</a> <a id="1251" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#252" class="Field">proj₁</a><a id="1256" class="Symbol">;</a> <a id="1258" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#264" class="Field">proj₂</a><a id="1263" class="Symbol">)</a>
  <a id="1267" class="Keyword">renaming</a> <a id="1276" class="Symbol">(</a><a id="1277" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="1281" class="Symbol">to</a> <a id="_,_"></a><a id="1284" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="1289" class="Symbol">)</a>
<a id="1291" class="Keyword">open</a> <a id="1296" class="Keyword">import</a> <a id="1303" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="1318" class="Keyword">using</a> <a id="1324" class="Symbol">(</a><a id="1325" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Primitive.html#590" class="Primitive">lzero</a><a id="1330" class="Symbol">)</a>
<a id="1332" class="Keyword">open</a> <a id="1337" class="Keyword">import</a> <a id="1344" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1361" class="Keyword">using</a> <a id="1367" class="Symbol">(</a><a id="1368" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#653" class="Function Operator">¬_</a><a id="1370" class="Symbol">)</a>
<a id="1372" class="Keyword">open</a> <a id="1377" class="Keyword">import</a> <a id="1384" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="1410" class="Keyword">using</a> <a id="1416" class="Symbol">(</a><a id="1417" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.Negation.html#858" class="Function">contradiction</a><a id="1430" class="Symbol">)</a>
<a id="1432" class="Keyword">open</a> <a id="1437" class="Keyword">import</a> <a id="1444" href="https://agda.github.io/agda-stdlib/v1.3/Data.Empty.html" class="Module">Data.Empty</a> <a id="1455" class="Keyword">using</a> <a id="1461" class="Symbol">(</a><a id="1462" href="https://agda.github.io/agda-stdlib/v1.3/Data.Empty.html#628" class="Function">⊥-elim</a><a id="1468" class="Symbol">)</a>
<a id="1470" class="Keyword">open</a> <a id="1475" class="Keyword">import</a> <a id="1482" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1499" class="Keyword">using</a> <a id="1505" class="Symbol">(</a><a id="1506" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1508" class="Record">Dec</a><a id="1509" class="Symbol">;</a> <a id="1511" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1645" class="InductiveConstructor">yes</a><a id="1514" class="Symbol">;</a> <a id="1516" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1682" class="InductiveConstructor">no</a><a id="1518" class="Symbol">)</a>
<a id="1520" class="Keyword">open</a> <a id="1525" class="Keyword">import</a> <a id="1532" href="https://agda.github.io/agda-stdlib/v1.3/Function.html" class="Module">Function</a> <a id="1541" class="Keyword">using</a> <a id="1547" class="Symbol">(</a><a id="1548" href="https://agda.github.io/agda-stdlib/v1.3/Function.Base.html#992" class="Function Operator">_∘_</a><a id="1551" class="Symbol">)</a>
<a id="1553" class="Keyword">open</a> <a id="1558" class="Keyword">import</a> <a id="1565" href="../Untyped/" class="Module">plfa.part2.Untyped</a>
     <a id="1589" class="Keyword">using</a> <a id="1595" class="Symbol">(</a><a id="1596" href="../Untyped/#3135" class="Datatype">Context</a><a id="1603" class="Symbol">;</a> <a id="1605" href="../Untyped/#3173" class="InductiveConstructor Operator">_,_</a><a id="1608" class="Symbol">;</a> <a id="1610" href="../Untyped/#3503" class="Datatype Operator">_∋_</a><a id="1613" class="Symbol">;</a> <a id="1615" href="../Untyped/#4276" class="Datatype Operator">_⊢_</a><a id="1618" class="Symbol">;</a> <a id="1620" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="1621" class="Symbol">;</a> <a id="1623" href="../Untyped/#3539" class="InductiveConstructor">Z</a><a id="1624" class="Symbol">;</a> <a id="1626" href="../Untyped/#3584" class="InductiveConstructor Operator">S_</a><a id="1628" class="Symbol">;</a> <a id="1630" href="../Untyped/#4312" class="InductiveConstructor Operator">`_</a><a id="1632" class="Symbol">;</a> <a id="1634" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ_</a><a id="1636" class="Symbol">;</a> <a id="1638" href="../Untyped/#4424" class="InductiveConstructor Operator">_·_</a><a id="1641" class="Symbol">;</a>
            <a id="1655" href="../Untyped/#6945" class="Function">subst</a><a id="1660" class="Symbol">;</a> <a id="1662" href="../Untyped/#7473" class="Function Operator">_[_]</a><a id="1666" class="Symbol">;</a> <a id="1668" href="../Untyped/#7357" class="Function">subst-zero</a><a id="1678" class="Symbol">;</a> <a id="1680" href="../Untyped/#5907" class="Function">ext</a><a id="1683" class="Symbol">;</a> <a id="1685" href="../Untyped/#6217" class="Function">rename</a><a id="1691" class="Symbol">;</a> <a id="1693" href="../Untyped/#6653" class="Function">exts</a><a id="1697" class="Symbol">;</a>
            <a id="1711" href="../Untyped/#9930" class="Datatype Operator">_—→_</a><a id="1715" class="Symbol">;</a> <a id="1717" href="../Untyped/#9980" class="InductiveConstructor">ξ₁</a><a id="1719" class="Symbol">;</a> <a id="1721" href="../Untyped/#10070" class="InductiveConstructor">ξ₂</a><a id="1723" class="Symbol">;</a> <a id="1725" href="../Untyped/#10160" class="InductiveConstructor">β</a><a id="1726" class="Symbol">;</a> <a id="1728" href="../Untyped/#10268" class="InductiveConstructor">ζ</a><a id="1729" class="Symbol">;</a> <a id="1731" href="../Untyped/#11050" class="Datatype Operator">_—↠_</a><a id="1735" class="Symbol">;</a> <a id="1737" href="../Untyped/#11156" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="1744" class="Symbol">;</a> <a id="1746" href="../Untyped/#11100" class="InductiveConstructor Operator">_∎</a><a id="1748" class="Symbol">)</a>
<a id="1750" class="Keyword">open</a> <a id="1755" class="Keyword">import</a> <a id="1762" href="../Substitution/" class="Module">plfa.part2.Substitution</a> <a id="1786" class="Keyword">using</a> <a id="1792" class="Symbol">(</a><a id="1793" href="../Substitution/#2192" class="Function">Rename</a><a id="1799" class="Symbol">;</a> <a id="1801" href="../Substitution/#2405" class="Function">Subst</a><a id="1806" class="Symbol">;</a> <a id="1808" href="../Substitution/#3052" class="Function">ids</a><a id="1811" class="Symbol">)</a>
<a id="1813" class="Keyword">open</a> <a id="1818" class="Keyword">import</a> <a id="1825" href="../Denotational/" class="Module">plfa.part3.Denotational</a>
     <a id="1854" class="Keyword">using</a> <a id="1860" class="Symbol">(</a><a id="1861" href="../Denotational/#4029" class="Datatype">Value</a><a id="1866" class="Symbol">;</a> <a id="1868" href="../Denotational/#4049" class="InductiveConstructor">⊥</a><a id="1869" class="Symbol">;</a> <a id="1871" href="../Denotational/#7166" class="Function">Env</a><a id="1874" class="Symbol">;</a> <a id="1876" href="../Denotational/#9224" class="Datatype Operator">_⊢_↓_</a><a id="1881" class="Symbol">;</a> <a id="1883" href="../Denotational/#7323" class="Function Operator">_`,_</a><a id="1887" class="Symbol">;</a> <a id="1889" href="../Denotational/#4386" class="Datatype Operator">_⊑_</a><a id="1892" class="Symbol">;</a> <a id="1894" href="../Denotational/#7986" class="Function Operator">_`⊑_</a><a id="1898" class="Symbol">;</a> <a id="1900" href="../Denotational/#8189" class="Function">`⊥</a><a id="1902" class="Symbol">;</a> <a id="1904" href="../Denotational/#8218" class="Function Operator">_`⊔_</a><a id="1908" class="Symbol">;</a> <a id="1910" href="../Denotational/#7564" class="Function">init</a><a id="1914" class="Symbol">;</a> <a id="1916" href="../Denotational/#7619" class="Function">last</a><a id="1920" class="Symbol">;</a> <a id="1922" href="../Denotational/#7668" class="Function">init-last</a><a id="1931" class="Symbol">;</a>
            <a id="1945" href="../Denotational/#5516" class="Function">⊑-refl</a><a id="1951" class="Symbol">;</a> <a id="1953" href="../Denotational/#4676" class="InductiveConstructor">⊑-trans</a><a id="1960" class="Symbol">;</a> <a id="1962" href="../Denotational/#8477" class="Function">`⊑-refl</a><a id="1969" class="Symbol">;</a> <a id="1971" href="../Denotational/#25590" class="Function">⊑-env</a><a id="1976" class="Symbol">;</a> <a id="1978" href="../Denotational/#8548" class="Function">⊑-env-conj-R1</a><a id="1991" class="Symbol">;</a> <a id="1993" href="../Denotational/#8654" class="Function">⊑-env-conj-R2</a><a id="2006" class="Symbol">;</a> <a id="2008" href="../Denotational/#26035" class="Function">up-env</a><a id="2014" class="Symbol">;</a>
            <a id="2028" href="../Denotational/#9278" class="InductiveConstructor">var</a><a id="2031" class="Symbol">;</a> <a id="2033" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a><a id="2039" class="Symbol">;</a> <a id="2041" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a><a id="2048" class="Symbol">;</a> <a id="2050" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a><a id="2057" class="Symbol">;</a> <a id="2059" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a><a id="2066" class="Symbol">;</a> <a id="2068" href="../Denotational/#9769" class="InductiveConstructor">sub</a><a id="2071" class="Symbol">;</a>
            <a id="2085" href="../Denotational/#24021" class="Function">rename-pres</a><a id="2096" class="Symbol">;</a> <a id="2098" href="../Denotational/#17364" class="Function">ℰ</a><a id="2099" class="Symbol">;</a> <a id="2101" href="../Denotational/#17546" class="Function Operator">_≃_</a><a id="2104" class="Symbol">;</a> <a id="2106" href="../Denotational/#17951" class="Function">≃-trans</a><a id="2113" class="Symbol">)</a>
<a id="2115" class="Keyword">open</a> <a id="2120" class="Keyword">import</a> <a id="2127" href="../Compositional/" class="Module">plfa.part3.Compositional</a> <a id="2152" class="Keyword">using</a> <a id="2158" class="Symbol">(</a><a id="2159" href="../Compositional/#3840" class="Function">lambda-inversion</a><a id="2175" class="Symbol">;</a> <a id="2177" href="../Compositional/#10011" class="Function">var-inv</a><a id="2184" class="Symbol">)</a>
</pre>
<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>
<p>The proof of preservation in this section mixes techniques from previous chapters. Like the proof of preservation for the STLC, we are preserving a relation defined separately from the syntax, in contrast to the intrinsically-typed terms. On the other hand, we are using de Bruijn indices for variables.</p>
<p>The outline of the proof remains the same in that we must prove lemmas concerning all of the auxiliary functions used in the reduction relation: substitution, renaming, and extension.</p>
<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>
<p>Our next goal is to prove that simultaneous substitution preserves meaning. That is, if <code>M</code> results in <code>v</code> in environment <code>γ</code>, then applying a substitution <code>σ</code> to <code>M</code> gives us a program that also results in <code>v</code>, but in an environment <code>δ</code> in which, for every variable <code>x</code>, <code>σ x</code> results in the same value as the one for <code>x</code> in the original environment <code>γ</code>. We write <code>δ ⊢ σ ↓ γ</code> for this condition.</p>
<pre class="Agda"><a id="3182" class="Keyword">infix</a> <a id="3188" class="Number">3</a> <a id="3190" href="../Soundness/#3197" class="Function Operator">_`⊢_↓_</a>
<a id="_`⊢_↓_"></a><a id="3197" href="../Soundness/#3197" class="Function Operator">_`⊢_↓_</a> <a id="3204" class="Symbol">:</a> <a id="3206" class="Symbol">∀{</a><a id="3208" href="../Soundness/#3208" class="Bound">Δ</a> <a id="3210" href="../Soundness/#3210" class="Bound">Γ</a><a id="3211" class="Symbol">}</a> <a id="3213" class="Symbol">→</a> <a id="3215" href="../Denotational/#7166" class="Function">Env</a> <a id="3219" href="../Soundness/#3208" class="Bound">Δ</a> <a id="3221" class="Symbol">→</a> <a id="3223" href="../Substitution/#2405" class="Function">Subst</a> <a id="3229" href="../Soundness/#3210" class="Bound">Γ</a> <a id="3231" href="../Soundness/#3208" class="Bound">Δ</a> <a id="3233" class="Symbol">→</a> <a id="3235" href="../Denotational/#7166" class="Function">Env</a> <a id="3239" href="../Soundness/#3210" class="Bound">Γ</a> <a id="3241" class="Symbol">→</a> <a id="3243" class="PrimitiveType">Set</a>
<a id="3247" href="../Soundness/#3197" class="Function Operator">_`⊢_↓_</a> <a id="3254" class="Symbol">{</a><a id="3255" href="../Soundness/#3255" class="Bound">Δ</a><a id="3256" class="Symbol">}{</a><a id="3258" href="../Soundness/#3258" class="Bound">Γ</a><a id="3259" class="Symbol">}</a> <a id="3261" href="../Soundness/#3261" class="Bound">δ</a> <a id="3263" href="../Soundness/#3263" class="Bound">σ</a> <a id="3265" href="../Soundness/#3265" class="Bound">γ</a> <a id="3267" class="Symbol">=</a> <a id="3269" class="Symbol">(∀</a> <a id="3272" class="Symbol">(</a><a id="3273" href="../Soundness/#3273" class="Bound">x</a> <a id="3275" class="Symbol">:</a> <a id="3277" href="../Soundness/#3258" class="Bound">Γ</a> <a id="3279" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="3281" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="3282" class="Symbol">)</a> <a id="3284" class="Symbol">→</a> <a id="3286" href="../Soundness/#3261" class="Bound">δ</a> <a id="3288" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="3290" href="../Soundness/#3263" class="Bound">σ</a> <a id="3292" href="../Soundness/#3273" class="Bound">x</a> <a id="3294" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="3296" href="../Soundness/#3265" class="Bound">γ</a> <a id="3298" href="../Soundness/#3273" class="Bound">x</a><a id="3299" class="Symbol">)</a>
</pre>
<p>As usual, to prepare for lambda abstraction, we prove an extension lemma. It says that applying the <code>exts</code> function to a substitution produces a new substitution that maps variables to terms that when evaluated in <code>δ , v</code> produce the values in <code>γ , v</code>.</p>
<pre class="Agda"><a id="subst-ext"></a><a id="3564" href="../Soundness/#3564" class="Function">subst-ext</a> <a id="3574" class="Symbol">:</a> <a id="3576" class="Symbol">∀</a> <a id="3578" class="Symbol">{</a><a id="3579" href="../Soundness/#3579" class="Bound">Γ</a> <a id="3581" href="../Soundness/#3581" class="Bound">Δ</a> <a id="3583" href="../Soundness/#3583" class="Bound">v</a><a id="3584" class="Symbol">}</a> <a id="3586" class="Symbol">{</a><a id="3587" href="../Soundness/#3587" class="Bound">γ</a> <a id="3589" class="Symbol">:</a> <a id="3591" href="../Denotational/#7166" class="Function">Env</a> <a id="3595" href="../Soundness/#3579" class="Bound">Γ</a><a id="3596" class="Symbol">}</a> <a id="3598" class="Symbol">{</a><a id="3599" href="../Soundness/#3599" class="Bound">δ</a> <a id="3601" class="Symbol">:</a> <a id="3603" href="../Denotational/#7166" class="Function">Env</a> <a id="3607" href="../Soundness/#3581" class="Bound">Δ</a><a id="3608" class="Symbol">}</a>
  <a id="3612" class="Symbol">→</a> <a id="3614" class="Symbol">(</a><a id="3615" href="../Soundness/#3615" class="Bound">σ</a> <a id="3617" class="Symbol">:</a> <a id="3619" href="../Substitution/#2405" class="Function">Subst</a> <a id="3625" href="../Soundness/#3579" class="Bound">Γ</a> <a id="3627" href="../Soundness/#3581" class="Bound">Δ</a><a id="3628" class="Symbol">)</a>
  <a id="3632" class="Symbol">→</a> <a id="3634" href="../Soundness/#3599" class="Bound">δ</a> <a id="3636" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="3639" href="../Soundness/#3615" class="Bound">σ</a> <a id="3641" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="3643" href="../Soundness/#3587" class="Bound">γ</a>
   <a id="3648" class="Comment">--------------------------</a>
  <a id="3677" class="Symbol">→</a> <a id="3679" href="../Soundness/#3599" class="Bound">δ</a> <a id="3681" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="3684" href="../Soundness/#3583" class="Bound">v</a> <a id="3686" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="3689" href="../Untyped/#6653" class="Function">exts</a> <a id="3694" href="../Soundness/#3615" class="Bound">σ</a> <a id="3696" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="3698" href="../Soundness/#3587" class="Bound">γ</a> <a id="3700" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="3703" href="../Soundness/#3583" class="Bound">v</a>
<a id="3705" href="../Soundness/#3564" class="Function">subst-ext</a> <a id="3715" href="../Soundness/#3715" class="Bound">σ</a> <a id="3717" href="../Soundness/#3717" class="Bound">d</a> <a id="3719" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="3721" class="Symbol">=</a> <a id="3723" href="../Denotational/#9278" class="InductiveConstructor">var</a>
<a id="3727" href="../Soundness/#3564" class="Function">subst-ext</a> <a id="3737" href="../Soundness/#3737" class="Bound">σ</a> <a id="3739" href="../Soundness/#3739" class="Bound">d</a> <a id="3741" class="Symbol">(</a><a id="3742" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="3744" href="../Soundness/#3744" class="Bound">x′</a><a id="3746" class="Symbol">)</a> <a id="3748" class="Symbol">=</a> <a id="3750" href="../Denotational/#24021" class="Function">rename-pres</a> <a id="3762" href="../Untyped/#3584" class="InductiveConstructor Operator">S_</a> <a id="3765" class="Symbol">(λ</a> <a id="3768" href="../Soundness/#3768" class="Bound">_</a> <a id="3770" class="Symbol">→</a> <a id="3772" href="../Denotational/#5516" class="Function">⊑-refl</a><a id="3778" class="Symbol">)</a> <a id="3780" class="Symbol">(</a><a id="3781" href="../Soundness/#3739" class="Bound">d</a> <a id="3783" href="../Soundness/#3744" class="Bound">x′</a><a id="3785" class="Symbol">)</a>
</pre>
<p>The proof is by cases on the de Bruijn index <code>x</code>.</p>
<ul>
<li><p>If it is <code>Z</code>, then we need to show that <code>δ , v ⊢ # 0 ↓ v</code>, which we have by rule <code>var</code>.</p></li>
<li><p>If it is <code>S x′</code>,then we need to show that <code>δ , v ⊢ rename S_ (σ x′) ↓ γ x′</code>, which we obtain by the <code>rename-pres</code> lemma.</p></li>
</ul>
<p>With the extension lemma in hand, the proof that simultaneous substitution preserves meaning is straightforward. Let’s dive in!</p>
<pre class="Agda"><a id="subst-pres"></a><a id="4198" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4209" class="Symbol">:</a> <a id="4211" class="Symbol">∀</a> <a id="4213" class="Symbol">{</a><a id="4214" href="../Soundness/#4214" class="Bound">Γ</a> <a id="4216" href="../Soundness/#4216" class="Bound">Δ</a> <a id="4218" href="../Soundness/#4218" class="Bound">v</a><a id="4219" class="Symbol">}</a> <a id="4221" class="Symbol">{</a><a id="4222" href="../Soundness/#4222" class="Bound">γ</a> <a id="4224" class="Symbol">:</a> <a id="4226" href="../Denotational/#7166" class="Function">Env</a> <a id="4230" href="../Soundness/#4214" class="Bound">Γ</a><a id="4231" class="Symbol">}</a> <a id="4233" class="Symbol">{</a><a id="4234" href="../Soundness/#4234" class="Bound">δ</a> <a id="4236" class="Symbol">:</a> <a id="4238" href="../Denotational/#7166" class="Function">Env</a> <a id="4242" href="../Soundness/#4216" class="Bound">Δ</a><a id="4243" class="Symbol">}</a> <a id="4245" class="Symbol">{</a><a id="4246" href="../Soundness/#4246" class="Bound">M</a> <a id="4248" class="Symbol">:</a> <a id="4250" href="../Soundness/#4214" class="Bound">Γ</a> <a id="4252" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="4254" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="4255" class="Symbol">}</a>
  <a id="4259" class="Symbol">→</a> <a id="4261" class="Symbol">(</a><a id="4262" href="../Soundness/#4262" class="Bound">σ</a> <a id="4264" class="Symbol">:</a> <a id="4266" href="../Substitution/#2405" class="Function">Subst</a> <a id="4272" href="../Soundness/#4214" class="Bound">Γ</a> <a id="4274" href="../Soundness/#4216" class="Bound">Δ</a><a id="4275" class="Symbol">)</a>
  <a id="4279" class="Symbol">→</a> <a id="4281" href="../Soundness/#4234" class="Bound">δ</a> <a id="4283" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="4286" href="../Soundness/#4262" class="Bound">σ</a> <a id="4288" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="4290" href="../Soundness/#4222" class="Bound">γ</a>
  <a id="4294" class="Symbol">→</a> <a id="4296" href="../Soundness/#4222" class="Bound">γ</a> <a id="4298" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="4300" href="../Soundness/#4246" class="Bound">M</a> <a id="4302" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="4304" href="../Soundness/#4218" class="Bound">v</a>
    <a id="4310" class="Comment">------------------</a>
  <a id="4331" class="Symbol">→</a> <a id="4333" href="../Soundness/#4234" class="Bound">δ</a> <a id="4335" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="4337" href="../Untyped/#6945" class="Function">subst</a> <a id="4343" href="../Soundness/#4262" class="Bound">σ</a> <a id="4345" href="../Soundness/#4246" class="Bound">M</a> <a id="4347" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="4349" href="../Soundness/#4218" class="Bound">v</a>
<a id="4351" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4362" href="../Soundness/#4362" class="Bound">σ</a> <a id="4364" href="../Soundness/#4364" class="Bound">s</a> <a id="4366" class="Symbol">(</a><a id="4367" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="4371" class="Symbol">{</a><a id="4372" class="Argument">x</a> <a id="4374" class="Symbol">=</a> <a id="4376" href="../Soundness/#4376" class="Bound">x</a><a id="4377" class="Symbol">})</a> <a id="4380" class="Symbol">=</a> <a id="4382" class="Symbol">(</a><a id="4383" href="../Soundness/#4364" class="Bound">s</a> <a id="4385" href="../Soundness/#4376" class="Bound">x</a><a id="4386" class="Symbol">)</a>
<a id="4388" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4399" href="../Soundness/#4399" class="Bound">σ</a> <a id="4401" href="../Soundness/#4401" class="Bound">s</a> <a id="4403" class="Symbol">(</a><a id="4404" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="4411" href="../Soundness/#4411" class="Bound">d₁</a> <a id="4414" href="../Soundness/#4414" class="Bound">d₂</a><a id="4416" class="Symbol">)</a> <a id="4418" class="Symbol">=</a>
  <a id="4422" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="4429" class="Symbol">(</a><a id="4430" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4441" href="../Soundness/#4399" class="Bound">σ</a> <a id="4443" href="../Soundness/#4401" class="Bound">s</a> <a id="4445" href="../Soundness/#4411" class="Bound">d₁</a><a id="4447" class="Symbol">)</a> <a id="4449" class="Symbol">(</a><a id="4450" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4461" href="../Soundness/#4399" class="Bound">σ</a> <a id="4463" href="../Soundness/#4401" class="Bound">s</a> <a id="4465" href="../Soundness/#4414" class="Bound">d₂</a><a id="4467" class="Symbol">)</a>
<a id="4469" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4480" href="../Soundness/#4480" class="Bound">σ</a> <a id="4482" href="../Soundness/#4482" class="Bound">s</a> <a id="4484" class="Symbol">(</a><a id="4485" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="4493" href="../Soundness/#4493" class="Bound">d</a><a id="4494" class="Symbol">)</a> <a id="4496" class="Symbol">=</a>
  <a id="4500" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="4508" class="Symbol">(</a><a id="4509" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4520" class="Symbol">(λ</a> <a id="4523" class="Symbol">{</a><a id="4524" href="../Soundness/#4524" class="Bound">A</a><a id="4525" class="Symbol">}</a> <a id="4527" class="Symbol">→</a> <a id="4529" href="../Untyped/#6653" class="Function">exts</a> <a id="4534" href="../Soundness/#4480" class="Bound">σ</a><a id="4535" class="Symbol">)</a> <a id="4537" class="Symbol">(</a><a id="4538" href="../Soundness/#3564" class="Function">subst-ext</a> <a id="4548" href="../Soundness/#4480" class="Bound">σ</a> <a id="4550" href="../Soundness/#4482" class="Bound">s</a><a id="4551" class="Symbol">)</a> <a id="4553" href="../Soundness/#4493" class="Bound">d</a><a id="4554" class="Symbol">)</a>
<a id="4556" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4567" href="../Soundness/#4567" class="Bound">σ</a> <a id="4569" href="../Soundness/#4569" class="Bound">s</a> <a id="4571" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a> <a id="4579" class="Symbol">=</a> <a id="4581" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a>
<a id="4589" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4600" href="../Soundness/#4600" class="Bound">σ</a> <a id="4602" href="../Soundness/#4602" class="Bound">s</a> <a id="4604" class="Symbol">(</a><a id="4605" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="4613" href="../Soundness/#4613" class="Bound">d₁</a> <a id="4616" href="../Soundness/#4616" class="Bound">d₂</a><a id="4618" class="Symbol">)</a> <a id="4620" class="Symbol">=</a>
  <a id="4624" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="4632" class="Symbol">(</a><a id="4633" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4644" href="../Soundness/#4600" class="Bound">σ</a> <a id="4646" href="../Soundness/#4602" class="Bound">s</a> <a id="4648" href="../Soundness/#4613" class="Bound">d₁</a><a id="4650" class="Symbol">)</a> <a id="4652" class="Symbol">(</a><a id="4653" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4664" href="../Soundness/#4600" class="Bound">σ</a> <a id="4666" href="../Soundness/#4602" class="Bound">s</a> <a id="4668" href="../Soundness/#4616" class="Bound">d₂</a><a id="4670" class="Symbol">)</a>
<a id="4672" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4683" href="../Soundness/#4683" class="Bound">σ</a> <a id="4685" href="../Soundness/#4685" class="Bound">s</a> <a id="4687" class="Symbol">(</a><a id="4688" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="4692" href="../Soundness/#4692" class="Bound">d</a> <a id="4694" href="../Soundness/#4694" class="Bound">lt</a><a id="4696" class="Symbol">)</a> <a id="4698" class="Symbol">=</a> <a id="4700" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="4704" class="Symbol">(</a><a id="4705" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="4716" href="../Soundness/#4683" class="Bound">σ</a> <a id="4718" href="../Soundness/#4685" class="Bound">s</a> <a id="4720" href="../Soundness/#4692" class="Bound">d</a><a id="4721" class="Symbol">)</a> <a id="4723" href="../Soundness/#4694" class="Bound">lt</a>
</pre>
<p>The proof is by induction on the semantics of <code>M</code>. The two interesting cases are for variables and lambda abstractions.</p>
<ul>
<li><p>For a variable <code>x</code>, we have that <code>v ⊑ γ x</code> and we need to show that <code>δ ⊢ σ x ↓ v</code>. From the premise applied to <code>x</code>, we have that <code>δ ⊢ σ x ↓ γ x</code>, so we conclude by the <code>sub</code> rule.</p></li>
<li><p>For a lambda abstraction, we must extend the substitution for the induction hypothesis. We apply the <code>subst-ext</code> lemma to show that the extended substitution maps variables to terms that result in the appropriate values.</p></li>
</ul>
<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>
<p>For β reduction, <code>(ƛ N) · M —→ N [ M ]</code>, we need to show that the semantics is preserved when substituting <code>M</code> for de Bruijn index 0 in term <code>N</code>. By inversion on the rules <code>↦-elim</code> and <code>↦-intro</code>, we have that <code>γ , v ⊢ M ↓ w</code> and <code>γ ⊢ N ↓ v</code>. So we need to show that <code>γ ⊢ M [ N ] ↓ w</code>, or equivalently, that <code>γ ⊢ subst (subst-zero N) M ↓ w</code>.</p>
<pre class="Agda"><a id="substitution"></a><a id="5665" href="../Soundness/#5665" class="Function">substitution</a> <a id="5678" class="Symbol">:</a> <a id="5680" class="Symbol">∀</a> <a id="5682" class="Symbol">{</a><a id="5683" href="../Soundness/#5683" class="Bound">Γ</a><a id="5684" class="Symbol">}</a> <a id="5686" class="Symbol">{</a><a id="5687" href="../Soundness/#5687" class="Bound">γ</a> <a id="5689" class="Symbol">:</a> <a id="5691" href="../Denotational/#7166" class="Function">Env</a> <a id="5695" href="../Soundness/#5683" class="Bound">Γ</a><a id="5696" class="Symbol">}</a> <a id="5698" class="Symbol">{</a><a id="5699" href="../Soundness/#5699" class="Bound">N</a> <a id="5701" href="../Soundness/#5701" class="Bound">M</a> <a id="5703" href="../Soundness/#5703" class="Bound">v</a> <a id="5705" href="../Soundness/#5705" class="Bound">w</a><a id="5706" class="Symbol">}</a>
   <a id="5711" class="Symbol">→</a> <a id="5713" href="../Soundness/#5687" class="Bound">γ</a> <a id="5715" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="5718" href="../Soundness/#5703" class="Bound">v</a> <a id="5720" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="5722" href="../Soundness/#5699" class="Bound">N</a> <a id="5724" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="5726" href="../Soundness/#5705" class="Bound">w</a>
   <a id="5731" class="Symbol">→</a> <a id="5733" href="../Soundness/#5687" class="Bound">γ</a> <a id="5735" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="5737" href="../Soundness/#5701" class="Bound">M</a> <a id="5739" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="5741" href="../Soundness/#5703" class="Bound">v</a>
     <a id="5748" class="Comment">---------------</a>
   <a id="5767" class="Symbol">→</a> <a id="5769" href="../Soundness/#5687" class="Bound">γ</a> <a id="5771" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="5773" href="../Soundness/#5699" class="Bound">N</a> <a id="5775" href="../Untyped/#7473" class="Function Operator">[</a> <a id="5777" href="../Soundness/#5701" class="Bound">M</a> <a id="5779" href="../Untyped/#7473" class="Function Operator">]</a> <a id="5781" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="5783" href="../Soundness/#5705" class="Bound">w</a>
<a id="5785" href="../Soundness/#5665" class="Function">substitution</a><a id="5797" class="Symbol">{</a><a id="5798" href="../Soundness/#5798" class="Bound">Γ</a><a id="5799" class="Symbol">}{</a><a id="5801" href="../Soundness/#5801" class="Bound">γ</a><a id="5802" class="Symbol">}{</a><a id="5804" href="../Soundness/#5804" class="Bound">N</a><a id="5805" class="Symbol">}{</a><a id="5807" href="../Soundness/#5807" class="Bound">M</a><a id="5808" class="Symbol">}{</a><a id="5810" href="../Soundness/#5810" class="Bound">v</a><a id="5811" class="Symbol">}{</a><a id="5813" href="../Soundness/#5813" class="Bound">w</a><a id="5814" class="Symbol">}</a> <a id="5816" href="../Soundness/#5816" class="Bound">dn</a> <a id="5819" href="../Soundness/#5819" class="Bound">dm</a> <a id="5822" class="Symbol">=</a>
  <a id="5826" href="../Soundness/#4198" class="Function">subst-pres</a> <a id="5837" class="Symbol">(</a><a id="5838" href="../Untyped/#7357" class="Function">subst-zero</a> <a id="5849" href="../Soundness/#5807" class="Bound">M</a><a id="5850" class="Symbol">)</a> <a id="5852" href="../Soundness/#5874" class="Function">sub-z-ok</a> <a id="5861" href="../Soundness/#5816" class="Bound">dn</a>
  <a id="5866" class="Keyword">where</a>
  <a id="5874" href="../Soundness/#5874" class="Function">sub-z-ok</a> <a id="5883" class="Symbol">:</a> <a id="5885" href="../Soundness/#5801" class="Bound">γ</a> <a id="5887" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="5890" href="../Untyped/#7357" class="Function">subst-zero</a> <a id="5901" href="../Soundness/#5807" class="Bound">M</a> <a id="5903" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="5905" class="Symbol">(</a><a id="5906" href="../Soundness/#5801" class="Bound">γ</a> <a id="5908" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="5911" href="../Soundness/#5810" class="Bound">v</a><a id="5912" class="Symbol">)</a>
  <a id="5916" href="../Soundness/#5874" class="Function">sub-z-ok</a> <a id="5925" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="5927" class="Symbol">=</a> <a id="5929" href="../Soundness/#5819" class="Bound">dm</a>
  <a id="5934" href="../Soundness/#5874" class="Function">sub-z-ok</a> <a id="5943" class="Symbol">(</a><a id="5944" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="5946" href="../Soundness/#5946" class="Bound">x</a><a id="5947" class="Symbol">)</a> <a id="5949" class="Symbol">=</a> <a id="5951" href="../Denotational/#9278" class="InductiveConstructor">var</a>
</pre>
<p>This result is a corollary of the lemma for simultaneous substitution. To use the lemma, we just need to show that <code>subst-zero M</code> maps variables to terms that produces the same values as those in <code>γ , v</code>. Let <code>y</code> be an arbitrary variable (de Bruijn index).</p>
<ul>
<li><p>If it is <code>Z</code>, then <code>(subst-zero M) y = M</code> and <code>(γ , v) y = v</code>. By the premise we conclude that <code>γ ⊢ M ↓ v</code>.</p></li>
<li><p>If it is <code>S x</code>, then <code>(subst-zero M) (S x) = x</code> and <code>(γ , v) (S x) = γ x</code>. So we conclude that <code>γ ⊢ x ↓ γ x</code> by rule <code>var</code>.</p></li>
</ul>
<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>
<p>With the substitution lemma in hand, it is straightforward to prove that reduction preserves denotations.</p>
<pre class="Agda"><a id="preserve"></a><a id="6612" href="../Soundness/#6612" class="Function">preserve</a> <a id="6621" class="Symbol">:</a> <a id="6623" class="Symbol">∀</a> <a id="6625" class="Symbol">{</a><a id="6626" href="../Soundness/#6626" class="Bound">Γ</a><a id="6627" class="Symbol">}</a> <a id="6629" class="Symbol">{</a><a id="6630" href="../Soundness/#6630" class="Bound">γ</a> <a id="6632" class="Symbol">:</a> <a id="6634" href="../Denotational/#7166" class="Function">Env</a> <a id="6638" href="../Soundness/#6626" class="Bound">Γ</a><a id="6639" class="Symbol">}</a> <a id="6641" class="Symbol">{</a><a id="6642" href="../Soundness/#6642" class="Bound">M</a> <a id="6644" href="../Soundness/#6644" class="Bound">N</a> <a id="6646" href="../Soundness/#6646" class="Bound">v</a><a id="6647" class="Symbol">}</a>
  <a id="6651" class="Symbol">→</a> <a id="6653" href="../Soundness/#6630" class="Bound">γ</a> <a id="6655" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="6657" href="../Soundness/#6642" class="Bound">M</a> <a id="6659" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="6661" href="../Soundness/#6646" class="Bound">v</a>
  <a id="6665" class="Symbol">→</a> <a id="6667" href="../Soundness/#6642" class="Bound">M</a> <a id="6669" href="../Untyped/#9930" class="Datatype Operator">—→</a> <a id="6672" href="../Soundness/#6644" class="Bound">N</a>
    <a id="6678" class="Comment">----------</a>
  <a id="6691" class="Symbol">→</a> <a id="6693" href="../Soundness/#6630" class="Bound">γ</a> <a id="6695" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="6697" href="../Soundness/#6644" class="Bound">N</a> <a id="6699" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="6701" href="../Soundness/#6646" class="Bound">v</a>
<a id="6703" href="../Soundness/#6612" class="Function">preserve</a> <a id="6712" class="Symbol">(</a><a id="6713" href="../Denotational/#9278" class="InductiveConstructor">var</a><a id="6716" class="Symbol">)</a> <a id="6718" class="Symbol">()</a>
<a id="6721" href="../Soundness/#6612" class="Function">preserve</a> <a id="6730" class="Symbol">(</a><a id="6731" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="6738" href="../Soundness/#6738" class="Bound">d₁</a> <a id="6741" href="../Soundness/#6741" class="Bound">d₂</a><a id="6743" class="Symbol">)</a> <a id="6745" class="Symbol">(</a><a id="6746" href="../Untyped/#9980" class="InductiveConstructor">ξ₁</a> <a id="6749" href="../Soundness/#6749" class="Bound">r</a><a id="6750" class="Symbol">)</a> <a id="6752" class="Symbol">=</a> <a id="6754" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="6761" class="Symbol">(</a><a id="6762" href="../Soundness/#6612" class="Function">preserve</a> <a id="6771" href="../Soundness/#6738" class="Bound">d₁</a> <a id="6774" href="../Soundness/#6749" class="Bound">r</a><a id="6775" class="Symbol">)</a> <a id="6777" href="../Soundness/#6741" class="Bound">d₂</a>
<a id="6780" href="../Soundness/#6612" class="Function">preserve</a> <a id="6789" class="Symbol">(</a><a id="6790" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="6797" href="../Soundness/#6797" class="Bound">d₁</a> <a id="6800" href="../Soundness/#6800" class="Bound">d₂</a><a id="6802" class="Symbol">)</a> <a id="6804" class="Symbol">(</a><a id="6805" href="../Untyped/#10070" class="InductiveConstructor">ξ₂</a> <a id="6808" href="../Soundness/#6808" class="Bound">r</a><a id="6809" class="Symbol">)</a> <a id="6811" class="Symbol">=</a> <a id="6813" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="6820" href="../Soundness/#6797" class="Bound">d₁</a> <a id="6823" class="Symbol">(</a><a id="6824" href="../Soundness/#6612" class="Function">preserve</a> <a id="6833" href="../Soundness/#6800" class="Bound">d₂</a> <a id="6836" href="../Soundness/#6808" class="Bound">r</a><a id="6837" class="Symbol">)</a>
<a id="6839" href="../Soundness/#6612" class="Function">preserve</a> <a id="6848" class="Symbol">(</a><a id="6849" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="6856" href="../Soundness/#6856" class="Bound">d₁</a> <a id="6859" href="../Soundness/#6859" class="Bound">d₂</a><a id="6861" class="Symbol">)</a> <a id="6863" href="../Untyped/#10160" class="InductiveConstructor">β</a> <a id="6865" class="Symbol">=</a> <a id="6867" href="../Soundness/#5665" class="Function">substitution</a> <a id="6880" class="Symbol">(</a><a id="6881" href="../Compositional/#3840" class="Function">lambda-inversion</a> <a id="6898" href="../Soundness/#6856" class="Bound">d₁</a><a id="6900" class="Symbol">)</a> <a id="6902" href="../Soundness/#6859" class="Bound">d₂</a>
<a id="6905" href="../Soundness/#6612" class="Function">preserve</a> <a id="6914" class="Symbol">(</a><a id="6915" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="6923" href="../Soundness/#6923" class="Bound">d</a><a id="6924" class="Symbol">)</a> <a id="6926" class="Symbol">(</a><a id="6927" href="../Untyped/#10268" class="InductiveConstructor">ζ</a> <a id="6929" href="../Soundness/#6929" class="Bound">r</a><a id="6930" class="Symbol">)</a> <a id="6932" class="Symbol">=</a> <a id="6934" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="6942" class="Symbol">(</a><a id="6943" href="../Soundness/#6612" class="Function">preserve</a> <a id="6952" href="../Soundness/#6923" class="Bound">d</a> <a id="6954" href="../Soundness/#6929" class="Bound">r</a><a id="6955" class="Symbol">)</a>
<a id="6957" href="../Soundness/#6612" class="Function">preserve</a> <a id="6966" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a> <a id="6974" href="../Soundness/#6974" class="Bound">r</a> <a id="6976" class="Symbol">=</a> <a id="6978" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a>
<a id="6986" href="../Soundness/#6612" class="Function">preserve</a> <a id="6995" class="Symbol">(</a><a id="6996" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="7004" href="../Soundness/#7004" class="Bound">d</a> <a id="7006" href="../Soundness/#7006" class="Bound">d₁</a><a id="7008" class="Symbol">)</a> <a id="7010" href="../Soundness/#7010" class="Bound">r</a> <a id="7012" class="Symbol">=</a> <a id="7014" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="7022" class="Symbol">(</a><a id="7023" href="../Soundness/#6612" class="Function">preserve</a> <a id="7032" href="../Soundness/#7004" class="Bound">d</a> <a id="7034" href="../Soundness/#7010" class="Bound">r</a><a id="7035" class="Symbol">)</a> <a id="7037" class="Symbol">(</a><a id="7038" href="../Soundness/#6612" class="Function">preserve</a> <a id="7047" href="../Soundness/#7006" class="Bound">d₁</a> <a id="7050" href="../Soundness/#7010" class="Bound">r</a><a id="7051" class="Symbol">)</a>
<a id="7053" href="../Soundness/#6612" class="Function">preserve</a> <a id="7062" class="Symbol">(</a><a id="7063" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="7067" href="../Soundness/#7067" class="Bound">d</a> <a id="7069" href="../Soundness/#7069" class="Bound">lt</a><a id="7071" class="Symbol">)</a> <a id="7073" href="../Soundness/#7073" class="Bound">r</a> <a id="7075" class="Symbol">=</a> <a id="7077" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="7081" class="Symbol">(</a><a id="7082" href="../Soundness/#6612" class="Function">preserve</a> <a id="7091" href="../Soundness/#7067" class="Bound">d</a> <a id="7093" href="../Soundness/#7073" class="Bound">r</a><a id="7094" class="Symbol">)</a> <a id="7096" href="../Soundness/#7069" class="Bound">lt</a>
</pre>
<p>We proceed by induction on the semantics of <code>M</code> with case analysis on the reduction.</p>
<ul>
<li><p>If <code>M</code> is a variable, then there is no such reduction.</p></li>
<li><p>If <code>M</code> is an application, then the reduction is either a congruence (ξ₁ or ξ₂) or β. For each congruence, we use the induction hypothesis. For β reduction we use the substitution lemma and the <code>sub</code> rule.</p></li>
<li><p>The rest of the cases are straightforward.</p></li>
</ul>
<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>
<p>This section proves that reduction reflects the denotation of a term. That is, if <code>N</code> results in <code>v</code>, and if <code>M</code> reduces to <code>N</code>, then <code>M</code> also results in <code>v</code>. While there are some broad similarities between this proof and the above proof of semantic preservation, we shall require a few more technical lemmas to obtain this result.</p>
<p>The main challenge is dealing with the substitution in β reduction:</p>
<pre><code>(ƛ N) · M —→ N [ M ]</code></pre>
<p>We have that <code>γ ⊢ N [ M ] ↓ v</code> and need to show that <code>γ ⊢ (ƛ N) · M ↓ v</code>. Now consider the derivation of <code>γ ⊢ N [ M ] ↓ v</code>. The term <code>M</code> may occur 0, 1, or many times inside <code>N [ M ]</code>. At each of those occurrences, <code>M</code> may result in a different value. But to build a derivation for <code>(ƛ N) · M</code>, we need a single value for <code>M</code>. If <code>M</code> occurred more than 1 time, then we can join all of the different values using <code>⊔</code>. If <code>M</code> occurred 0 times, then we do not need any information about <code>M</code> and can therefore use <code>⊥</code> for the value of <code>M</code>.</p>
<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>
<p>Previously we showed that renaming variables preserves meaning. Now we prove the opposite, that it reflects meaning. That is, if <code>δ ⊢ rename ρ M ↓ v</code>, then <code>γ ⊢ M ↓ v</code>, where <code>(δ ∘ ρ)</code>⊑ γ`.</p>
First, we need a variant of a lemma given earlier.
<pre class="Agda"><a id="ext-⊑′"></a><a id="8789" href="../Soundness/#8789" class="Function">ext-⊑′</a> <a id="8796" class="Symbol">:</a> <a id="8798" class="Symbol">∀</a> <a id="8800" class="Symbol">{</a><a id="8801" href="../Soundness/#8801" class="Bound">Γ</a> <a id="8803" href="../Soundness/#8803" class="Bound">Δ</a> <a id="8805" href="../Soundness/#8805" class="Bound">v</a><a id="8806" class="Symbol">}</a> <a id="8808" class="Symbol">{</a><a id="8809" href="../Soundness/#8809" class="Bound">γ</a> <a id="8811" class="Symbol">:</a> <a id="8813" href="../Denotational/#7166" class="Function">Env</a> <a id="8817" href="../Soundness/#8801" class="Bound">Γ</a><a id="8818" class="Symbol">}</a> <a id="8820" class="Symbol">{</a><a id="8821" href="../Soundness/#8821" class="Bound">δ</a> <a id="8823" class="Symbol">:</a> <a id="8825" href="../Denotational/#7166" class="Function">Env</a> <a id="8829" href="../Soundness/#8803" class="Bound">Δ</a><a id="8830" class="Symbol">}</a>
  <a id="8834" class="Symbol">→</a> <a id="8836" class="Symbol">(</a><a id="8837" href="../Soundness/#8837" class="Bound">ρ</a> <a id="8839" class="Symbol">:</a> <a id="8841" href="../Substitution/#2192" class="Function">Rename</a> <a id="8848" href="../Soundness/#8801" class="Bound">Γ</a> <a id="8850" href="../Soundness/#8803" class="Bound">Δ</a><a id="8851" class="Symbol">)</a>
  <a id="8855" class="Symbol">→</a> <a id="8857" class="Symbol">(</a><a id="8858" href="../Soundness/#8821" class="Bound">δ</a> <a id="8860" href="https://agda.github.io/agda-stdlib/v1.3/Function.Base.html#992" class="Function Operator">∘</a> <a id="8862" href="../Soundness/#8837" class="Bound">ρ</a><a id="8863" class="Symbol">)</a> <a id="8865" href="../Denotational/#7986" class="Function Operator">`⊑</a> <a id="8868" href="../Soundness/#8809" class="Bound">γ</a>
    <a id="8874" class="Comment">------------------------------</a>
  <a id="8907" class="Symbol">→</a> <a id="8909" class="Symbol">((</a><a id="8911" href="../Soundness/#8821" class="Bound">δ</a> <a id="8913" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="8916" href="../Soundness/#8805" class="Bound">v</a><a id="8917" class="Symbol">)</a> <a id="8919" href="https://agda.github.io/agda-stdlib/v1.3/Function.Base.html#992" class="Function Operator">∘</a> <a id="8921" href="../Untyped/#5907" class="Function">ext</a> <a id="8925" href="../Soundness/#8837" class="Bound">ρ</a><a id="8926" class="Symbol">)</a> <a id="8928" href="../Denotational/#7986" class="Function Operator">`⊑</a> <a id="8931" class="Symbol">(</a><a id="8932" href="../Soundness/#8809" class="Bound">γ</a> <a id="8934" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="8937" href="../Soundness/#8805" class="Bound">v</a><a id="8938" class="Symbol">)</a>
<a id="8940" href="../Soundness/#8789" class="Function">ext-⊑′</a> <a id="8947" href="../Soundness/#8947" class="Bound">ρ</a> <a id="8949" href="../Soundness/#8949" class="Bound">lt</a> <a id="8952" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="8954" class="Symbol">=</a> <a id="8956" href="../Denotational/#5516" class="Function">⊑-refl</a>
<a id="8963" href="../Soundness/#8789" class="Function">ext-⊑′</a> <a id="8970" href="../Soundness/#8970" class="Bound">ρ</a> <a id="8972" href="../Soundness/#8972" class="Bound">lt</a> <a id="8975" class="Symbol">(</a><a id="8976" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="8978" href="../Soundness/#8978" class="Bound">x</a><a id="8979" class="Symbol">)</a> <a id="8981" class="Symbol">=</a> <a id="8983" href="../Soundness/#8972" class="Bound">lt</a> <a id="8986" href="../Soundness/#8978" class="Bound">x</a>
</pre>
The proof is then as follows.
<pre class="Agda"><a id="rename-reflect"></a><a id="9027" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9042" class="Symbol">:</a> <a id="9044" class="Symbol">∀</a> <a id="9046" class="Symbol">{</a><a id="9047" href="../Soundness/#9047" class="Bound">Γ</a> <a id="9049" href="../Soundness/#9049" class="Bound">Δ</a> <a id="9051" href="../Soundness/#9051" class="Bound">v</a><a id="9052" class="Symbol">}</a> <a id="9054" class="Symbol">{</a><a id="9055" href="../Soundness/#9055" class="Bound">γ</a> <a id="9057" class="Symbol">:</a> <a id="9059" href="../Denotational/#7166" class="Function">Env</a> <a id="9063" href="../Soundness/#9047" class="Bound">Γ</a><a id="9064" class="Symbol">}</a> <a id="9066" class="Symbol">{</a><a id="9067" href="../Soundness/#9067" class="Bound">δ</a> <a id="9069" class="Symbol">:</a> <a id="9071" href="../Denotational/#7166" class="Function">Env</a> <a id="9075" href="../Soundness/#9049" class="Bound">Δ</a><a id="9076" class="Symbol">}</a> <a id="9078" class="Symbol">{</a> <a id="9080" href="../Soundness/#9080" class="Bound">M</a> <a id="9082" class="Symbol">:</a> <a id="9084" href="../Soundness/#9047" class="Bound">Γ</a> <a id="9086" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="9088" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="9089" class="Symbol">}</a>
  <a id="9093" class="Symbol">→</a> <a id="9095" class="Symbol">{</a><a id="9096" href="../Soundness/#9096" class="Bound">ρ</a> <a id="9098" class="Symbol">:</a> <a id="9100" href="../Substitution/#2192" class="Function">Rename</a> <a id="9107" href="../Soundness/#9047" class="Bound">Γ</a> <a id="9109" href="../Soundness/#9049" class="Bound">Δ</a><a id="9110" class="Symbol">}</a>
  <a id="9114" class="Symbol">→</a> <a id="9116" class="Symbol">(</a><a id="9117" href="../Soundness/#9067" class="Bound">δ</a> <a id="9119" href="https://agda.github.io/agda-stdlib/v1.3/Function.Base.html#992" class="Function Operator">∘</a> <a id="9121" href="../Soundness/#9096" class="Bound">ρ</a><a id="9122" class="Symbol">)</a> <a id="9124" href="../Denotational/#7986" class="Function Operator">`⊑</a> <a id="9127" href="../Soundness/#9055" class="Bound">γ</a>
  <a id="9131" class="Symbol">→</a> <a id="9133" href="../Soundness/#9067" class="Bound">δ</a> <a id="9135" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="9137" href="../Untyped/#6217" class="Function">rename</a> <a id="9144" href="../Soundness/#9096" class="Bound">ρ</a> <a id="9146" href="../Soundness/#9080" class="Bound">M</a> <a id="9148" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="9150" href="../Soundness/#9051" class="Bound">v</a>
    <a id="9156" class="Comment">------------------------------------</a>
  <a id="9195" class="Symbol">→</a> <a id="9197" href="../Soundness/#9055" class="Bound">γ</a> <a id="9199" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="9201" href="../Soundness/#9080" class="Bound">M</a> <a id="9203" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="9205" href="../Soundness/#9051" class="Bound">v</a>
<a id="9207" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9222" class="Symbol">{</a><a id="9223" class="Argument">M</a> <a id="9225" class="Symbol">=</a> <a id="9227" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="9229" href="../Soundness/#9229" class="Bound">x</a><a id="9230" class="Symbol">}</a> <a id="9232" href="../Soundness/#9232" class="Bound">all-n</a> <a id="9238" href="../Soundness/#9238" class="Bound">d</a> <a id="9240" class="Keyword">with</a> <a id="9245" href="../Compositional/#10011" class="Function">var-inv</a> <a id="9253" href="../Soundness/#9238" class="Bound">d</a>
<a id="9255" class="Symbol">...</a> <a id="9259" class="Symbol">|</a> <a id="9261" href="../Soundness/#9261" class="Bound">lt</a> <a id="9264" class="Symbol">=</a>  <a id="9267" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="9271" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="9275" class="Symbol">(</a><a id="9276" href="../Denotational/#4676" class="InductiveConstructor">⊑-trans</a> <a id="9284" href="../Soundness/#9261" class="Bound">lt</a> <a id="9287" class="Symbol">(</a><a id="9288" class="Bound">all-n</a> <a id="9294" class="Bound">x</a><a id="9295" class="Symbol">))</a>
<a id="9298" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9313" class="Symbol">{</a><a id="9314" class="Argument">M</a> <a id="9316" class="Symbol">=</a> <a id="9318" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="9320" href="../Soundness/#9320" class="Bound">N</a><a id="9321" class="Symbol">}{</a><a id="9323" class="Argument">ρ</a> <a id="9325" class="Symbol">=</a> <a id="9327" href="../Soundness/#9327" class="Bound">ρ</a><a id="9328" class="Symbol">}</a> <a id="9330" href="../Soundness/#9330" class="Bound">all-n</a> <a id="9336" class="Symbol">(</a><a id="9337" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="9345" href="../Soundness/#9345" class="Bound">d</a><a id="9346" class="Symbol">)</a> <a id="9348" class="Symbol">=</a>
   <a id="9353" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="9361" class="Symbol">(</a><a id="9362" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9377" class="Symbol">(</a><a id="9378" href="../Soundness/#8789" class="Function">ext-⊑′</a> <a id="9385" href="../Soundness/#9327" class="Bound">ρ</a> <a id="9387" href="../Soundness/#9330" class="Bound">all-n</a><a id="9392" class="Symbol">)</a> <a id="9394" href="../Soundness/#9345" class="Bound">d</a><a id="9395" class="Symbol">)</a>
<a id="9397" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9412" class="Symbol">{</a><a id="9413" class="Argument">M</a> <a id="9415" class="Symbol">=</a> <a id="9417" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="9419" href="../Soundness/#9419" class="Bound">N</a><a id="9420" class="Symbol">}</a> <a id="9422" href="../Soundness/#9422" class="Bound">all-n</a> <a id="9428" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a> <a id="9436" class="Symbol">=</a> <a id="9438" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a>
<a id="9446" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9461" class="Symbol">{</a><a id="9462" class="Argument">M</a> <a id="9464" class="Symbol">=</a> <a id="9466" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="9468" href="../Soundness/#9468" class="Bound">N</a><a id="9469" class="Symbol">}</a> <a id="9471" href="../Soundness/#9471" class="Bound">all-n</a> <a id="9477" class="Symbol">(</a><a id="9478" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="9486" href="../Soundness/#9486" class="Bound">d₁</a> <a id="9489" href="../Soundness/#9489" class="Bound">d₂</a><a id="9491" class="Symbol">)</a> <a id="9493" class="Symbol">=</a>
   <a id="9498" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="9506" class="Symbol">(</a><a id="9507" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9522" href="../Soundness/#9471" class="Bound">all-n</a> <a id="9528" href="../Soundness/#9486" class="Bound">d₁</a><a id="9530" class="Symbol">)</a> <a id="9532" class="Symbol">(</a><a id="9533" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9548" href="../Soundness/#9471" class="Bound">all-n</a> <a id="9554" href="../Soundness/#9489" class="Bound">d₂</a><a id="9556" class="Symbol">)</a>
<a id="9558" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9573" class="Symbol">{</a><a id="9574" class="Argument">M</a> <a id="9576" class="Symbol">=</a> <a id="9578" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="9580" href="../Soundness/#9580" class="Bound">N</a><a id="9581" class="Symbol">}</a> <a id="9583" href="../Soundness/#9583" class="Bound">all-n</a> <a id="9589" class="Symbol">(</a><a id="9590" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="9594" href="../Soundness/#9594" class="Bound">d₁</a> <a id="9597" href="../Soundness/#9597" class="Bound">lt</a><a id="9599" class="Symbol">)</a> <a id="9601" class="Symbol">=</a>
   <a id="9606" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="9610" class="Symbol">(</a><a id="9611" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9626" href="../Soundness/#9583" class="Bound">all-n</a> <a id="9632" href="../Soundness/#9594" class="Bound">d₁</a><a id="9634" class="Symbol">)</a> <a id="9636" href="../Soundness/#9597" class="Bound">lt</a>
<a id="9639" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9654" class="Symbol">{</a><a id="9655" class="Argument">M</a> <a id="9657" class="Symbol">=</a> <a id="9659" href="../Soundness/#9659" class="Bound">L</a> <a id="9661" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="9663" href="../Soundness/#9663" class="Bound">M</a><a id="9664" class="Symbol">}</a> <a id="9666" href="../Soundness/#9666" class="Bound">all-n</a> <a id="9672" class="Symbol">(</a><a id="9673" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="9680" href="../Soundness/#9680" class="Bound">d₁</a> <a id="9683" href="../Soundness/#9683" class="Bound">d₂</a><a id="9685" class="Symbol">)</a> <a id="9687" class="Symbol">=</a>
   <a id="9692" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="9699" class="Symbol">(</a><a id="9700" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9715" href="../Soundness/#9666" class="Bound">all-n</a> <a id="9721" href="../Soundness/#9680" class="Bound">d₁</a><a id="9723" class="Symbol">)</a> <a id="9725" class="Symbol">(</a><a id="9726" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9741" href="../Soundness/#9666" class="Bound">all-n</a> <a id="9747" href="../Soundness/#9683" class="Bound">d₂</a><a id="9749" class="Symbol">)</a>
<a id="9751" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9766" class="Symbol">{</a><a id="9767" class="Argument">M</a> <a id="9769" class="Symbol">=</a> <a id="9771" href="../Soundness/#9771" class="Bound">L</a> <a id="9773" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="9775" href="../Soundness/#9775" class="Bound">M</a><a id="9776" class="Symbol">}</a> <a id="9778" href="../Soundness/#9778" class="Bound">all-n</a> <a id="9784" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a> <a id="9792" class="Symbol">=</a> <a id="9794" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a>
<a id="9802" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9817" class="Symbol">{</a><a id="9818" class="Argument">M</a> <a id="9820" class="Symbol">=</a> <a id="9822" href="../Soundness/#9822" class="Bound">L</a> <a id="9824" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="9826" href="../Soundness/#9826" class="Bound">M</a><a id="9827" class="Symbol">}</a> <a id="9829" href="../Soundness/#9829" class="Bound">all-n</a> <a id="9835" class="Symbol">(</a><a id="9836" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="9844" href="../Soundness/#9844" class="Bound">d₁</a> <a id="9847" href="../Soundness/#9847" class="Bound">d₂</a><a id="9849" class="Symbol">)</a> <a id="9851" class="Symbol">=</a>
   <a id="9856" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="9864" class="Symbol">(</a><a id="9865" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9880" href="../Soundness/#9829" class="Bound">all-n</a> <a id="9886" href="../Soundness/#9844" class="Bound">d₁</a><a id="9888" class="Symbol">)</a> <a id="9890" class="Symbol">(</a><a id="9891" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9906" href="../Soundness/#9829" class="Bound">all-n</a> <a id="9912" href="../Soundness/#9847" class="Bound">d₂</a><a id="9914" class="Symbol">)</a>
<a id="9916" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9931" class="Symbol">{</a><a id="9932" class="Argument">M</a> <a id="9934" class="Symbol">=</a> <a id="9936" href="../Soundness/#9936" class="Bound">L</a> <a id="9938" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="9940" href="../Soundness/#9940" class="Bound">M</a><a id="9941" class="Symbol">}</a> <a id="9943" href="../Soundness/#9943" class="Bound">all-n</a> <a id="9949" class="Symbol">(</a><a id="9950" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="9954" href="../Soundness/#9954" class="Bound">d₁</a> <a id="9957" href="../Soundness/#9957" class="Bound">lt</a><a id="9959" class="Symbol">)</a> <a id="9961" class="Symbol">=</a>
   <a id="9966" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="9970" class="Symbol">(</a><a id="9971" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="9986" href="../Soundness/#9943" class="Bound">all-n</a> <a id="9992" href="../Soundness/#9954" class="Bound">d₁</a><a id="9994" class="Symbol">)</a> <a id="9996" href="../Soundness/#9957" class="Bound">lt</a>
</pre>
<p>We cannot prove this lemma by induction on the derivation of <code>δ ⊢ rename ρ M ↓ v</code>, so instead we proceed by induction on <code>M</code>.</p>
<ul>
<li><p>If it is a variable, we apply the inversion lemma to obtain that <code>v ⊑ δ (ρ x)</code>. Instantiating the premise to <code>x</code> we have <code>δ (ρ x) = γ x</code>, so we conclude by the <code>var</code> rule.</p></li>
<li><p>If it is a lambda abstraction <code>ƛ N</code>, we have rename <code>ρ (ƛ N) = ƛ (rename (ext ρ) N)</code>. We proceed by cases on <code>δ ⊢ ƛ (rename (ext ρ) N) ↓ v</code>.</p>
<ul>
<li><p>Rule <code>↦-intro</code>: To satisfy the premise of the induction hypothesis, we prove that the renaming can be extended to be a mapping from <code>γ , v₁ to δ , v₁</code>.</p></li>
<li><p>Rule <code>⊥-intro</code>: We simply apply <code>⊥-intro</code>.</p></li>
<li><p>Rule <code>⊔-intro</code>: We apply the induction hypotheses and <code>⊔-intro</code>.</p></li>
<li><p>Rule <code>sub</code>: We apply the induction hypothesis and <code>sub</code>.</p></li>
</ul></li>
<li><p>If it is an application <code>L · M</code>, we have <code>rename ρ (L · M) = (rename ρ L) · (rename ρ M)</code>. We proceed by cases on <code>δ ⊢ (rename ρ L) · (rename ρ M) ↓ v</code> and all the cases are straightforward.</p></li>
</ul>
<p>In the upcoming uses of <code>rename-reflect</code>, the renaming will always be the increment function. So we prove a corollary for that special case.</p>
<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11149" href="../Soundness/#11149" class="Function">rename-inc-reflect</a> <a id="11168" class="Symbol">:</a> <a id="11170" class="Symbol">∀</a> <a id="11172" class="Symbol">{</a><a id="11173" href="../Soundness/#11173" class="Bound">Γ</a> <a id="11175" href="../Soundness/#11175" class="Bound">v′</a> <a id="11178" href="../Soundness/#11178" class="Bound">v</a><a id="11179" class="Symbol">}</a> <a id="11181" class="Symbol">{</a><a id="11182" href="../Soundness/#11182" class="Bound">γ</a> <a id="11184" class="Symbol">:</a> <a id="11186" href="../Denotational/#7166" class="Function">Env</a> <a id="11190" href="../Soundness/#11173" class="Bound">Γ</a><a id="11191" class="Symbol">}</a> <a id="11193" class="Symbol">{</a> <a id="11195" href="../Soundness/#11195" class="Bound">M</a> <a id="11197" class="Symbol">:</a> <a id="11199" href="../Soundness/#11173" class="Bound">Γ</a> <a id="11201" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="11203" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="11204" class="Symbol">}</a>
  <a id="11208" class="Symbol">→</a> <a id="11210" class="Symbol">(</a><a id="11211" href="../Soundness/#11182" class="Bound">γ</a> <a id="11213" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="11216" href="../Soundness/#11175" class="Bound">v′</a><a id="11218" class="Symbol">)</a> <a id="11220" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="11222" href="../Untyped/#6217" class="Function">rename</a> <a id="11229" href="../Untyped/#3584" class="InductiveConstructor Operator">S_</a> <a id="11232" href="../Soundness/#11195" class="Bound">M</a> <a id="11234" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="11236" href="../Soundness/#11178" class="Bound">v</a>
    <a id="11242" class="Comment">----------------------------</a>
  <a id="11273" class="Symbol">→</a> <a id="11275" href="../Soundness/#11182" class="Bound">γ</a> <a id="11277" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="11279" href="../Soundness/#11195" class="Bound">M</a> <a id="11281" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="11283" href="../Soundness/#11178" class="Bound">v</a>
<a id="11285" href="../Soundness/#11149" class="Function">rename-inc-reflect</a> <a id="11304" href="../Soundness/#11304" class="Bound">d</a> <a id="11306" class="Symbol">=</a> <a id="11308" href="../Soundness/#9027" class="Function">rename-reflect</a> <a id="11323" href="../Denotational/#8477" class="Function">`⊑-refl</a> <a id="11331" href="../Soundness/#11304" class="Bound">d</a>
</pre>
<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>
<p>We are almost ready to begin proving that simultaneous substitution reflects denotations. That is, if <code>γ ⊢ (subst σ M) ↓ v</code>, then <code>γ ⊢ σ k ↓ δ k</code> and <code>δ ⊢ M ↓ v</code> for any <code>k</code> and some <code>δ</code>. We shall start with the case in which <code>M</code> is a variable <code>x</code>. So instead the premise is <code>γ ⊢ σ x ↓ v</code> and we need to show that <code>δ ⊢ x ↓ v</code> for some <code>δ</code>. The <code>δ</code> that we choose shall be the environment that maps <code>x</code> to <code>v</code> and every other variable to <code>⊥</code>.</p>
<p>Next we define the environment that maps <code>x</code> to <code>v</code> and every other variable to <code>⊥</code>, that is <code>const-env x v</code>. To tell variables apart, we define the following function for deciding equality of variables.</p>
<pre class="Agda"><a id="_var≟_"></a><a id="12049" href="../Soundness/#12049" class="Function Operator">_var≟_</a> <a id="12056" class="Symbol">:</a> <a id="12058" class="Symbol">∀</a> <a id="12060" class="Symbol">{</a><a id="12061" href="../Soundness/#12061" class="Bound">Γ</a><a id="12062" class="Symbol">}</a> <a id="12064" class="Symbol">→</a> <a id="12066" class="Symbol">(</a><a id="12067" href="../Soundness/#12067" class="Bound">x</a> <a id="12069" href="../Soundness/#12069" class="Bound">y</a> <a id="12071" class="Symbol">:</a> <a id="12073" href="../Soundness/#12061" class="Bound">Γ</a> <a id="12075" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="12077" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="12078" class="Symbol">)</a> <a id="12080" class="Symbol">→</a> <a id="12082" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1508" class="Record">Dec</a> <a id="12086" class="Symbol">(</a><a id="12087" href="../Soundness/#12067" class="Bound">x</a> <a id="12089" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="12091" href="../Soundness/#12069" class="Bound">y</a><a id="12092" class="Symbol">)</a>
<a id="12094" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="12096" href="../Soundness/#12049" class="Function Operator">var≟</a> <a id="12101" href="../Untyped/#3539" class="InductiveConstructor">Z</a>  <a id="12104" class="Symbol">=</a>  <a id="12107" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="12111" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="12116" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="12118" href="../Soundness/#12049" class="Function Operator">var≟</a> <a id="12123" class="Symbol">(</a><a id="12124" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="12126" class="Symbol">_)</a>  <a id="12130" class="Symbol">=</a>  <a id="12133" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1682" class="InductiveConstructor">no</a> <a id="12136" class="Symbol">λ()</a>
<a id="12140" class="Symbol">(</a><a id="12141" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="12143" class="Symbol">_)</a> <a id="12146" href="../Soundness/#12049" class="Function Operator">var≟</a> <a id="12151" href="../Untyped/#3539" class="InductiveConstructor">Z</a>  <a id="12154" class="Symbol">=</a>  <a id="12157" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1682" class="InductiveConstructor">no</a> <a id="12160" class="Symbol">λ()</a>
<a id="12164" class="Symbol">(</a><a id="12165" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="12167" href="../Soundness/#12167" class="Bound">x</a><a id="12168" class="Symbol">)</a> <a id="12170" href="../Soundness/#12049" class="Function Operator">var≟</a> <a id="12175" class="Symbol">(</a><a id="12176" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="12178" href="../Soundness/#12178" class="Bound">y</a><a id="12179" class="Symbol">)</a> <a id="12181" class="Keyword">with</a>  <a id="12187" href="../Soundness/#12167" class="Bound">x</a> <a id="12189" href="../Soundness/#12049" class="Function Operator">var≟</a> <a id="12194" href="../Soundness/#12178" class="Bound">y</a>
<a id="12196" class="Symbol">...</a>                 <a id="12216" class="Symbol">|</a>  <a id="12219" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="12223" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="12228" class="Symbol">=</a>  <a id="12231" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="12235" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="12240" class="Symbol">...</a>                 <a id="12260" class="Symbol">|</a>  <a id="12263" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1682" class="InductiveConstructor">no</a> <a id="12266" href="../Soundness/#12266" class="Bound">neq</a>   <a id="12272" class="Symbol">=</a>  <a id="12275" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1682" class="InductiveConstructor">no</a> <a id="12278" class="Symbol">λ{</a><a id="12280" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="12285" class="Symbol">→</a> <a id="12287" href="../Soundness/#12266" class="Bound">neq</a> <a id="12291" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="12295" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12298" href="../Soundness/#12298" class="Function">var≟-refl</a> <a id="12308" class="Symbol">:</a> <a id="12310" class="Symbol">∀</a> <a id="12312" class="Symbol">{</a><a id="12313" href="../Soundness/#12313" class="Bound">Γ</a><a id="12314" class="Symbol">}</a> <a id="12316" class="Symbol">(</a><a id="12317" href="../Soundness/#12317" class="Bound">x</a> <a id="12319" class="Symbol">:</a> <a id="12321" href="../Soundness/#12313" class="Bound">Γ</a> <a id="12323" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="12325" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="12326" class="Symbol">)</a> <a id="12328" class="Symbol">→</a> <a id="12330" class="Symbol">(</a><a id="12331" href="../Soundness/#12317" class="Bound">x</a> <a id="12333" href="../Soundness/#12049" class="Function Operator">var≟</a> <a id="12338" href="../Soundness/#12317" class="Bound">x</a><a id="12339" class="Symbol">)</a> <a id="12341" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="12343" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="12347" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="12352" href="../Soundness/#12298" class="Function">var≟-refl</a> <a id="12362" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="12364" class="Symbol">=</a> <a id="12366" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="12371" href="../Soundness/#12298" class="Function">var≟-refl</a> <a id="12381" class="Symbol">(</a><a id="12382" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="12384" href="../Soundness/#12384" class="Bound">x</a><a id="12385" class="Symbol">)</a> <a id="12387" class="Keyword">rewrite</a> <a id="12395" href="../Soundness/#12298" class="Function">var≟-refl</a> <a id="12405" href="../Soundness/#12384" class="Bound">x</a> <a id="12407" class="Symbol">=</a> <a id="12409" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
<p>Now we use <code>var≟</code> to define <code>const-env</code>.</p>
<pre class="Agda"><a id="const-env"></a><a id="12465" href="../Soundness/#12465" class="Function">const-env</a> <a id="12475" class="Symbol">:</a> <a id="12477" class="Symbol">∀{</a><a id="12479" href="../Soundness/#12479" class="Bound">Γ</a><a id="12480" class="Symbol">}</a> <a id="12482" class="Symbol">→</a> <a id="12484" class="Symbol">(</a><a id="12485" href="../Soundness/#12485" class="Bound">x</a> <a id="12487" class="Symbol">:</a> <a id="12489" href="../Soundness/#12479" class="Bound">Γ</a> <a id="12491" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="12493" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="12494" class="Symbol">)</a> <a id="12496" class="Symbol">→</a> <a id="12498" href="../Denotational/#4029" class="Datatype">Value</a> <a id="12504" class="Symbol">→</a> <a id="12506" href="../Denotational/#7166" class="Function">Env</a> <a id="12510" href="../Soundness/#12479" class="Bound">Γ</a>
<a id="12512" href="../Soundness/#12465" class="Function">const-env</a> <a id="12522" href="../Soundness/#12522" class="Bound">x</a> <a id="12524" href="../Soundness/#12524" class="Bound">v</a> <a id="12526" href="../Soundness/#12526" class="Bound">y</a> <a id="12528" class="Keyword">with</a> <a id="12533" href="../Soundness/#12522" class="Bound">x</a> <a id="12535" href="../Soundness/#12049" class="Function Operator">var≟</a> <a id="12540" href="../Soundness/#12526" class="Bound">y</a>
<a id="12542" class="Symbol">...</a>             <a id="12558" class="Symbol">|</a> <a id="12560" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="12564" class="Symbol">_</a>       <a id="12572" class="Symbol">=</a> <a id="12574" class="Bound">v</a>
<a id="12576" class="Symbol">...</a>             <a id="12592" class="Symbol">|</a> <a id="12594" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1682" class="InductiveConstructor">no</a> <a id="12597" class="Symbol">_</a>        <a id="12606" class="Symbol">=</a> <a id="12608" href="../Denotational/#4049" class="InductiveConstructor">⊥</a>
</pre>
<p>Of course, <code>const-env x v</code> maps <code>x</code> to value <code>v</code></p>
<pre class="Agda"><a id="same-const-env"></a><a id="12669" href="../Soundness/#12669" class="Function">same-const-env</a> <a id="12684" class="Symbol">:</a> <a id="12686" class="Symbol">∀{</a><a id="12688" href="../Soundness/#12688" class="Bound">Γ</a><a id="12689" class="Symbol">}</a> <a id="12691" class="Symbol">{</a><a id="12692" href="../Soundness/#12692" class="Bound">x</a> <a id="12694" class="Symbol">:</a> <a id="12696" href="../Soundness/#12688" class="Bound">Γ</a> <a id="12698" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="12700" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="12701" class="Symbol">}</a> <a id="12703" class="Symbol">{</a><a id="12704" href="../Soundness/#12704" class="Bound">v</a><a id="12705" class="Symbol">}</a> <a id="12707" class="Symbol">→</a> <a id="12709" class="Symbol">(</a><a id="12710" href="../Soundness/#12465" class="Function">const-env</a> <a id="12720" href="../Soundness/#12692" class="Bound">x</a> <a id="12722" href="../Soundness/#12704" class="Bound">v</a><a id="12723" class="Symbol">)</a> <a id="12725" href="../Soundness/#12692" class="Bound">x</a> <a id="12727" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="12729" href="../Soundness/#12704" class="Bound">v</a>
<a id="12731" href="../Soundness/#12669" class="Function">same-const-env</a> <a id="12746" class="Symbol">{</a><a id="12747" class="Argument">x</a> <a id="12749" class="Symbol">=</a> <a id="12751" href="../Soundness/#12751" class="Bound">x</a><a id="12752" class="Symbol">}</a> <a id="12754" class="Keyword">rewrite</a> <a id="12762" href="../Soundness/#12298" class="Function">var≟-refl</a> <a id="12772" href="../Soundness/#12751" class="Bound">x</a> <a id="12774" class="Symbol">=</a> <a id="12776" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
<p>and <code>const-env x v</code> maps <code>y</code> to <code>⊥, so long as</code>x ≢ y`.</p>
<pre class="Agda"><a id="diff-const-env"></a><a id="12847" href="../Soundness/#12847" class="Function">diff-const-env</a> <a id="12862" class="Symbol">:</a> <a id="12864" class="Symbol">∀{</a><a id="12866" href="../Soundness/#12866" class="Bound">Γ</a><a id="12867" class="Symbol">}</a> <a id="12869" class="Symbol">{</a><a id="12870" href="../Soundness/#12870" class="Bound">x</a> <a id="12872" href="../Soundness/#12872" class="Bound">y</a> <a id="12874" class="Symbol">:</a> <a id="12876" href="../Soundness/#12866" class="Bound">Γ</a> <a id="12878" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="12880" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="12881" class="Symbol">}</a> <a id="12883" class="Symbol">{</a><a id="12884" href="../Soundness/#12884" class="Bound">v</a><a id="12885" class="Symbol">}</a>
  <a id="12889" class="Symbol">→</a> <a id="12891" href="../Soundness/#12870" class="Bound">x</a> <a id="12893" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#840" class="Function Operator">≢</a> <a id="12895" href="../Soundness/#12872" class="Bound">y</a>
    <a id="12901" class="Comment">-------------------</a>
  <a id="12923" class="Symbol">→</a> <a id="12925" href="../Soundness/#12465" class="Function">const-env</a> <a id="12935" href="../Soundness/#12870" class="Bound">x</a> <a id="12937" href="../Soundness/#12884" class="Bound">v</a> <a id="12939" href="../Soundness/#12872" class="Bound">y</a> <a id="12941" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="12943" href="../Denotational/#4049" class="InductiveConstructor">⊥</a>
<a id="12945" href="../Soundness/#12847" class="Function">diff-const-env</a> <a id="12960" class="Symbol">{</a><a id="12961" href="../Soundness/#12961" class="Bound">Γ</a><a id="12962" class="Symbol">}</a> <a id="12964" class="Symbol">{</a><a id="12965" href="../Soundness/#12965" class="Bound">x</a><a id="12966" class="Symbol">}</a> <a id="12968" class="Symbol">{</a><a id="12969" href="../Soundness/#12969" class="Bound">y</a><a id="12970" class="Symbol">}</a> <a id="12972" href="../Soundness/#12972" class="Bound">neq</a> <a id="12976" class="Keyword">with</a> <a id="12981" href="../Soundness/#12965" class="Bound">x</a> <a id="12983" href="../Soundness/#12049" class="Function Operator">var≟</a> <a id="12988" href="../Soundness/#12969" class="Bound">y</a>
<a id="12990" class="Symbol">...</a>  <a id="12995" class="Symbol">|</a> <a id="12997" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="13001" href="../Soundness/#13001" class="Bound">eq</a>  <a id="13005" class="Symbol">=</a>  <a id="13008" href="https://agda.github.io/agda-stdlib/v1.3/Data.Empty.html#628" class="Function">⊥-elim</a> <a id="13015" class="Symbol">(</a><a id="13016" class="Bound">neq</a> <a id="13020" href="../Soundness/#13001" class="Bound">eq</a><a id="13022" class="Symbol">)</a>
<a id="13024" class="Symbol">...</a>  <a id="13029" class="Symbol">|</a> <a id="13031" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1682" class="InductiveConstructor">no</a> <a id="13034" class="Symbol">_</a>    <a id="13039" class="Symbol">=</a>  <a id="13042" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
<p>So we choose <code>const-env x v</code> for <code>δ</code> and obtain <code>δ ⊢ x ↓ v</code> with the <code>var</code> rule.</p>
<p>It remains to prove that <code>γ ⊢ σ ↓ δ</code> and <code>δ ⊢ M ↓ v</code> for any <code>k</code>, given that we have chosen <code>const-env x v</code> for <code>δ</code>. We shall have two cases to consider, <code>x ≡ y</code> or <code>x ≢ y</code>.</p>
<p>Now to finish the two cases of the proof.</p>
<ul>
<li>In the case where <code>x ≡ y</code>, we need to show that <code>γ ⊢ σ y ↓ v</code>, but that’s just our premise.</li>
<li>In the case where <code>x ≢ y,</code> we need to show that <code>γ ⊢ σ y ↓ ⊥</code>, which we do via rule <code>⊥-intro</code>.</li>
</ul>
<p>Thus, we have completed the variable case of the proof that simultaneous substitution reflects denotations. Here is the proof again, formally.</p>
<pre class="Agda"><a id="subst-reflect-var"></a><a id="13698" href="../Soundness/#13698" class="Function">subst-reflect-var</a> <a id="13716" class="Symbol">:</a> <a id="13718" class="Symbol">∀</a> <a id="13720" class="Symbol">{</a><a id="13721" href="../Soundness/#13721" class="Bound">Γ</a> <a id="13723" href="../Soundness/#13723" class="Bound">Δ</a><a id="13724" class="Symbol">}</a> <a id="13726" class="Symbol">{</a><a id="13727" href="../Soundness/#13727" class="Bound">γ</a> <a id="13729" class="Symbol">:</a> <a id="13731" href="../Denotational/#7166" class="Function">Env</a> <a id="13735" href="../Soundness/#13723" class="Bound">Δ</a><a id="13736" class="Symbol">}</a> <a id="13738" class="Symbol">{</a><a id="13739" href="../Soundness/#13739" class="Bound">x</a> <a id="13741" class="Symbol">:</a> <a id="13743" href="../Soundness/#13721" class="Bound">Γ</a> <a id="13745" href="../Untyped/#3503" class="Datatype Operator">∋</a> <a id="13747" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="13748" class="Symbol">}</a> <a id="13750" class="Symbol">{</a><a id="13751" href="../Soundness/#13751" class="Bound">v</a><a id="13752" class="Symbol">}</a> <a id="13754" class="Symbol">{</a><a id="13755" href="../Soundness/#13755" class="Bound">σ</a> <a id="13757" class="Symbol">:</a> <a id="13759" href="../Substitution/#2405" class="Function">Subst</a> <a id="13765" href="../Soundness/#13721" class="Bound">Γ</a> <a id="13767" href="../Soundness/#13723" class="Bound">Δ</a><a id="13768" class="Symbol">}</a>
  <a id="13772" class="Symbol">→</a> <a id="13774" href="../Soundness/#13727" class="Bound">γ</a> <a id="13776" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="13778" href="../Soundness/#13755" class="Bound">σ</a> <a id="13780" href="../Soundness/#13739" class="Bound">x</a> <a id="13782" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="13784" href="../Soundness/#13751" class="Bound">v</a>
    <a id="13790" class="Comment">-----------------------------------------</a>
  <a id="13834" class="Symbol">→</a> <a id="13836" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="13839" href="../Soundness/#13839" class="Bound">δ</a> <a id="13841" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="13843" href="../Denotational/#7166" class="Function">Env</a> <a id="13847" href="../Soundness/#13721" class="Bound">Γ</a> <a id="13849" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="13851" href="../Soundness/#13727" class="Bound">γ</a> <a id="13853" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="13856" href="../Soundness/#13755" class="Bound">σ</a> <a id="13858" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="13860" href="../Soundness/#13839" class="Bound">δ</a>  <a id="13863" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a>  <a id="13866" href="../Soundness/#13839" class="Bound">δ</a> <a id="13868" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="13870" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="13872" href="../Soundness/#13739" class="Bound">x</a> <a id="13874" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="13876" href="../Soundness/#13751" class="Bound">v</a>
<a id="13878" href="../Soundness/#13698" class="Function">subst-reflect-var</a> <a id="13896" class="Symbol">{</a><a id="13897" href="../Soundness/#13897" class="Bound">Γ</a><a id="13898" class="Symbol">}{</a><a id="13900" href="../Soundness/#13900" class="Bound">Δ</a><a id="13901" class="Symbol">}{</a><a id="13903" href="../Soundness/#13903" class="Bound">γ</a><a id="13904" class="Symbol">}{</a><a id="13906" href="../Soundness/#13906" class="Bound">x</a><a id="13907" class="Symbol">}{</a><a id="13909" href="../Soundness/#13909" class="Bound">v</a><a id="13910" class="Symbol">}{</a><a id="13912" href="../Soundness/#13912" class="Bound">σ</a><a id="13913" class="Symbol">}</a> <a id="13915" href="../Soundness/#13915" class="Bound">xv</a>
  <a id="13920" class="Keyword">rewrite</a> <a id="13928" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a> <a id="13932" class="Symbol">(</a><a id="13933" href="../Soundness/#12669" class="Function">same-const-env</a> <a id="13948" class="Symbol">{</a><a id="13949" href="../Soundness/#13897" class="Bound">Γ</a><a id="13950" class="Symbol">}{</a><a id="13952" href="../Soundness/#13906" class="Bound">x</a><a id="13953" class="Symbol">}{</a><a id="13955" href="../Soundness/#13909" class="Bound">v</a><a id="13956" class="Symbol">})</a> <a id="13959" class="Symbol">=</a>
    <a id="13965" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="13967" href="../Soundness/#12465" class="Function">const-env</a> <a id="13977" href="../Soundness/#13906" class="Bound">x</a> <a id="13979" href="../Soundness/#13909" class="Bound">v</a> <a id="13981" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="13983" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="13985" href="../Soundness/#14018" class="Function">const-env-ok</a> <a id="13998" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="14000" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="14004" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="14006" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>
  <a id="14010" class="Keyword">where</a>
  <a id="14018" href="../Soundness/#14018" class="Function">const-env-ok</a> <a id="14031" class="Symbol">:</a> <a id="14033" href="../Soundness/#13903" class="Bound">γ</a> <a id="14035" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="14038" href="../Soundness/#13912" class="Bound">σ</a> <a id="14040" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="14042" href="../Soundness/#12465" class="Function">const-env</a> <a id="14052" href="../Soundness/#13906" class="Bound">x</a> <a id="14054" href="../Soundness/#13909" class="Bound">v</a>
  <a id="14058" href="../Soundness/#14018" class="Function">const-env-ok</a> <a id="14071" href="../Soundness/#14071" class="Bound">y</a> <a id="14073" class="Keyword">with</a> <a id="14078" href="../Soundness/#13906" class="Bound">x</a> <a id="14080" href="../Soundness/#12049" class="Function Operator">var≟</a> <a id="14085" href="../Soundness/#14071" class="Bound">y</a>
  <a id="14089" class="Symbol">...</a> <a id="14093" class="Symbol">|</a> <a id="14095" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="14099" href="../Soundness/#14099" class="Bound">x≡y</a> <a id="14103" class="Keyword">rewrite</a> <a id="14111" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a> <a id="14115" href="../Soundness/#14099" class="Bound">x≡y</a> <a id="14119" class="Symbol">|</a> <a id="14121" href="../Soundness/#12669" class="Function">same-const-env</a> <a id="14136" class="Symbol">{</a><a id="14137" href="../Soundness/#13897" class="Bound">Γ</a><a id="14138" class="Symbol">}{</a><a id="14140" href="../Soundness/#13906" class="Bound">x</a><a id="14141" class="Symbol">}{</a><a id="14143" href="../Soundness/#13909" class="Bound">v</a><a id="14144" class="Symbol">}</a> <a id="14146" class="Symbol">=</a> <a id="14148" href="../Soundness/#13915" class="Bound">xv</a>
  <a id="14153" class="Symbol">...</a> <a id="14157" class="Symbol">|</a> <a id="14159" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Nullary.html#1682" class="InductiveConstructor">no</a> <a id="14162" href="../Soundness/#14162" class="Bound">x≢y</a> <a id="14166" class="Keyword">rewrite</a> <a id="14174" href="../Soundness/#12847" class="Function">diff-const-env</a> <a id="14189" class="Symbol">{</a><a id="14190" href="../Soundness/#13897" class="Bound">Γ</a><a id="14191" class="Symbol">}{</a><a id="14193" href="../Soundness/#13906" class="Bound">x</a><a id="14194" class="Symbol">}{</a><a id="14196" class="Bound">y</a><a id="14197" class="Symbol">}{</a><a id="14199" href="../Soundness/#13909" class="Bound">v</a><a id="14200" class="Symbol">}</a> <a id="14202" href="../Soundness/#14162" class="Bound">x≢y</a> <a id="14206" class="Symbol">=</a> <a id="14208" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a>
</pre>
<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>
<p>Every substitution produces terms that can evaluate to <code>⊥</code>.</p>
<pre class="Agda"><a id="subst-⊥"></a><a id="14335" href="../Soundness/#14335" class="Function">subst-⊥</a> <a id="14343" class="Symbol">:</a> <a id="14345" class="Symbol">∀{</a><a id="14347" href="../Soundness/#14347" class="Bound">Γ</a> <a id="14349" href="../Soundness/#14349" class="Bound">Δ</a><a id="14350" class="Symbol">}{</a><a id="14352" href="../Soundness/#14352" class="Bound">γ</a> <a id="14354" class="Symbol">:</a> <a id="14356" href="../Denotational/#7166" class="Function">Env</a> <a id="14360" href="../Soundness/#14349" class="Bound">Δ</a><a id="14361" class="Symbol">}{</a><a id="14363" href="../Soundness/#14363" class="Bound">σ</a> <a id="14365" class="Symbol">:</a> <a id="14367" href="../Substitution/#2405" class="Function">Subst</a> <a id="14373" href="../Soundness/#14347" class="Bound">Γ</a> <a id="14375" href="../Soundness/#14349" class="Bound">Δ</a><a id="14376" class="Symbol">}</a>
    <a id="14382" class="Comment">-----------------</a>
  <a id="14402" class="Symbol">→</a> <a id="14404" href="../Soundness/#14352" class="Bound">γ</a> <a id="14406" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="14409" href="../Soundness/#14363" class="Bound">σ</a> <a id="14411" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="14413" href="../Denotational/#8189" class="Function">`⊥</a>
<a id="14416" href="../Soundness/#14335" class="Function">subst-⊥</a> <a id="14424" href="../Soundness/#14424" class="Bound">x</a> <a id="14426" class="Symbol">=</a> <a id="14428" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a>
</pre>
<p>If a substitution produces terms that evaluate to the values in both <code>γ₁</code> and <code>γ₂</code>, then those terms also evaluate to the values in <code>γ₁ ⊔ γ₂</code>.</p>
<pre class="Agda"><a id="subst-⊔"></a><a id="14589" href="../Soundness/#14589" class="Function">subst-⊔</a> <a id="14597" class="Symbol">:</a> <a id="14599" class="Symbol">∀{</a><a id="14601" href="../Soundness/#14601" class="Bound">Γ</a> <a id="14603" href="../Soundness/#14603" class="Bound">Δ</a><a id="14604" class="Symbol">}{</a><a id="14606" href="../Soundness/#14606" class="Bound">γ</a> <a id="14608" class="Symbol">:</a> <a id="14610" href="../Denotational/#7166" class="Function">Env</a> <a id="14614" href="../Soundness/#14603" class="Bound">Δ</a><a id="14615" class="Symbol">}{</a><a id="14617" href="../Soundness/#14617" class="Bound">γ₁</a> <a id="14620" href="../Soundness/#14620" class="Bound">γ₂</a> <a id="14623" class="Symbol">:</a> <a id="14625" href="../Denotational/#7166" class="Function">Env</a> <a id="14629" href="../Soundness/#14601" class="Bound">Γ</a><a id="14630" class="Symbol">}{</a><a id="14632" href="../Soundness/#14632" class="Bound">σ</a> <a id="14634" class="Symbol">:</a> <a id="14636" href="../Substitution/#2405" class="Function">Subst</a> <a id="14642" href="../Soundness/#14601" class="Bound">Γ</a> <a id="14644" href="../Soundness/#14603" class="Bound">Δ</a><a id="14645" class="Symbol">}</a>
           <a id="14658" class="Symbol">→</a> <a id="14660" href="../Soundness/#14606" class="Bound">γ</a> <a id="14662" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="14665" href="../Soundness/#14632" class="Bound">σ</a> <a id="14667" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="14669" href="../Soundness/#14617" class="Bound">γ₁</a>
           <a id="14683" class="Symbol">→</a> <a id="14685" href="../Soundness/#14606" class="Bound">γ</a> <a id="14687" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="14690" href="../Soundness/#14632" class="Bound">σ</a> <a id="14692" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="14694" href="../Soundness/#14620" class="Bound">γ₂</a>
             <a id="14710" class="Comment">-------------------------</a>
           <a id="14747" class="Symbol">→</a> <a id="14749" href="../Soundness/#14606" class="Bound">γ</a> <a id="14751" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="14754" href="../Soundness/#14632" class="Bound">σ</a> <a id="14756" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="14758" class="Symbol">(</a><a id="14759" href="../Soundness/#14617" class="Bound">γ₁</a> <a id="14762" href="../Denotational/#8218" class="Function Operator">`⊔</a> <a id="14765" href="../Soundness/#14620" class="Bound">γ₂</a><a id="14767" class="Symbol">)</a>
<a id="14769" href="../Soundness/#14589" class="Function">subst-⊔</a> <a id="14777" href="../Soundness/#14777" class="Bound">γ₁-ok</a> <a id="14783" href="../Soundness/#14783" class="Bound">γ₂-ok</a> <a id="14789" href="../Soundness/#14789" class="Bound">x</a> <a id="14791" class="Symbol">=</a> <a id="14793" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="14801" class="Symbol">(</a><a id="14802" href="../Soundness/#14777" class="Bound">γ₁-ok</a> <a id="14808" href="../Soundness/#14789" class="Bound">x</a><a id="14809" class="Symbol">)</a> <a id="14811" class="Symbol">(</a><a id="14812" href="../Soundness/#14783" class="Bound">γ₂-ok</a> <a id="14818" href="../Soundness/#14789" class="Bound">x</a><a id="14819" class="Symbol">)</a>
</pre>
<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>
<pre class="Agda"><a id="lambda-inj"></a><a id="14871" href="../Soundness/#14871" class="Function">lambda-inj</a> <a id="14882" class="Symbol">:</a> <a id="14884" class="Symbol">∀</a> <a id="14886" class="Symbol">{</a><a id="14887" href="../Soundness/#14887" class="Bound">Γ</a><a id="14888" class="Symbol">}</a> <a id="14890" class="Symbol">{</a><a id="14891" href="../Soundness/#14891" class="Bound">M</a> <a id="14893" href="../Soundness/#14893" class="Bound">N</a> <a id="14895" class="Symbol">:</a> <a id="14897" href="../Soundness/#14887" class="Bound">Γ</a> <a id="14899" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="14901" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="14903" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="14905" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="14907" class="Symbol">}</a>
  <a id="14911" class="Symbol">→</a> <a id="14913" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a> <a id="14917" class="Symbol">{</a><a id="14918" class="Argument">A</a> <a id="14920" class="Symbol">=</a> <a id="14922" href="../Soundness/#14887" class="Bound">Γ</a> <a id="14924" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="14926" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="14927" class="Symbol">}</a> <a id="14929" class="Symbol">(</a><a id="14930" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="14932" href="../Soundness/#14891" class="Bound">M</a><a id="14933" class="Symbol">)</a> <a id="14935" class="Symbol">(</a><a id="14936" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="14938" href="../Soundness/#14893" class="Bound">N</a><a id="14939" class="Symbol">)</a>
    <a id="14945" class="Comment">---------------------------</a>
  <a id="14975" class="Symbol">→</a> <a id="14977" href="../Soundness/#14891" class="Bound">M</a> <a id="14979" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="14981" href="../Soundness/#14893" class="Bound">N</a>
<a id="14983" href="../Soundness/#14871" class="Function">lambda-inj</a> <a id="14994" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="14999" class="Symbol">=</a> <a id="15001" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>
<p>In this section we prove a central lemma, that substitution reflects denotations. That is, if <code>γ ⊢ subst σ M ↓ v</code>, then <code>δ ⊢ M ↓ v</code> and <code>γ ⊢ σ ↓ δ</code> for some <code>δ</code>. We shall proceed by induction on the derivation of <code>γ ⊢ subst σ M ↓ v</code>. This requires a minor restatement of the lemma, changing the premise to <code>γ ⊢ L ↓ v</code> and <code>L ≡ subst σ M</code>.</p>
<pre class="Agda"><a id="split"></a><a id="15407" href="../Soundness/#15407" class="Function">split</a> <a id="15413" class="Symbol">:</a> <a id="15415" class="Symbol">∀</a> <a id="15417" class="Symbol">{</a><a id="15418" href="../Soundness/#15418" class="Bound">Γ</a><a id="15419" class="Symbol">}</a> <a id="15421" class="Symbol">{</a><a id="15422" href="../Soundness/#15422" class="Bound">M</a> <a id="15424" class="Symbol">:</a> <a id="15426" href="../Soundness/#15418" class="Bound">Γ</a> <a id="15428" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="15430" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="15432" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="15434" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="15435" class="Symbol">}</a> <a id="15437" class="Symbol">{</a><a id="15438" href="../Soundness/#15438" class="Bound">δ</a> <a id="15440" class="Symbol">:</a> <a id="15442" href="../Denotational/#7166" class="Function">Env</a> <a id="15446" class="Symbol">(</a><a id="15447" href="../Soundness/#15418" class="Bound">Γ</a> <a id="15449" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="15451" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="15452" class="Symbol">)}</a> <a id="15455" class="Symbol">{</a><a id="15456" href="../Soundness/#15456" class="Bound">v</a><a id="15457" class="Symbol">}</a>
  <a id="15461" class="Symbol">→</a> <a id="15463" href="../Soundness/#15438" class="Bound">δ</a> <a id="15465" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="15467" href="../Soundness/#15422" class="Bound">M</a> <a id="15469" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="15471" href="../Soundness/#15456" class="Bound">v</a>
    <a id="15477" class="Comment">--------------------------</a>
  <a id="15506" class="Symbol">→</a> <a id="15508" class="Symbol">(</a><a id="15509" href="../Denotational/#7564" class="Function">init</a> <a id="15514" href="../Soundness/#15438" class="Bound">δ</a> <a id="15516" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="15519" href="../Denotational/#7619" class="Function">last</a> <a id="15524" href="../Soundness/#15438" class="Bound">δ</a><a id="15525" class="Symbol">)</a> <a id="15527" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="15529" href="../Soundness/#15422" class="Bound">M</a> <a id="15531" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="15533" href="../Soundness/#15456" class="Bound">v</a>
<a id="15535" href="../Soundness/#15407" class="Function">split</a> <a id="15541" class="Symbol">{</a><a id="15542" class="Argument">δ</a> <a id="15544" class="Symbol">=</a> <a id="15546" href="../Soundness/#15546" class="Bound">δ</a><a id="15547" class="Symbol">}</a> <a id="15549" href="../Soundness/#15549" class="Bound">δMv</a> <a id="15553" class="Keyword">rewrite</a> <a id="15561" href="../Denotational/#7668" class="Function">init-last</a> <a id="15571" href="../Soundness/#15546" class="Bound">δ</a> <a id="15573" class="Symbol">=</a> <a id="15575" href="../Soundness/#15549" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="15580" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="15594" class="Symbol">:</a> <a id="15596" class="Symbol">∀</a> <a id="15598" class="Symbol">{</a><a id="15599" href="../Soundness/#15599" class="Bound">Γ</a> <a id="15601" href="../Soundness/#15601" class="Bound">Δ</a><a id="15602" class="Symbol">}</a> <a id="15604" class="Symbol">{</a><a id="15605" href="../Soundness/#15605" class="Bound">δ</a> <a id="15607" class="Symbol">:</a> <a id="15609" href="../Denotational/#7166" class="Function">Env</a> <a id="15613" href="../Soundness/#15601" class="Bound">Δ</a><a id="15614" class="Symbol">}</a> <a id="15616" class="Symbol">{</a><a id="15617" href="../Soundness/#15617" class="Bound">M</a> <a id="15619" class="Symbol">:</a> <a id="15621" href="../Soundness/#15599" class="Bound">Γ</a> <a id="15623" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="15625" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="15626" class="Symbol">}</a> <a id="15628" class="Symbol">{</a><a id="15629" href="../Soundness/#15629" class="Bound">v</a><a id="15630" class="Symbol">}</a> <a id="15632" class="Symbol">{</a><a id="15633" href="../Soundness/#15633" class="Bound">L</a> <a id="15635" class="Symbol">:</a> <a id="15637" href="../Soundness/#15601" class="Bound">Δ</a> <a id="15639" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="15641" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="15642" class="Symbol">}</a> <a id="15644" class="Symbol">{</a><a id="15645" href="../Soundness/#15645" class="Bound">σ</a> <a id="15647" class="Symbol">:</a> <a id="15649" href="../Substitution/#2405" class="Function">Subst</a> <a id="15655" href="../Soundness/#15599" class="Bound">Γ</a> <a id="15657" href="../Soundness/#15601" class="Bound">Δ</a><a id="15658" class="Symbol">}</a>
  <a id="15662" class="Symbol">→</a> <a id="15664" href="../Soundness/#15605" class="Bound">δ</a> <a id="15666" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="15668" href="../Soundness/#15633" class="Bound">L</a> <a id="15670" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="15672" href="../Soundness/#15629" class="Bound">v</a>
  <a id="15676" class="Symbol">→</a> <a id="15678" href="../Untyped/#6945" class="Function">subst</a> <a id="15684" href="../Soundness/#15645" class="Bound">σ</a> <a id="15686" href="../Soundness/#15617" class="Bound">M</a> <a id="15688" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="15690" href="../Soundness/#15633" class="Bound">L</a>
    <a id="15696" class="Comment">---------------------------------------</a>
  <a id="15738" class="Symbol">→</a> <a id="15740" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="15743" href="../Soundness/#15743" class="Bound">γ</a> <a id="15745" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="15747" href="../Denotational/#7166" class="Function">Env</a> <a id="15751" href="../Soundness/#15599" class="Bound">Γ</a> <a id="15753" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="15755" href="../Soundness/#15605" class="Bound">δ</a> <a id="15757" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="15760" href="../Soundness/#15645" class="Bound">σ</a> <a id="15762" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="15764" href="../Soundness/#15743" class="Bound">γ</a>  <a id="15767" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a>  <a id="15770" href="../Soundness/#15743" class="Bound">γ</a> <a id="15772" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="15774" href="../Soundness/#15617" class="Bound">M</a> <a id="15776" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="15778" href="../Soundness/#15629" class="Bound">v</a>

<a id="15781" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="15795" class="Symbol">{</a><a id="15796" class="Argument">M</a> <a id="15798" class="Symbol">=</a> <a id="15800" href="../Soundness/#15800" class="Bound">M</a><a id="15801" class="Symbol">}{</a><a id="15803" class="Argument">σ</a> <a id="15805" class="Symbol">=</a> <a id="15807" href="../Soundness/#15807" class="Bound">σ</a><a id="15808" class="Symbol">}</a> <a id="15810" class="Symbol">(</a><a id="15811" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="15815" class="Symbol">{</a><a id="15816" class="Argument">x</a> <a id="15818" class="Symbol">=</a> <a id="15820" href="../Soundness/#15820" class="Bound">y</a><a id="15821" class="Symbol">})</a> <a id="15824" href="../Soundness/#15824" class="Bound">eqL</a> <a id="15828" class="Keyword">with</a> <a id="15833" href="../Soundness/#15800" class="Bound">M</a>
<a id="15835" class="Symbol">...</a> <a id="15839" class="Symbol">|</a> <a id="15841" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="15843" href="../Soundness/#15843" class="Bound">x</a>  <a id="15846" class="Keyword">with</a> <a id="15851" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="15855" class="Symbol">{</a><a id="15856" class="Argument">x</a> <a id="15858" class="Symbol">=</a> <a id="15860" class="Bound">y</a><a id="15861" class="Symbol">}</a>
<a id="15863" class="Symbol">...</a>           <a id="15877" class="Symbol">|</a> <a id="15879" href="../Soundness/#15879" class="Bound">yv</a>  <a id="15883" class="Keyword">rewrite</a> <a id="15891" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a> <a id="15895" class="Bound">eqL</a> <a id="15899" class="Symbol">=</a> <a id="15901" href="../Soundness/#13698" class="Function">subst-reflect-var</a> <a id="15919" class="Symbol">{</a><a id="15920" class="Argument">σ</a> <a id="15922" class="Symbol">=</a> <a id="15924" class="Bound">σ</a><a id="15925" class="Symbol">}</a> <a id="15927" href="../Soundness/#15879" class="Bound">yv</a>
<a id="15930" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="15944" class="Symbol">{</a><a id="15945" class="Argument">M</a> <a id="15947" class="Symbol">=</a> <a id="15949" href="../Soundness/#15949" class="Bound">M</a><a id="15950" class="Symbol">}</a> <a id="15952" class="Symbol">(</a><a id="15953" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="15957" class="Symbol">{</a><a id="15958" class="Argument">x</a> <a id="15960" class="Symbol">=</a> <a id="15962" href="../Soundness/#15962" class="Bound">y</a><a id="15963" class="Symbol">})</a> <a id="15966" class="Symbol">()</a> <a id="15969" class="Symbol">|</a> <a id="15971" href="../Soundness/#15971" class="Bound">M₁</a> <a id="15974" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="15976" href="../Soundness/#15976" class="Bound">M₂</a>
<a id="15979" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="15993" class="Symbol">{</a><a id="15994" class="Argument">M</a> <a id="15996" class="Symbol">=</a> <a id="15998" href="../Soundness/#15998" class="Bound">M</a><a id="15999" class="Symbol">}</a> <a id="16001" class="Symbol">(</a><a id="16002" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="16006" class="Symbol">{</a><a id="16007" class="Argument">x</a> <a id="16009" class="Symbol">=</a> <a id="16011" href="../Soundness/#16011" class="Bound">y</a><a id="16012" class="Symbol">})</a> <a id="16015" class="Symbol">()</a> <a id="16018" class="Symbol">|</a> <a id="16020" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="16022" href="../Soundness/#16022" class="Bound">M′</a>

<a id="16026" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="16040" class="Symbol">{</a><a id="16041" class="Argument">M</a> <a id="16043" class="Symbol">=</a> <a id="16045" href="../Soundness/#16045" class="Bound">M</a><a id="16046" class="Symbol">}{</a><a id="16048" class="Argument">σ</a> <a id="16050" class="Symbol">=</a> <a id="16052" href="../Soundness/#16052" class="Bound">σ</a><a id="16053" class="Symbol">}</a> <a id="16055" class="Symbol">(</a><a id="16056" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="16063" href="../Soundness/#16063" class="Bound">d₁</a> <a id="16066" href="../Soundness/#16066" class="Bound">d₂</a><a id="16068" class="Symbol">)</a> <a id="16070" href="../Soundness/#16070" class="Bound">eqL</a>
         <a id="16083" class="Keyword">with</a> <a id="16088" href="../Soundness/#16045" class="Bound">M</a>
<a id="16090" class="Symbol">...</a>    <a id="16097" class="Symbol">|</a> <a id="16099" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="16101" href="../Soundness/#16101" class="Bound">x</a> <a id="16103" class="Keyword">with</a> <a id="16108" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="16115" class="Bound">d₁</a> <a id="16118" class="Bound">d₂</a>
<a id="16121" class="Symbol">...</a>    <a id="16128" class="Symbol">|</a> <a id="16130" href="../Soundness/#16130" class="Bound">d′</a> <a id="16133" class="Keyword">rewrite</a> <a id="16141" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a> <a id="16145" class="Bound">eqL</a> <a id="16149" class="Symbol">=</a> <a id="16151" href="../Soundness/#13698" class="Function">subst-reflect-var</a> <a id="16169" class="Symbol">{</a><a id="16170" class="Argument">σ</a> <a id="16172" class="Symbol">=</a> <a id="16174" class="Bound">σ</a><a id="16175" class="Symbol">}</a> <a id="16177" href="../Soundness/#16130" class="Bound">d′</a>
<a id="16180" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="16194" class="Symbol">(</a><a id="16195" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="16202" href="../Soundness/#16202" class="Bound">d₁</a> <a id="16205" href="../Soundness/#16205" class="Bound">d₂</a><a id="16207" class="Symbol">)</a> <a id="16209" class="Symbol">()</a> <a id="16212" class="Symbol">|</a> <a id="16214" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="16216" href="../Soundness/#16216" class="Bound">M′</a>
<a id="16219" href="../Soundness/#15580" class="Function">subst-reflect</a><a id="16232" class="Symbol">{</a><a id="16233" href="../Soundness/#16233" class="Bound">Γ</a><a id="16234" class="Symbol">}{</a><a id="16236" href="../Soundness/#16236" class="Bound">Δ</a><a id="16237" class="Symbol">}{</a><a id="16239" href="../Soundness/#16239" class="Bound">γ</a><a id="16240" class="Symbol">}{</a><a id="16242" class="Argument">σ</a> <a id="16244" class="Symbol">=</a> <a id="16246" href="../Soundness/#16246" class="Bound">σ</a><a id="16247" class="Symbol">}</a> <a id="16249" class="Symbol">(</a><a id="16250" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="16257" href="../Soundness/#16257" class="Bound">d₁</a> <a id="16260" href="../Soundness/#16260" class="Bound">d₂</a><a id="16262" class="Symbol">)</a>
   <a id="16267" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="16272" class="Symbol">|</a> <a id="16274" href="../Soundness/#16274" class="Bound">M₁</a> <a id="16277" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="16279" href="../Soundness/#16279" class="Bound">M₂</a>
     <a id="16287" class="Keyword">with</a> <a id="16292" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="16306" class="Symbol">{</a><a id="16307" class="Argument">M</a> <a id="16309" class="Symbol">=</a> <a id="16311" href="../Soundness/#16274" class="Bound">M₁</a><a id="16313" class="Symbol">}</a> <a id="16315" href="../Soundness/#16257" class="Bound">d₁</a> <a id="16318" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="16323" class="Symbol">|</a> <a id="16325" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="16339" class="Symbol">{</a><a id="16340" class="Argument">M</a> <a id="16342" class="Symbol">=</a> <a id="16344" href="../Soundness/#16279" class="Bound">M₂</a><a id="16346" class="Symbol">}</a> <a id="16348" href="../Soundness/#16260" class="Bound">d₂</a> <a id="16351" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="16356" class="Symbol">...</a>     <a id="16364" class="Symbol">|</a> <a id="16366" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16368" href="../Soundness/#16368" class="Bound">δ₁</a> <a id="16371" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="16373" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16375" href="../Soundness/#16375" class="Bound">subst-δ₁</a> <a id="16384" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="16386" href="../Soundness/#16386" class="Bound">m1</a> <a id="16389" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="16391" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="16393" class="Symbol">|</a> <a id="16395" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16397" href="../Soundness/#16397" class="Bound">δ₂</a> <a id="16400" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="16402" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16404" href="../Soundness/#16404" class="Bound">subst-δ₂</a> <a id="16413" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="16415" href="../Soundness/#16415" class="Bound">m2</a> <a id="16418" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="16420" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="16422" class="Symbol">=</a>
     <a id="16429" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16431" href="../Soundness/#16368" class="Bound">δ₁</a> <a id="16434" href="../Denotational/#8218" class="Function Operator">`⊔</a> <a id="16437" href="../Soundness/#16397" class="Bound">δ₂</a> <a id="16440" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="16442" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16444" href="../Soundness/#14589" class="Function">subst-⊔</a> <a id="16452" class="Symbol">{</a><a id="16453" class="Argument">γ₁</a> <a id="16456" class="Symbol">=</a> <a id="16458" href="../Soundness/#16368" class="Bound">δ₁</a><a id="16460" class="Symbol">}{</a><a id="16462" class="Argument">γ₂</a> <a id="16465" class="Symbol">=</a> <a id="16467" href="../Soundness/#16397" class="Bound">δ₂</a><a id="16469" class="Symbol">}{</a><a id="16471" class="Argument">σ</a> <a id="16473" class="Symbol">=</a> <a id="16475" class="Bound">σ</a><a id="16476" class="Symbol">}</a> <a id="16478" href="../Soundness/#16375" class="Bound">subst-δ₁</a> <a id="16487" href="../Soundness/#16404" class="Bound">subst-δ₂</a> <a id="16496" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a>
                    <a id="16518" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="16525" class="Symbol">(</a><a id="16526" href="../Denotational/#25590" class="Function">⊑-env</a> <a id="16532" href="../Soundness/#16386" class="Bound">m1</a> <a id="16535" class="Symbol">(</a><a id="16536" href="../Denotational/#8548" class="Function">⊑-env-conj-R1</a> <a id="16550" href="../Soundness/#16368" class="Bound">δ₁</a> <a id="16553" href="../Soundness/#16397" class="Bound">δ₂</a><a id="16555" class="Symbol">))</a>
                           <a id="16585" class="Symbol">(</a><a id="16586" href="../Denotational/#25590" class="Function">⊑-env</a> <a id="16592" href="../Soundness/#16415" class="Bound">m2</a> <a id="16595" class="Symbol">(</a><a id="16596" href="../Denotational/#8654" class="Function">⊑-env-conj-R2</a> <a id="16610" href="../Soundness/#16368" class="Bound">δ₁</a> <a id="16613" href="../Soundness/#16397" class="Bound">δ₂</a><a id="16615" class="Symbol">))</a> <a id="16618" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="16620" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>

<a id="16623" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="16637" class="Symbol">{</a><a id="16638" class="Argument">M</a> <a id="16640" class="Symbol">=</a> <a id="16642" href="../Soundness/#16642" class="Bound">M</a><a id="16643" class="Symbol">}{</a><a id="16645" class="Argument">σ</a> <a id="16647" class="Symbol">=</a> <a id="16649" href="../Soundness/#16649" class="Bound">σ</a><a id="16650" class="Symbol">}</a> <a id="16652" class="Symbol">(</a><a id="16653" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="16661" href="../Soundness/#16661" class="Bound">d</a><a id="16662" class="Symbol">)</a> <a id="16664" href="../Soundness/#16664" class="Bound">eqL</a> <a id="16668" class="Keyword">with</a> <a id="16673" href="../Soundness/#16642" class="Bound">M</a>
<a id="16675" class="Symbol">...</a>    <a id="16682" class="Symbol">|</a> <a id="16684" href="../Untyped/#4312" class="InductiveConstructor Operator">`</a> <a id="16686" href="../Soundness/#16686" class="Bound">x</a> <a id="16688" class="Keyword">with</a> <a id="16693" class="Symbol">(</a><a id="16694" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="16702" class="Bound">d</a><a id="16703" class="Symbol">)</a>
<a id="16705" class="Symbol">...</a>             <a id="16721" class="Symbol">|</a> <a id="16723" href="../Soundness/#16723" class="Bound">d′</a> <a id="16726" class="Keyword">rewrite</a> <a id="16734" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a> <a id="16738" class="Bound">eqL</a> <a id="16742" class="Symbol">=</a> <a id="16744" href="../Soundness/#13698" class="Function">subst-reflect-var</a> <a id="16762" class="Symbol">{</a><a id="16763" class="Argument">σ</a> <a id="16765" class="Symbol">=</a> <a id="16767" class="Bound">σ</a><a id="16768" class="Symbol">}</a> <a id="16770" href="../Soundness/#16723" class="Bound">d′</a>
<a id="16773" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="16787" class="Symbol">{</a><a id="16788" class="Argument">σ</a> <a id="16790" class="Symbol">=</a> <a id="16792" href="../Soundness/#16792" class="Bound">σ</a><a id="16793" class="Symbol">}</a> <a id="16795" class="Symbol">(</a><a id="16796" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="16804" href="../Soundness/#16804" class="Bound">d</a><a id="16805" class="Symbol">)</a> <a id="16807" href="../Soundness/#16807" class="Bound">eq</a> <a id="16810" class="Symbol">|</a> <a id="16812" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="16814" href="../Soundness/#16814" class="Bound">M′</a>
      <a id="16823" class="Keyword">with</a> <a id="16828" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="16842" class="Symbol">{</a><a id="16843" class="Argument">σ</a> <a id="16845" class="Symbol">=</a> <a id="16847" href="../Untyped/#6653" class="Function">exts</a> <a id="16852" href="../Soundness/#16792" class="Bound">σ</a><a id="16853" class="Symbol">}</a> <a id="16855" href="../Soundness/#16804" class="Bound">d</a> <a id="16857" class="Symbol">(</a><a id="16858" href="../Soundness/#14871" class="Function">lambda-inj</a> <a id="16869" href="../Soundness/#16807" class="Bound">eq</a><a id="16871" class="Symbol">)</a>
<a id="16873" class="Symbol">...</a> <a id="16877" class="Symbol">|</a> <a id="16879" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16881" href="../Soundness/#16881" class="Bound">δ′</a> <a id="16884" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="16886" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16888" href="../Soundness/#16888" class="Bound">exts-σ-δ′</a> <a id="16898" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="16900" href="../Soundness/#16900" class="Bound">m′</a> <a id="16903" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="16905" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="16907" class="Symbol">=</a>
    <a id="16913" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16915" href="../Denotational/#7564" class="Function">init</a> <a id="16920" href="../Soundness/#16881" class="Bound">δ′</a> <a id="16923" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="16925" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="16927" class="Symbol">((λ</a> <a id="16931" href="../Soundness/#16931" class="Bound">x</a> <a id="16933" class="Symbol">→</a> <a id="16935" href="../Soundness/#11149" class="Function">rename-inc-reflect</a> <a id="16954" class="Symbol">(</a><a id="16955" href="../Soundness/#16888" class="Bound">exts-σ-δ′</a> <a id="16965" class="Symbol">(</a><a id="16966" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="16968" href="../Soundness/#16931" class="Bound">x</a><a id="16969" class="Symbol">))))</a> <a id="16974" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a>
             <a id="16989" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="16997" class="Symbol">(</a><a id="16998" href="../Denotational/#26035" class="Function">up-env</a> <a id="17005" class="Symbol">(</a><a id="17006" href="../Soundness/#15407" class="Function">split</a> <a id="17012" href="../Soundness/#16900" class="Bound">m′</a><a id="17014" class="Symbol">)</a> <a id="17016" class="Symbol">(</a><a id="17017" href="../Compositional/#10011" class="Function">var-inv</a> <a id="17025" class="Symbol">(</a><a id="17026" href="../Soundness/#16888" class="Bound">exts-σ-δ′</a> <a id="17036" href="../Untyped/#3539" class="InductiveConstructor">Z</a><a id="17037" class="Symbol">)))</a> <a id="17041" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17043" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>
<a id="17045" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="17059" class="Symbol">(</a><a id="17060" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="17068" href="../Soundness/#17068" class="Bound">d</a><a id="17069" class="Symbol">)</a> <a id="17071" class="Symbol">()</a> <a id="17074" class="Symbol">|</a> <a id="17076" href="../Soundness/#17076" class="Bound">M₁</a> <a id="17079" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="17081" href="../Soundness/#17081" class="Bound">M₂</a>

<a id="17085" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="17099" class="Symbol">{</a><a id="17100" class="Argument">σ</a> <a id="17102" class="Symbol">=</a> <a id="17104" href="../Soundness/#17104" class="Bound">σ</a><a id="17105" class="Symbol">}</a> <a id="17107" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a> <a id="17115" href="../Soundness/#17115" class="Bound">eq</a> <a id="17118" class="Symbol">=</a>
    <a id="17124" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17126" href="../Denotational/#8189" class="Function">`⊥</a> <a id="17129" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17131" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17133" href="../Soundness/#14335" class="Function">subst-⊥</a> <a id="17141" class="Symbol">{</a><a id="17142" class="Argument">σ</a> <a id="17144" class="Symbol">=</a> <a id="17146" href="../Soundness/#17104" class="Bound">σ</a><a id="17147" class="Symbol">}</a> <a id="17149" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17151" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a> <a id="17159" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17161" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>

<a id="17164" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="17178" class="Symbol">{</a><a id="17179" class="Argument">σ</a> <a id="17181" class="Symbol">=</a> <a id="17183" href="../Soundness/#17183" class="Bound">σ</a><a id="17184" class="Symbol">}</a> <a id="17186" class="Symbol">(</a><a id="17187" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="17195" href="../Soundness/#17195" class="Bound">d₁</a> <a id="17198" href="../Soundness/#17198" class="Bound">d₂</a><a id="17200" class="Symbol">)</a> <a id="17202" href="../Soundness/#17202" class="Bound">eq</a>
  <a id="17207" class="Keyword">with</a> <a id="17212" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="17226" class="Symbol">{</a><a id="17227" class="Argument">σ</a> <a id="17229" class="Symbol">=</a> <a id="17231" href="../Soundness/#17183" class="Bound">σ</a><a id="17232" class="Symbol">}</a> <a id="17234" href="../Soundness/#17195" class="Bound">d₁</a> <a id="17237" href="../Soundness/#17202" class="Bound">eq</a> <a id="17240" class="Symbol">|</a> <a id="17242" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="17256" class="Symbol">{</a><a id="17257" class="Argument">σ</a> <a id="17259" class="Symbol">=</a> <a id="17261" href="../Soundness/#17183" class="Bound">σ</a><a id="17262" class="Symbol">}</a> <a id="17264" href="../Soundness/#17198" class="Bound">d₂</a> <a id="17267" href="../Soundness/#17202" class="Bound">eq</a>
<a id="17270" class="Symbol">...</a> <a id="17274" class="Symbol">|</a> <a id="17276" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17278" href="../Soundness/#17278" class="Bound">δ₁</a> <a id="17281" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17283" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17285" href="../Soundness/#17285" class="Bound">subst-δ₁</a> <a id="17294" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17296" href="../Soundness/#17296" class="Bound">m1</a> <a id="17299" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17301" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17303" class="Symbol">|</a> <a id="17305" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17307" href="../Soundness/#17307" class="Bound">δ₂</a> <a id="17310" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17312" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17314" href="../Soundness/#17314" class="Bound">subst-δ₂</a> <a id="17323" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17325" href="../Soundness/#17325" class="Bound">m2</a> <a id="17328" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17330" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17332" class="Symbol">=</a>
     <a id="17339" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17341" href="../Soundness/#17278" class="Bound">δ₁</a> <a id="17344" href="../Denotational/#8218" class="Function Operator">`⊔</a> <a id="17347" href="../Soundness/#17307" class="Bound">δ₂</a> <a id="17350" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17352" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17354" href="../Soundness/#14589" class="Function">subst-⊔</a> <a id="17362" class="Symbol">{</a><a id="17363" class="Argument">γ₁</a> <a id="17366" class="Symbol">=</a> <a id="17368" href="../Soundness/#17278" class="Bound">δ₁</a><a id="17370" class="Symbol">}{</a><a id="17372" class="Argument">γ₂</a> <a id="17375" class="Symbol">=</a> <a id="17377" href="../Soundness/#17307" class="Bound">δ₂</a><a id="17379" class="Symbol">}{</a><a id="17381" class="Argument">σ</a> <a id="17383" class="Symbol">=</a> <a id="17385" class="Bound">σ</a><a id="17386" class="Symbol">}</a> <a id="17388" href="../Soundness/#17285" class="Bound">subst-δ₁</a> <a id="17397" href="../Soundness/#17314" class="Bound">subst-δ₂</a> <a id="17406" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a>
                    <a id="17428" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="17436" class="Symbol">(</a><a id="17437" href="../Denotational/#25590" class="Function">⊑-env</a> <a id="17443" href="../Soundness/#17296" class="Bound">m1</a> <a id="17446" class="Symbol">(</a><a id="17447" href="../Denotational/#8548" class="Function">⊑-env-conj-R1</a> <a id="17461" href="../Soundness/#17278" class="Bound">δ₁</a> <a id="17464" href="../Soundness/#17307" class="Bound">δ₂</a><a id="17466" class="Symbol">))</a>
                            <a id="17497" class="Symbol">(</a><a id="17498" href="../Denotational/#25590" class="Function">⊑-env</a> <a id="17504" href="../Soundness/#17325" class="Bound">m2</a> <a id="17507" class="Symbol">(</a><a id="17508" href="../Denotational/#8654" class="Function">⊑-env-conj-R2</a> <a id="17522" href="../Soundness/#17278" class="Bound">δ₁</a> <a id="17525" href="../Soundness/#17307" class="Bound">δ₂</a><a id="17527" class="Symbol">))</a> <a id="17530" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17532" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>
<a id="17534" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="17548" class="Symbol">(</a><a id="17549" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="17553" href="../Soundness/#17553" class="Bound">d</a> <a id="17555" href="../Soundness/#17555" class="Bound">lt</a><a id="17557" class="Symbol">)</a> <a id="17559" href="../Soundness/#17559" class="Bound">eq</a>
    <a id="17566" class="Keyword">with</a> <a id="17571" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="17585" href="../Soundness/#17553" class="Bound">d</a> <a id="17587" href="../Soundness/#17559" class="Bound">eq</a>
<a id="17590" class="Symbol">...</a> <a id="17594" class="Symbol">|</a> <a id="17596" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17598" href="../Soundness/#17598" class="Bound">δ</a> <a id="17600" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17602" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17604" href="../Soundness/#17604" class="Bound">subst-δ</a> <a id="17612" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17614" href="../Soundness/#17614" class="Bound">m</a> <a id="17616" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17618" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17620" class="Symbol">=</a> <a id="17622" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17624" href="../Soundness/#17598" class="Bound">δ</a> <a id="17626" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17628" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="17630" href="../Soundness/#17604" class="Bound">subst-δ</a> <a id="17638" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="17640" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="17644" href="../Soundness/#17614" class="Bound">m</a> <a id="17646" class="Bound">lt</a> <a id="17649" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="17651" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>
</pre>
<ul>
<li><p>Case <code>var</code>: We have subst <code>σ M ≡ y</code>, so <code>M</code> must also be a variable, say <code>x</code>. We apply the lemma <code>subst-reflect-var</code> to conclude.</p></li>
<li><p>Case <code>↦-elim</code>: We have <code>subst σ M ≡ L₁ · L₂</code>. We proceed by cases on <code>M</code>.</p>
<ul>
<li><p>Case <code>M ≡ x</code>: We apply the <code>subst-reflect-var</code> lemma again to conclude.</p></li>
<li><p>Case <code>M ≡ M₁ · M₂</code>: By the induction hypothesis, we have some <code>δ₁</code> and <code>δ₂</code> such that <code>δ₁ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code>γ ⊢ σ ↓ δ₁</code>, as well as <code>δ₂ ⊢ M₂ ↓ v₁</code> and <code>γ ⊢ σ ↓ δ₂</code>. By <code>⊑-env</code> we have <code>δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code>δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁</code> (using <code>⊑-env-conj-R1</code> and <code>⊑-env-conj-R2</code>), and therefore <code>δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃</code>. We conclude this case by obtaining <code>γ ⊢ σ ↓ δ₁ ⊔ δ₂</code> by the <code>subst-⊔</code> lemma.</p></li>
</ul></li>
<li><p>Case <code>↦-intro</code>: We have <code>subst σ M ≡ ƛ L′</code>. We proceed by cases on <code>M</code>.</p>
<ul>
<li><p>Case <code>M ≡ x</code>: We apply the <code>subst-reflect-var</code> lemma.</p></li>
<li><p>Case <code>M ≡ ƛ M′</code>: By the induction hypothesis, we have <code>(δ′ , v′) ⊢ M′ ↓ v₂</code> and <code>(δ , v₁) ⊢ exts σ ↓ (δ′ , v′)</code>. From the later we have <code>(δ , v₁) ⊢ # 0 ↓ v′</code>. By the lemma <code>var-inv</code> we have <code>v′ ⊑ v₁</code>, so by the <code>up-env</code> lemma we have <code>(δ′ , v₁) ⊢ M′ ↓ v₂</code> and therefore <code>δ′ ⊢ ƛ M′ ↓ v₁ → v₂</code>. We also need to show that <code>δ</code>⊢ σ ↓ δ′<code>.  Fix</code>k<code>. We have</code>(δ , v₁) ⊢ rename S_ σ k ↓ δ k′<code>.  We then apply the lemma</code>rename-inc-reflect<code>to obtain</code>δ ⊢ σ k ↓ δ k′`, so this case is complete.</p></li>
</ul></li>
<li><p>Case <code>⊥-intro</code>: We choose <code>⊥</code> for <code>δ</code>. We have <code>⊥ ⊢ M ↓ ⊥</code> by <code>⊥-intro</code>. We have <code>δ ⊢ σ ↓ ⊥</code> by the lemma <code>subst-empty</code>.</p></li>
<li><p>Case <code>⊔-intro</code>: By the induction hypothesis we have <code>δ₁ ⊢ M ↓ v₁</code>, <code>δ₂ ⊢ M ↓ v₂</code>, <code>δ ⊢ σ ↓ δ₁</code>, and <code>δ ⊢ σ ↓ δ₂</code>. We have <code>δ₁ ⊔ δ₂ ⊢ M ↓ v₁</code> and <code>δ₁ ⊔ δ₂ ⊢ M ↓ v₂</code> by <code>⊑-env</code> with <code>⊑-env-conj-R1</code> and <code>⊑-env-conj-R2</code>. So by <code>⊔-intro</code> we have <code>δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂</code>. By <code>subst-⊔</code> we conclude that <code>δ ⊢ σ ↓ δ₁ ⊔ δ₂</code>.</p></li>
</ul>
<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>
<p>Most of the work is now behind us. We have proved that simultaneous substitution reflects denotations. Of course, β reduction uses single substitution, so we need a corollary that proves that single substitution reflects denotations. That is, given terms <code>N : (Γ , ★ ⊢ ★)</code> and <code>M : (Γ ⊢ ★)</code>, if <code>γ ⊢ N [ M ] ↓ w</code>, then <code>γ ⊢ M ↓ v</code> and <code>(γ , v) ⊢ N ↓ w</code> for some value <code>v</code>. We have <code>N [ M ] = subst (subst-zero M) N</code>.</p>
<p>We first prove a lemma about <code>subst-zero</code>, that if <code>δ ⊢ subst-zero M ↓ γ</code>, then <code>γ ⊑ (δ , w) × δ ⊢ M ↓ w</code> for some <code>w</code>.</p>
<pre class="Agda"><a id="subst-zero-reflect"></a><a id="20081" href="../Soundness/#20081" class="Function">subst-zero-reflect</a> <a id="20100" class="Symbol">:</a> <a id="20102" class="Symbol">∀</a> <a id="20104" class="Symbol">{</a><a id="20105" href="../Soundness/#20105" class="Bound">Δ</a><a id="20106" class="Symbol">}</a> <a id="20108" class="Symbol">{</a><a id="20109" href="../Soundness/#20109" class="Bound">δ</a> <a id="20111" class="Symbol">:</a> <a id="20113" href="../Denotational/#7166" class="Function">Env</a> <a id="20117" href="../Soundness/#20105" class="Bound">Δ</a><a id="20118" class="Symbol">}</a> <a id="20120" class="Symbol">{</a><a id="20121" href="../Soundness/#20121" class="Bound">γ</a> <a id="20123" class="Symbol">:</a> <a id="20125" href="../Denotational/#7166" class="Function">Env</a> <a id="20129" class="Symbol">(</a><a id="20130" href="../Soundness/#20105" class="Bound">Δ</a> <a id="20132" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="20134" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="20135" class="Symbol">)}</a> <a id="20138" class="Symbol">{</a><a id="20139" href="../Soundness/#20139" class="Bound">M</a> <a id="20141" class="Symbol">:</a> <a id="20143" href="../Soundness/#20105" class="Bound">Δ</a> <a id="20145" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="20147" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="20148" class="Symbol">}</a>
  <a id="20152" class="Symbol">→</a> <a id="20154" href="../Soundness/#20109" class="Bound">δ</a> <a id="20156" href="../Soundness/#3197" class="Function Operator">`⊢</a> <a id="20159" href="../Untyped/#7357" class="Function">subst-zero</a> <a id="20170" href="../Soundness/#20139" class="Bound">M</a> <a id="20172" href="../Soundness/#3197" class="Function Operator">↓</a> <a id="20174" href="../Soundness/#20121" class="Bound">γ</a>
    <a id="20180" class="Comment">----------------------------------------</a>
  <a id="20223" class="Symbol">→</a> <a id="20225" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="20228" href="../Soundness/#20228" class="Bound">w</a> <a id="20230" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="20232" href="../Denotational/#4029" class="Datatype">Value</a> <a id="20238" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="20240" href="../Soundness/#20121" class="Bound">γ</a> <a id="20242" href="../Denotational/#7986" class="Function Operator">`⊑</a> <a id="20245" class="Symbol">(</a><a id="20246" href="../Soundness/#20109" class="Bound">δ</a> <a id="20248" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="20251" href="../Soundness/#20228" class="Bound">w</a><a id="20252" class="Symbol">)</a> <a id="20254" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a> <a id="20256" href="../Soundness/#20109" class="Bound">δ</a> <a id="20258" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="20260" href="../Soundness/#20139" class="Bound">M</a> <a id="20262" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="20264" href="../Soundness/#20228" class="Bound">w</a>
<a id="20266" href="../Soundness/#20081" class="Function">subst-zero-reflect</a> <a id="20285" class="Symbol">{</a><a id="20286" class="Argument">δ</a> <a id="20288" class="Symbol">=</a> <a id="20290" href="../Soundness/#20290" class="Bound">δ</a><a id="20291" class="Symbol">}</a> <a id="20293" class="Symbol">{</a><a id="20294" class="Argument">γ</a> <a id="20296" class="Symbol">=</a> <a id="20298" href="../Soundness/#20298" class="Bound">γ</a><a id="20299" class="Symbol">}</a> <a id="20301" href="../Soundness/#20301" class="Bound">δσγ</a> <a id="20305" class="Symbol">=</a> <a id="20307" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="20309" href="../Denotational/#7619" class="Function">last</a> <a id="20314" href="../Soundness/#20298" class="Bound">γ</a> <a id="20316" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="20318" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="20320" href="../Soundness/#20348" class="Function">lemma</a> <a id="20326" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="20328" href="../Soundness/#20301" class="Bound">δσγ</a> <a id="20332" href="../Untyped/#3539" class="InductiveConstructor">Z</a> <a id="20334" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="20336" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>
  <a id="20340" class="Keyword">where</a>
  <a id="20348" href="../Soundness/#20348" class="Function">lemma</a> <a id="20354" class="Symbol">:</a> <a id="20356" href="../Soundness/#20298" class="Bound">γ</a> <a id="20358" href="../Denotational/#7986" class="Function Operator">`⊑</a> <a id="20361" class="Symbol">(</a><a id="20362" href="../Soundness/#20290" class="Bound">δ</a> <a id="20364" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="20367" href="../Denotational/#7619" class="Function">last</a> <a id="20372" href="../Soundness/#20298" class="Bound">γ</a><a id="20373" class="Symbol">)</a>
  <a id="20377" href="../Soundness/#20348" class="Function">lemma</a> <a id="20383" href="../Untyped/#3539" class="InductiveConstructor">Z</a>  <a id="20386" class="Symbol">=</a>  <a id="20389" href="../Denotational/#5516" class="Function">⊑-refl</a>
  <a id="20398" href="../Soundness/#20348" class="Function">lemma</a> <a id="20404" class="Symbol">(</a><a id="20405" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="20407" href="../Soundness/#20407" class="Bound">x</a><a id="20408" class="Symbol">)</a> <a id="20410" class="Symbol">=</a> <a id="20412" href="../Compositional/#10011" class="Function">var-inv</a> <a id="20420" class="Symbol">(</a><a id="20421" href="../Soundness/#20301" class="Bound">δσγ</a> <a id="20425" class="Symbol">(</a><a id="20426" href="../Untyped/#3584" class="InductiveConstructor Operator">S</a> <a id="20428" href="../Soundness/#20407" class="Bound">x</a><a id="20429" class="Symbol">))</a>
</pre>
<p>We choose <code>w</code> to be the last value in <code>γ</code> and we obtain <code>δ ⊢ M ↓ w</code> by applying the premise to variable <code>Z</code>. Finally, to prove <code>γ ⊑ (δ , w)</code>, we prove a lemma by induction in the input variable. The base case is trivial because of our choice of <code>w</code>. In the induction case, <code>S x</code>, the premise <code>δ ⊢ subst-zero M ↓ γ</code> gives us <code>δ ⊢ x ↓ γ (S x)</code> and then using <code>var-inv</code> we conclude that <code>γ (S x) ⊑ (δ</code>, w) (S x)`.</p>
<p>Now to prove that substitution reflects denotations.</p>
<pre class="Agda"><a id="substitution-reflect"></a><a id="20908" href="../Soundness/#20908" class="Function">substitution-reflect</a> <a id="20929" class="Symbol">:</a> <a id="20931" class="Symbol">∀</a> <a id="20933" class="Symbol">{</a><a id="20934" href="../Soundness/#20934" class="Bound">Δ</a><a id="20935" class="Symbol">}</a> <a id="20937" class="Symbol">{</a><a id="20938" href="../Soundness/#20938" class="Bound">δ</a> <a id="20940" class="Symbol">:</a> <a id="20942" href="../Denotational/#7166" class="Function">Env</a> <a id="20946" href="../Soundness/#20934" class="Bound">Δ</a><a id="20947" class="Symbol">}</a> <a id="20949" class="Symbol">{</a><a id="20950" href="../Soundness/#20950" class="Bound">N</a> <a id="20952" class="Symbol">:</a> <a id="20954" href="../Soundness/#20934" class="Bound">Δ</a> <a id="20956" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="20958" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="20960" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="20962" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="20963" class="Symbol">}</a> <a id="20965" class="Symbol">{</a><a id="20966" href="../Soundness/#20966" class="Bound">M</a> <a id="20968" class="Symbol">:</a> <a id="20970" href="../Soundness/#20934" class="Bound">Δ</a> <a id="20972" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="20974" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="20975" class="Symbol">}</a> <a id="20977" class="Symbol">{</a><a id="20978" href="../Soundness/#20978" class="Bound">v</a><a id="20979" class="Symbol">}</a>
  <a id="20983" class="Symbol">→</a> <a id="20985" href="../Soundness/#20938" class="Bound">δ</a> <a id="20987" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="20989" href="../Soundness/#20950" class="Bound">N</a> <a id="20991" href="../Untyped/#7473" class="Function Operator">[</a> <a id="20993" href="../Soundness/#20966" class="Bound">M</a> <a id="20995" href="../Untyped/#7473" class="Function Operator">]</a> <a id="20997" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="20999" href="../Soundness/#20978" class="Bound">v</a>
    <a id="21005" class="Comment">------------------------------------------------</a>
  <a id="21056" class="Symbol">→</a> <a id="21058" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">Σ[</a> <a id="21061" href="../Soundness/#21061" class="Bound">w</a> <a id="21063" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">∈</a> <a id="21065" href="../Denotational/#4029" class="Datatype">Value</a> <a id="21071" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#916" class="Function">]</a> <a id="21073" href="../Soundness/#20938" class="Bound">δ</a> <a id="21075" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="21077" href="../Soundness/#20966" class="Bound">M</a> <a id="21079" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="21081" href="../Soundness/#21061" class="Bound">w</a>  <a id="21084" href="https://agda.github.io/agda-stdlib/v1.3/Data.Product.html#1167" class="Function Operator">×</a>  <a id="21087" class="Symbol">(</a><a id="21088" href="../Soundness/#20938" class="Bound">δ</a> <a id="21090" href="../Denotational/#7323" class="Function Operator">`,</a> <a id="21093" href="../Soundness/#21061" class="Bound">w</a><a id="21094" class="Symbol">)</a> <a id="21096" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="21098" href="../Soundness/#20950" class="Bound">N</a> <a id="21100" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="21102" href="../Soundness/#20978" class="Bound">v</a>
<a id="21104" href="../Soundness/#20908" class="Function">substitution-reflect</a> <a id="21125" href="../Soundness/#21125" class="Bound">d</a> <a id="21127" class="Keyword">with</a> <a id="21132" href="../Soundness/#15580" class="Function">subst-reflect</a> <a id="21146" href="../Soundness/#21125" class="Bound">d</a> <a id="21148" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="21153" class="Symbol">...</a>  <a id="21158" class="Symbol">|</a> <a id="21160" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="21162" href="../Soundness/#21162" class="Bound">γ</a> <a id="21164" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="21166" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="21168" href="../Soundness/#21168" class="Bound">δσγ</a> <a id="21172" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="21174" href="../Soundness/#21174" class="Bound">γNv</a> <a id="21178" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="21180" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="21182" class="Keyword">with</a> <a id="21187" href="../Soundness/#20081" class="Function">subst-zero-reflect</a> <a id="21206" href="../Soundness/#21168" class="Bound">δσγ</a>
<a id="21210" class="Symbol">...</a>    <a id="21217" class="Symbol">|</a> <a id="21219" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="21221" href="../Soundness/#21221" class="Bound">w</a> <a id="21223" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="21225" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="21227" href="../Soundness/#21227" class="Bound">ineq</a> <a id="21232" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="21234" href="../Soundness/#21234" class="Bound">δMw</a> <a id="21238" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="21240" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="21242" class="Symbol">=</a> <a id="21244" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="21246" href="../Soundness/#21221" class="Bound">w</a> <a id="21248" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="21250" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="21252" href="../Soundness/#21234" class="Bound">δMw</a> <a id="21256" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="21258" href="../Denotational/#25590" class="Function">⊑-env</a> <a id="21264" class="Bound">γNv</a> <a id="21268" href="../Soundness/#21227" class="Bound">ineq</a> <a id="21273" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="21275" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We apply the <code>subst-reflect</code> lemma to obtain <code>δ ⊢ subst-zero M ↓ γ</code> and <code>γ ⊢ N ↓ v</code> for some <code>γ</code>. Using the former, the <code>subst-zero-reflect</code> lemma gives us <code>γ ⊑ (δ , w)</code> and <code>δ ⊢ M ↓ w</code>. We conclude that <code>δ , w ⊢ N ↓ v</code> by applying the <code>⊑-env</code> lemma, using <code>γ ⊢ N ↓ v</code> and <code>γ ⊑ (δ , w)</code>.</p>
<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>
<p>Now that we have proved that substitution reflects denotations, we can easily prove that reduction does too.</p>
<pre class="Agda"><a id="reflect-beta"></a><a id="21722" href="../Soundness/#21722" class="Function">reflect-beta</a> <a id="21735" class="Symbol">:</a> <a id="21737" class="Symbol">∀{</a><a id="21739" href="../Soundness/#21739" class="Bound">Γ</a><a id="21740" class="Symbol">}{</a><a id="21742" href="../Soundness/#21742" class="Bound">γ</a> <a id="21744" class="Symbol">:</a> <a id="21746" href="../Denotational/#7166" class="Function">Env</a> <a id="21750" href="../Soundness/#21739" class="Bound">Γ</a><a id="21751" class="Symbol">}{</a><a id="21753" href="../Soundness/#21753" class="Bound">M</a> <a id="21755" href="../Soundness/#21755" class="Bound">N</a><a id="21756" class="Symbol">}{</a><a id="21758" href="../Soundness/#21758" class="Bound">v</a><a id="21759" class="Symbol">}</a>
    <a id="21765" class="Symbol">→</a> <a id="21767" href="../Soundness/#21742" class="Bound">γ</a> <a id="21769" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="21771" class="Symbol">(</a><a id="21772" href="../Soundness/#21755" class="Bound">N</a> <a id="21774" href="../Untyped/#7473" class="Function Operator">[</a> <a id="21776" href="../Soundness/#21753" class="Bound">M</a> <a id="21778" href="../Untyped/#7473" class="Function Operator">]</a><a id="21779" class="Symbol">)</a> <a id="21781" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="21783" href="../Soundness/#21758" class="Bound">v</a>
    <a id="21789" class="Symbol">→</a> <a id="21791" href="../Soundness/#21742" class="Bound">γ</a> <a id="21793" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="21795" class="Symbol">(</a><a id="21796" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="21798" href="../Soundness/#21755" class="Bound">N</a><a id="21799" class="Symbol">)</a> <a id="21801" href="../Untyped/#4424" class="InductiveConstructor Operator">·</a> <a id="21803" href="../Soundness/#21753" class="Bound">M</a> <a id="21805" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="21807" href="../Soundness/#21758" class="Bound">v</a>
<a id="21809" href="../Soundness/#21722" class="Function">reflect-beta</a> <a id="21822" href="../Soundness/#21822" class="Bound">d</a>
    <a id="21828" class="Keyword">with</a> <a id="21833" href="../Soundness/#20908" class="Function">substitution-reflect</a> <a id="21854" href="../Soundness/#21822" class="Bound">d</a>
<a id="21856" class="Symbol">...</a> <a id="21860" class="Symbol">|</a> <a id="21862" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="21864" href="../Soundness/#21864" class="Bound">v₂′</a> <a id="21868" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="21870" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="21872" href="../Soundness/#21872" class="Bound">d₁′</a> <a id="21876" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="21878" href="../Soundness/#21878" class="Bound">d₂′</a> <a id="21882" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="21884" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a> <a id="21886" class="Symbol">=</a> <a id="21888" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="21895" class="Symbol">(</a><a id="21896" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="21904" href="../Soundness/#21878" class="Bound">d₂′</a><a id="21907" class="Symbol">)</a> <a id="21909" href="../Soundness/#21872" class="Bound">d₁′</a>


<a id="reflect"></a><a id="21915" href="../Soundness/#21915" class="Function">reflect</a> <a id="21923" class="Symbol">:</a> <a id="21925" class="Symbol">∀</a> <a id="21927" class="Symbol">{</a><a id="21928" href="../Soundness/#21928" class="Bound">Γ</a><a id="21929" class="Symbol">}</a> <a id="21931" class="Symbol">{</a><a id="21932" href="../Soundness/#21932" class="Bound">γ</a> <a id="21934" class="Symbol">:</a> <a id="21936" href="../Denotational/#7166" class="Function">Env</a> <a id="21940" href="../Soundness/#21928" class="Bound">Γ</a><a id="21941" class="Symbol">}</a> <a id="21943" class="Symbol">{</a><a id="21944" href="../Soundness/#21944" class="Bound">M</a> <a id="21946" href="../Soundness/#21946" class="Bound">M′</a> <a id="21949" href="../Soundness/#21949" class="Bound">N</a> <a id="21951" href="../Soundness/#21951" class="Bound">v</a><a id="21952" class="Symbol">}</a>
  <a id="21956" class="Symbol">→</a> <a id="21958" href="../Soundness/#21932" class="Bound">γ</a> <a id="21960" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="21962" href="../Soundness/#21949" class="Bound">N</a> <a id="21964" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="21966" href="../Soundness/#21951" class="Bound">v</a>  <a id="21969" class="Symbol">→</a>  <a id="21972" href="../Soundness/#21944" class="Bound">M</a> <a id="21974" href="../Untyped/#9930" class="Datatype Operator">—→</a> <a id="21977" href="../Soundness/#21946" class="Bound">M′</a>  <a id="21981" class="Symbol">→</a>   <a id="21985" href="../Soundness/#21946" class="Bound">M′</a> <a id="21988" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="21990" href="../Soundness/#21949" class="Bound">N</a>
    <a id="21996" class="Comment">---------------------------------</a>
  <a id="22032" class="Symbol">→</a> <a id="22034" href="../Soundness/#21932" class="Bound">γ</a> <a id="22036" href="../Denotational/#9224" class="Datatype Operator">⊢</a> <a id="22038" href="../Soundness/#21944" class="Bound">M</a> <a id="22040" href="../Denotational/#9224" class="Datatype Operator">↓</a> <a id="22042" href="../Soundness/#21951" class="Bound">v</a>
<a id="22044" href="../Soundness/#21915" class="Function">reflect</a> <a id="22052" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="22056" class="Symbol">(</a><a id="22057" href="../Untyped/#9980" class="InductiveConstructor">ξ₁</a> <a id="22060" href="../Soundness/#22060" class="Bound">r</a><a id="22061" class="Symbol">)</a> <a id="22063" class="Symbol">()</a>
<a id="22066" href="../Soundness/#21915" class="Function">reflect</a> <a id="22074" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="22078" class="Symbol">(</a><a id="22079" href="../Untyped/#10070" class="InductiveConstructor">ξ₂</a> <a id="22082" href="../Soundness/#22082" class="Bound">r</a><a id="22083" class="Symbol">)</a> <a id="22085" class="Symbol">()</a>
<a id="22088" href="../Soundness/#21915" class="Function">reflect</a><a id="22095" class="Symbol">{</a><a id="22096" class="Argument">γ</a> <a id="22098" class="Symbol">=</a> <a id="22100" href="../Soundness/#22100" class="Bound">γ</a><a id="22101" class="Symbol">}</a> <a id="22103" class="Symbol">(</a><a id="22104" href="../Denotational/#9278" class="InductiveConstructor">var</a><a id="22107" class="Symbol">{</a><a id="22108" class="Argument">x</a> <a id="22110" class="Symbol">=</a> <a id="22112" href="../Soundness/#22112" class="Bound">x</a><a id="22113" class="Symbol">})</a> <a id="22116" href="../Untyped/#10160" class="InductiveConstructor">β</a> <a id="22118" href="../Soundness/#22118" class="Bound">mn</a>
    <a id="22125" class="Keyword">with</a> <a id="22130" href="../Denotational/#9278" class="InductiveConstructor">var</a><a id="22133" class="Symbol">{</a><a id="22134" class="Argument">γ</a> <a id="22136" class="Symbol">=</a> <a id="22138" href="../Soundness/#22100" class="Bound">γ</a><a id="22139" class="Symbol">}{</a><a id="22141" class="Argument">x</a> <a id="22143" class="Symbol">=</a> <a id="22145" href="../Soundness/#22112" class="Bound">x</a><a id="22146" class="Symbol">}</a>
<a id="22148" class="Symbol">...</a> <a id="22152" class="Symbol">|</a> <a id="22154" href="../Soundness/#22154" class="Bound">d′</a> <a id="22157" class="Keyword">rewrite</a> <a id="22165" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a> <a id="22169" class="Bound">mn</a> <a id="22172" class="Symbol">=</a> <a id="22174" href="../Soundness/#21722" class="Function">reflect-beta</a> <a id="22187" href="../Soundness/#22154" class="Bound">d′</a>
<a id="22190" href="../Soundness/#21915" class="Function">reflect</a> <a id="22198" href="../Denotational/#9278" class="InductiveConstructor">var</a> <a id="22202" class="Symbol">(</a><a id="22203" href="../Untyped/#10268" class="InductiveConstructor">ζ</a> <a id="22205" href="../Soundness/#22205" class="Bound">r</a><a id="22206" class="Symbol">)</a> <a id="22208" class="Symbol">()</a>
<a id="22211" href="../Soundness/#21915" class="Function">reflect</a> <a id="22219" class="Symbol">(</a><a id="22220" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="22227" href="../Soundness/#22227" class="Bound">d₁</a> <a id="22230" href="../Soundness/#22230" class="Bound">d₂</a><a id="22232" class="Symbol">)</a> <a id="22234" class="Symbol">(</a><a id="22235" href="../Untyped/#9980" class="InductiveConstructor">ξ₁</a> <a id="22238" href="../Soundness/#22238" class="Bound">r</a><a id="22239" class="Symbol">)</a> <a id="22241" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="22246" class="Symbol">=</a> <a id="22248" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="22255" class="Symbol">(</a><a id="22256" href="../Soundness/#21915" class="Function">reflect</a> <a id="22264" href="../Soundness/#22227" class="Bound">d₁</a> <a id="22267" href="../Soundness/#22238" class="Bound">r</a> <a id="22269" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="22273" class="Symbol">)</a> <a id="22275" href="../Soundness/#22230" class="Bound">d₂</a>
<a id="22278" href="../Soundness/#21915" class="Function">reflect</a> <a id="22286" class="Symbol">(</a><a id="22287" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="22294" href="../Soundness/#22294" class="Bound">d₁</a> <a id="22297" href="../Soundness/#22297" class="Bound">d₂</a><a id="22299" class="Symbol">)</a> <a id="22301" class="Symbol">(</a><a id="22302" href="../Untyped/#10070" class="InductiveConstructor">ξ₂</a> <a id="22305" href="../Soundness/#22305" class="Bound">r</a><a id="22306" class="Symbol">)</a> <a id="22308" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="22313" class="Symbol">=</a> <a id="22315" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="22322" href="../Soundness/#22294" class="Bound">d₁</a> <a id="22325" class="Symbol">(</a><a id="22326" href="../Soundness/#21915" class="Function">reflect</a> <a id="22334" href="../Soundness/#22297" class="Bound">d₂</a> <a id="22337" href="../Soundness/#22305" class="Bound">r</a> <a id="22339" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="22343" class="Symbol">)</a>
<a id="22345" href="../Soundness/#21915" class="Function">reflect</a> <a id="22353" class="Symbol">(</a><a id="22354" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="22361" href="../Soundness/#22361" class="Bound">d₁</a> <a id="22364" href="../Soundness/#22364" class="Bound">d₂</a><a id="22366" class="Symbol">)</a> <a id="22368" href="../Untyped/#10160" class="InductiveConstructor">β</a> <a id="22370" href="../Soundness/#22370" class="Bound">mn</a>
    <a id="22377" class="Keyword">with</a> <a id="22382" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="22389" href="../Soundness/#22361" class="Bound">d₁</a> <a id="22392" href="../Soundness/#22364" class="Bound">d₂</a>
<a id="22395" class="Symbol">...</a> <a id="22399" class="Symbol">|</a> <a id="22401" href="../Soundness/#22401" class="Bound">d′</a> <a id="22404" class="Keyword">rewrite</a> <a id="22412" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a> <a id="22416" class="Bound">mn</a> <a id="22419" class="Symbol">=</a> <a id="22421" href="../Soundness/#21722" class="Function">reflect-beta</a> <a id="22434" href="../Soundness/#22401" class="Bound">d′</a>
<a id="22437" href="../Soundness/#21915" class="Function">reflect</a> <a id="22445" class="Symbol">(</a><a id="22446" href="../Denotational/#9353" class="InductiveConstructor">↦-elim</a> <a id="22453" href="../Soundness/#22453" class="Bound">d₁</a> <a id="22456" href="../Soundness/#22456" class="Bound">d₂</a><a id="22458" class="Symbol">)</a> <a id="22460" class="Symbol">(</a><a id="22461" href="../Untyped/#10268" class="InductiveConstructor">ζ</a> <a id="22463" href="../Soundness/#22463" class="Bound">r</a><a id="22464" class="Symbol">)</a> <a id="22466" class="Symbol">()</a>
<a id="22469" href="../Soundness/#21915" class="Function">reflect</a> <a id="22477" class="Symbol">(</a><a id="22478" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="22486" href="../Soundness/#22486" class="Bound">d</a><a id="22487" class="Symbol">)</a> <a id="22489" class="Symbol">(</a><a id="22490" href="../Untyped/#9980" class="InductiveConstructor">ξ₁</a> <a id="22493" href="../Soundness/#22493" class="Bound">r</a><a id="22494" class="Symbol">)</a> <a id="22496" class="Symbol">()</a>
<a id="22499" href="../Soundness/#21915" class="Function">reflect</a> <a id="22507" class="Symbol">(</a><a id="22508" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="22516" href="../Soundness/#22516" class="Bound">d</a><a id="22517" class="Symbol">)</a> <a id="22519" class="Symbol">(</a><a id="22520" href="../Untyped/#10070" class="InductiveConstructor">ξ₂</a> <a id="22523" href="../Soundness/#22523" class="Bound">r</a><a id="22524" class="Symbol">)</a> <a id="22526" class="Symbol">()</a>
<a id="22529" href="../Soundness/#21915" class="Function">reflect</a> <a id="22537" class="Symbol">(</a><a id="22538" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="22546" href="../Soundness/#22546" class="Bound">d</a><a id="22547" class="Symbol">)</a> <a id="22549" href="../Untyped/#10160" class="InductiveConstructor">β</a> <a id="22551" href="../Soundness/#22551" class="Bound">mn</a>
    <a id="22558" class="Keyword">with</a> <a id="22563" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="22571" href="../Soundness/#22546" class="Bound">d</a>
<a id="22573" class="Symbol">...</a> <a id="22577" class="Symbol">|</a> <a id="22579" href="../Soundness/#22579" class="Bound">d′</a> <a id="22582" class="Keyword">rewrite</a> <a id="22590" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a> <a id="22594" class="Bound">mn</a> <a id="22597" class="Symbol">=</a> <a id="22599" href="../Soundness/#21722" class="Function">reflect-beta</a> <a id="22612" href="../Soundness/#22579" class="Bound">d′</a>
<a id="22615" href="../Soundness/#21915" class="Function">reflect</a> <a id="22623" class="Symbol">(</a><a id="22624" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="22632" href="../Soundness/#22632" class="Bound">d</a><a id="22633" class="Symbol">)</a> <a id="22635" class="Symbol">(</a><a id="22636" href="../Untyped/#10268" class="InductiveConstructor">ζ</a> <a id="22638" href="../Soundness/#22638" class="Bound">r</a><a id="22639" class="Symbol">)</a> <a id="22641" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="22646" class="Symbol">=</a> <a id="22648" href="../Denotational/#9475" class="InductiveConstructor">↦-intro</a> <a id="22656" class="Symbol">(</a><a id="22657" href="../Soundness/#21915" class="Function">reflect</a> <a id="22665" href="../Soundness/#22632" class="Bound">d</a> <a id="22667" href="../Soundness/#22638" class="Bound">r</a> <a id="22669" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="22673" class="Symbol">)</a>
<a id="22675" href="../Soundness/#21915" class="Function">reflect</a> <a id="22683" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a> <a id="22691" href="../Soundness/#22691" class="Bound">r</a> <a id="22693" href="../Soundness/#22693" class="Bound">mn</a> <a id="22696" class="Symbol">=</a> <a id="22698" href="../Denotational/#9587" class="InductiveConstructor">⊥-intro</a>
<a id="22706" href="../Soundness/#21915" class="Function">reflect</a> <a id="22714" class="Symbol">(</a><a id="22715" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="22723" href="../Soundness/#22723" class="Bound">d₁</a> <a id="22726" href="../Soundness/#22726" class="Bound">d₂</a><a id="22728" class="Symbol">)</a> <a id="22730" href="../Soundness/#22730" class="Bound">r</a> <a id="22732" href="../Soundness/#22732" class="Bound">mn</a> <a id="22735" class="Keyword">rewrite</a> <a id="22743" href="https://agda.github.io/agda-stdlib/v1.3/Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a> <a id="22747" href="../Soundness/#22732" class="Bound">mn</a> <a id="22750" class="Symbol">=</a>
   <a id="22755" href="../Denotational/#9654" class="InductiveConstructor">⊔-intro</a> <a id="22763" class="Symbol">(</a><a id="22764" href="../Soundness/#21915" class="Function">reflect</a> <a id="22772" href="../Soundness/#22723" class="Bound">d₁</a> <a id="22775" href="../Soundness/#22730" class="Bound">r</a> <a id="22777" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="22781" class="Symbol">)</a> <a id="22783" class="Symbol">(</a><a id="22784" href="../Soundness/#21915" class="Function">reflect</a> <a id="22792" href="../Soundness/#22726" class="Bound">d₂</a> <a id="22795" href="../Soundness/#22730" class="Bound">r</a> <a id="22797" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="22801" class="Symbol">)</a>
<a id="22803" href="../Soundness/#21915" class="Function">reflect</a> <a id="22811" class="Symbol">(</a><a id="22812" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="22816" href="../Soundness/#22816" class="Bound">d</a> <a id="22818" href="../Soundness/#22818" class="Bound">lt</a><a id="22820" class="Symbol">)</a> <a id="22822" href="../Soundness/#22822" class="Bound">r</a> <a id="22824" href="../Soundness/#22824" class="Bound">mn</a> <a id="22827" class="Symbol">=</a> <a id="22829" href="../Denotational/#9769" class="InductiveConstructor">sub</a> <a id="22833" class="Symbol">(</a><a id="22834" href="../Soundness/#21915" class="Function">reflect</a> <a id="22842" href="../Soundness/#22816" class="Bound">d</a> <a id="22844" href="../Soundness/#22822" class="Bound">r</a> <a id="22846" href="../Soundness/#22824" class="Bound">mn</a><a id="22848" class="Symbol">)</a> <a id="22850" href="../Soundness/#22818" class="Bound">lt</a>
</pre>
<h2 id="reduction-implies-denotational-equality">Reduction implies denotational equality</h2>
<p>We have proved that reduction both preserves and reflects denotations. Thus, reduction implies denotational equality.</p>
<pre class="Agda"><a id="reduce-equal"></a><a id="23025" href="../Soundness/#23025" class="Function">reduce-equal</a> <a id="23038" class="Symbol">:</a> <a id="23040" class="Symbol">∀</a> <a id="23042" class="Symbol">{</a><a id="23043" href="../Soundness/#23043" class="Bound">Γ</a><a id="23044" class="Symbol">}</a> <a id="23046" class="Symbol">{</a><a id="23047" href="../Soundness/#23047" class="Bound">M</a> <a id="23049" class="Symbol">:</a> <a id="23051" href="../Soundness/#23043" class="Bound">Γ</a> <a id="23053" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="23055" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="23056" class="Symbol">}</a> <a id="23058" class="Symbol">{</a><a id="23059" href="../Soundness/#23059" class="Bound">N</a> <a id="23061" class="Symbol">:</a> <a id="23063" href="../Soundness/#23043" class="Bound">Γ</a> <a id="23065" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="23067" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="23068" class="Symbol">}</a>
  <a id="23072" class="Symbol">→</a> <a id="23074" href="../Soundness/#23047" class="Bound">M</a> <a id="23076" href="../Untyped/#9930" class="Datatype Operator">—→</a> <a id="23079" href="../Soundness/#23059" class="Bound">N</a>
    <a id="23085" class="Comment">---------</a>
  <a id="23097" class="Symbol">→</a> <a id="23099" href="../Denotational/#17364" class="Function">ℰ</a> <a id="23101" href="../Soundness/#23047" class="Bound">M</a> <a id="23103" href="../Denotational/#17546" class="Function Operator">≃</a> <a id="23105" href="../Denotational/#17364" class="Function">ℰ</a> <a id="23107" href="../Soundness/#23059" class="Bound">N</a>
<a id="23109" href="../Soundness/#23025" class="Function">reduce-equal</a> <a id="23122" class="Symbol">{</a><a id="23123" href="../Soundness/#23123" class="Bound">Γ</a><a id="23124" class="Symbol">}{</a><a id="23126" href="../Soundness/#23126" class="Bound">M</a><a id="23127" class="Symbol">}{</a><a id="23129" href="../Soundness/#23129" class="Bound">N</a><a id="23130" class="Symbol">}</a> <a id="23132" href="../Soundness/#23132" class="Bound">r</a> <a id="23134" href="../Soundness/#23134" class="Bound">γ</a> <a id="23136" href="../Soundness/#23136" class="Bound">v</a> <a id="23138" class="Symbol">=</a>
    <a id="23144" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="23146" class="Symbol">(λ</a> <a id="23149" href="../Soundness/#23149" class="Bound">m</a> <a id="23151" class="Symbol">→</a> <a id="23153" href="../Soundness/#6612" class="Function">preserve</a> <a id="23162" href="../Soundness/#23149" class="Bound">m</a> <a id="23164" href="../Soundness/#23132" class="Bound">r</a><a id="23165" class="Symbol">)</a> <a id="23167" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="23169" class="Symbol">(λ</a> <a id="23172" href="../Soundness/#23172" class="Bound">n</a> <a id="23174" class="Symbol">→</a> <a id="23176" href="../Soundness/#21915" class="Function">reflect</a> <a id="23184" href="../Soundness/#23172" class="Bound">n</a> <a id="23186" href="../Soundness/#23132" class="Bound">r</a> <a id="23188" href="https://agda.github.io/agda-stdlib/v1.3/Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="23192" class="Symbol">)</a> <a id="23194" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>We conclude with the <em>soundness property</em>, that multi-step reduction to a lambda abstraction implies denotational equivalence with a lambda abstraction.</p>
<pre class="Agda"><a id="soundness"></a><a id="23359" href="../Soundness/#23359" class="Function">soundness</a> <a id="23369" class="Symbol">:</a> <a id="23371" class="Symbol">∀{</a><a id="23373" href="../Soundness/#23373" class="Bound">Γ</a><a id="23374" class="Symbol">}</a> <a id="23376" class="Symbol">{</a><a id="23377" href="../Soundness/#23377" class="Bound">M</a> <a id="23379" class="Symbol">:</a> <a id="23381" href="../Soundness/#23373" class="Bound">Γ</a> <a id="23383" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="23385" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="23386" class="Symbol">}</a> <a id="23388" class="Symbol">{</a><a id="23389" href="../Soundness/#23389" class="Bound">N</a> <a id="23391" class="Symbol">:</a> <a id="23393" href="../Soundness/#23373" class="Bound">Γ</a> <a id="23395" href="../Untyped/#3173" class="InductiveConstructor Operator">,</a> <a id="23397" href="../Untyped/#2870" class="InductiveConstructor">★</a> <a id="23399" href="../Untyped/#4276" class="Datatype Operator">⊢</a> <a id="23401" href="../Untyped/#2870" class="InductiveConstructor">★</a><a id="23402" class="Symbol">}</a>
  <a id="23406" class="Symbol">→</a> <a id="23408" href="../Soundness/#23377" class="Bound">M</a> <a id="23410" href="../Untyped/#11050" class="Datatype Operator">—↠</a> <a id="23413" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="23415" href="../Soundness/#23389" class="Bound">N</a>
    <a id="23421" class="Comment">-----------------</a>
  <a id="23441" class="Symbol">→</a> <a id="23443" href="../Denotational/#17364" class="Function">ℰ</a> <a id="23445" href="../Soundness/#23377" class="Bound">M</a> <a id="23447" href="../Denotational/#17546" class="Function Operator">≃</a> <a id="23449" href="../Denotational/#17364" class="Function">ℰ</a> <a id="23451" class="Symbol">(</a><a id="23452" href="../Untyped/#4364" class="InductiveConstructor Operator">ƛ</a> <a id="23454" href="../Soundness/#23389" class="Bound">N</a><a id="23455" class="Symbol">)</a>
<a id="23457" href="../Soundness/#23359" class="Function">soundness</a> <a id="23467" class="Symbol">(</a><a id="23468" class="DottedPattern Symbol">.(</a><a id="23470" href="../Untyped/#4364" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="23472" class="DottedPattern Symbol">_)</a> <a id="23475" href="../Untyped/#11100" class="InductiveConstructor Operator">∎</a><a id="23476" class="Symbol">)</a> <a id="23478" href="../Soundness/#23478" class="Bound">γ</a> <a id="23480" href="../Soundness/#23480" class="Bound">v</a> <a id="23482" class="Symbol">=</a> <a id="23484" href="../Soundness/#1284" class="InductiveConstructor Operator">⟨</a> <a id="23486" class="Symbol">(λ</a> <a id="23489" href="../Soundness/#23489" class="Bound">x</a> <a id="23491" class="Symbol">→</a> <a id="23493" href="../Soundness/#23489" class="Bound">x</a><a id="23494" class="Symbol">)</a> <a id="23496" href="../Soundness/#1284" class="InductiveConstructor Operator">,</a> <a id="23498" class="Symbol">(λ</a> <a id="23501" href="../Soundness/#23501" class="Bound">x</a> <a id="23503" class="Symbol">→</a> <a id="23505" href="../Soundness/#23501" class="Bound">x</a><a id="23506" class="Symbol">)</a> <a id="23508" href="../Soundness/#1284" class="InductiveConstructor Operator">⟩</a>
<a id="23510" href="../Soundness/#23359" class="Function">soundness</a> <a id="23520" class="Symbol">{</a><a id="23521" href="../Soundness/#23521" class="Bound">Γ</a><a id="23522" class="Symbol">}</a> <a id="23524" class="Symbol">(</a><a id="23525" href="../Soundness/#23525" class="Bound">L</a> <a id="23527" href="../Untyped/#11156" class="InductiveConstructor Operator">—→⟨</a> <a id="23531" href="../Soundness/#23531" class="Bound">r</a> <a id="23533" href="../Untyped/#11156" class="InductiveConstructor Operator">⟩</a> <a id="23535" href="../Soundness/#23535" class="Bound">M—↠N</a><a id="23539" class="Symbol">)</a> <a id="23541" href="../Soundness/#23541" class="Bound">γ</a> <a id="23543" href="../Soundness/#23543" class="Bound">v</a> <a id="23545" class="Symbol">=</a>
   <a id="23550" class="Keyword">let</a> <a id="23554" href="../Soundness/#23554" class="Bound">ih</a> <a id="23557" class="Symbol">=</a> <a id="23559" href="../Soundness/#23359" class="Function">soundness</a> <a id="23569" href="../Soundness/#23535" class="Bound">M—↠N</a> <a id="23574" class="Keyword">in</a>
   <a id="23580" class="Keyword">let</a> <a id="23584" href="../Soundness/#23584" class="Bound">e</a> <a id="23586" class="Symbol">=</a> <a id="23588" href="../Soundness/#23025" class="Function">reduce-equal</a> <a id="23601" href="../Soundness/#23531" class="Bound">r</a> <a id="23603" class="Keyword">in</a>
   <a id="23609" href="../Denotational/#17951" class="Function">≃-trans</a> <a id="23617" class="Symbol">{</a><a id="23618" href="../Soundness/#23521" class="Bound">Γ</a><a id="23619" class="Symbol">}</a> <a id="23621" href="../Soundness/#23584" class="Bound">e</a> <a id="23623" href="../Soundness/#23554" class="Bound">ih</a> <a id="23626" href="../Soundness/#23541" class="Bound">γ</a> <a id="23628" href="../Soundness/#23543" class="Bound">v</a>
</pre>
<h2 id="unicode">Unicode</h2>
<p>This chapter uses the following unicode:</p>
<pre><code>≟  U+225F  QUESTIONED EQUAL TO (\?=)</code></pre>
    </div>
    <nav class="pager">
    <ul class="pagination">
        
        <li><a class="pagelink" href="../Compositional/">上一章</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="https://github.com/Agda-zh/PLFA-zh/blob/dev/src/plfa/part3/Soundness.lagda.md">源文件</a></li>
        <li class="separator">&bullet;</li>
        
        
        <li><a class="pagelink" href="../Adequacy/">下一章</a></li>
        <li class="separator">&bullet;</li>
        
    </ul>
</nav>

</article>

            </div>
        </main>
        <footer class="site-footer h-card">
    <data class="u-url" href="../"></data>
    <div class="wrapper">
        <h2 class="footer-heading">编程语言基础：Agda 语言描述</h2>
        
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Philip Wadler</li>
                    <li>
                        
                        <a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/wadler" title="wadler"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;wadler</a></li>
    
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Wen Kokke</li>
                    <li>
                        
                        <a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/wenkokke" title="wenkokke"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;wenkokke</a></li>
    
    
    <li><a rel="me" href="https://twitter.com/wenkokke" title="wenkokke"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#twitter"></use></svg>&nbsp;wenkokke</a></li>
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Jeremy G. Siek</li>
                    <li>
                        
                        <a class="u-email" href="mailto:jsiek@indiana.edu">jsiek@indiana.edu</a>
                        
                    </li>
                </ul>
            </div>
            <div class="footer-col footer-col-2">
                <ul class="social-media-list">
    
    <li><a rel="me" href="https://github.com/jsiek" title="jsiek"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#github"></use></svg>&nbsp;jsiek</a></li>
    
    
    <li><a rel="me" href="https://twitter.com/jeremysiek" title="jeremysiek"><svg class="svg-icon grey"><use xlink:href="/public/minima-social-icons.svg#twitter"></use></svg>&nbsp;jeremysiek</a></li>
    
</ul>

            </div>
            <div class="footer-col footer-col-3">
                
            </div>
        </div>
        
        
        This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
    </div>
</footer>

    </body>
</html>
